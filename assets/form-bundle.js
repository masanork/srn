var PJ=Object.create;var{getPrototypeOf:FJ,defineProperty:c$,getOwnPropertyNames:kJ}=Object;var _J=Object.prototype.hasOwnProperty;var h$=($,q,J)=>{J=$!=null?PJ(FJ($)):{};let Q=q||!$||!$.__esModule?c$(J,"default",{value:$,enumerable:!0}):J;for(let G of kJ($))if(!_J.call(Q,G))c$(Q,G,{get:()=>$[G],enumerable:!0});return Q};var yJ=($,q)=>()=>(q||$((q={exports:{}}).exports,q),q.exports);var Y$=yJ((V1,vq)=>{vq.exports=function $(q){if(typeof q==="number"&&isNaN(q))throw new Error("NaN is not allowed");if(typeof q==="number"&&!isFinite(q))throw new Error("Infinity is not allowed");if(q===null||typeof q!=="object")return JSON.stringify(q);if(q.toJSON instanceof Function)return $(q.toJSON());if(Array.isArray(q))return`[${q.reduce((G,U,X)=>{return`${G}${X===0?"":","}${$(U===void 0||typeof U==="symbol"?null:U)}`},"")}]`;return`{${Object.keys(q).sort().reduce((Q,G)=>{if(q[G]===void 0||typeof q[G]==="symbol")return Q;let U=Q.length===0?"":",";return`${Q}${U}${$(G)}:${$(q[G])}`},"")}}`}});class i0{runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let q=$.dataset.copyFrom;if(q){let G=($.closest("tr")||document).querySelector(`[data-base-key="${q}"], [data-json-path="${q}"]`);if(G&&G.value!==$.value)$.value=G.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let q=$.dataset.formula;if(!q)return;let J=$.closest("tr"),Q=$.closest("table"),G=(X)=>{let Y=0,N="none";if(J){let O=`[data-base-key="${X}"], [data-json-path="${X}"]`,K=J.querySelector(O);if(K){if(N="row-input",K.value!=="")Y=parseFloat(K.value)}}if(N==="none"){let O=document.querySelector(`[data-json-path="${X}"]`);if(O){if(N="static-input",O.value!=="")Y=parseFloat(O.value)}}return Y},U=q.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(X,Y)=>{let N=0,O=Q||document,K=O.querySelectorAll(`[data-base-key="${Y}"], [data-json-path="${Y}"]`);if(K.length===0&&O!==document)K=document.querySelectorAll(`[data-base-key="${Y}"], [data-json-path="${Y}"]`);return K.forEach((W)=>{let D=parseFloat(W.value);if(!isNaN(D))N+=D}),N});U=U.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(X)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(X))return X;return String(G(X))});try{let X=new Function("return "+U)();if(typeof X==="number"&&!isNaN(X))$.value=Number.isInteger(X)?X:X.toFixed(0);else $.value=""}catch(X){console.error("Calc Error:",X),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function O0($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function T8($,q=""){if(!Number.isSafeInteger($)||$<0){let J=q&&`"${q}" `;throw new Error(`${J}expected integer >= 0, got ${$}`)}}function u($,q,J=""){let Q=O0($),G=$?.length,U=q!==void 0;if(!Q||U&&G!==q){let X=J&&`"${J}" `,Y=U?` of length ${q}`:"",N=Q?`length=${G}`:`type=${typeof $}`;throw new Error(X+"expected Uint8Array"+Y+", got "+N)}return $}function t8($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");T8($.outputLen),T8($.blockLen)}function l8($,q=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(q&&$.finished)throw new Error("Hash#digest() has already been called")}function l$($,q){u($,void 0,"digestInto() output");let J=q.outputLen;if($.length<J)throw new Error('"digestInto() output" expected to be of length >='+J)}function E8(...$){for(let q=0;q<$.length;q++)$[q].fill(0)}function L0($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function H8($,q){return $<<32-q|$>>>q}var u$=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),SJ=Array.from({length:256},($,q)=>q.toString(16).padStart(2,"0"));function u8($){if(u($),u$)return $.toHex();let q="";for(let J=0;J<$.length;J++)q+=SJ[$[J]];return q}var I8={_0:48,_9:57,A:65,F:70,a:97,f:102};function p$($){if($>=I8._0&&$<=I8._9)return $-I8._0;if($>=I8.A&&$<=I8.F)return $-(I8.A-10);if($>=I8.a&&$<=I8.f)return $-(I8.a-10);return}function e8($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(u$)return Uint8Array.fromHex($);let q=$.length,J=q/2;if(q%2)throw new Error("hex string expected, got unpadded hex of length "+q);let Q=new Uint8Array(J);for(let G=0,U=0;G<J;G++,U+=2){let X=p$($.charCodeAt(U)),Y=p$($.charCodeAt(U+1));if(X===void 0||Y===void 0){let N=$[U]+$[U+1];throw new Error('hex string expected, got non-hex character "'+N+'" at index '+U)}Q[G]=X*16+Y}return Q}function $0(...$){let q=0;for(let Q=0;Q<$.length;Q++){let G=$[Q];u(G),q+=G.length}let J=new Uint8Array(q);for(let Q=0,G=0;Q<$.length;Q++){let U=$[Q];J.set(U,G),G+=U.length}return J}function r0($,q={}){let J=(G,U)=>$(U).update(G).digest(),Q=$(void 0);return J.outputLen=Q.outputLen,J.blockLen=Q.blockLen,J.create=(G)=>$(G),Object.assign(J,q),Object.freeze(J)}function q0($=32){let q=typeof globalThis==="object"?globalThis.crypto:null;if(typeof q?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return q.getRandomValues(new Uint8Array($))}var o0=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function d$($,q,J){return $&q^~$&J}function n$($,q,J){return $&q^$&J^q&J}class W0{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,q,J,Q){this.blockLen=$,this.outputLen=q,this.padOffset=J,this.isLE=Q,this.buffer=new Uint8Array($),this.view=L0(this.buffer)}update($){l8(this),u($);let{view:q,buffer:J,blockLen:Q}=this,G=$.length;for(let U=0;U<G;){let X=Math.min(Q-this.pos,G-U);if(X===Q){let Y=L0($);for(;Q<=G-U;U+=Q)this.process(Y,U);continue}if(J.set($.subarray(U,U+X),this.pos),this.pos+=X,U+=X,this.pos===Q)this.process(q,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){l8(this),l$($,this),this.finished=!0;let{buffer:q,view:J,blockLen:Q,isLE:G}=this,{pos:U}=this;if(q[U++]=128,E8(this.buffer.subarray(U)),this.padOffset>Q-U)this.process(J,0),U=0;for(let K=U;K<Q;K++)q[K]=0;J.setBigUint64(Q-8,BigInt(this.length*8),G),this.process(J,0);let X=L0($),Y=this.outputLen;if(Y%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let N=Y/4,O=this.get();if(N>O.length)throw new Error("_sha2: outputLen bigger than state");for(let K=0;K<N;K++)X.setUint32(4*K,O[K],G)}digest(){let{buffer:$,outputLen:q}=this;this.digestInto($);let J=$.slice(0,q);return this.destroy(),J}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:q,buffer:J,length:Q,finished:G,destroyed:U,pos:X}=this;if($.destroyed=U,$.finished=G,$.length=Q,$.pos=X,Q%q)$.buffer.set(J);return $}clone(){return this._cloneInto()}}var f8=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),A8=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),q8=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J8=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var C0=BigInt(4294967295),i$=BigInt(32);function vJ($,q=!1){if(q)return{h:Number($&C0),l:Number($>>i$&C0)};return{h:Number($>>i$&C0)|0,l:Number($&C0)|0}}function r$($,q=!1){let J=$.length,Q=new Uint32Array(J),G=new Uint32Array(J);for(let U=0;U<J;U++){let{h:X,l:Y}=vJ($[U],q);[Q[U],G[U]]=[X,Y]}return[Q,G]}var a0=($,q,J)=>$>>>J,s0=($,q,J)=>$<<32-J|q>>>J,v8=($,q,J)=>$>>>J|q<<32-J,g8=($,q,J)=>$<<32-J|q>>>J,J0=($,q,J)=>$<<64-J|q>>>J-32,Q0=($,q,J)=>$>>>J-32|q<<64-J;function z8($,q,J,Q){let G=(q>>>0)+(Q>>>0);return{h:$+J+(G/4294967296|0)|0,l:G|0}}var o$=($,q,J)=>($>>>0)+(q>>>0)+(J>>>0),a$=($,q,J,Q)=>q+J+Q+($/4294967296|0)|0,s$=($,q,J,Q)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0),t$=($,q,J,Q,G)=>q+J+Q+G+($/4294967296|0)|0,e$=($,q,J,Q,G)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0)+(G>>>0),$q=($,q,J,Q,G,U)=>q+J+Q+G+U+($/4294967296|0)|0;var mJ=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),x8=new Uint32Array(64);class t0 extends W0{constructor($){super(64,$,8,!1)}get(){let{A:$,B:q,C:J,D:Q,E:G,F:U,G:X,H:Y}=this;return[$,q,J,Q,G,U,X,Y]}set($,q,J,Q,G,U,X,Y){this.A=$|0,this.B=q|0,this.C=J|0,this.D=Q|0,this.E=G|0,this.F=U|0,this.G=X|0,this.H=Y|0}process($,q){for(let K=0;K<16;K++,q+=4)x8[K]=$.getUint32(q,!1);for(let K=16;K<64;K++){let W=x8[K-15],D=x8[K-2],A=H8(W,7)^H8(W,18)^W>>>3,B=H8(D,17)^H8(D,19)^D>>>10;x8[K]=B+x8[K-7]+A+x8[K-16]|0}let{A:J,B:Q,C:G,D:U,E:X,F:Y,G:N,H:O}=this;for(let K=0;K<64;K++){let W=H8(X,6)^H8(X,11)^H8(X,25),D=O+W+d$(X,Y,N)+mJ[K]+x8[K]|0,B=(H8(J,2)^H8(J,13)^H8(J,22))+n$(J,Q,G)|0;O=N,N=Y,Y=X,X=U+D|0,U=G,G=Q,Q=J,J=D+B|0}J=J+this.A|0,Q=Q+this.B|0,G=G+this.C|0,U=U+this.D|0,X=X+this.E|0,Y=Y+this.F|0,N=N+this.G|0,O=O+this.H|0,this.set(J,Q,G,U,X,Y,N,O)}roundClean(){E8(x8)}destroy(){this.set(0,0,0,0,0,0,0,0),E8(this.buffer)}}class qq extends t0{A=f8[0]|0;B=f8[1]|0;C=f8[2]|0;D=f8[3]|0;E=f8[4]|0;F=f8[5]|0;G=f8[6]|0;H=f8[7]|0;constructor(){super(32)}}class bJ extends t0{A=A8[0]|0;B=A8[1]|0;C=A8[2]|0;D=A8[3]|0;E=A8[4]|0;F=A8[5]|0;G=A8[6]|0;H=A8[7]|0;constructor(){super(28)}}var Jq=(()=>r$(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),cJ=(()=>Jq[0])(),hJ=(()=>Jq[1])(),P8=new Uint32Array(80),F8=new Uint32Array(80);class G0 extends W0{constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:q,Bh:J,Bl:Q,Ch:G,Cl:U,Dh:X,Dl:Y,Eh:N,El:O,Fh:K,Fl:W,Gh:D,Gl:A,Hh:B,Hl:x}=this;return[$,q,J,Q,G,U,X,Y,N,O,K,W,D,A,B,x]}set($,q,J,Q,G,U,X,Y,N,O,K,W,D,A,B,x){this.Ah=$|0,this.Al=q|0,this.Bh=J|0,this.Bl=Q|0,this.Ch=G|0,this.Cl=U|0,this.Dh=X|0,this.Dl=Y|0,this.Eh=N|0,this.El=O|0,this.Fh=K|0,this.Fl=W|0,this.Gh=D|0,this.Gl=A|0,this.Hh=B|0,this.Hl=x|0}process($,q){for(let I=0;I<16;I++,q+=4)P8[I]=$.getUint32(q),F8[I]=$.getUint32(q+=4);for(let I=16;I<80;I++){let R=P8[I-15]|0,g=F8[I-15]|0,m=v8(R,g,1)^v8(R,g,8)^a0(R,g,7),l=g8(R,g,1)^g8(R,g,8)^s0(R,g,7),b=P8[I-2]|0,j=F8[I-2]|0,F=v8(b,j,19)^J0(b,j,61)^a0(b,j,6),S=g8(b,j,19)^Q0(b,j,61)^s0(b,j,6),p=s$(l,S,F8[I-7],F8[I-16]),d=t$(p,m,F,P8[I-7],P8[I-16]);P8[I]=d|0,F8[I]=p|0}let{Ah:J,Al:Q,Bh:G,Bl:U,Ch:X,Cl:Y,Dh:N,Dl:O,Eh:K,El:W,Fh:D,Fl:A,Gh:B,Gl:x,Hh:E,Hl:f}=this;for(let I=0;I<80;I++){let R=v8(K,W,14)^v8(K,W,18)^J0(K,W,41),g=g8(K,W,14)^g8(K,W,18)^Q0(K,W,41),m=K&D^~K&B,l=W&A^~W&x,b=e$(f,g,l,hJ[I],F8[I]),j=$q(b,E,R,m,cJ[I],P8[I]),F=b|0,S=v8(J,Q,28)^J0(J,Q,34)^J0(J,Q,39),p=g8(J,Q,28)^Q0(J,Q,34)^Q0(J,Q,39),d=J&G^J&X^G&X,M=Q&U^Q&Y^U&Y;E=B|0,f=x|0,B=D|0,x=A|0,D=K|0,A=W|0,{h:K,l:W}=z8(N|0,O|0,j|0,F|0),N=X|0,O=Y|0,X=G|0,Y=U|0,G=J|0,U=Q|0;let z=o$(F,p,M);J=a$(z,j,S,d),Q=z|0}({h:J,l:Q}=z8(this.Ah|0,this.Al|0,J|0,Q|0)),{h:G,l:U}=z8(this.Bh|0,this.Bl|0,G|0,U|0),{h:X,l:Y}=z8(this.Ch|0,this.Cl|0,X|0,Y|0),{h:N,l:O}=z8(this.Dh|0,this.Dl|0,N|0,O|0),{h:K,l:W}=z8(this.Eh|0,this.El|0,K|0,W|0),{h:D,l:A}=z8(this.Fh|0,this.Fl|0,D|0,A|0),{h:B,l:x}=z8(this.Gh|0,this.Gl|0,B|0,x|0),{h:E,l:f}=z8(this.Hh|0,this.Hl|0,E|0,f|0),this.set(J,Q,G,U,X,Y,N,O,K,W,D,A,B,x,E,f)}roundClean(){E8(P8,F8)}destroy(){E8(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Qq extends G0{Ah=J8[0]|0;Al=J8[1]|0;Bh=J8[2]|0;Bl=J8[3]|0;Ch=J8[4]|0;Cl=J8[5]|0;Dh=J8[6]|0;Dl=J8[7]|0;Eh=J8[8]|0;El=J8[9]|0;Fh=J8[10]|0;Fl=J8[11]|0;Gh=J8[12]|0;Gl=J8[13]|0;Hh=J8[14]|0;Hl=J8[15]|0;constructor(){super(64)}}class pJ extends G0{Ah=q8[0]|0;Al=q8[1]|0;Bh=q8[2]|0;Bl=q8[3]|0;Ch=q8[4]|0;Cl=q8[5]|0;Dh=q8[6]|0;Dl=q8[7]|0;Eh=q8[8]|0;El=q8[9]|0;Fh=q8[10]|0;Fl=q8[11]|0;Gh=q8[12]|0;Gl=q8[13]|0;Hh=q8[14]|0;Hl=q8[15]|0;constructor(){super(48)}}var Q8=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),G8=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class lJ extends G0{Ah=Q8[0]|0;Al=Q8[1]|0;Bh=Q8[2]|0;Bl=Q8[3]|0;Ch=Q8[4]|0;Cl=Q8[5]|0;Dh=Q8[6]|0;Dl=Q8[7]|0;Eh=Q8[8]|0;El=Q8[9]|0;Fh=Q8[10]|0;Fl=Q8[11]|0;Gh=Q8[12]|0;Gl=Q8[13]|0;Hh=Q8[14]|0;Hl=Q8[15]|0;constructor(){super(28)}}class uJ extends G0{Ah=G8[0]|0;Al=G8[1]|0;Bh=G8[2]|0;Bl=G8[3]|0;Ch=G8[4]|0;Cl=G8[5]|0;Dh=G8[6]|0;Dl=G8[7]|0;Eh=G8[8]|0;El=G8[9]|0;Fh=G8[10]|0;Fl=G8[11]|0;Gh=G8[12]|0;Gl=G8[13]|0;Hh=G8[14]|0;Hl=G8[15]|0;constructor(){super(32)}}var Z8=r0(()=>new qq,o0(1));var Gq=r0(()=>new Qq,o0(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Xq=BigInt(0),Uq=BigInt(1);function H0($,q=""){if(typeof $!=="boolean"){let J=q&&`"${q}" `;throw new Error(J+"expected boolean, got type="+typeof $)}return $}function dJ($){if(typeof $==="bigint"){if(!E0($))throw new Error("positive bigint expected, got "+$)}else T8($);return $}function Nq($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?Xq:BigInt("0x"+$)}function Yq($){return Nq(u8($))}function j8($){return Nq(u8(m8(u($)).reverse()))}function e0($,q){T8(q),$=dJ($);let J=e8($.toString(16).padStart(q*2,"0"));if(J.length!==q)throw new Error("number too large");return J}function T0($,q){return e0($,q).reverse()}function m8($){return Uint8Array.from($)}var E0=($)=>typeof $==="bigint"&&Xq<=$;function nJ($,q,J){return E0($)&&E0(q)&&E0(J)&&q<=$&&$<J}function d8($,q,J,Q){if(!nJ(q,J,Q))throw new Error("expected valid "+$+": "+J+" <= n < "+Q+", got "+q)}var Zq=($)=>(Uq<<BigInt($))-Uq;function b8($,q={},J={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function Q(U,X,Y){let N=$[U];if(Y&&N===void 0)return;let O=typeof N;if(O!==X||N===null)throw new Error(`param "${U}" is invalid: expected ${X}, got ${O}`)}let G=(U,X)=>Object.entries(U).forEach(([Y,N])=>Q(Y,N,X));G(q,!1),G(J,!0)}function $$($){let q=new WeakMap;return(J,...Q)=>{let G=q.get(J);if(G!==void 0)return G;let U=$(J,...Q);return q.set(J,U),U}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var X8=BigInt(0),U8=BigInt(1),c8=BigInt(2),Oq=BigInt(3),Lq=BigInt(4),Wq=BigInt(5),iJ=BigInt(7),Cq=BigInt(8),rJ=BigInt(9),Eq=BigInt(16);function i($,q){let J=$%q;return J>=X8?J:q+J}function L8($,q,J){let Q=$;while(q-- >X8)Q*=Q,Q%=J;return Q}function Kq($,q){if($===X8)throw new Error("invert: expected non-zero number");if(q<=X8)throw new Error("invert: expected positive modulus, got "+q);let J=i($,q),Q=q,G=X8,U=U8,X=U8,Y=X8;while(J!==X8){let O=Q/J,K=Q%J,W=G-X*O,D=U-Y*O;Q=J,J=K,G=X,U=Y,X=W,Y=D}if(Q!==U8)throw new Error("invert: does not exist");return i(G,q)}function q$($,q,J){if(!$.eql($.sqr(q),J))throw new Error("Cannot find square root")}function Hq($,q){let J=($.ORDER+U8)/Lq,Q=$.pow(q,J);return q$($,Q,q),Q}function oJ($,q){let J=($.ORDER-Wq)/Cq,Q=$.mul(q,c8),G=$.pow(Q,J),U=$.mul(q,G),X=$.mul($.mul(U,c8),G),Y=$.mul(U,$.sub(X,$.ONE));return q$($,Y,q),Y}function aJ($){let q=D0($),J=Tq($),Q=J(q,q.neg(q.ONE)),G=J(q,Q),U=J(q,q.neg(Q)),X=($+iJ)/Eq;return(Y,N)=>{let O=Y.pow(N,X),K=Y.mul(O,Q),W=Y.mul(O,G),D=Y.mul(O,U),A=Y.eql(Y.sqr(K),N),B=Y.eql(Y.sqr(W),N);O=Y.cmov(O,K,A),K=Y.cmov(D,W,B);let x=Y.eql(Y.sqr(K),N),E=Y.cmov(O,K,x);return q$(Y,E,N),E}}function Tq($){if($<Oq)throw new Error("sqrt is not defined for small field");let q=$-U8,J=0;while(q%c8===X8)q/=c8,J++;let Q=c8,G=D0($);while(Mq(G,Q)===1)if(Q++>1000)throw new Error("Cannot find square root: probably non-prime P");if(J===1)return Hq;let U=G.pow(Q,q),X=(q+U8)/c8;return function Y(N,O){if(N.is0(O))return O;if(Mq(N,O)!==1)throw new Error("Cannot find square root");let K=J,W=N.mul(N.ONE,U),D=N.pow(O,q),A=N.pow(O,X);while(!N.eql(D,N.ONE)){if(N.is0(D))return N.ZERO;let B=1,x=N.sqr(D);while(!N.eql(x,N.ONE))if(B++,x=N.sqr(x),B===K)throw new Error("Cannot find square root");let E=U8<<BigInt(K-B-1),f=N.pow(W,E);K=B,W=N.sqr(f),D=N.mul(D,W),A=N.mul(A,f)}return A}}function sJ($){if($%Lq===Oq)return Hq;if($%Cq===Wq)return oJ;if($%Eq===rJ)return aJ($);return Tq($)}var zq=($,q)=>(i($,q)&U8)===U8,tJ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Dq($){let q={ORDER:"bigint",BYTES:"number",BITS:"number"},J=tJ.reduce((Q,G)=>{return Q[G]="function",Q},q);return b8($,J),$}function eJ($,q,J){if(J<X8)throw new Error("invalid exponent, negatives unsupported");if(J===X8)return $.ONE;if(J===U8)return q;let Q=$.ONE,G=q;while(J>X8){if(J&U8)Q=$.mul(Q,G);G=$.sqr(G),J>>=U8}return Q}function z0($,q,J=!1){let Q=new Array(q.length).fill(J?$.ZERO:void 0),G=q.reduce((X,Y,N)=>{if($.is0(Y))return X;return Q[N]=X,$.mul(X,Y)},$.ONE),U=$.inv(G);return q.reduceRight((X,Y,N)=>{if($.is0(Y))return X;return Q[N]=$.mul(X,Q[N]),$.mul(X,Y)},U),Q}function Mq($,q){let J=($.ORDER-U8)/c8,Q=$.pow(q,J),G=$.eql(Q,$.ONE),U=$.eql(Q,$.ZERO),X=$.eql(Q,$.neg($.ONE));if(!G&&!U&&!X)throw new Error("invalid Legendre symbol result");return G?1:U?0:-1}function $Q($,q){if(q!==void 0)T8(q);let J=q!==void 0?q:$.toString(2).length,Q=Math.ceil(J/8);return{nBitLength:J,nByteLength:Q}}class wq{ORDER;BITS;BYTES;isLE;ZERO=X8;ONE=U8;_lengths;_sqrt;_mod;constructor($,q={}){if($<=X8)throw new Error("invalid field: expected ORDER > 0, got "+$);let J=void 0;if(this.isLE=!1,q!=null&&typeof q==="object"){if(typeof q.BITS==="number")J=q.BITS;if(typeof q.sqrt==="function")this.sqrt=q.sqrt;if(typeof q.isLE==="boolean")this.isLE=q.isLE;if(q.allowedLengths)this._lengths=q.allowedLengths?.slice();if(typeof q.modFromBytes==="boolean")this._mod=q.modFromBytes}let{nBitLength:Q,nByteLength:G}=$Q($,J);if(G>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=Q,this.BYTES=G,this._sqrt=void 0,Object.preventExtensions(this)}create($){return i($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return X8<=$&&$<this.ORDER}is0($){return $===X8}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&U8)===U8}neg($){return i(-$,this.ORDER)}eql($,q){return $===q}sqr($){return i($*$,this.ORDER)}add($,q){return i($+q,this.ORDER)}sub($,q){return i($-q,this.ORDER)}mul($,q){return i($*q,this.ORDER)}pow($,q){return eJ(this,$,q)}div($,q){return i($*Kq(q,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,q){return $+q}subN($,q){return $-q}mulN($,q){return $*q}inv($){return Kq($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=sJ(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?T0($,this.BYTES):e0($,this.BYTES)}fromBytes($,q=!1){u($);let{_lengths:J,BYTES:Q,isLE:G,ORDER:U,_mod:X}=this;if(J){if(!J.includes($.length)||$.length>Q)throw new Error("Field.fromBytes: expected "+J+" bytes, got "+$.length);let N=new Uint8Array(Q);N.set($,G?0:N.length-$.length),$=N}if($.length!==Q)throw new Error("Field.fromBytes: expected "+Q+" bytes, got "+$.length);let Y=G?j8($):Yq($);if(X)Y=i(Y,U);if(!q){if(!this.isValid(Y))throw new Error("invalid field element: outside of range 0..ORDER")}return Y}invertBatch($){return z0(this,$)}cmov($,q,J){return J?q:$}}function D0($,q={}){return new wq($,q)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var w0=BigInt(0),U$=BigInt(1);function Rq($,q){let J=q.negate();return $?J:q}function R0($,q){let J=z0($.Fp,q.map((Q)=>Q.Z));return q.map((Q,G)=>$.fromAffine(Q.toAffine(J[G])))}function Aq($,q){if(!Number.isSafeInteger($)||$<=0||$>q)throw new Error("invalid window size, expected [1.."+q+"], got W="+$)}function J$($,q){Aq($,q);let J=Math.ceil(q/$)+1,Q=2**($-1),G=2**$,U=Zq($),X=BigInt($);return{windows:J,windowSize:Q,mask:U,maxNumber:G,shiftBy:X}}function Bq($,q,J){let{windowSize:Q,mask:G,maxNumber:U,shiftBy:X}=J,Y=Number($&G),N=$>>X;if(Y>Q)Y-=U,N+=U$;let O=q*Q,K=O+Math.abs(Y)-1,W=Y===0,D=Y<0,A=q%2!==0;return{nextN:N,offset:K,isZero:W,isNeg:D,isNegF:A,offsetF:O}}var Q$=new WeakMap,jq=new WeakMap;function G$($){return jq.get($)||1}function Iq($){if($!==w0)throw new Error("invalid wNAF")}class X${BASE;ZERO;Fn;bits;constructor($,q){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=q}_unsafeLadder($,q,J=this.ZERO){let Q=$;while(q>w0){if(q&U$)J=J.add(Q);Q=Q.double(),q>>=U$}return J}precomputeWindow($,q){let{windows:J,windowSize:Q}=J$(q,this.bits),G=[],U=$,X=U;for(let Y=0;Y<J;Y++){X=U,G.push(X);for(let N=1;N<Q;N++)X=X.add(U),G.push(X);U=X.double()}return G}wNAF($,q,J){if(!this.Fn.isValid(J))throw new Error("invalid scalar");let Q=this.ZERO,G=this.BASE,U=J$($,this.bits);for(let X=0;X<U.windows;X++){let{nextN:Y,offset:N,isZero:O,isNeg:K,isNegF:W,offsetF:D}=Bq(J,X,U);if(J=Y,O)G=G.add(Rq(W,q[D]));else Q=Q.add(Rq(K,q[N]))}return Iq(J),{p:Q,f:G}}wNAFUnsafe($,q,J,Q=this.ZERO){let G=J$($,this.bits);for(let U=0;U<G.windows;U++){if(J===w0)break;let{nextN:X,offset:Y,isZero:N,isNeg:O}=Bq(J,U,G);if(J=X,N)continue;else{let K=q[Y];Q=Q.add(O?K.negate():K)}}return Iq(J),Q}getPrecomputes($,q,J){let Q=Q$.get(q);if(!Q){if(Q=this.precomputeWindow(q,$),$!==1){if(typeof J==="function")Q=J(Q);Q$.set(q,Q)}}return Q}cached($,q,J){let Q=G$($);return this.wNAF(Q,this.getPrecomputes(Q,$,J),q)}unsafe($,q,J,Q){let G=G$($);if(G===1)return this._unsafeLadder($,q,Q);return this.wNAFUnsafe(G,this.getPrecomputes(G,$,J),q,Q)}createCache($,q){Aq(q,this.bits),jq.set($,q),Q$.delete($)}hasCache($){return G$($)!==1}}function fq($,q,J){if(q){if(q.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Dq(q),q}else return D0($,{isLE:J})}function Vq($,q,J={},Q){if(Q===void 0)Q=$==="edwards";if(!q||typeof q!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let N of["p","n","h"]){let O=q[N];if(!(typeof O==="bigint"&&O>w0))throw new Error(`CURVE.${N} must be positive bigint`)}let G=fq(q.p,J.Fp,Q),U=fq(q.n,J.Fn,Q),Y=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let N of Y)if(!G.isValid(q[N]))throw new Error(`CURVE.${N} must be valid field element of CURVE.Fp`);return q=Object.freeze(Object.assign({},q)),{CURVE:q,Fp:G,Fn:U}}function B0($,q){return function J(Q){let G=$(Q);return{secretKey:G,publicKey:q(G)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var k8=BigInt(0),t=BigInt(1),N$=BigInt(2),qQ=BigInt(8);function JQ($,q,J,Q){let G=$.sqr(J),U=$.sqr(Q),X=$.add($.mul(q.a,G),U),Y=$.add($.ONE,$.mul(q.d,$.mul(G,U)));return $.eql(X,Y)}function xq($,q={}){let J=Vq("edwards",$,q,q.FpFnLE),{Fp:Q,Fn:G}=J,U=J.CURVE,{h:X}=U;b8(q,{},{uvRatio:"function"});let Y=N$<<BigInt(G.BYTES*8)-t,N=(E)=>Q.create(E),O=q.uvRatio||((E,f)=>{try{return{isValid:!0,value:Q.sqrt(Q.div(E,f))}}catch(I){return{isValid:!1,value:k8}}});if(!JQ(Q,U,U.Gx,U.Gy))throw new Error("bad curve params: generator point");function K(E,f,I=!1){let R=I?t:k8;return d8("coordinate "+E,f,R,Y),f}function W(E){if(!(E instanceof B))throw new Error("EdwardsPoint expected")}let D=$$((E,f)=>{let{X:I,Y:R,Z:g}=E,m=E.is0();if(f==null)f=m?qQ:Q.inv(g);let l=N(I*f),b=N(R*f),j=Q.mul(g,f);if(m)return{x:k8,y:t};if(j!==t)throw new Error("invZ was invalid");return{x:l,y:b}}),A=$$((E)=>{let{a:f,d:I}=U;if(E.is0())throw new Error("bad point: ZERO");let{X:R,Y:g,Z:m,T:l}=E,b=N(R*R),j=N(g*g),F=N(m*m),S=N(F*F),p=N(b*f),d=N(F*N(p+j)),M=N(S+N(I*N(b*j)));if(d!==M)throw new Error("bad point: equation left != right (1)");let z=N(R*g),C=N(m*l);if(z!==C)throw new Error("bad point: equation left != right (2)");return!0});class B{static BASE=new B(U.Gx,U.Gy,t,N(U.Gx*U.Gy));static ZERO=new B(k8,t,t,k8);static Fp=Q;static Fn=G;X;Y;Z;T;constructor(E,f,I,R){this.X=K("x",E),this.Y=K("y",f),this.Z=K("z",I,!0),this.T=K("t",R),Object.freeze(this)}static CURVE(){return U}static fromAffine(E){if(E instanceof B)throw new Error("extended point not allowed");let{x:f,y:I}=E||{};return K("x",f),K("y",I),new B(f,I,t,N(f*I))}static fromBytes(E,f=!1){let I=Q.BYTES,{a:R,d:g}=U;E=m8(u(E,I,"point")),H0(f,"zip215");let m=m8(E),l=E[I-1];m[I-1]=l&-129;let b=j8(m),j=f?Y:Q.ORDER;d8("point.y",b,k8,j);let F=N(b*b),S=N(F-t),p=N(g*F-R),{isValid:d,value:M}=O(S,p);if(!d)throw new Error("bad point: invalid y coordinate");let z=(M&t)===t,C=(l&128)!==0;if(!f&&M===k8&&C)throw new Error("bad point: x=0 and x_0=1");if(C!==z)M=N(-M);return B.fromAffine({x:M,y:b})}static fromHex(E,f=!1){return B.fromBytes(e8(E),f)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(E=8,f=!0){if(x.createCache(this,E),!f)this.multiply(N$);return this}assertValidity(){A(this)}equals(E){W(E);let{X:f,Y:I,Z:R}=this,{X:g,Y:m,Z:l}=E,b=N(f*l),j=N(g*R),F=N(I*l),S=N(m*R);return b===j&&F===S}is0(){return this.equals(B.ZERO)}negate(){return new B(N(-this.X),this.Y,this.Z,N(-this.T))}double(){let{a:E}=U,{X:f,Y:I,Z:R}=this,g=N(f*f),m=N(I*I),l=N(N$*N(R*R)),b=N(E*g),j=f+I,F=N(N(j*j)-g-m),S=b+m,p=S-l,d=b-m,M=N(F*p),z=N(S*d),C=N(F*d),T=N(p*S);return new B(M,z,T,C)}add(E){W(E);let{a:f,d:I}=U,{X:R,Y:g,Z:m,T:l}=this,{X:b,Y:j,Z:F,T:S}=E,p=N(R*b),d=N(g*j),M=N(l*I*S),z=N(m*F),C=N((R+g)*(b+j)-p-d),T=z-M,w=z+M,V=N(d-f*p),k=N(C*T),_=N(w*V),y=N(C*V),v=N(T*w);return new B(k,_,v,y)}subtract(E){return this.add(E.negate())}multiply(E){if(!G.isValidNot0(E))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:f,f:I}=x.cached(this,E,(R)=>R0(B,R));return R0(B,[f,I])[0]}multiplyUnsafe(E,f=B.ZERO){if(!G.isValid(E))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(E===k8)return B.ZERO;if(this.is0()||E===t)return this;return x.unsafe(this,E,(I)=>R0(B,I),f)}isSmallOrder(){return this.multiplyUnsafe(X).is0()}isTorsionFree(){return x.unsafe(this,U.n).is0()}toAffine(E){return D(this,E)}clearCofactor(){if(X===t)return this;return this.multiplyUnsafe(X)}toBytes(){let{x:E,y:f}=this.toAffine(),I=Q.toBytes(f);return I[I.length-1]|=E&t?128:0,I}toHex(){return u8(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let x=new X$(B,G.BITS);return B.BASE.precompute(8),B}function Pq($,q,J={}){if(typeof q!=="function")throw new Error('"hash" function param is required');b8(J,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:Q}=J,{BASE:G,Fp:U,Fn:X}=$,Y=J.randomBytes||q0,N=J.adjustScalarBytes||((j)=>j),O=J.domain||((j,F,S)=>{if(H0(S,"phflag"),F.length||S)throw new Error("Contexts/pre-hash are not supported");return j});function K(j){return X.create(j8(j))}function W(j){let F=R.secretKey;u(j,R.secretKey,"secretKey");let S=u(q(j),2*F,"hashedSecretKey"),p=N(S.slice(0,F)),d=S.slice(F,2*F),M=K(p);return{head:p,prefix:d,scalar:M}}function D(j){let{head:F,prefix:S,scalar:p}=W(j),d=G.multiply(p),M=d.toBytes();return{head:F,prefix:S,scalar:p,point:d,pointBytes:M}}function A(j){return D(j).pointBytes}function B(j=Uint8Array.of(),...F){let S=$0(...F);return K(q(O(S,u(j,void 0,"context"),!!Q)))}function x(j,F,S={}){if(j=u(j,void 0,"message"),Q)j=Q(j);let{prefix:p,scalar:d,pointBytes:M}=D(F),z=B(S.context,p,j),C=G.multiply(z).toBytes(),T=B(S.context,C,M,j),w=X.create(z+T*d);if(!X.isValid(w))throw new Error("sign failed: invalid s");let V=$0(C,X.toBytes(w));return u(V,R.signature,"result")}let E={zip215:!0};function f(j,F,S,p=E){let{context:d,zip215:M}=p,z=R.signature;if(j=u(j,z,"signature"),F=u(F,void 0,"message"),S=u(S,R.publicKey,"publicKey"),M!==void 0)H0(M,"zip215");if(Q)F=Q(F);let C=z/2,T=j.subarray(0,C),w=j8(j.subarray(C,z)),V,k,_;try{V=$.fromBytes(S,M),k=$.fromBytes(T,M),_=G.multiplyUnsafe(w)}catch(s8){return!1}if(!M&&V.isSmallOrder())return!1;let y=B(d,k.toBytes(),V.toBytes(),F);return k.add(V.multiplyUnsafe(y)).subtract(_).clearCofactor().is0()}let I=U.BYTES,R={secretKey:I,publicKey:I,signature:2*I,seed:I};function g(j=Y(R.seed)){return u(j,R.seed,"seed")}function m(j){return O0(j)&&j.length===X.BYTES}function l(j,F){try{return!!$.fromBytes(j,F)}catch(S){return!1}}let b={getExtendedPublicKey:D,randomSecretKey:g,isValidSecretKey:m,isValidPublicKey:l,toMontgomery(j){let{y:F}=$.fromBytes(j),S=R.publicKey,p=S===32;if(!p&&S!==57)throw new Error("only defined for 25519 and 448");let d=p?U.div(t+F,t-F):U.div(F-t,F+t);return U.toBytes(d)},toMontgomerySecret(j){let F=R.secretKey;u(j,F);let S=q(j.subarray(0,F));return N(S).subarray(0,F)}};return Object.freeze({keygen:B0(g,A),getPublicKey:A,sign:x,verify:f,utils:b,Point:$,lengths:R})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var U0=BigInt(0),n8=BigInt(1),I0=BigInt(2);function QQ($){return b8($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function Fq($){let q=QQ($),{P:J,type:Q,adjustScalarBytes:G,powPminus2:U,randomBytes:X}=q,Y=Q==="x25519";if(!Y&&Q!=="x448")throw new Error("invalid type");let N=X||q0,O=Y?255:448,K=Y?32:56,W=Y?BigInt(9):BigInt(5),D=Y?BigInt(121665):BigInt(39081),A=Y?I0**BigInt(254):I0**BigInt(447),B=Y?BigInt(8)*I0**BigInt(251)-n8:BigInt(4)*I0**BigInt(445)-n8,x=A+B+n8,E=(z)=>i(z,J),f=I(W);function I(z){return T0(E(z),K)}function R(z){let C=m8(u(z,K,"uCoordinate"));if(Y)C[31]&=127;return E(j8(C))}function g(z){return j8(G(m8(u(z,K,"scalar"))))}function m(z,C){let T=S(R(C),g(z));if(T===U0)throw new Error("invalid private or public key received");return I(T)}function l(z){return m(z,f)}let b=l,j=m;function F(z,C,T){let w=E(z*(C-T));return C=E(C-w),T=E(T+w),{x_2:C,x_3:T}}function S(z,C){d8("u",z,U0,J),d8("scalar",C,A,x);let T=C,w=z,V=n8,k=U0,_=z,y=n8,v=U0;for(let l0=BigInt(O-1);l0>=U0;l0--){let _$=T>>l0&n8;v^=_$,{x_2:V,x_3:_}=F(v,V,_),{x_2:k,x_3:y}=F(v,k,y),v=_$;let u0=V+k,d0=E(u0*u0),n0=V-k,y$=E(n0*n0),S$=d0-y$,VJ=_+y,xJ=_-y,v$=E(xJ*u0),g$=E(VJ*n0),m$=v$+g$,b$=v$-g$;_=E(m$*m$),y=E(w*E(b$*b$)),V=E(d0*y$),k=E(S$*(d0+E(D*S$)))}({x_2:V,x_3:_}=F(v,V,_)),{x_2:k,x_3:y}=F(v,k,y);let s8=U(k);return E(V*s8)}let p={secretKey:K,publicKey:K,seed:K},d=(z=N(K))=>{return u(z,p.seed,"seed"),z},M={randomSecretKey:d};return Object.freeze({keygen:B0(d,b),getSharedSecret:j,getPublicKey:b,scalarMult:m,scalarMultBase:l,utils:M,GuBytes:f.slice(),lengths:p})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var GQ=BigInt(1),kq=BigInt(2),UQ=BigInt(3),XQ=BigInt(5),NQ=BigInt(8),f0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),YQ=(()=>({p:f0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:NQ,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function yq($){let q=BigInt(10),J=BigInt(20),Q=BigInt(40),G=BigInt(80),U=f0,Y=$*$%U*$%U,N=L8(Y,kq,U)*Y%U,O=L8(N,GQ,U)*$%U,K=L8(O,XQ,U)*O%U,W=L8(K,q,U)*K%U,D=L8(W,J,U)*W%U,A=L8(D,Q,U)*D%U,B=L8(A,G,U)*A%U,x=L8(B,G,U)*A%U,E=L8(x,q,U)*K%U;return{pow_p_5_8:L8(E,kq,U)*$%U,b2:Y}}function Sq($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var _q=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function ZQ($,q){let J=f0,Q=i(q*q*q,J),G=i(Q*Q*q,J),U=yq($*G).pow_p_5_8,X=i($*Q*U,J),Y=i(q*X*X,J),N=X,O=i(X*_q,J),K=Y===$,W=Y===i(-$,J),D=Y===i(-$*_q,J);if(K)X=N;if(W||D)X=O;if(zq(X,J))X=i(-X,J);return{isValid:K||W,value:X}}var KQ=xq(YQ,{uvRatio:ZQ});function MQ($){return Pq(KQ,Gq,Object.assign({adjustScalarBytes:Sq},$))}var _8=MQ({});var A0=(()=>{let $=f0;return Fq({P:$,type:"x25519",powPminus2:(q)=>{let{pow_p_5_8:J,b2:Q}=yq(q);return i(L8(J,UQ,$)*Q,$)},adjustScalarBytes:Sq})})();var GJ=h$(Y$(),1);var Z$;try{Z$=new TextDecoder}catch($){}var P,p8,H=0;var hq=[],OQ=105,LQ=57342,WQ=57343,gq=57337;var mq=6,i8={},X0=112810000,V8=16810000;var K$=hq,M$=0,c={},r,x0,P0=0,Y0=0,a,W8,o=[],O$=[],Y8,N8,N0,bq={useRecords:!1,mapsAsObjects:!0},Z0=!1,pq=2;try{new Function("")}catch($){pq=1/0}class y8{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[q,J]of Object.entries($.keyMap))this.mapKey.set(J,q)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let q=new Map;for(let[J,Q]of Object.entries($))q.set(this._keyMap.hasOwnProperty(J)?this._keyMap[J]:J,Q);return q}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[J,Q]of Object.entries(this._keyMap))this._mapKey.set(Q,J)}let q={};return $.forEach((J,Q)=>q[C8(this._mapKey.has(Q)?this._mapKey.get(Q):Q)]=J),q}mapDecode($,q){let J=this.decode($);if(this._keyMap)switch(J.constructor.name){case"Array":return J.map((Q)=>this.decodeKeys(Q))}return J}decode($,q){if(P)return nq(()=>{return F0(),this?this.decode($,q):y8.prototype.decode.call(bq,$,q)});p8=q>-1?q:$.length,H=0,M$=0,Y0=0,x0=null,K$=hq,a=null,P=$;try{N8=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(J){if(P=null,$ instanceof Uint8Array)throw J;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof y8){if(c=this,Y8=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return r=this.structures,j0();else if(!r||r.length>0)r=[]}else{if(c=bq,!r||r.length>0)r=[];Y8=null}return j0()}decodeMultiple($,q){let J,Q=0;try{let G=$.length;Z0=!0;let U=this?this.decode($,G):T$.decode($,G);if(q){if(q(U)===!1)return;while(H<G)if(Q=H,q(j0())===!1)return}else{J=[U];while(H<G)Q=H,J.push(j0());return J}}catch(G){throw G.lastPosition=Q,G.values=J,G}finally{Z0=!1,F0()}}}function j0(){try{let $=h();if(a){if(H>=a.postBundlePosition){let q=new Error("Unexpected bundle position");throw q.incomplete=!0,q}H=a.postBundlePosition,a=null}if(H==p8){if(r=null,P=null,W8)W8=null}else if(H>p8){let q=new Error("Unexpected end of CBOR data");throw q.incomplete=!0,q}else if(!Z0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(F0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function h(){let $=P[H++],q=$>>5;if($=$&31,$>23)switch($){case 24:$=P[H++];break;case 25:if(q==7)return TQ();$=N8.getUint16(H),H+=2;break;case 26:if(q==7){let J=N8.getFloat32(H);if(c.useFloat32>2){let Q=k0[(P[H]&127)<<1|P[H+1]>>7];return H+=4,(Q*J+(J>0?0.5:-0.5)>>0)/Q}return H+=4,J}$=N8.getUint32(H),H+=4;break;case 27:if(q==7){let J=N8.getFloat64(H);return H+=8,J}if(q>1){if(N8.getUint32(H)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=N8.getUint32(H+4)}else if(c.int64AsNumber)$=N8.getUint32(H)*4294967296,$+=N8.getUint32(H+4);else $=N8.getBigUint64(H);H+=8;break;case 31:switch(q){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let J=[],Q,G=0;while((Q=h())!=i8){if(G>=X0)throw new Error(`Array length exceeds ${X0}`);J[G++]=Q}return q==4?J:q==3?J.join(""):Buffer.concat(J);case 5:let U;if(c.mapsAsObjects){let X={},Y=0;if(c.keyMap)while((U=h())!=i8){if(Y++>=V8)throw new Error(`Property count exceeds ${V8}`);X[C8(c.decodeKey(U))]=h()}else while((U=h())!=i8){if(Y++>=V8)throw new Error(`Property count exceeds ${V8}`);X[C8(U)]=h()}return X}else{if(N0)c.mapsAsObjects=!0,N0=!1;let X=new Map;if(c.keyMap){let Y=0;while((U=h())!=i8){if(Y++>=V8)throw new Error(`Map size exceeds ${V8}`);X.set(c.decodeKey(U),h())}}else{let Y=0;while((U=h())!=i8){if(Y++>=V8)throw new Error(`Map size exceeds ${V8}`);X.set(U,h())}}return X}case 7:return i8;default:throw new Error("Invalid major type for indefinite length "+q)}default:throw new Error("Unknown token "+$)}switch(q){case 0:return $;case 1:return~$;case 2:return HQ($);case 3:if(Y0>=H)return x0.slice(H-P0,(H+=$)-P0);if(Y0==0&&p8<140&&$<32){let G=$<16?lq($):EQ($);if(G!=null)return G}return CQ($);case 4:if($>=X0)throw new Error(`Array length exceeds ${X0}`);let J=new Array($);for(let G=0;G<$;G++)J[G]=h();return J;case 5:if($>=V8)throw new Error(`Map size exceeds ${X0}`);if(c.mapsAsObjects){let G={};if(c.keyMap)for(let U=0;U<$;U++)G[C8(c.decodeKey(h()))]=h();else for(let U=0;U<$;U++)G[C8(h())]=h();return G}else{if(N0)c.mapsAsObjects=!0,N0=!1;let G=new Map;if(c.keyMap)for(let U=0;U<$;U++)G.set(c.decodeKey(h()),h());else for(let U=0;U<$;U++)G.set(h(),h());return G}case 6:if($>=gq){let G=r[$&8191];if(G){if(!G.read)G.read=L$(G);return G.read()}if($<65536){if($==WQ){let U=o8(),X=h(),Y=h();C$(X,Y);let N={};if(c.keyMap)for(let O=2;O<U;O++){let K=c.decodeKey(Y[O-2]);N[C8(K)]=h()}else for(let O=2;O<U;O++){let K=Y[O-2];N[C8(K)]=h()}return N}else if($==LQ){let U=o8(),X=h();for(let Y=2;Y<U;Y++)C$(X++,h());return h()}else if($==gq)return IQ();if(c.getShared){if(H$(),G=r[$&8191],G){if(!G.read)G.read=L$(G);return G.read()}}}}let Q=o[$];if(Q)if(Q.handlesRead)return Q(h);else return Q(h());else{let G=h();for(let U=0;U<O$.length;U++){let X=O$[U]($,G);if(X!==void 0)return X}return new D8(G,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let G=(Y8||h8())[$];if(G!==void 0)return G;throw new Error("Unknown token "+$)}default:if(isNaN($)){let G=new Error("Unexpected end of CBOR data");throw G.incomplete=!0,G}throw new Error("Unknown CBOR token "+$)}}var cq=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function L$($){if(!$)throw new Error("Structure is required in record definition");function q(){let J=P[H++];if(J=J&31,J>23)switch(J){case 24:J=P[H++];break;case 25:J=N8.getUint16(H),H+=2;break;case 26:J=N8.getUint32(H),H+=4;break;default:throw new Error("Expected array header, but got "+P[H-1])}let Q=this.compiledReader;while(Q){if(Q.propertyCount===J)return Q(h);Q=Q.next}if(this.slowReads++>=pq){let U=this.length==J?this:this.slice(0,J);if(Q=c.keyMap?new Function("r","return {"+U.map((X)=>c.decodeKey(X)).map((X)=>cq.test(X)?C8(X)+":r()":"["+JSON.stringify(X)+"]:r()").join(",")+"}"):new Function("r","return {"+U.map((X)=>cq.test(X)?C8(X)+":r()":"["+JSON.stringify(X)+"]:r()").join(",")+"}"),this.compiledReader)Q.next=this.compiledReader;return Q.propertyCount=J,this.compiledReader=Q,Q(h)}let G={};if(c.keyMap)for(let U=0;U<J;U++)G[C8(c.decodeKey(this[U]))]=h();else for(let U=0;U<J;U++)G[C8(this[U])]=h();return G}return $.slowReads=0,q}function C8($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var CQ=W$;function W$($){let q;if($<16){if(q=lq($))return q}if($>64&&Z$)return Z$.decode(P.subarray(H,H+=$));let J=H+$,Q=[];q="";while(H<J){let G=P[H++];if((G&128)===0)Q.push(G);else if((G&224)===192){let U=P[H++]&63;Q.push((G&31)<<6|U)}else if((G&240)===224){let U=P[H++]&63,X=P[H++]&63;Q.push((G&31)<<12|U<<6|X)}else if((G&248)===240){let U=P[H++]&63,X=P[H++]&63,Y=P[H++]&63,N=(G&7)<<18|U<<12|X<<6|Y;if(N>65535)N-=65536,Q.push(N>>>10&1023|55296),N=56320|N&1023;Q.push(N)}else Q.push(G);if(Q.length>=4096)q+=e.apply(String,Q),Q.length=0}if(Q.length>0)q+=e.apply(String,Q);return q}var e=String.fromCharCode;function EQ($){let q=H,J=new Array($);for(let Q=0;Q<$;Q++){let G=P[H++];if((G&128)>0){H=q;return}J[Q]=G}return e.apply(String,J)}function lq($){if($<4)if($<2)if($===0)return"";else{let q=P[H++];if((q&128)>1){H-=1;return}return e(q)}else{let q=P[H++],J=P[H++];if((q&128)>0||(J&128)>0){H-=2;return}if($<3)return e(q,J);let Q=P[H++];if((Q&128)>0){H-=3;return}return e(q,J,Q)}else{let q=P[H++],J=P[H++],Q=P[H++],G=P[H++];if((q&128)>0||(J&128)>0||(Q&128)>0||(G&128)>0){H-=4;return}if($<6)if($===4)return e(q,J,Q,G);else{let U=P[H++];if((U&128)>0){H-=5;return}return e(q,J,Q,G,U)}else if($<8){let U=P[H++],X=P[H++];if((U&128)>0||(X&128)>0){H-=6;return}if($<7)return e(q,J,Q,G,U,X);let Y=P[H++];if((Y&128)>0){H-=7;return}return e(q,J,Q,G,U,X,Y)}else{let U=P[H++],X=P[H++],Y=P[H++],N=P[H++];if((U&128)>0||(X&128)>0||(Y&128)>0||(N&128)>0){H-=8;return}if($<10)if($===8)return e(q,J,Q,G,U,X,Y,N);else{let O=P[H++];if((O&128)>0){H-=9;return}return e(q,J,Q,G,U,X,Y,N,O)}else if($<12){let O=P[H++],K=P[H++];if((O&128)>0||(K&128)>0){H-=10;return}if($<11)return e(q,J,Q,G,U,X,Y,N,O,K);let W=P[H++];if((W&128)>0){H-=11;return}return e(q,J,Q,G,U,X,Y,N,O,K,W)}else{let O=P[H++],K=P[H++],W=P[H++],D=P[H++];if((O&128)>0||(K&128)>0||(W&128)>0||(D&128)>0){H-=12;return}if($<14)if($===12)return e(q,J,Q,G,U,X,Y,N,O,K,W,D);else{let A=P[H++];if((A&128)>0){H-=13;return}return e(q,J,Q,G,U,X,Y,N,O,K,W,D,A)}else{let A=P[H++],B=P[H++];if((A&128)>0||(B&128)>0){H-=14;return}if($<15)return e(q,J,Q,G,U,X,Y,N,O,K,W,D,A,B);let x=P[H++];if((x&128)>0){H-=15;return}return e(q,J,Q,G,U,X,Y,N,O,K,W,D,A,B,x)}}}}}function HQ($){return c.copyBuffers?Uint8Array.prototype.slice.call(P,H,H+=$):P.subarray(H,H+=$)}var uq=new Float32Array(1),V0=new Uint8Array(uq.buffer,0,4);function TQ(){let $=P[H++],q=P[H++],J=($&127)>>2;if(J===31){if(q||$&3)return NaN;return $&128?-1/0:1/0}if(J===0){let Q=(($&3)<<8|q)/16777216;return $&128?-Q:Q}return V0[3]=$&128|(J>>1)+56,V0[2]=($&7)<<5|q>>3,V0[1]=q<<5,V0[0]=0,uq[0]}var x1=new Array(4096);class D8{constructor($,q){this.value=$,this.tag=q}}o[0]=($)=>{return new Date($)};o[1]=($)=>{return new Date(Math.round($*1000))};o[2]=($)=>{let q=BigInt(0);for(let J=0,Q=$.byteLength;J<Q;J++)q=BigInt($[J])+(q<<BigInt(8));return q};o[3]=($)=>{return BigInt(-1)-o[2]($)};o[4]=($)=>{return+($[1]+"e"+$[0])};o[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var C$=($,q)=>{$=$-57344;let J=r[$];if(J&&J.isShared)(r.restoreStructures||(r.restoreStructures=[]))[$]=J;r[$]=q,q.read=L$(q)};o[OQ]=($)=>{let q=$.length,J=$[1];C$($[0],J);let Q={};for(let G=2;G<q;G++){let U=J[G-2];Q[C8(U)]=$[G]}return Q};o[14]=($)=>{if(a)return a[0].slice(a.position0,a.position0+=$);return new D8($,14)};o[15]=($)=>{if(a)return a[1].slice(a.position1,a.position1+=$);return new D8($,15)};var zQ={Error,RegExp};o[27]=($)=>{return(zQ[$[0]]||Error)($[1],$[2])};var dq=($)=>{if(P[H++]!=132){let J=new Error("Packed values structure must be followed by a 4 element array");if(P.length<H)J.incomplete=!0;throw J}let q=$();if(!q||!q.length){let J=new Error("Packed values structure must be followed by a 4 element array");throw J.incomplete=!0,J}return Y8=Y8?q.concat(Y8.slice(q.length)):q,Y8.prefixes=$(),Y8.suffixes=$(),$()};dq.handlesRead=!0;o[51]=dq;o[mq]=($)=>{if(!Y8)if(c.getShared)H$();else return new D8($,mq);if(typeof $=="number")return Y8[16+($>=0?2*$:-2*$-1)];let q=new Error("No support for non-integer packed references yet");if($===void 0)q.incomplete=!0;throw q};o[28]=($)=>{if(!W8)W8=new Map,W8.id=0;let q=W8.id++,J=H,Q=P[H],G;if(Q>>5==4)G=[];else G={};let U={target:G};W8.set(q,U);let X=$();if(U.used){if(Object.getPrototypeOf(G)!==Object.getPrototypeOf(X))H=J,G=X,W8.set(q,{target:G}),X=$();return Object.assign(G,X)}return U.target=X,X};o[28].handlesRead=!0;o[29]=($)=>{let q=W8.get($);return q.used=!0,q.target};o[258]=($)=>new Set($);(o[259]=($)=>{if(c.mapsAsObjects)c.mapsAsObjects=!1,N0=!0;return $()}).handlesRead=!0;function r8($,q){if(typeof $==="string")return $+q;if($ instanceof Array)return $.concat(q);return Object.assign({},$,q)}function h8(){if(!Y8)if(c.getShared)H$();else throw new Error("No packed values available");return Y8}var DQ=1399353956;O$.push(($,q)=>{if($>=225&&$<=255)return r8(h8().prefixes[$-224],q);if($>=28704&&$<=32767)return r8(h8().prefixes[$-28672],q);if($>=1879052288&&$<=2147483647)return r8(h8().prefixes[$-1879048192],q);if($>=216&&$<=223)return r8(q,h8().suffixes[$-216]);if($>=27647&&$<=28671)return r8(q,h8().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return r8(q,h8().suffixes[$-1811939328]);if($==DQ)return{packedValues:Y8,structures:r.slice(0),version:q};if($==55799)return q});var wQ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,E$=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],RQ=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<E$.length;$++)BQ(E$[$],RQ[$]);function BQ($,q){let J="get"+$.name.slice(0,-5),Q;if(typeof $==="function")Q=$.BYTES_PER_ELEMENT;else $=null;for(let G=0;G<2;G++){if(!G&&Q==1)continue;let U=Q==2?1:Q==4?2:Q==8?3:0;o[G?q:q-4]=Q==1||G==wQ?(X)=>{if(!$)throw new Error("Could not find typed array for code "+q);if(!c.copyBuffers){if(Q===1||Q===2&&!(X.byteOffset&1)||Q===4&&!(X.byteOffset&3)||Q===8&&!(X.byteOffset&7))return new $(X.buffer,X.byteOffset,X.byteLength>>U)}return new $(Uint8Array.prototype.slice.call(X,0).buffer)}:(X)=>{if(!$)throw new Error("Could not find typed array for code "+q);let Y=new DataView(X.buffer,X.byteOffset,X.byteLength),N=X.length>>U,O=new $(N),K=Y[J];for(let W=0;W<N;W++)O[W]=K.call(Y,W<<U,G);return O}}}function IQ(){let $=o8(),q=H+h();for(let Q=2;Q<$;Q++){let G=o8();H+=G}let J=H;return H=q,a=[W$(o8()),W$(o8())],a.position0=0,a.position1=0,a.postBundlePosition=H,H=J,h()}function o8(){let $=P[H++]&31;if($>23)switch($){case 24:$=P[H++];break;case 25:$=N8.getUint16(H),H+=2;break;case 26:$=N8.getUint32(H),H+=4;break}return $}function H$(){if(c.getShared){let $=nq(()=>{return P=null,c.getShared()})||{},q=$.structures||[];if(c.sharedVersion=$.version,Y8=c.sharedValues=$.packedValues,r===!0)c.structures=r=q;else r.splice.apply(r,[0,q.length].concat(q))}}function nq($){let q=p8,J=H,Q=M$,G=P0,U=Y0,X=x0,Y=K$,N=W8,O=a,K=new Uint8Array(P.slice(0,p8)),W=r,D=c,A=Z0,B=$();return p8=q,H=J,M$=Q,P0=G,Y0=U,x0=X,K$=Y,W8=N,a=O,P=K,Z0=A,r=W,c=D,N8=new DataView(P.buffer,P.byteOffset,P.byteLength),B}function F0(){P=null,W8=null,r=null}var k0=new Array(147);for(let $=0;$<256;$++)k0[$]=+("1e"+Math.floor(45.15-$*0.30103));var T$=new y8({useRecords:!1}),_0=T$.decode,fQ=T$.decodeMultiple;var y0;try{y0=new TextEncoder}catch($){}var B$,eq,v0=typeof globalThis==="object"&&globalThis.Buffer,K0=typeof v0!=="undefined",z$=K0?v0.allocUnsafeSlow:Uint8Array,iq=K0?v0:Uint8Array,rq=256,oq=K0?4294967296:2144337920;var D$,L,n,Z=0,S8,s=null,AQ=61440,jQ=/[\u0080-\uFFFF]/,K8=Symbol("record-id");class g0 extends y8{constructor($){super($);this.offset=0;let q,J,Q,G,U,X;$=$||{};let Y=iq.prototype.utf8Write?function(M,z,C){return L.utf8Write(M,z,C)}:y0&&y0.encodeInto?function(M,z){return y0.encodeInto(M,L.subarray(z)).written}:!1,N=this,O=$.structures||$.saveStructures,K=$.maxSharedStructures;if(K==null)K=O?128:0;if(K>8190)throw new Error("Maximum maxSharedStructure is 8190");let W=$.sequential;if(W)K=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let D,A,B=$.sharedValues,x;if(B){x=Object.create(null);for(let M=0,z=B.length;M<z;M++)x[B[M]]=M}let E=[],f=0,I=0;this.mapEncode=function(M,z){if(this._keyMap&&!this._mapped)switch(M.constructor.name){case"Array":M=M.map((C)=>this.encodeKeys(C));break}return this.encode(M,z)},this.encode=function(M,z){if(!L)L=new z$(8192),n=new DataView(L.buffer,0,8192),Z=0;if(S8=L.length-10,S8-Z<2048)L=new z$(L.length),n=new DataView(L.buffer,0,L.length),S8=L.length-10,Z=0;else if(z===f$)Z=Z+7&2147483640;if(J=Z,N.useSelfDescribedHeader)n.setUint32(Z,3654940416),Z+=3;if(X=N.structuredClone?new Map:null,N.bundleStrings&&typeof M!=="string")s=[],s.size=1/0;else s=null;if(Q=N.structures,Q){if(Q.uninitialized){let T=N.getShared()||{};N.structures=Q=T.structures||[],N.sharedVersion=T.version;let w=N.sharedValues=T.packedValues;if(w){x={};for(let V=0,k=w.length;V<k;V++)x[w[V]]=V}}let C=Q.length;if(C>K&&!W)C=K;if(!Q.transitions){Q.transitions=Object.create(null);for(let T=0;T<C;T++){let w=Q[T];if(!w)continue;let V,k=Q.transitions;for(let _=0,y=w.length;_<y;_++){if(k[K8]===void 0)k[K8]=T;let v=w[_];if(V=k[v],!V)V=k[v]=Object.create(null);k=V}k[K8]=T|1048576}}if(!W)Q.nextId=C}if(G)G=!1;if(U=Q||[],A=x,$.pack){let C=new Map;if(C.values=[],C.encoder=N,C.maxValues=$.maxPrivatePackedValues||(x?16:1/0),C.objectMap=x||!1,C.samplingPackedValues=D,S0(M,C),C.values.length>0){L[Z++]=216,L[Z++]=51,R8(4);let T=C.values;R(T),R8(0),R8(0),A=Object.create(x||null);for(let w=0,V=T.length;w<V;w++)A[T[w]]=w}}D$=z&R$;try{if(D$)return;if(R(M),s)sq(J,R);if(N.offset=Z,X&&X.idsToInsert){if(Z+=X.idsToInsert.length*2,Z>S8)m(Z);N.offset=Z;let C=PQ(L.subarray(J,Z),X.idsToInsert);return X=null,C}if(z&f$)return L.start=J,L.end=Z,L;return L.subarray(J,Z)}finally{if(Q){if(I<10)I++;if(Q.length>K)Q.length=K;if(f>1e4){if(Q.transitions=null,I=0,f=0,E.length>0)E=[]}else if(E.length>0&&!W){for(let C=0,T=E.length;C<T;C++)E[C][K8]=void 0;E=[]}}if(G&&N.saveShared){if(N.structures.length>K)N.structures=N.structures.slice(0,K);let C=L.subarray(J,Z);if(N.updateSharedData()===!1)return N.encode(M);return C}if(z&yQ)Z=J}},this.findCommonStringsToPack=()=>{if(D=new Map,!x)x=Object.create(null);return(M)=>{let z=M&&M.threshold||4,C=this.pack?M.maxPrivatePackedValues||16:0;if(!B)B=this.sharedValues=[];for(let[T,w]of D)if(w.count>z)x[T]=C++,B.push(T),G=!0;while(this.saveShared&&this.updateSharedData()===!1);D=null}};let R=(M)=>{if(Z>S8)L=m(Z);var z=typeof M,C;if(z==="string"){if(A){let k=A[M];if(k>=0){if(k<16)L[Z++]=k+224;else if(L[Z++]=198,k&1)R(15-k>>1);else R(k-16>>1);return}else if(D&&!$.pack){let _=D.get(M);if(_)_.count++;else D.set(M,{count:1})}}let T=M.length;if(s&&T>=4&&T<1024){if((s.size+=T)>AQ){let _,y=(s[0]?s[0].length*3+s[1].length:0)+10;if(Z+y>S8)L=m(Z+y);if(L[Z++]=217,L[Z++]=223,L[Z++]=249,L[Z++]=s.position?132:130,L[Z++]=26,_=Z-J,Z+=4,s.position)sq(J,R);s=["",""],s.size=0,s.position=_}let k=jQ.test(M);s[k?0:1]+=M,L[Z++]=k?206:207,R(T);return}let w;if(T<32)w=1;else if(T<256)w=2;else if(T<65536)w=3;else w=5;let V=T*3;if(Z+V>S8)L=m(Z+V);if(T<64||!Y){let k,_,y,v=Z+w;for(k=0;k<T;k++)if(_=M.charCodeAt(k),_<128)L[v++]=_;else if(_<2048)L[v++]=_>>6|192,L[v++]=_&63|128;else if((_&64512)===55296&&((y=M.charCodeAt(k+1))&64512)===56320)_=65536+((_&1023)<<10)+(y&1023),k++,L[v++]=_>>18|240,L[v++]=_>>12&63|128,L[v++]=_>>6&63|128,L[v++]=_&63|128;else L[v++]=_>>12|224,L[v++]=_>>6&63|128,L[v++]=_&63|128;C=v-Z-w}else C=Y(M,Z+w,V);if(C<24)L[Z++]=96|C;else if(C<256){if(w<2)L.copyWithin(Z+2,Z+1,Z+1+C);L[Z++]=120,L[Z++]=C}else if(C<65536){if(w<3)L.copyWithin(Z+3,Z+2,Z+2+C);L[Z++]=121,L[Z++]=C>>8,L[Z++]=C&255}else{if(w<5)L.copyWithin(Z+5,Z+3,Z+3+C);L[Z++]=122,n.setUint32(Z,C),Z+=4}Z+=C}else if(z==="number")if(!this.alwaysUseFloat&&M>>>0===M)if(M<24)L[Z++]=M;else if(M<256)L[Z++]=24,L[Z++]=M;else if(M<65536)L[Z++]=25,L[Z++]=M>>8,L[Z++]=M&255;else L[Z++]=26,n.setUint32(Z,M),Z+=4;else if(!this.alwaysUseFloat&&M>>0===M)if(M>=-24)L[Z++]=31-M;else if(M>=-256)L[Z++]=56,L[Z++]=~M;else if(M>=-65536)L[Z++]=57,n.setUint16(Z,~M),Z+=2;else L[Z++]=58,n.setUint32(Z,~M),Z+=4;else{let T;if((T=this.useFloat32)>0&&M<4294967296&&M>=-2147483648){L[Z++]=250,n.setFloat32(Z,M);let w;if(T<4||(w=M*k0[(L[Z]&127)<<1|L[Z+1]>>7])>>0===w){Z+=4;return}else Z--}L[Z++]=251,n.setFloat64(Z,M),Z+=8}else if(z==="object")if(!M)L[Z++]=246;else{if(X){let w=X.get(M);if(w){if(L[Z++]=216,L[Z++]=29,L[Z++]=25,!w.references){let V=X.idsToInsert||(X.idsToInsert=[]);w.references=[],V.push(w)}w.references.push(Z-J),Z+=2;return}else X.set(M,{offset:Z-J})}let T=M.constructor;if(T===Object)g(M);else if(T===Array){if(C=M.length,C<24)L[Z++]=128|C;else R8(C);for(let w=0;w<C;w++)R(M[w])}else if(T===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)L[Z++]=217,L[Z++]=1,L[Z++]=3;if(C=M.size,C<24)L[Z++]=160|C;else if(C<256)L[Z++]=184,L[Z++]=C;else if(C<65536)L[Z++]=185,L[Z++]=C>>8,L[Z++]=C&255;else L[Z++]=186,n.setUint32(Z,C),Z+=4;if(N.keyMap)for(let[w,V]of M)R(N.encodeKey(w)),R(V);else for(let[w,V]of M)R(w),R(V)}else{for(let w=0,V=B$.length;w<V;w++){let k=eq[w];if(M instanceof k){let _=B$[w],y=_.tag;if(y==null)y=_.getTag&&_.getTag.call(this,M);if(y<24)L[Z++]=192|y;else if(y<256)L[Z++]=216,L[Z++]=y;else if(y<65536)L[Z++]=217,L[Z++]=y>>8,L[Z++]=y&255;else if(y>-1)L[Z++]=218,n.setUint32(Z,y),Z+=4;_.encode.call(this,M,R,m);return}}if(M[Symbol.iterator]){if(D$){let w=new Error("Iterable should be serialized as iterator");throw w.iteratorNotHandled=!0,w}L[Z++]=159;for(let w of M)R(w);L[Z++]=255;return}if(M[Symbol.asyncIterator]||w$(M)){let w=new Error("Iterable/blob should be serialized as iterator");throw w.iteratorNotHandled=!0,w}if(this.useToJSON&&M.toJSON){let w=M.toJSON();if(w!==M)return R(w)}g(M)}}else if(z==="boolean")L[Z++]=M?245:244;else if(z==="bigint"){if(M<BigInt(1)<<BigInt(64)&&M>=0)L[Z++]=27,n.setBigUint64(Z,M);else if(M>-(BigInt(1)<<BigInt(64))&&M<0)L[Z++]=59,n.setBigUint64(Z,-M-BigInt(1));else if(this.largeBigIntToFloat)L[Z++]=251,n.setFloat64(Z,Number(M));else{if(M>=BigInt(0))L[Z++]=194;else L[Z++]=195,M=BigInt(-1)-M;let T=[];while(M)T.push(Number(M&BigInt(255))),M>>=BigInt(8);I$(new Uint8Array(T.reverse()),m);return}Z+=8}else if(z==="undefined")L[Z++]=247;else throw new Error("Unknown type: "+z)},g=this.useRecords===!1?this.variableMapSize?(M)=>{let z=Object.keys(M),C=Object.values(M),T=z.length;if(T<24)L[Z++]=160|T;else if(T<256)L[Z++]=184,L[Z++]=T;else if(T<65536)L[Z++]=185,L[Z++]=T>>8,L[Z++]=T&255;else L[Z++]=186,n.setUint32(Z,T),Z+=4;let w;if(N.keyMap)for(let V=0;V<T;V++)R(N.encodeKey(z[V])),R(C[V]);else for(let V=0;V<T;V++)R(z[V]),R(C[V])}:(M)=>{L[Z++]=185;let z=Z-J;Z+=2;let C=0;if(N.keyMap){for(let T in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(T))R(N.encodeKey(T)),R(M[T]),C++}else for(let T in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(T))R(T),R(M[T]),C++;L[z+++J]=C>>8,L[z+J]=C&255}:(M,z)=>{let C,T=U.transitions||(U.transitions=Object.create(null)),w=0,V=0,k,_;if(this.keyMap){_=Object.keys(M).map((v)=>this.encodeKey(v)),V=_.length;for(let v=0;v<V;v++){let s8=_[v];if(C=T[s8],!C)C=T[s8]=Object.create(null),w++;T=C}}else for(let v in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(v)){if(C=T[v],!C){if(T[K8]&1048576)k=T[K8]&65535;C=T[v]=Object.create(null),w++}T=C,V++}let y=T[K8];if(y!==void 0)y&=65535,L[Z++]=217,L[Z++]=y>>8|224,L[Z++]=y&255;else{if(!_)_=T.__keys__||(T.__keys__=Object.keys(M));if(k===void 0){if(y=U.nextId++,!y)y=0,U.nextId=1;if(y>=rq)U.nextId=(y=K)+1}else y=k;if(U[y]=_,y<K){L[Z++]=217,L[Z++]=y>>8|224,L[Z++]=y&255,T=U.transitions;for(let v=0;v<V;v++){if(T[K8]===void 0||T[K8]&1048576)T[K8]=y;T=T[_[v]]}T[K8]=y|1048576,G=!0}else{if(T[K8]=y,n.setUint32(Z,3655335680),Z+=3,w)f+=I*w;if(E.length>=rq-K)E.shift()[K8]=void 0;if(E.push(T),R8(V+2),R(57344+y),R(_),z)return;for(let v in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(v))R(M[v]);return}}if(V<24)L[Z++]=128|V;else R8(V);if(z)return;for(let v in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(v))R(M[v])},m=(M)=>{let z;if(M>16777216){if(M-J>oq)throw new Error("Encoded buffer would be larger than maximum buffer size");z=Math.min(oq,Math.round(Math.max((M-J)*(M>67108864?1.25:2),4194304)/4096)*4096)}else z=(Math.max(M-J<<2,L.length-1)>>12)+1<<12;let C=new z$(z);if(n=new DataView(C.buffer,0,z),L.copy)L.copy(C,0,J,M);else C.set(L.slice(J,M));return Z-=J,J=0,S8=C.length-10,L=C},l=100,b=1000;this.encodeAsIterable=function(M,z){return p(M,z,j)},this.encodeAsAsyncIterable=function(M,z){return p(M,z,d)};function*j(M,z,C){let T=M.constructor;if(T===Object){let w=N.useRecords!==!1;if(w)g(M,!0);else aq(Object.keys(M).length,160);for(let V in M){let k=M[V];if(!w)R(V);if(k&&typeof k==="object")if(z[V])yield*j(k,z[V]);else yield*F(k,z,V);else R(k)}}else if(T===Array){let w=M.length;R8(w);for(let V=0;V<w;V++){let k=M[V];if(k&&(typeof k==="object"||Z-J>l))if(z.element)yield*j(k,z.element);else yield*F(k,z,"element");else R(k)}}else if(M[Symbol.iterator]&&!M.buffer){L[Z++]=159;for(let w of M)if(w&&(typeof w==="object"||Z-J>l))if(z.element)yield*j(w,z.element);else yield*F(w,z,"element");else R(w);L[Z++]=255}else if(w$(M))aq(M.size,64),yield L.subarray(J,Z),yield M,S();else if(M[Symbol.asyncIterator])L[Z++]=159,yield L.subarray(J,Z),yield M,S(),L[Z++]=255;else R(M);if(C&&Z>J)yield L.subarray(J,Z);else if(Z-J>l)yield L.subarray(J,Z),S()}function*F(M,z,C){let T=Z-J;try{if(R(M),Z-J>l)yield L.subarray(J,Z),S()}catch(w){if(w.iteratorNotHandled)z[C]={},Z=J+T,yield*j.call(this,M,z[C]);else throw w}}function S(){l=b,N.encode(null,R$)}function p(M,z,C){if(z&&z.chunkThreshold)l=b=z.chunkThreshold;else l=100;if(M&&typeof M==="object")return N.encode(null,R$),C(M,N.iterateProperties||(N.iterateProperties={}),!0);return[N.encode(M)]}async function*d(M,z){for(let C of j(M,z,!0)){let T=C.constructor;if(T===iq||T===Uint8Array)yield C;else if(w$(C)){let w=C.stream().getReader(),V;while(!(V=await w.read()).done)yield V.value}else if(C[Symbol.asyncIterator])for await(let w of C)if(S(),w)yield*d(w,z.async||(z.async={}));else yield N.encode(w);else yield C}}}useBuffer($){L=$,n=new DataView(L.buffer,L.byteOffset,L.byteLength),Z=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let q=this.structures.slice(0),J=new A$(q,this.sharedValues,this.sharedVersion),Q=this.saveShared(J,(G)=>(G&&G.version||0)==$);if(Q===!1)J=this.getShared()||{},this.structures=J.structures||[],this.sharedValues=J.packedValues,this.sharedVersion=J.version,this.structures.nextId=this.structures.length;else q.forEach((G,U)=>this.structures[U]=G);return Q}}function aq($,q){if($<24)L[Z++]=q|$;else if($<256)L[Z++]=q|24,L[Z++]=$;else if($<65536)L[Z++]=q|25,L[Z++]=$>>8,L[Z++]=$&255;else L[Z++]=q|26,n.setUint32(Z,$),Z+=4}class A${constructor($,q,J){this.structures=$,this.packedValues=q,this.version=J}}function R8($){if($<24)L[Z++]=128|$;else if($<256)L[Z++]=152,L[Z++]=$;else if($<65536)L[Z++]=153,L[Z++]=$>>8,L[Z++]=$&255;else L[Z++]=154,n.setUint32(Z,$),Z+=4}var VQ=typeof Blob==="undefined"?function(){}:Blob;function w$($){if($ instanceof VQ)return!0;let q=$[Symbol.toStringTag];return q==="Blob"||q==="File"}function S0($,q){switch(typeof $){case"string":if($.length>3){if(q.objectMap[$]>-1||q.values.length>=q.maxValues)return;let Q=q.get($);if(Q){if(++Q.count==2)q.values.push($)}else if(q.set($,{count:1}),q.samplingPackedValues){let G=q.samplingPackedValues.get($);if(G)G.count++;else q.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let Q=0,G=$.length;Q<G;Q++)S0($[Q],q);else{let Q=!q.encoder.useRecords;for(var J in $)if($.hasOwnProperty(J)){if(Q)S0(J,q);S0($[J],q)}}break;case"function":console.log($)}}var xQ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;eq=[Date,Set,Error,RegExp,D8,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,A$];B$=[{tag:1,encode($,q){let J=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&J>=0&&J<4294967296)L[Z++]=26,n.setUint32(Z,J),Z+=4;else L[Z++]=251,n.setFloat64(Z,J),Z+=8}},{tag:258,encode($,q){let J=Array.from($);q(J)}},{tag:27,encode($,q){q([$.name,$.message])}},{tag:27,encode($,q){q(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,q){q($.value)}},{encode($,q,J){I$($,J)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||K0&&this.tagUint8Array!==!1)return 64}},encode($,q,J){I$($,J)}},w8(68,1),w8(69,2),w8(70,4),w8(71,8),w8(72,1),w8(77,2),w8(78,4),w8(79,8),w8(85,4),w8(86,8),{encode($,q){let J=$.packedValues||[],Q=$.structures||[];if(J.values.length>0){L[Z++]=216,L[Z++]=51,R8(4);let G=J.values;q(G),R8(0),R8(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let U=0,X=G.length;U<X;U++)packedObjectMap[G[U]]=U}if(Q){n.setUint32(Z,3655335424),Z+=3;let G=Q.slice(0);G.unshift(57344),G.push(new D8($.version,1399353956)),q(G)}else q(new D8($.version,1399353956))}}];function w8($,q){if(!xQ&&q>1)$-=4;return{tag:$,encode:function J(Q,G){let U=Q.byteLength,X=Q.byteOffset||0,Y=Q.buffer||Q;G(K0?v0.from(Y,X,U):new Uint8Array(Y,X,U))}}}function I$($,q){let J=$.byteLength;if(J<24)L[Z++]=64+J;else if(J<256)L[Z++]=88,L[Z++]=J;else if(J<65536)L[Z++]=89,L[Z++]=J>>8,L[Z++]=J&255;else L[Z++]=90,n.setUint32(Z,J),Z+=4;if(Z+J>=L.length)q(Z+J);L.set($.buffer?$:new Uint8Array($),Z),Z+=J}function PQ($,q){let J,Q=q.length*2,G=$.length-Q;q.sort((U,X)=>U.offset>X.offset?1:-1);for(let U=0;U<q.length;U++){let X=q[U];X.id=U;for(let Y of X.references)$[Y++]=U>>8,$[Y]=U&255}while(J=q.pop()){let U=J.offset;$.copyWithin(U+Q,U,G),Q-=2;let X=U+Q;$[X++]=216,$[X++]=28,G=U}return $}function sq($,q){n.setUint32(s.position+$,Z-s.position-$+1);let J=s;s=null,q(J[0]),q(J[1])}var j$=new g0({useRecords:!1}),FQ=j$.encode,kQ=j$.encodeAsIterable,_Q=j$.encodeAsAsyncIterable;var f$=512,yQ=1024,R$=2048;var m0=($)=>{let q=new Uint8Array($),J="";for(let Q=0;Q<q.byteLength;Q++)J+=String.fromCharCode(q[Q]);return btoa(J).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},$J=($)=>{let q=atob($.replace(/-/g,"+").replace(/_/g,"/")),J=new Uint8Array(q.length);for(let Q=0;Q<q.length;Q++)J[Q]=q.charCodeAt(Q);return J.buffer};async function qJ($){let q=crypto.getRandomValues(new Uint8Array(32)),J=crypto.getRandomValues(new Uint8Array(16)),Q=await navigator.credentials.create({publicKey:{challenge:q,rp:{name:"Sorane Web/A Form"},user:{id:J,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:60000,attestation:"none"}});if(!Q)throw new Error("Credential creation failed");return{id:Q.id,rawId:m0(Q.rawId),response:Q.response}}async function JJ($,q){let J=await navigator.credentials.get({publicKey:{challenge:q,allowCredentials:[{id:$J($),type:"public-key"}],userVerification:"required"}});if(!J)throw new Error("Assertion failed");let Q=J.response;return{id:J.id,signature:m0(Q.signature),authenticatorData:m0(Q.authenticatorData),clientDataJSON:m0(Q.clientDataJSON)}}async function b0($,q){let J=crypto.getRandomValues(new Uint8Array(32)),Q=await navigator.credentials.get({publicKey:{challenge:J,allowCredentials:[{id:$J($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:q}}}}});if(!Q)throw new Error("Assertion failed");let U=Q.getClientExtensionResults()?.prf?.results?.first;if(!U)throw new Error("PRF extension not available");return new Uint8Array(U)}function M0($){return Array.from($).map((q)=>q.toString(16).padStart(2,"0")).join("")}function QJ($){let q=new Uint8Array($.length/2);for(let J=0;J<q.length;J++)q[J]=parseInt($.substring(J*2,J*2+2),16);return q}class UJ{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),q=localStorage.getItem("weba_passkey_pub");if($&&q){this.credentialId=$,this.publicKey=QJ(q),this.publicKeyType="p256",this.usePasskey=!0;return}let J=localStorage.getItem("weba_private_key");if(J)this.edPrivateKey=QJ(J),this.publicKey=_8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey...");let $=await qJ("User"),q=new Uint8Array($.response.attestationObject),Q=_0(q).authData,G=new DataView(Q.buffer,Q.byteOffset,Q.byteLength),U=53,X=G.getUint16(U);U+=2,U+=X;let Y=Q.slice(U),N=_0(Y),O=N.get(-2),K=N.get(-3);if(!O||!K)throw new Error("Invalid COSE Key: x or y missing");let W=new Uint8Array(65);if(W[0]=4,W.set(O,1),W.set(K,33),this.credentialId=$.rawId,this.publicKey=W,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",M0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=_8.utils.randomSecretKey(),this.publicKey=_8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",M0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${M0(this.publicKey)}`}getPublicKey(){return this.publicKey?M0(this.publicKey):""}async sign($,q="authentication"){if(!this.publicKey)await this.register();let J=GJ.default($),Q=new TextEncoder().encode(J);if(this.usePasskey&&this.credentialId){let G=await crypto.subtle.digest("SHA-256",Q),U=await JJ(this.credentialId,G);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:U.signature,"srn:authenticatorData":U.authenticatorData,"srn:clientDataJSON":U.clientDataJSON,"srn:credentialId":U.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let G=_8.sign(Q,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:M0(G)}}}}}var a8=new UJ;class V${oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,q){if(t8($),u(q,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let J=this.blockLen,Q=new Uint8Array(J);Q.set(q.length>J?$.create().update(q).digest():q);for(let G=0;G<Q.length;G++)Q[G]^=54;this.iHash.update(Q),this.oHash=$.create();for(let G=0;G<Q.length;G++)Q[G]^=106;this.oHash.update(Q),E8(Q)}update($){return l8(this),this.iHash.update($),this}digestInto($){l8(this),u($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:q,iHash:J,finished:Q,destroyed:G,blockLen:U,outputLen:X}=this;return $=$,$.finished=Q,$.destroyed=G,$.blockLen=U,$.outputLen=X,$.oHash=q._cloneInto($.oHash),$.iHash=J._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var c0=($,q,J)=>new V$($,q).update(J).digest();c0.create=($,q)=>new V$($,q);function SQ($,q,J){if(t8($),J===void 0)J=new Uint8Array($.outputLen);return c0($,J,q)}var x$=Uint8Array.of(0),XJ=Uint8Array.of();function vQ($,q,J,Q=32){t8($),T8(Q,"length");let G=$.outputLen;if(Q>255*G)throw new Error("Length must be <= 255*HashLen");let U=Math.ceil(Q/G);if(J===void 0)J=XJ;else u(J,void 0,"info");let X=new Uint8Array(U*G),Y=c0.create($,q),N=Y._cloneInto(),O=new Uint8Array(Y.outputLen);for(let K=0;K<U;K++)x$[0]=K+1,N.update(K===0?XJ:O).update(J).update(x$).digestInto(O),X.set(O,G*K),Y._cloneInto(N);return Y.destroy(),N.destroy(),E8(O,x$),X.slice(0,Q)}var M8=($,q,J,Q,G)=>vQ($,SQ($,q,J),Q,G);var ZJ=h$(Y$(),1),NJ="weba_l2_ed25519_sk";function O8($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let q="";return $.forEach((Q)=>{q+=String.fromCharCode(Q)}),btoa(q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function $8($){let q=$.length%4===0?"":"=".repeat(4-$.length%4),J=$.replace(/-/g,"+").replace(/_/g,"/")+q;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(J,"base64"));let Q=atob(J),G=new Uint8Array(Q.length);for(let U=0;U<Q.length;U+=1)G[U]=Q.charCodeAt(U);return G}function h0($){let q=ZJ.default($);if(q===void 0)throw new Error("Failed to canonicalize JSON");return q}function YJ($){let q=new Uint8Array($);return crypto.getRandomValues(q),q}function gQ(){let $=localStorage.getItem(NJ);if($)return $8($);let q=_8.utils.randomSecretKey();return localStorage.setItem(NJ,O8(q)),q}function mQ($,q,J){let Q={layer1_ref:$,recipient:q,weba_version:J};return new TextEncoder().encode(h0(Q))}function KJ($,q){let J=new Uint8Array($.length+q.length);return J.set($,0),J.set(q,$.length),J}function MJ(){return globalThis.webaPqcKem||null}async function OJ($,q,J,Q){let G=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["encrypt"]),U=await crypto.subtle.encrypt({name:"AES-GCM",iv:J,additionalData:Q},G,$);return new Uint8Array(U)}async function LJ($){let q=M8(Z8,$.prfKey,void 0,void 0,32),J=M8(Z8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=M8(Z8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.aad??new Uint8Array;return OJ($.recipientSk,J,Q,G)}async function WJ($,q,J,Q){let G=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["decrypt"]),U=await crypto.subtle.decrypt({name:"AES-GCM",iv:J,additionalData:Q},G,$);return new Uint8Array(U)}async function CJ($){let q=$.config.weba_version??"0.1",J=$.config.recipient_kid,Q=$.config.layer1_ref,G=$.user_kid??"user#sig-1",U=gQ(),X=h0($.layer2_plain),Y=new TextEncoder().encode(X),N=_8.sign(Y,U),O={alg:"Ed25519",kid:G,sig:O8(N),created_at:new Date().toISOString()},K={layer2_plain:$.layer2_plain,layer2_sig:O},W=mQ(Q,J,q),D=new TextEncoder().encode(h0(K)),A=$8($.config.recipient_x25519),B=YJ(32),x=A0.getPublicKey(B),E=A0.getSharedSecret(B,A),f=E,I,R="X25519";if($.config.recipient_pqc){let j=$.pqcProvider??MJ();if(!j)throw new Error("PQC requested but no provider is available");let F=$8($.config.recipient_pqc),S=j.encapsulate(F);I=S.encapsulation,f=KJ(E,S.sharedSecret),R=`X25519+${j.kemId}`}let g=M8(Z8,f,W,void 0,32),m=M8(Z8,g,void 0,new TextEncoder().encode("weba-l2/key"),32),l=M8(Z8,g,void 0,new TextEncoder().encode("weba-l2/iv"),12),b=await OJ(D,m,l,W);return{weba_version:q,layer1_ref:Q,layer2:{enc:"HPKE-v1",suite:{kem:R,kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:J,encapsulated:{classical:O8(x),...I?{pqc:O8(I)}:{}},ciphertext:O8(b),aad:O8(W)},meta:{created_at:new Date().toISOString(),nonce:O8(YJ(16))}}}function EJ(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function p0($,q,J){let Q=$8($.layer2.aad),G={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},U=new TextEncoder().encode(h0(G));if(O8(U)!==$.layer2.aad)throw new Error("AAD mismatch");let X=$8($.layer2.encapsulated.classical),Y=A0.getSharedSecret(q,X),N=Y;if($.layer2.encapsulated.pqc){let B=J?.pqcProvider??MJ(),x=J?.pqcRecipientSk;if(!B||!x)throw new Error("Missing PQC KEM for envelope");let E=$8($.layer2.encapsulated.pqc),f=B.decapsulate(x,E);N=KJ(Y,f)}let O=M8(Z8,N,Q,void 0,32),K=M8(Z8,O,void 0,new TextEncoder().encode("weba-l2/key"),32),W=M8(Z8,O,void 0,new TextEncoder().encode("weba-l2/iv"),12),D=$8($.layer2.ciphertext),A=await WJ(D,K,W,Q);return JSON.parse(new TextDecoder().decode(A))}async function HJ($){let q=M8(Z8,$.prfKey,void 0,void 0,32),J=M8(Z8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=M8(Z8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.keywrap.aad?$8($.keywrap.aad):new Uint8Array,U=$8($.keywrap.wrapped_key);return WJ(U,J,Q,G)}class P${formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let q=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((G)=>{let U=G.dataset.jsonPath;if(U)q[U]=G.value}),document.querySelectorAll('[type="radio"]:checked').forEach((G)=>{q[G.name]=G.value}),document.querySelectorAll("table.data-table.dynamic").forEach((G)=>{let U=G.dataset.tableKey;if(U){let X=[];G.querySelectorAll("tbody tr").forEach((Y)=>{let N={},O=!1;if(Y.querySelectorAll("[data-base-key]").forEach((K)=>{if(K.type==="checkbox"){if(N[K.dataset.baseKey]=K.checked,K.checked)O=!0}else if(N[K.dataset.baseKey]=K.value,K.value)O=!0}),O)X.push(N)}),q[U]=X}});let J=document.getElementById("json-ld");if(J)J.textContent=JSON.stringify(q,null,2);let Q=document.getElementById("json-debug");if(Q)Q.textContent=JSON.stringify(q,null,2);return q}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),q=window,J=q.generatedJsonStructure&&q.generatedJsonStructure.name||"Response",Q=window.location.href.split("#")[0],G=this.getL2Config(),U=document.getElementById("weba-l2-encrypt");if(!!(G?.enabled&&(U?U.checked:G.default_enabled))){if(!G?.recipient_kid||!G?.recipient_x25519||!G?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let N=await CJ({layer2_plain:$,config:G,user_kid:G.user_kid});this.downloadHtml("submit",!0,{l2Envelope:N,stripPlaintext:!0})}catch(N){console.error(N),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!a8.getPublicKey()){if(!await a8.register()){alert("Key registration failed.");return}}let Y={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:a8.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:Q,answers:$}};try{let N=await a8.sign(Y);this.downloadHtml("submitted",!0,{embeddedVc:N})}catch(N){console.error(N),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let q=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(q[Q]!==void 0)J.value=q[Q]}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey,G=q[Q];if(Array.isArray(G)){let U=J.querySelector("tbody");if(!U)return;let X=U.querySelectorAll(".template-row");G.forEach((Y,N)=>{let O;if(N===0)O=U.querySelector(".template-row");else{let K=U.querySelector(".template-row");if(K){O=K.cloneNode(!0),O.classList.remove("template-row");let W=O.querySelector(".remove-row-btn");if(W)W.style.visibility="visible";U.appendChild(O)}}if(O)O.querySelectorAll("input, select").forEach((K)=>{let W=K.dataset.baseKey;if(W&&Y[W]!==void 0)if(K.type==="checkbox")K.checked=!!Y[W];else K.value=Y[W]})})}})}catch(q){console.error(q)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,q,J){let Q=window,U=new DOMParser().parseFromString(document.documentElement.outerHTML,"text/html");if(J?.stripPlaintext){U.querySelectorAll("input").forEach((E)=>{if(E.type==="checkbox"||E.type==="radio")E.checked=!1,E.removeAttribute("checked");else E.value="",E.removeAttribute("value")}),U.querySelectorAll("textarea").forEach((E)=>{E.value="",E.textContent=""}),U.querySelectorAll("select").forEach((E)=>{E.selectedIndex=-1,E.querySelectorAll("option").forEach((f)=>f.removeAttribute("selected"))}),U.getElementById("json-ld")?.remove(),U.getElementById("data-layer")?.remove();let x=U.getElementById("json-debug");if(x)x.textContent=""}if(J?.embeddedVc){let x=JSON.stringify(J.embeddedVc,null,2),E=U.createElement("script");E.type="application/ld+json",E.id="weba-user-vc",E.textContent=x,U.body.appendChild(E);let f=U.createElement("div");f.className="weba-user-verification no-print",f.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",f.innerHTML=`
                <details>
                    <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
                        <span></span> 
                    </summary>
                    <div style="padding: 1rem 0;">
                        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
                    </div>
                </details>
            `;let I=f.querySelector("pre");if(I)I.textContent=x;U.body.appendChild(f)}if(J?.l2Envelope){let x=U.createElement("script");x.id="weba-l2-envelope",x.type="application/json",x.textContent=JSON.stringify(J.l2Envelope,null,2),U.body.appendChild(x)}let X=U.documentElement.outerHTML,Y=new Blob([X],{type:"text/html"}),N=URL.createObjectURL(Y),O=document.createElement("a");O.href=N;let K=Q.generatedJsonStructure&&Q.generatedJsonStructure.name||"web-a-form",W=new Date,D=W.getFullYear()+("0"+(W.getMonth()+1)).slice(-2)+("0"+W.getDate()).slice(-2)+"-"+("0"+W.getHours()).slice(-2)+("0"+W.getMinutes()).slice(-2),A=Math.random().toString(36).substring(2,8),B=`${K}_${D}_${$}_${A}.html`;if(O.download=B,O.click(),q)setTimeout(()=>window.location.reload(),1000)}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class F${calc;data;constructor($,q){this.calc=$,this.data=q}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},q=(navigator.language||"en").startsWith("ja")?"ja":"en",J=$[q]||$.en;document.querySelectorAll("[data-i18n]").forEach((Q)=>{let G=Q.dataset.i18n;if(J[G])Q.textContent=J[G]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((J)=>{return J.querySelectorAll("td").length>0}).forEach((J,Q)=>{let G=Q+1;J.querySelectorAll(".auto-num").forEach((U)=>{if(U.value!=G)U.value=G.toString(),U.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let q=$.closest("tr"),J=q.parentElement;if(q.classList.contains("template-row"))q.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox")Q.checked=!1;else Q.value=""});else{if(q.remove(),J)this.renumberRows(J);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,q){let J=document.getElementById("tbl_"+q);if(!J)return;let Q=J.querySelector("tbody");if(!Q)return;let G=Q.querySelector(".template-row");if(!G)return;let U=G.cloneNode(!0);U.classList.remove("template-row"),U.querySelectorAll("input").forEach((Y)=>{if(Y.type==="checkbox")Y.checked=Y.hasAttribute("checked");else Y.value=Y.getAttribute("value")||""});let X=U.querySelector(".remove-row-btn");if(X)X.style.visibility="visible";U.querySelectorAll("[data-copy-from]").forEach((Y)=>{let N=Y.dataset.copyFrom;if(N){let O=U.querySelector(`[data-base-key="${N}"]`);if(O&&O.value)Y.value=O.value}}),Q.appendChild(U),this.renumberRows(Q),this.calc.recalculate()}switchTab($,q){document.querySelectorAll(".tab-btn").forEach((Q)=>Q.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((Q)=>Q.classList.remove("active")),$.classList.add("active");let J=document.getElementById(q);if(J)J.classList.add("active")}}function TJ($){let q=document.getElementById($);if(!q||!q.textContent)return null;try{return JSON.parse(q.textContent)}catch{return null}}function zJ(){let $=TJ("weba-l2-envelope");if(!$)return;let q=TJ("weba-l2-keywrap"),J=document.querySelector(".weba-form-container")||document.body,Q=document.createElement("div");Q.className="weba-l2-unlock",Q.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let G=document.createElement("div");G.textContent="Encrypted Submission",G.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",Q.appendChild(G);let U=document.createElement("div");U.textContent="Locked. Unlock with Passkey.",U.style.cssText="color:#64748b;margin-bottom:0.75rem;",Q.appendChild(U);let X=document.createElement("button");X.textContent="Unlock (Passkey)",X.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",Q.appendChild(X);let Y=document.createElement("pre");Y.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",Q.appendChild(Y);let N=document.createElement("details");N.style.cssText="margin-top:0.75rem; display:none;",N.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',Q.appendChild(N);let O=document.createElement("button");O.textContent="Export JSON",O.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",O.disabled=!0,Q.appendChild(O),X.addEventListener("click",async()=>{if(!q){U.textContent="Key wrap package not found.";return}X.disabled=!0,U.textContent="Waiting for passkey...";try{let K=$8(q.prf_salt),W=await b0(q.credential_id,K),D=await HJ({keywrap:q,prfKey:W}),A=await p0($,D);bQ(A.layer2_plain),document.body.classList.add("weba-l2-readonly"),Y.textContent=JSON.stringify(A.layer2_plain,null,2),Y.style.display="block";let B=N.querySelector("pre");if(B)B.textContent=JSON.stringify(A.layer2_sig,null,2);N.style.display="block",O.style.display="inline-block",O.disabled=!1,U.textContent="Unlocked.",O.onclick=()=>{let x=new Blob([JSON.stringify(A,null,2)],{type:"application/json"}),E=URL.createObjectURL(x),f=document.createElement("a");f.href=E,f.download="weba-l2-decrypted.json",f.click()}}catch(K){console.error(K),U.textContent="Unlock failed.",X.disabled=!1}}),J.appendChild(Q)}function bQ($){if(!$||typeof $!=="object")return;let q=$;document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(!Q||!(Q in q))return;let G=q[Q];if(J.type==="checkbox")J.checked=Boolean(G);else if(J.type==="radio")J.checked=J.value===String(G);else J.value=G===null||G===void 0?"":String(G)}),document.querySelectorAll('input[type="radio"]').forEach((J)=>{let Q=J.name;if(!Q||!(Q in q))return;let G=q[Q];J.checked=J.value===String(G)}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey;if(!Q)return;let G=q[Q];if(!Array.isArray(G))return;let U=J.querySelector("tbody");if(!U)return;let X=U.querySelector("tr.template-row");if(!X)return;Array.from(U.querySelectorAll("tr")).forEach((Y)=>{if(!Y.classList.contains("template-row"))Y.remove()}),G.forEach((Y,N)=>{let O=N===0?X:X.cloneNode(!0);if(N>0){O.classList.remove("template-row");let K=O.querySelector(".remove-row-btn");if(K)K.style.visibility="visible";U.appendChild(O)}if(Y&&typeof Y==="object")O.querySelectorAll("input, select, textarea").forEach((K)=>{let W=K.dataset.baseKey;if(!W)return;let D=Y[W];if(K.type==="checkbox")K.checked=Boolean(D);else K.value=D===null||D===void 0?"":String(D)})})}),document.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.disabled=!0;else J.readOnly=!0}),document.querySelectorAll("textarea").forEach((J)=>{J.readOnly=!0}),document.querySelectorAll("select").forEach((J)=>{J.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((J)=>{J.disabled=!0})}function B8($){return document.getElementById($)}function DJ(){if(!B8("weba-l2-keywrap-tool"))return;let q=B8("kwp-recipient-sk"),J=B8("kwp-credential-id"),Q=B8("kwp-prf-salt"),G=B8("kwp-aad"),U=B8("kwp-kid"),X=B8("kwp-status"),Y=B8("kwp-output"),N=B8("kwp-generate-salt"),O=B8("kwp-wrap");if(!q||!J||!Q||!X||!Y||!O)return;N?.addEventListener("click",()=>{let K=new Uint8Array(32);crypto.getRandomValues(K),Q.value=O8(K)}),O.addEventListener("click",async()=>{X.textContent="Waiting for passkey...",O.disabled=!0;try{if(!q.value||!J.value||!Q.value)throw new Error("Missing required fields.");let K=$8(q.value.trim()),W=$8(Q.value.trim()),D=await b0(J.value.trim(),W),A=G?.value?$8(G.value.trim()):void 0,B=await LJ({recipientSk:K,prfKey:D,aad:A}),x={alg:"WebAuthn-PRF-AESGCM-v1",kid:U?.value||"issuer#passkey-1",credential_id:J.value.trim(),prf_salt:O8(W),wrapped_key:O8(B),...A?{aad:O8(A)}:{}};Y.textContent=JSON.stringify(x,null,2),X.textContent="Key wrap ready."}catch(K){console.error(K),X.textContent="Key wrap failed."}finally{O.disabled=!1}})}function BJ($){if(typeof DOMParser!=="undefined")return new DOMParser().parseFromString($,"text/html");if(typeof document!=="undefined"){let q=document.implementation.createHTMLDocument("");return q.documentElement.innerHTML=$,q}return null}function IJ($,q){let J=BJ($);if(J)return J.getElementById(q)?.textContent??null;let Q=new RegExp(`<script[^>]*id=["']${q}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),G=$.match(Q);return G?G[1]:null}function cQ($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function hQ($,q){let J=BJ($);if(J)return J.querySelector(`script[type="${q}"]`)?.textContent??null;let Q=new RegExp(`<script[^>]*type=["']${cQ(q)}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),G=$.match(Q);return G?G[1]:null}function pQ($){let q=IJ($,"data-layer");if(q)try{return JSON.parse(q)}catch{return null}let J=hQ($,"application/ld+json");if(J)try{return JSON.parse(J)}catch{return null}return null}function lQ($){let q=IJ($,"weba-l2-envelope");if(!q)return null;try{return JSON.parse(q)}catch{return null}}function uQ($){if(!$.trim())return null;try{let q=JSON.parse($);if(!q.recipient_x25519_private)return null;return q}catch{return null}}function dQ(){let $=document.getElementById("weba-l2-keys");if(!$?.textContent)return null;return uQ($.textContent)}function nQ($){let q={},J=(Q,G)=>{if(Q===null||Q===void 0){q[G]=null;return}if(Array.isArray(Q)){Q.forEach((U,X)=>{J(U,G?`${G}[${X}]`:`[${X}]`)});return}if(typeof Q==="object"){Object.entries(Q).forEach(([U,X])=>{let Y=G?`${G}.${U}`:U;J(X,Y)});return}q[G]=Q};if(J($,""),""in q)delete q[""];return q}function wJ($){let q={_filename:$.filename},J=new Set(["_filename"]);if($.includeJson)J.add("_json"),q._json=JSON.stringify($.plain);let Q=nQ($.plain||{});for(let G of Object.keys(Q)){if($.omitKey&&$.omitKey(G))continue;J.add(G),q[G]=Q[G]}if($.sig)J.add("_l2_sig"),q._l2_sig=JSON.stringify($.sig);return{row:q,keys:J}}async function iQ($,q){let J=lQ($);if(J&&q){if(q.recipient_kid&&J.layer2?.recipient&&q.recipient_kid!==J.layer2.recipient)throw new Error(`recipient_kid mismatch (${J.layer2.recipient})`);let G=$8(q.recipient_x25519_private),U=q.recipient_pqc_private&&q.recipient_pqc_kem==="ML-KEM-768"?{pqcProvider:globalThis.webaPqcKem??null,pqcRecipientSk:$8(q.recipient_pqc_private)}:void 0,X=await p0(J,G,U);return{plain:X.layer2_plain??X,sig:X.layer2_sig,source:"l2"}}let Q=pQ($);if(Q)return{plain:Q,source:"jsonld"};return{source:null}}function RJ($){if($===null||$===void 0)return"";let q=String($);if(/[",\n]/.test(q))return`"${q.replace(/"/g,'""')}"`;return q}function rQ($,q){let J=[];return J.push(q.map(RJ).join(",")),$.forEach((Q)=>{let G=q.map((U)=>RJ(Q[U])).join(",");J.push(G)}),"\uFEFF"+J.join(`
`)}function oQ($,q,J){if(q.length===0){$.innerHTML='<div class="agg-empty">No rows to display.</div>';return}let Q=J.map((U)=>`<th>${U}</th>`).join(""),G=q.slice(0,20).map((U)=>{return`<tr>${J.map((Y)=>`<td>${U[Y]??""}</td>`).join("")}</tr>`}).join("");$.innerHTML=`<table class="agg-table"><thead><tr>${Q}</tr></thead><tbody>${G}</tbody></table>`}function fJ(){let $=document.getElementById("aggregator-root");if(!$)return;$.innerHTML=`
    <div class="agg-panel">
      <div class="agg-row">
        <label class="agg-label">Input HTML</label>
        <input id="weba-agg-files" type="file" accept=".html" multiple />
      </div>
      <div class="agg-row">
        <label class="agg-label">L2 Key (embedded)</label>
        <div id="weba-agg-key-status" class="agg-chip">Not loaded</div>
        <div class="agg-note">Use <code>&lt;script id="weba-l2-keys"&gt;</code> to embed.</div>
      </div>
      <div class="agg-row">
        <label class="agg-label">Include JSON</label>
        <input id="weba-agg-include-json" type="checkbox" />
      </div>
      <div class="agg-row">
        <button id="weba-agg-run" class="agg-btn">Decrypt & Aggregate</button>
        <button id="weba-agg-download" class="agg-btn secondary" disabled>Download CSV</button>
      </div>
      <div id="weba-agg-status" class="agg-status">Ready.</div>
    </div>
    <div id="weba-agg-output" class="agg-output"></div>
  `;let q=$.querySelector("#weba-agg-files"),J=$.querySelector("#weba-agg-status"),Q=$.querySelector("#weba-agg-output"),G=$.querySelector("#weba-agg-include-json"),U=$.querySelector("#weba-agg-run"),X=$.querySelector("#weba-agg-download"),Y=$.querySelector("#weba-agg-key-status"),N="",O=dQ();if(Y)Y.textContent=O?.recipient_kid?`Loaded (${O.recipient_kid})`:O?"Loaded":"Not loaded",Y.classList.toggle("ready",!!O);let K=async()=>{if(!q?.files||q.files.length===0){if(J)J.textContent="Select HTML files first.";return}if(J)J.textContent="Processing...";if(X)X.disabled=!0;let W=[],D=new Set(["_filename"]),A=0,B=0,x=O;for(let f of Array.from(q.files))try{let I=await f.text(),R=await iQ(I,x);if(R.source==="l2"&&R.plain){let g=wJ({plain:R.plain,filename:f.name,includeJson:G?.checked,sig:R.sig});g.keys.forEach((m)=>D.add(m)),W.push(g.row),A+=1;continue}if(R.source==="jsonld"&&R.plain){let g=wJ({plain:R.plain,filename:f.name,includeJson:G?.checked,omitKey:(m)=>m.startsWith("@")});g.keys.forEach((m)=>D.add(m)),W.push(g.row),A+=1;continue}B+=1}catch(I){console.error(I),B+=1}let E=Array.from(D).sort((f,I)=>{if(f==="_filename")return-1;if(I==="_filename")return 1;return f.localeCompare(I)});if(N=rQ(W,E),X)X.disabled=W.length===0;if(J)J.textContent=`Processed ${A} files. Errors: ${B}.`;if(Q)oQ(Q,W,E)};U?.addEventListener("click",()=>{K().catch((W)=>{if(J)J.textContent="Failed to aggregate.";console.error(W)})}),X?.addEventListener("click",()=>{if(!N)return;let W=new Blob([N],{type:"text/csv"}),D=URL.createObjectURL(W),A=document.createElement("a");A.href=D,A.download="weba-aggregated.csv",A.click(),URL.revokeObjectURL(D)})}function AJ(){console.log("Web/A Runtime Booting...");let $=new i0,q=new P$,J=new F$($,q),Q=window,G=document.getElementById("weba-structure");if(G?.textContent)try{Q.generatedJsonStructure=JSON.parse(G.textContent)}catch(Y){console.warn("Failed to parse weba structure JSON",Y)}let U=EJ();if(U)Q.webaL2Config=U;Q.saveDraft=()=>q.saveDraft(),Q.submitDocument=()=>q.submitDocument(),Q.signAndDownload=()=>q.signAndDownload(),Q.clearData=()=>q.clearData(),Q.removeTableRow=(Y)=>J.removeTableRow(Y),Q.addTableRow=(Y,N)=>J.addTableRow(Y,N),Q.switchTab=(Y,N)=>J.switchTab(Y,N),Q.recalculate=()=>$.recalculate(),Q.escapeHtml=(Y)=>{if(!Y)return"";let N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return Y.toString().replace(/[&<>"']/g,(O)=>N[O]||O)},q.restoreFromLS(),J.applyI18n(),J.initTables(),$.recalculate(),zJ(),DJ(),fJ();let X;document.addEventListener("input",(Y)=>{let N=Y.target;if(Y.isTrusted)N.dataset.dirty="true";let O=N.dataset.baseKey||N.dataset.jsonPath;if(O)(N.closest("tr")||document).querySelectorAll(`[data-copy-from="${O}"]`).forEach((D)=>{if(!D.dataset.dirty){if(D.value!==N.value)D.value=N.value,D.dispatchEvent(new Event("input"))}});$.recalculate(),q.updateJsonLd(),clearTimeout(X),X=setTimeout(()=>q.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class k${suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let q=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",q.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let q=$.toString().toLowerCase();return q=q.replace(/[---]/g,(J)=>{return String.fromCharCode(J.charCodeAt(0)-65248)}),q=q.replace(/[-]/g,(J)=>String.fromCharCode(J.charCodeAt(0)-65248)),q.trim()}clean($){if(!$)return"";let q=this.normalize($);return q=q.replace(/(|||||npo||)/g,""),q=q.replace(/(\(\)|\(\)|\(\))/g,""),q.trim()}toIndex($){let q=parseInt($||"",10);return Number.isFinite(q)?q-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let q=window,J=$.dataset.masterSrc,Q=$.dataset.suggestSource;if(!J&&!Q)return;let G=this.toIndex($.dataset.masterLabelIndex),U=this.toIndex($.dataset.masterValueIndex),X=$.value;if(!X){this.hideSuggestions();return}let Y=[],N=this.normalize(X);if(Q==="column"){let O=$.dataset.baseKey,K=$.closest("table");if(K&&O){let W=new Set;K.querySelectorAll(`[data-base-key="${O}"]`).forEach((D)=>{if(D===$)return;let A=D.value;if(A&&this.normalize(A).includes(N)){if(!W.has(A))W.add(A),Y.push({val:A,row:[A],label:A,score:10})}})}}else if(J){let O=q.generatedJsonStructure.masterData;if(!O||!O[J])return;O[J].forEach((W,D)=>{if(D===0)return;if(W.some((B)=>this.normalize(B||"").includes(N))){let B=G>=0?W[G]||"":"",x=U>=0?W[U]||"":"",E=U>=0?x:G>=0?B:W[1]||W[0]||"";Y.push({val:E,row:W,label:B,score:10,idx:D})}})}this.renderSuggestions($,Y,G)}renderSuggestions($,q,J){if(q.length===0){this.hideSuggestions();return}let Q=window,G=q.slice(0,10),U="";G.forEach((K)=>{let W=Q.escapeHtml(JSON.stringify(K.row)),D=J>=0?K.label||K.row.join(" : "):K.row.join(" : ");U+=`<div class="suggestion-item" data-val="${Q.escapeHtml(K.val)}" data-row="${W}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${Q.escapeHtml(D)}</div>`});let X=this.getGlobalBox();X.innerHTML=U;let Y=$.getBoundingClientRect(),N=window.scrollY||document.documentElement.scrollTop,O=window.scrollX||document.documentElement.scrollLeft;X.style.width=Math.max(Y.width,200)+"px",X.style.left=Y.left+O+"px",X.style.top=Y.bottom+N+"px",X.querySelectorAll(".suggestion-item").forEach((K)=>{K.onmouseenter=()=>K.style.background="#f0f8ff",K.onmouseleave=()=>K.style.background="white"}),X.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let q=window,J=this.activeSearchInput,Q=$.dataset.val||"",G=$.dataset.row||"[]";try{let U=JSON.parse(G),X=J.dataset.masterSrc,Y=X?q.generatedJsonStructure.masterData[X][0]:[],N=!1;if(Y.length>0&&U.length>0){let O=J.closest("tr");if(O){let K=Array.from(O.querySelectorAll("input, select, textarea"));Y.forEach((W,D)=>{if(!W)return;let A=U[D];this.fillField(K,W,A,J,()=>{N=!0})})}}if(!N)J.value=Q,J.dispatchEvent(new Event("input",{bubbles:!0}))}catch(U){console.error(U)}this.hideSuggestions()}fillField($,q,J,Q,G){let U=this.normalize(q),X=$.find((Y)=>{let N=Y.dataset.baseKey||Y.dataset.jsonPath,O=this.normalize(Y.getAttribute("placeholder")||"");return N&&this.normalize(N)===U||O===U});if(X){if(X.value=J||"",X.dispatchEvent(new Event("input",{bubbles:!0})),X===Q)G()}}}var jJ=new k$;window.GlobalSearch=jJ;AJ();jJ.init();
