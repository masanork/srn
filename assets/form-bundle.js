var n1=Object.create;var{getPrototypeOf:d1,defineProperty:h8,getOwnPropertyNames:h1}=Object;var i1=Object.prototype.hasOwnProperty;var i8=($,q,J)=>{J=$!=null?n1(d1($)):{};let f=q||!$||!$.__esModule?h8(J,"default",{value:$,enumerable:!0}):J;for(let Q of h1($))if(!i1.call(f,Q))h8(f,Q,{get:()=>$[Q],enumerable:!0});return f};var r1=($,q)=>()=>(q||$((q={exports:{}}).exports,q),q.exports);var Z8=r1((af,uq)=>{uq.exports=function $(q){if(typeof q==="number"&&isNaN(q))throw new Error("NaN is not allowed");if(typeof q==="number"&&!isFinite(q))throw new Error("Infinity is not allowed");if(q===null||typeof q!=="object")return JSON.stringify(q);if(q.toJSON instanceof Function)return $(q.toJSON());if(Array.isArray(q))return`[${q.reduce((Q,U,G)=>{return`${Q}${G===0?"":","}${$(U===void 0||typeof U==="symbol"?null:U)}`},"")}]`;return`{${Object.keys(q).sort().reduce((f,Q)=>{if(q[Q]===void 0||typeof q[Q]==="symbol")return f;let U=f.length===0?"":",";return`${f}${U}${$(Q)}:${$(q[Q])}`},"")}}`}});class a${runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let q=$.dataset.copyFrom;if(q){let Q=($.closest("tr")||document).querySelector(`[data-base-key="${q}"], [data-json-path="${q}"]`);if(Q&&Q.value!==$.value)$.value=Q.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let q=$.dataset.formula;if(!q)return;let J=$.closest("tr"),f=$.closest("table"),Q=(G)=>{let X=0,N="none";if(J){let M=`[data-base-key="${G}"], [data-json-path="${G}"]`,K=J.querySelector(M);if(K){if(N="row-input",K.value!=="")X=parseFloat(K.value)}}if(N==="none"){let M=document.querySelector(`[data-json-path="${G}"]`);if(M){if(N="static-input",M.value!=="")X=parseFloat(M.value)}}return X},U=q.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(G,X)=>{let N=0,M=f||document,K=M.querySelectorAll(`[data-base-key="${X}"], [data-json-path="${X}"]`);if(K.length===0&&M!==document)K=document.querySelectorAll(`[data-base-key="${X}"], [data-json-path="${X}"]`);return K.forEach((O)=>{let W=parseFloat(O.value);if(!isNaN(W))N+=W}),N});U=U.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(G)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(G))return G;return String(Q(G))});try{let G=new Function("return "+U)();if(typeof G==="number"&&!isNaN(G))$.value=Number.isInteger(G)?G:G.toFixed(0);else $.value=""}catch(G){console.error("Calc Error:",G),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function C$($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function E0($,q=""){if(!Number.isSafeInteger($)||$<0){let J=q&&`"${q}" `;throw new Error(`${J}expected integer >= 0, got ${$}`)}}function d($,q,J=""){let f=C$($),Q=$?.length,U=q!==void 0;if(!f||U&&Q!==q){let G=J&&`"${J}" `,X=U?` of length ${q}`:"",N=f?`length=${Q}`:`type=${typeof $}`;throw new Error(G+"expected Uint8Array"+X+", got "+N)}return $}function e0($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");E0($.outputLen),E0($.blockLen)}function n0($,q=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(q&&$.finished)throw new Error("Hash#digest() has already been called")}function o8($,q){d($,void 0,"digestInto() output");let J=q.outputLen;if($.length<J)throw new Error('"digestInto() output" expected to be of length >='+J)}function C0(...$){for(let q=0;q<$.length;q++)$[q].fill(0)}function W$($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function W0($,q){return $<<32-q|$>>>q}var a8=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),o1=Array.from({length:256},($,q)=>q.toString(16).padStart(2,"0"));function d0($){if(d($),a8)return $.toHex();let q="";for(let J=0;J<$.length;J++)q+=o1[$[J]];return q}var A0={_0:48,_9:57,A:65,F:70,a:97,f:102};function r8($){if($>=A0._0&&$<=A0._9)return $-A0._0;if($>=A0.A&&$<=A0.F)return $-(A0.A-10);if($>=A0.a&&$<=A0.f)return $-(A0.a-10);return}function $$($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(a8)return Uint8Array.fromHex($);let q=$.length,J=q/2;if(q%2)throw new Error("hex string expected, got unpadded hex of length "+q);let f=new Uint8Array(J);for(let Q=0,U=0;Q<J;Q++,U+=2){let G=r8($.charCodeAt(U)),X=r8($.charCodeAt(U+1));if(G===void 0||X===void 0){let N=$[U]+$[U+1];throw new Error('hex string expected, got non-hex character "'+N+'" at index '+U)}f[Q]=G*16+X}return f}function q$(...$){let q=0;for(let f=0;f<$.length;f++){let Q=$[f];d(Q),q+=Q.length}let J=new Uint8Array(q);for(let f=0,Q=0;f<$.length;f++){let U=$[f];J.set(U,Q),Q+=U.length}return J}function s$($,q={}){let J=(Q,U)=>$(U).update(Q).digest(),f=$(void 0);return J.outputLen=f.outputLen,J.blockLen=f.blockLen,J.create=(Q)=>$(Q),Object.assign(J,q),Object.freeze(J)}function J$($=32){let q=typeof globalThis==="object"?globalThis.crypto:null;if(typeof q?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return q.getRandomValues(new Uint8Array($))}var t$=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function s8($,q,J){return $&q^~$&J}function t8($,q,J){return $&q^$&J^q&J}class E${blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,q,J,f){this.blockLen=$,this.outputLen=q,this.padOffset=J,this.isLE=f,this.buffer=new Uint8Array($),this.view=W$(this.buffer)}update($){n0(this),d($);let{view:q,buffer:J,blockLen:f}=this,Q=$.length;for(let U=0;U<Q;){let G=Math.min(f-this.pos,Q-U);if(G===f){let X=W$($);for(;f<=Q-U;U+=f)this.process(X,U);continue}if(J.set($.subarray(U,U+G),this.pos),this.pos+=G,U+=G,this.pos===f)this.process(q,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){n0(this),o8($,this),this.finished=!0;let{buffer:q,view:J,blockLen:f,isLE:Q}=this,{pos:U}=this;if(q[U++]=128,C0(this.buffer.subarray(U)),this.padOffset>f-U)this.process(J,0),U=0;for(let K=U;K<f;K++)q[K]=0;J.setBigUint64(f-8,BigInt(this.length*8),Q),this.process(J,0);let G=W$($),X=this.outputLen;if(X%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let N=X/4,M=this.get();if(N>M.length)throw new Error("_sha2: outputLen bigger than state");for(let K=0;K<N;K++)G.setUint32(4*K,M[K],Q)}digest(){let{buffer:$,outputLen:q}=this;this.digestInto($);let J=$.slice(0,q);return this.destroy(),J}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:q,buffer:J,length:f,finished:Q,destroyed:U,pos:G}=this;if($.destroyed=U,$.finished=Q,$.length=f,$.pos=G,f%q)$.buffer.set(J);return $}clone(){return this._cloneInto()}}var z0=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),B0=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),q0=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J0=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var H$=BigInt(4294967295),e8=BigInt(32);function a1($,q=!1){if(q)return{h:Number($&H$),l:Number($>>e8&H$)};return{h:Number($>>e8&H$)|0,l:Number($&H$)|0}}function $q($,q=!1){let J=$.length,f=new Uint32Array(J),Q=new Uint32Array(J);for(let U=0;U<J;U++){let{h:G,l:X}=a1($[U],q);[f[U],Q[U]]=[G,X]}return[f,Q]}var e$=($,q,J)=>$>>>J,$8=($,q,J)=>$<<32-J|q>>>J,k0=($,q,J)=>$>>>J|q<<32-J,_0=($,q,J)=>$<<32-J|q>>>J,f$=($,q,J)=>$<<64-J|q>>>J-32,Q$=($,q,J)=>$>>>J-32|q<<64-J;function H0($,q,J,f){let Q=(q>>>0)+(f>>>0);return{h:$+J+(Q/4294967296|0)|0,l:Q|0}}var qq=($,q,J)=>($>>>0)+(q>>>0)+(J>>>0),Jq=($,q,J,f)=>q+J+f+($/4294967296|0)|0,fq=($,q,J,f)=>($>>>0)+(q>>>0)+(J>>>0)+(f>>>0),Qq=($,q,J,f,Q)=>q+J+f+Q+($/4294967296|0)|0,Uq=($,q,J,f,Q)=>($>>>0)+(q>>>0)+(J>>>0)+(f>>>0)+(Q>>>0),Gq=($,q,J,f,Q,U)=>q+J+f+Q+U+($/4294967296|0)|0;var t1=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),y0=new Uint32Array(64);class q8 extends E${constructor($){super(64,$,8,!1)}get(){let{A:$,B:q,C:J,D:f,E:Q,F:U,G,H:X}=this;return[$,q,J,f,Q,U,G,X]}set($,q,J,f,Q,U,G,X){this.A=$|0,this.B=q|0,this.C=J|0,this.D=f|0,this.E=Q|0,this.F=U|0,this.G=G|0,this.H=X|0}process($,q){for(let K=0;K<16;K++,q+=4)y0[K]=$.getUint32(q,!1);for(let K=16;K<64;K++){let O=y0[K-15],W=y0[K-2],T=W0(O,7)^W0(O,18)^O>>>3,z=W0(W,17)^W0(W,19)^W>>>10;y0[K]=z+y0[K-7]+T+y0[K-16]|0}let{A:J,B:f,C:Q,D:U,E:G,F:X,G:N,H:M}=this;for(let K=0;K<64;K++){let O=W0(G,6)^W0(G,11)^W0(G,25),W=M+O+s8(G,X,N)+t1[K]+y0[K]|0,z=(W0(J,2)^W0(J,13)^W0(J,22))+t8(J,f,Q)|0;M=N,N=X,X=G,G=U+W|0,U=Q,Q=f,f=J,J=W+z|0}J=J+this.A|0,f=f+this.B|0,Q=Q+this.C|0,U=U+this.D|0,G=G+this.E|0,X=X+this.F|0,N=N+this.G|0,M=M+this.H|0,this.set(J,f,Q,U,G,X,N,M)}roundClean(){C0(y0)}destroy(){this.set(0,0,0,0,0,0,0,0),C0(this.buffer)}}class Nq extends q8{A=z0[0]|0;B=z0[1]|0;C=z0[2]|0;D=z0[3]|0;E=z0[4]|0;F=z0[5]|0;G=z0[6]|0;H=z0[7]|0;constructor(){super(32)}}class e1 extends q8{A=B0[0]|0;B=B0[1]|0;C=B0[2]|0;D=B0[3]|0;E=B0[4]|0;F=B0[5]|0;G=B0[6]|0;H=B0[7]|0;constructor(){super(28)}}var Xq=(()=>$q(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),$J=(()=>Xq[0])(),qJ=(()=>Xq[1])(),x0=new Uint32Array(80),V0=new Uint32Array(80);class U$ extends E${constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:q,Bh:J,Bl:f,Ch:Q,Cl:U,Dh:G,Dl:X,Eh:N,El:M,Fh:K,Fl:O,Gh:W,Gl:T,Hh:z,Hl:x}=this;return[$,q,J,f,Q,U,G,X,N,M,K,O,W,T,z,x]}set($,q,J,f,Q,U,G,X,N,M,K,O,W,T,z,x){this.Ah=$|0,this.Al=q|0,this.Bh=J|0,this.Bl=f|0,this.Ch=Q|0,this.Cl=U|0,this.Dh=G|0,this.Dl=X|0,this.Eh=N|0,this.El=M|0,this.Fh=K|0,this.Fl=O|0,this.Gh=W|0,this.Gl=T|0,this.Hh=z|0,this.Hl=x|0}process($,q){for(let R=0;R<16;R++,q+=4)x0[R]=$.getUint32(q),V0[R]=$.getUint32(q+=4);for(let R=16;R<80;R++){let A=x0[R-15]|0,I=V0[R-15]|0,F=k0(A,I,1)^k0(A,I,8)^e$(A,I,7),k=_0(A,I,1)^_0(A,I,8)^$8(A,I,7),l=x0[R-2]|0,B=V0[R-2]|0,P=k0(l,B,19)^f$(l,B,61)^e$(l,B,6),_=_0(l,B,19)^Q$(l,B,61)^$8(l,B,6),b=fq(k,_,V0[R-7],V0[R-16]),u=Qq(b,F,P,x0[R-7],x0[R-16]);x0[R]=u|0,V0[R]=b|0}let{Ah:J,Al:f,Bh:Q,Bl:U,Ch:G,Cl:X,Dh:N,Dl:M,Eh:K,El:O,Fh:W,Fl:T,Gh:z,Gl:x,Hh:E,Hl:y}=this;for(let R=0;R<80;R++){let A=k0(K,O,14)^k0(K,O,18)^f$(K,O,41),I=_0(K,O,14)^_0(K,O,18)^Q$(K,O,41),F=K&W^~K&z,k=O&T^~O&x,l=Uq(y,I,k,qJ[R],V0[R]),B=Gq(l,E,A,F,$J[R],x0[R]),P=l|0,_=k0(J,f,28)^f$(J,f,34)^f$(J,f,39),b=_0(J,f,28)^Q$(J,f,34)^Q$(J,f,39),u=J&Q^J&G^Q&G,Z=f&U^f&X^U&X;E=z|0,y=x|0,z=W|0,x=T|0,W=K|0,T=O|0,{h:K,l:O}=H0(N|0,M|0,B|0,P|0),N=G|0,M=X|0,G=Q|0,X=U|0,Q=J|0,U=f|0;let H=qq(P,b,Z);J=Jq(H,B,_,u),f=H|0}({h:J,l:f}=H0(this.Ah|0,this.Al|0,J|0,f|0)),{h:Q,l:U}=H0(this.Bh|0,this.Bl|0,Q|0,U|0),{h:G,l:X}=H0(this.Ch|0,this.Cl|0,G|0,X|0),{h:N,l:M}=H0(this.Dh|0,this.Dl|0,N|0,M|0),{h:K,l:O}=H0(this.Eh|0,this.El|0,K|0,O|0),{h:W,l:T}=H0(this.Fh|0,this.Fl|0,W|0,T|0),{h:z,l:x}=H0(this.Gh|0,this.Gl|0,z|0,x|0),{h:E,l:y}=H0(this.Hh|0,this.Hl|0,E|0,y|0),this.set(J,f,Q,U,G,X,N,M,K,O,W,T,z,x,E,y)}roundClean(){C0(x0,V0)}destroy(){C0(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Kq extends U${Ah=J0[0]|0;Al=J0[1]|0;Bh=J0[2]|0;Bl=J0[3]|0;Ch=J0[4]|0;Cl=J0[5]|0;Dh=J0[6]|0;Dl=J0[7]|0;Eh=J0[8]|0;El=J0[9]|0;Fh=J0[10]|0;Fl=J0[11]|0;Gh=J0[12]|0;Gl=J0[13]|0;Hh=J0[14]|0;Hl=J0[15]|0;constructor(){super(64)}}class JJ extends U${Ah=q0[0]|0;Al=q0[1]|0;Bh=q0[2]|0;Bl=q0[3]|0;Ch=q0[4]|0;Cl=q0[5]|0;Dh=q0[6]|0;Dl=q0[7]|0;Eh=q0[8]|0;El=q0[9]|0;Fh=q0[10]|0;Fl=q0[11]|0;Gh=q0[12]|0;Gl=q0[13]|0;Hh=q0[14]|0;Hl=q0[15]|0;constructor(){super(48)}}var f0=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),Q0=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class fJ extends U${Ah=f0[0]|0;Al=f0[1]|0;Bh=f0[2]|0;Bl=f0[3]|0;Ch=f0[4]|0;Cl=f0[5]|0;Dh=f0[6]|0;Dl=f0[7]|0;Eh=f0[8]|0;El=f0[9]|0;Fh=f0[10]|0;Fl=f0[11]|0;Gh=f0[12]|0;Gl=f0[13]|0;Hh=f0[14]|0;Hl=f0[15]|0;constructor(){super(28)}}class QJ extends U${Ah=Q0[0]|0;Al=Q0[1]|0;Bh=Q0[2]|0;Bl=Q0[3]|0;Ch=Q0[4]|0;Cl=Q0[5]|0;Dh=Q0[6]|0;Dl=Q0[7]|0;Eh=Q0[8]|0;El=Q0[9]|0;Fh=Q0[10]|0;Fl=Q0[11]|0;Gh=Q0[12]|0;Gl=Q0[13]|0;Hh=Q0[14]|0;Hl=Q0[15]|0;constructor(){super(32)}}var X0=s$(()=>new Nq,t$(1));var Yq=s$(()=>new Kq,t$(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Mq=BigInt(0),Zq=BigInt(1);function T$($,q=""){if(typeof $!=="boolean"){let J=q&&`"${q}" `;throw new Error(J+"expected boolean, got type="+typeof $)}return $}function UJ($){if(typeof $==="bigint"){if(!g$($))throw new Error("positive bigint expected, got "+$)}else E0($);return $}function Lq($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?Mq:BigInt("0x"+$)}function Oq($){return Lq(d0($))}function I0($){return Lq(d0(S0(d($)).reverse()))}function J8($,q){E0(q),$=UJ($);let J=$$($.toString(16).padStart(q*2,"0"));if(J.length!==q)throw new Error("number too large");return J}function R$($,q){return J8($,q).reverse()}function S0($){return Uint8Array.from($)}var g$=($)=>typeof $==="bigint"&&Mq<=$;function GJ($,q,J){return g$($)&&g$(q)&&g$(J)&&q<=$&&$<J}function h0($,q,J,f){if(!GJ(q,J,f))throw new Error("expected valid "+$+": "+J+" <= n < "+f+", got "+q)}var wq=($)=>(Zq<<BigInt($))-Zq;function b0($,q={},J={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function f(U,G,X){let N=$[U];if(X&&N===void 0)return;let M=typeof N;if(M!==G||N===null)throw new Error(`param "${U}" is invalid: expected ${G}, got ${M}`)}let Q=(U,G)=>Object.entries(U).forEach(([X,N])=>f(X,N,G));Q(q,!1),Q(J,!0)}function f8($){let q=new WeakMap;return(J,...f)=>{let Q=q.get(J);if(Q!==void 0)return Q;let U=$(J,...f);return q.set(J,U),U}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var G0=BigInt(0),U0=BigInt(1),l0=BigInt(2),Eq=BigInt(3),Hq=BigInt(4),gq=BigInt(5),NJ=BigInt(7),Tq=BigInt(8),XJ=BigInt(9),Rq=BigInt(16);function i($,q){let J=$%q;return J>=G0?J:q+J}function L0($,q,J){let f=$;while(q-- >G0)f*=f,f%=J;return f}function Cq($,q){if($===G0)throw new Error("invert: expected non-zero number");if(q<=G0)throw new Error("invert: expected positive modulus, got "+q);let J=i($,q),f=q,Q=G0,U=U0,G=U0,X=G0;while(J!==G0){let M=f/J,K=f%J,O=Q-G*M,W=U-X*M;f=J,J=K,Q=G,U=X,G=O,X=W}if(f!==U0)throw new Error("invert: does not exist");return i(Q,q)}function Q8($,q,J){if(!$.eql($.sqr(q),J))throw new Error("Cannot find square root")}function Dq($,q){let J=($.ORDER+U0)/Hq,f=$.pow(q,J);return Q8($,f,q),f}function KJ($,q){let J=($.ORDER-gq)/Tq,f=$.mul(q,l0),Q=$.pow(f,J),U=$.mul(q,Q),G=$.mul($.mul(U,l0),Q),X=$.mul(U,$.sub(G,$.ONE));return Q8($,X,q),X}function YJ($){let q=A$($),J=Aq($),f=J(q,q.neg(q.ONE)),Q=J(q,f),U=J(q,q.neg(f)),G=($+NJ)/Rq;return(X,N)=>{let M=X.pow(N,G),K=X.mul(M,f),O=X.mul(M,Q),W=X.mul(M,U),T=X.eql(X.sqr(K),N),z=X.eql(X.sqr(O),N);M=X.cmov(M,K,T),K=X.cmov(W,O,z);let x=X.eql(X.sqr(K),N),E=X.cmov(M,K,x);return Q8(X,E,N),E}}function Aq($){if($<Eq)throw new Error("sqrt is not defined for small field");let q=$-U0,J=0;while(q%l0===G0)q/=l0,J++;let f=l0,Q=A$($);while(Wq(Q,f)===1)if(f++>1000)throw new Error("Cannot find square root: probably non-prime P");if(J===1)return Dq;let U=Q.pow(f,q),G=(q+U0)/l0;return function X(N,M){if(N.is0(M))return M;if(Wq(N,M)!==1)throw new Error("Cannot find square root");let K=J,O=N.mul(N.ONE,U),W=N.pow(M,q),T=N.pow(M,G);while(!N.eql(W,N.ONE)){if(N.is0(W))return N.ZERO;let z=1,x=N.sqr(W);while(!N.eql(x,N.ONE))if(z++,x=N.sqr(x),z===K)throw new Error("Cannot find square root");let E=U0<<BigInt(K-z-1),y=N.pow(O,E);K=z,O=N.sqr(y),W=N.mul(W,O),T=N.mul(T,y)}return T}}function ZJ($){if($%Hq===Eq)return Dq;if($%Tq===gq)return KJ;if($%Rq===XJ)return YJ($);return Aq($)}var zq=($,q)=>(i($,q)&U0)===U0,MJ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Bq($){let q={ORDER:"bigint",BYTES:"number",BITS:"number"},J=MJ.reduce((f,Q)=>{return f[Q]="function",f},q);return b0($,J),$}function LJ($,q,J){if(J<G0)throw new Error("invalid exponent, negatives unsupported");if(J===G0)return $.ONE;if(J===U0)return q;let f=$.ONE,Q=q;while(J>G0){if(J&U0)f=$.mul(f,Q);Q=$.sqr(Q),J>>=U0}return f}function D$($,q,J=!1){let f=new Array(q.length).fill(J?$.ZERO:void 0),Q=q.reduce((G,X,N)=>{if($.is0(X))return G;return f[N]=G,$.mul(G,X)},$.ONE),U=$.inv(Q);return q.reduceRight((G,X,N)=>{if($.is0(X))return G;return f[N]=$.mul(G,f[N]),$.mul(G,X)},U),f}function Wq($,q){let J=($.ORDER-U0)/l0,f=$.pow(q,J),Q=$.eql(f,$.ONE),U=$.eql(f,$.ZERO),G=$.eql(f,$.neg($.ONE));if(!Q&&!U&&!G)throw new Error("invalid Legendre symbol result");return Q?1:U?0:-1}function OJ($,q){if(q!==void 0)E0(q);let J=q!==void 0?q:$.toString(2).length,f=Math.ceil(J/8);return{nBitLength:J,nByteLength:f}}class Iq{ORDER;BITS;BYTES;isLE;ZERO=G0;ONE=U0;_lengths;_sqrt;_mod;constructor($,q={}){if($<=G0)throw new Error("invalid field: expected ORDER > 0, got "+$);let J=void 0;if(this.isLE=!1,q!=null&&typeof q==="object"){if(typeof q.BITS==="number")J=q.BITS;if(typeof q.sqrt==="function")this.sqrt=q.sqrt;if(typeof q.isLE==="boolean")this.isLE=q.isLE;if(q.allowedLengths)this._lengths=q.allowedLengths?.slice();if(typeof q.modFromBytes==="boolean")this._mod=q.modFromBytes}let{nBitLength:f,nByteLength:Q}=OJ($,J);if(Q>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=f,this.BYTES=Q,this._sqrt=void 0,Object.preventExtensions(this)}create($){return i($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return G0<=$&&$<this.ORDER}is0($){return $===G0}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&U0)===U0}neg($){return i(-$,this.ORDER)}eql($,q){return $===q}sqr($){return i($*$,this.ORDER)}add($,q){return i($+q,this.ORDER)}sub($,q){return i($-q,this.ORDER)}mul($,q){return i($*q,this.ORDER)}pow($,q){return LJ(this,$,q)}div($,q){return i($*Cq(q,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,q){return $+q}subN($,q){return $-q}mulN($,q){return $*q}inv($){return Cq($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=ZJ(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?R$($,this.BYTES):J8($,this.BYTES)}fromBytes($,q=!1){d($);let{_lengths:J,BYTES:f,isLE:Q,ORDER:U,_mod:G}=this;if(J){if(!J.includes($.length)||$.length>f)throw new Error("Field.fromBytes: expected "+J+" bytes, got "+$.length);let N=new Uint8Array(f);N.set($,Q?0:N.length-$.length),$=N}if($.length!==f)throw new Error("Field.fromBytes: expected "+f+" bytes, got "+$.length);let X=Q?I0($):Oq($);if(G)X=i(X,U);if(!q){if(!this.isValid(X))throw new Error("invalid field element: outside of range 0..ORDER")}return X}invertBatch($){return D$(this,$)}cmov($,q,J){return J?q:$}}function A$($,q={}){return new Iq($,q)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var z$=BigInt(0),X8=BigInt(1);function jq($,q){let J=q.negate();return $?J:q}function B$($,q){let J=D$($.Fp,q.map((f)=>f.Z));return q.map((f,Q)=>$.fromAffine(f.toAffine(J[Q])))}function Pq($,q){if(!Number.isSafeInteger($)||$<=0||$>q)throw new Error("invalid window size, expected [1.."+q+"], got W="+$)}function U8($,q){Pq($,q);let J=Math.ceil(q/$)+1,f=2**($-1),Q=2**$,U=wq($),G=BigInt($);return{windows:J,windowSize:f,mask:U,maxNumber:Q,shiftBy:G}}function yq($,q,J){let{windowSize:f,mask:Q,maxNumber:U,shiftBy:G}=J,X=Number($&Q),N=$>>G;if(X>f)X-=U,N+=X8;let M=q*f,K=M+Math.abs(X)-1,O=X===0,W=X<0,T=q%2!==0;return{nextN:N,offset:K,isZero:O,isNeg:W,isNegF:T,offsetF:M}}var G8=new WeakMap,mq=new WeakMap;function N8($){return mq.get($)||1}function xq($){if($!==z$)throw new Error("invalid wNAF")}class K8{BASE;ZERO;Fn;bits;constructor($,q){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=q}_unsafeLadder($,q,J=this.ZERO){let f=$;while(q>z$){if(q&X8)J=J.add(f);f=f.double(),q>>=X8}return J}precomputeWindow($,q){let{windows:J,windowSize:f}=U8(q,this.bits),Q=[],U=$,G=U;for(let X=0;X<J;X++){G=U,Q.push(G);for(let N=1;N<f;N++)G=G.add(U),Q.push(G);U=G.double()}return Q}wNAF($,q,J){if(!this.Fn.isValid(J))throw new Error("invalid scalar");let f=this.ZERO,Q=this.BASE,U=U8($,this.bits);for(let G=0;G<U.windows;G++){let{nextN:X,offset:N,isZero:M,isNeg:K,isNegF:O,offsetF:W}=yq(J,G,U);if(J=X,M)Q=Q.add(jq(O,q[W]));else f=f.add(jq(K,q[N]))}return xq(J),{p:f,f:Q}}wNAFUnsafe($,q,J,f=this.ZERO){let Q=U8($,this.bits);for(let U=0;U<Q.windows;U++){if(J===z$)break;let{nextN:G,offset:X,isZero:N,isNeg:M}=yq(J,U,Q);if(J=G,N)continue;else{let K=q[X];f=f.add(M?K.negate():K)}}return xq(J),f}getPrecomputes($,q,J){let f=G8.get(q);if(!f){if(f=this.precomputeWindow(q,$),$!==1){if(typeof J==="function")f=J(f);G8.set(q,f)}}return f}cached($,q,J){let f=N8($);return this.wNAF(f,this.getPrecomputes(f,$,J),q)}unsafe($,q,J,f){let Q=N8($);if(Q===1)return this._unsafeLadder($,q,f);return this.wNAFUnsafe(Q,this.getPrecomputes(Q,$,J),q,f)}createCache($,q){Pq(q,this.bits),mq.set($,q),G8.delete($)}hasCache($){return N8($)!==1}}function Vq($,q,J){if(q){if(q.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Bq(q),q}else return A$($,{isLE:J})}function Fq($,q,J={},f){if(f===void 0)f=$==="edwards";if(!q||typeof q!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let N of["p","n","h"]){let M=q[N];if(!(typeof M==="bigint"&&M>z$))throw new Error(`CURVE.${N} must be positive bigint`)}let Q=Vq(q.p,J.Fp,f),U=Vq(q.n,J.Fn,f),X=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let N of X)if(!Q.isValid(q[N]))throw new Error(`CURVE.${N} must be valid field element of CURVE.Fp`);return q=Object.freeze(Object.assign({},q)),{CURVE:q,Fp:Q,Fn:U}}function I$($,q){return function J(f){let Q=$(f);return{secretKey:Q,publicKey:q(Q)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var P0=BigInt(0),e=BigInt(1),Y8=BigInt(2),wJ=BigInt(8);function CJ($,q,J,f){let Q=$.sqr(J),U=$.sqr(f),G=$.add($.mul(q.a,Q),U),X=$.add($.ONE,$.mul(q.d,$.mul(Q,U)));return $.eql(G,X)}function vq($,q={}){let J=Fq("edwards",$,q,q.FpFnLE),{Fp:f,Fn:Q}=J,U=J.CURVE,{h:G}=U;b0(q,{},{uvRatio:"function"});let X=Y8<<BigInt(Q.BYTES*8)-e,N=(E)=>f.create(E),M=q.uvRatio||((E,y)=>{try{return{isValid:!0,value:f.sqrt(f.div(E,y))}}catch(R){return{isValid:!1,value:P0}}});if(!CJ(f,U,U.Gx,U.Gy))throw new Error("bad curve params: generator point");function K(E,y,R=!1){let A=R?e:P0;return h0("coordinate "+E,y,A,X),y}function O(E){if(!(E instanceof z))throw new Error("EdwardsPoint expected")}let W=f8((E,y)=>{let{X:R,Y:A,Z:I}=E,F=E.is0();if(y==null)y=F?wJ:f.inv(I);let k=N(R*y),l=N(A*y),B=f.mul(I,y);if(F)return{x:P0,y:e};if(B!==e)throw new Error("invZ was invalid");return{x:k,y:l}}),T=f8((E)=>{let{a:y,d:R}=U;if(E.is0())throw new Error("bad point: ZERO");let{X:A,Y:I,Z:F,T:k}=E,l=N(A*A),B=N(I*I),P=N(F*F),_=N(P*P),b=N(l*y),u=N(P*N(b+B)),Z=N(_+N(R*N(l*B)));if(u!==Z)throw new Error("bad point: equation left != right (1)");let H=N(A*I),w=N(F*k);if(H!==w)throw new Error("bad point: equation left != right (2)");return!0});class z{static BASE=new z(U.Gx,U.Gy,e,N(U.Gx*U.Gy));static ZERO=new z(P0,e,e,P0);static Fp=f;static Fn=Q;X;Y;Z;T;constructor(E,y,R,A){this.X=K("x",E),this.Y=K("y",y),this.Z=K("z",R,!0),this.T=K("t",A),Object.freeze(this)}static CURVE(){return U}static fromAffine(E){if(E instanceof z)throw new Error("extended point not allowed");let{x:y,y:R}=E||{};return K("x",y),K("y",R),new z(y,R,e,N(y*R))}static fromBytes(E,y=!1){let R=f.BYTES,{a:A,d:I}=U;E=S0(d(E,R,"point")),T$(y,"zip215");let F=S0(E),k=E[R-1];F[R-1]=k&-129;let l=I0(F),B=y?X:f.ORDER;h0("point.y",l,P0,B);let P=N(l*l),_=N(P-e),b=N(I*P-A),{isValid:u,value:Z}=M(_,b);if(!u)throw new Error("bad point: invalid y coordinate");let H=(Z&e)===e,w=(k&128)!==0;if(!y&&Z===P0&&w)throw new Error("bad point: x=0 and x_0=1");if(w!==H)Z=N(-Z);return z.fromAffine({x:Z,y:l})}static fromHex(E,y=!1){return z.fromBytes($$(E),y)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(E=8,y=!0){if(x.createCache(this,E),!y)this.multiply(Y8);return this}assertValidity(){T(this)}equals(E){O(E);let{X:y,Y:R,Z:A}=this,{X:I,Y:F,Z:k}=E,l=N(y*k),B=N(I*A),P=N(R*k),_=N(F*A);return l===B&&P===_}is0(){return this.equals(z.ZERO)}negate(){return new z(N(-this.X),this.Y,this.Z,N(-this.T))}double(){let{a:E}=U,{X:y,Y:R,Z:A}=this,I=N(y*y),F=N(R*R),k=N(Y8*N(A*A)),l=N(E*I),B=y+R,P=N(N(B*B)-I-F),_=l+F,b=_-k,u=l-F,Z=N(P*b),H=N(_*u),w=N(P*u),g=N(b*_);return new z(Z,H,g,w)}add(E){O(E);let{a:y,d:R}=U,{X:A,Y:I,Z:F,T:k}=this,{X:l,Y:B,Z:P,T:_}=E,b=N(A*l),u=N(I*B),Z=N(k*R*_),H=N(F*P),w=N((A+I)*(l+B)-b-u),g=H-Z,D=H+Z,j=N(u-y*b),m=N(w*g),v=N(D*j),S=N(w*j),c=N(g*D);return new z(m,v,c,S)}subtract(E){return this.add(E.negate())}multiply(E){if(!Q.isValidNot0(E))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:y,f:R}=x.cached(this,E,(A)=>B$(z,A));return B$(z,[y,R])[0]}multiplyUnsafe(E,y=z.ZERO){if(!Q.isValid(E))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(E===P0)return z.ZERO;if(this.is0()||E===e)return this;return x.unsafe(this,E,(R)=>B$(z,R),y)}isSmallOrder(){return this.multiplyUnsafe(G).is0()}isTorsionFree(){return x.unsafe(this,U.n).is0()}toAffine(E){return W(this,E)}clearCofactor(){if(G===e)return this;return this.multiplyUnsafe(G)}toBytes(){let{x:E,y}=this.toAffine(),R=f.toBytes(y);return R[R.length-1]|=E&e?128:0,R}toHex(){return d0(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let x=new K8(z,Q.BITS);return z.BASE.precompute(8),z}function kq($,q,J={}){if(typeof q!=="function")throw new Error('"hash" function param is required');b0(J,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:f}=J,{BASE:Q,Fp:U,Fn:G}=$,X=J.randomBytes||J$,N=J.adjustScalarBytes||((B)=>B),M=J.domain||((B,P,_)=>{if(T$(_,"phflag"),P.length||_)throw new Error("Contexts/pre-hash are not supported");return B});function K(B){return G.create(I0(B))}function O(B){let P=A.secretKey;d(B,A.secretKey,"secretKey");let _=d(q(B),2*P,"hashedSecretKey"),b=N(_.slice(0,P)),u=_.slice(P,2*P),Z=K(b);return{head:b,prefix:u,scalar:Z}}function W(B){let{head:P,prefix:_,scalar:b}=O(B),u=Q.multiply(b),Z=u.toBytes();return{head:P,prefix:_,scalar:b,point:u,pointBytes:Z}}function T(B){return W(B).pointBytes}function z(B=Uint8Array.of(),...P){let _=q$(...P);return K(q(M(_,d(B,void 0,"context"),!!f)))}function x(B,P,_={}){if(B=d(B,void 0,"message"),f)B=f(B);let{prefix:b,scalar:u,pointBytes:Z}=W(P),H=z(_.context,b,B),w=Q.multiply(H).toBytes(),g=z(_.context,w,Z,B),D=G.create(H+g*u);if(!G.isValid(D))throw new Error("sign failed: invalid s");let j=q$(w,G.toBytes(D));return d(j,A.signature,"result")}let E={zip215:!0};function y(B,P,_,b=E){let{context:u,zip215:Z}=b,H=A.signature;if(B=d(B,H,"signature"),P=d(P,void 0,"message"),_=d(_,A.publicKey,"publicKey"),Z!==void 0)T$(Z,"zip215");if(f)P=f(P);let w=H/2,g=B.subarray(0,w),D=I0(B.subarray(w,H)),j,m,v;try{j=$.fromBytes(_,Z),m=$.fromBytes(g,Z),v=Q.multiplyUnsafe(D)}catch(t0){return!1}if(!Z&&j.isSmallOrder())return!1;let S=z(u,m.toBytes(),j.toBytes(),P);return m.add(j.multiplyUnsafe(S)).subtract(v).clearCofactor().is0()}let R=U.BYTES,A={secretKey:R,publicKey:R,signature:2*R,seed:R};function I(B=X(A.seed)){return d(B,A.seed,"seed")}function F(B){return C$(B)&&B.length===G.BYTES}function k(B,P){try{return!!$.fromBytes(B,P)}catch(_){return!1}}let l={getExtendedPublicKey:W,randomSecretKey:I,isValidSecretKey:F,isValidPublicKey:k,toMontgomery(B){let{y:P}=$.fromBytes(B),_=A.publicKey,b=_===32;if(!b&&_!==57)throw new Error("only defined for 25519 and 448");let u=b?U.div(e+P,e-P):U.div(P-e,P+e);return U.toBytes(u)},toMontgomerySecret(B){let P=A.secretKey;d(B,P);let _=q(B.subarray(0,P));return N(_).subarray(0,P)}};return Object.freeze({keygen:I$(I,T),getPublicKey:T,sign:x,verify:y,utils:l,Point:$,lengths:A})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var G$=BigInt(0),i0=BigInt(1),j$=BigInt(2);function WJ($){return b0($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function _q($){let q=WJ($),{P:J,type:f,adjustScalarBytes:Q,powPminus2:U,randomBytes:G}=q,X=f==="x25519";if(!X&&f!=="x448")throw new Error("invalid type");let N=G||J$,M=X?255:448,K=X?32:56,O=X?BigInt(9):BigInt(5),W=X?BigInt(121665):BigInt(39081),T=X?j$**BigInt(254):j$**BigInt(447),z=X?BigInt(8)*j$**BigInt(251)-i0:BigInt(4)*j$**BigInt(445)-i0,x=T+z+i0,E=(H)=>i(H,J),y=R(O);function R(H){return R$(E(H),K)}function A(H){let w=S0(d(H,K,"uCoordinate"));if(X)w[31]&=127;return E(I0(w))}function I(H){return I0(Q(S0(d(H,K,"scalar"))))}function F(H,w){let g=_(A(w),I(H));if(g===G$)throw new Error("invalid private or public key received");return R(g)}function k(H){return F(H,y)}let l=k,B=F;function P(H,w,g){let D=E(H*(w-g));return w=E(w-D),g=E(g+D),{x_2:w,x_3:g}}function _(H,w){h0("u",H,G$,J),h0("scalar",w,T,x);let g=w,D=H,j=i0,m=G$,v=H,S=i0,c=G$;for(let h$=BigInt(M-1);h$>=G$;h$--){let b8=g>>h$&i0;c^=b8,{x_2:j,x_3:v}=P(c,j,v),{x_2:m,x_3:S}=P(c,m,S),c=b8;let i$=j+m,r$=E(i$*i$),o$=j-m,l8=E(o$*o$),c8=r$-l8,u1=v+S,p1=v-S,u8=E(p1*i$),p8=E(u1*o$),n8=u8+p8,d8=u8-p8;v=E(n8*n8),S=E(D*E(d8*d8)),j=E(r$*l8),m=E(c8*(r$+E(W*c8)))}({x_2:j,x_3:v}=P(c,j,v)),{x_2:m,x_3:S}=P(c,m,S);let t0=U(m);return E(j*t0)}let b={secretKey:K,publicKey:K,seed:K},u=(H=N(K))=>{return d(H,b.seed,"seed"),H},Z={randomSecretKey:u};return Object.freeze({keygen:I$(u,l),getSharedSecret:B,getPublicKey:l,scalarMult:F,scalarMultBase:k,utils:Z,GuBytes:y.slice(),lengths:b})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var EJ=BigInt(1),Sq=BigInt(2),HJ=BigInt(3),gJ=BigInt(5),TJ=BigInt(8),y$=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),RJ=(()=>({p:y$,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:TJ,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function lq($){let q=BigInt(10),J=BigInt(20),f=BigInt(40),Q=BigInt(80),U=y$,X=$*$%U*$%U,N=L0(X,Sq,U)*X%U,M=L0(N,EJ,U)*$%U,K=L0(M,gJ,U)*M%U,O=L0(K,q,U)*K%U,W=L0(O,J,U)*O%U,T=L0(W,f,U)*W%U,z=L0(T,Q,U)*T%U,x=L0(z,Q,U)*T%U,E=L0(x,q,U)*K%U;return{pow_p_5_8:L0(E,Sq,U)*$%U,b2:X}}function cq($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var bq=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function DJ($,q){let J=y$,f=i(q*q*q,J),Q=i(f*f*q,J),U=lq($*Q).pow_p_5_8,G=i($*f*U,J),X=i(q*G*G,J),N=G,M=i(G*bq,J),K=X===$,O=X===i(-$,J),W=X===i(-$*bq,J);if(K)G=N;if(O||W)G=M;if(zq(G,J))G=i(-G,J);return{isValid:K||O,value:G}}var AJ=vq(RJ,{uvRatio:DJ});function zJ($){return kq(AJ,Yq,Object.assign({adjustScalarBytes:cq},$))}var m0=zJ({});var N$=(()=>{let $=y$;return _q({P:$,type:"x25519",powPminus2:(q)=>{let{pow_p_5_8:J,b2:f}=lq(q);return i(L0(J,HJ,$)*f,$)},adjustScalarBytes:cq})})();var Y1=i8(Z8(),1);var M8;try{M8=new TextDecoder}catch($){}var V,u0,C=0;var iq=[],BJ=105,IJ=57342,jJ=57343,pq=57337;var nq=6,r0={},X$=112810000,j0=16810000;var L8=iq,O8=0,p={},r,P$,m$=0,Y$=0,a,O0,o=[],w8=[],K0,N0,K$,dq={useRecords:!1,mapsAsObjects:!0},Z$=!1,rq=2;try{new Function("")}catch($){rq=1/0}class F0{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[q,J]of Object.entries($.keyMap))this.mapKey.set(J,q)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let q=new Map;for(let[J,f]of Object.entries($))q.set(this._keyMap.hasOwnProperty(J)?this._keyMap[J]:J,f);return q}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[J,f]of Object.entries(this._keyMap))this._mapKey.set(f,J)}let q={};return $.forEach((J,f)=>q[w0(this._mapKey.has(f)?this._mapKey.get(f):f)]=J),q}mapDecode($,q){let J=this.decode($);if(this._keyMap)switch(J.constructor.name){case"Array":return J.map((f)=>this.decodeKeys(f))}return J}decode($,q){if(V)return tq(()=>{return F$(),this?this.decode($,q):F0.prototype.decode.call(dq,$,q)});u0=q>-1?q:$.length,C=0,O8=0,Y$=0,P$=null,L8=iq,a=null,V=$;try{N0=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(J){if(V=null,$ instanceof Uint8Array)throw J;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof F0){if(p=this,K0=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return r=this.structures,x$();else if(!r||r.length>0)r=[]}else{if(p=dq,!r||r.length>0)r=[];K0=null}return x$()}decodeMultiple($,q){let J,f=0;try{let Q=$.length;Z$=!0;let U=this?this.decode($,Q):T8.decode($,Q);if(q){if(q(U)===!1)return;while(C<Q)if(f=C,q(x$())===!1)return}else{J=[U];while(C<Q)f=C,J.push(x$());return J}}catch(Q){throw Q.lastPosition=f,Q.values=J,Q}finally{Z$=!1,F$()}}}function x$(){try{let $=n();if(a){if(C>=a.postBundlePosition){let q=new Error("Unexpected bundle position");throw q.incomplete=!0,q}C=a.postBundlePosition,a=null}if(C==u0){if(r=null,V=null,O0)O0=null}else if(C>u0){let q=new Error("Unexpected end of CBOR data");throw q.incomplete=!0,q}else if(!Z$)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(F$(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function n(){let $=V[C++],q=$>>5;if($=$&31,$>23)switch($){case 24:$=V[C++];break;case 25:if(q==7)return PJ();$=N0.getUint16(C),C+=2;break;case 26:if(q==7){let J=N0.getFloat32(C);if(p.useFloat32>2){let f=v$[(V[C]&127)<<1|V[C+1]>>7];return C+=4,(f*J+(J>0?0.5:-0.5)>>0)/f}return C+=4,J}$=N0.getUint32(C),C+=4;break;case 27:if(q==7){let J=N0.getFloat64(C);return C+=8,J}if(q>1){if(N0.getUint32(C)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=N0.getUint32(C+4)}else if(p.int64AsNumber)$=N0.getUint32(C)*4294967296,$+=N0.getUint32(C+4);else $=N0.getBigUint64(C);C+=8;break;case 31:switch(q){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let J=[],f,Q=0;while((f=n())!=r0){if(Q>=X$)throw new Error(`Array length exceeds ${X$}`);J[Q++]=f}return q==4?J:q==3?J.join(""):Buffer.concat(J);case 5:let U;if(p.mapsAsObjects){let G={},X=0;if(p.keyMap)while((U=n())!=r0){if(X++>=j0)throw new Error(`Property count exceeds ${j0}`);G[w0(p.decodeKey(U))]=n()}else while((U=n())!=r0){if(X++>=j0)throw new Error(`Property count exceeds ${j0}`);G[w0(U)]=n()}return G}else{if(K$)p.mapsAsObjects=!0,K$=!1;let G=new Map;if(p.keyMap){let X=0;while((U=n())!=r0){if(X++>=j0)throw new Error(`Map size exceeds ${j0}`);G.set(p.decodeKey(U),n())}}else{let X=0;while((U=n())!=r0){if(X++>=j0)throw new Error(`Map size exceeds ${j0}`);G.set(U,n())}}return G}case 7:return r0;default:throw new Error("Invalid major type for indefinite length "+q)}default:throw new Error("Unknown token "+$)}switch(q){case 0:return $;case 1:return~$;case 2:return VJ($);case 3:if(Y$>=C)return P$.slice(C-m$,(C+=$)-m$);if(Y$==0&&u0<140&&$<32){let Q=$<16?oq($):xJ($);if(Q!=null)return Q}return yJ($);case 4:if($>=X$)throw new Error(`Array length exceeds ${X$}`);let J=new Array($);for(let Q=0;Q<$;Q++)J[Q]=n();return J;case 5:if($>=j0)throw new Error(`Map size exceeds ${X$}`);if(p.mapsAsObjects){let Q={};if(p.keyMap)for(let U=0;U<$;U++)Q[w0(p.decodeKey(n()))]=n();else for(let U=0;U<$;U++)Q[w0(n())]=n();return Q}else{if(K$)p.mapsAsObjects=!0,K$=!1;let Q=new Map;if(p.keyMap)for(let U=0;U<$;U++)Q.set(p.decodeKey(n()),n());else for(let U=0;U<$;U++)Q.set(n(),n());return Q}case 6:if($>=pq){let Q=r[$&8191];if(Q){if(!Q.read)Q.read=C8(Q);return Q.read()}if($<65536){if($==jJ){let U=a0(),G=n(),X=n();E8(G,X);let N={};if(p.keyMap)for(let M=2;M<U;M++){let K=p.decodeKey(X[M-2]);N[w0(K)]=n()}else for(let M=2;M<U;M++){let K=X[M-2];N[w0(K)]=n()}return N}else if($==IJ){let U=a0(),G=n();for(let X=2;X<U;X++)E8(G++,n());return n()}else if($==pq)return SJ();if(p.getShared){if(g8(),Q=r[$&8191],Q){if(!Q.read)Q.read=C8(Q);return Q.read()}}}}let f=o[$];if(f)if(f.handlesRead)return f(n);else return f(n());else{let Q=n();for(let U=0;U<w8.length;U++){let G=w8[U]($,Q);if(G!==void 0)return G}return new g0(Q,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let Q=(K0||c0())[$];if(Q!==void 0)return Q;throw new Error("Unknown token "+$)}default:if(isNaN($)){let Q=new Error("Unexpected end of CBOR data");throw Q.incomplete=!0,Q}throw new Error("Unknown CBOR token "+$)}}var hq=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function C8($){if(!$)throw new Error("Structure is required in record definition");function q(){let J=V[C++];if(J=J&31,J>23)switch(J){case 24:J=V[C++];break;case 25:J=N0.getUint16(C),C+=2;break;case 26:J=N0.getUint32(C),C+=4;break;default:throw new Error("Expected array header, but got "+V[C-1])}let f=this.compiledReader;while(f){if(f.propertyCount===J)return f(n);f=f.next}if(this.slowReads++>=rq){let U=this.length==J?this:this.slice(0,J);if(f=p.keyMap?new Function("r","return {"+U.map((G)=>p.decodeKey(G)).map((G)=>hq.test(G)?w0(G)+":r()":"["+JSON.stringify(G)+"]:r()").join(",")+"}"):new Function("r","return {"+U.map((G)=>hq.test(G)?w0(G)+":r()":"["+JSON.stringify(G)+"]:r()").join(",")+"}"),this.compiledReader)f.next=this.compiledReader;return f.propertyCount=J,this.compiledReader=f,f(n)}let Q={};if(p.keyMap)for(let U=0;U<J;U++)Q[w0(p.decodeKey(this[U]))]=n();else for(let U=0;U<J;U++)Q[w0(this[U])]=n();return Q}return $.slowReads=0,q}function w0($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var yJ=W8;function W8($){let q;if($<16){if(q=oq($))return q}if($>64&&M8)return M8.decode(V.subarray(C,C+=$));let J=C+$,f=[];q="";while(C<J){let Q=V[C++];if((Q&128)===0)f.push(Q);else if((Q&224)===192){let U=V[C++]&63;f.push((Q&31)<<6|U)}else if((Q&240)===224){let U=V[C++]&63,G=V[C++]&63;f.push((Q&31)<<12|U<<6|G)}else if((Q&248)===240){let U=V[C++]&63,G=V[C++]&63,X=V[C++]&63,N=(Q&7)<<18|U<<12|G<<6|X;if(N>65535)N-=65536,f.push(N>>>10&1023|55296),N=56320|N&1023;f.push(N)}else f.push(Q);if(f.length>=4096)q+=$0.apply(String,f),f.length=0}if(f.length>0)q+=$0.apply(String,f);return q}var $0=String.fromCharCode;function xJ($){let q=C,J=new Array($);for(let f=0;f<$;f++){let Q=V[C++];if((Q&128)>0){C=q;return}J[f]=Q}return $0.apply(String,J)}function oq($){if($<4)if($<2)if($===0)return"";else{let q=V[C++];if((q&128)>1){C-=1;return}return $0(q)}else{let q=V[C++],J=V[C++];if((q&128)>0||(J&128)>0){C-=2;return}if($<3)return $0(q,J);let f=V[C++];if((f&128)>0){C-=3;return}return $0(q,J,f)}else{let q=V[C++],J=V[C++],f=V[C++],Q=V[C++];if((q&128)>0||(J&128)>0||(f&128)>0||(Q&128)>0){C-=4;return}if($<6)if($===4)return $0(q,J,f,Q);else{let U=V[C++];if((U&128)>0){C-=5;return}return $0(q,J,f,Q,U)}else if($<8){let U=V[C++],G=V[C++];if((U&128)>0||(G&128)>0){C-=6;return}if($<7)return $0(q,J,f,Q,U,G);let X=V[C++];if((X&128)>0){C-=7;return}return $0(q,J,f,Q,U,G,X)}else{let U=V[C++],G=V[C++],X=V[C++],N=V[C++];if((U&128)>0||(G&128)>0||(X&128)>0||(N&128)>0){C-=8;return}if($<10)if($===8)return $0(q,J,f,Q,U,G,X,N);else{let M=V[C++];if((M&128)>0){C-=9;return}return $0(q,J,f,Q,U,G,X,N,M)}else if($<12){let M=V[C++],K=V[C++];if((M&128)>0||(K&128)>0){C-=10;return}if($<11)return $0(q,J,f,Q,U,G,X,N,M,K);let O=V[C++];if((O&128)>0){C-=11;return}return $0(q,J,f,Q,U,G,X,N,M,K,O)}else{let M=V[C++],K=V[C++],O=V[C++],W=V[C++];if((M&128)>0||(K&128)>0||(O&128)>0||(W&128)>0){C-=12;return}if($<14)if($===12)return $0(q,J,f,Q,U,G,X,N,M,K,O,W);else{let T=V[C++];if((T&128)>0){C-=13;return}return $0(q,J,f,Q,U,G,X,N,M,K,O,W,T)}else{let T=V[C++],z=V[C++];if((T&128)>0||(z&128)>0){C-=14;return}if($<15)return $0(q,J,f,Q,U,G,X,N,M,K,O,W,T,z);let x=V[C++];if((x&128)>0){C-=15;return}return $0(q,J,f,Q,U,G,X,N,M,K,O,W,T,z,x)}}}}}function VJ($){return p.copyBuffers?Uint8Array.prototype.slice.call(V,C,C+=$):V.subarray(C,C+=$)}var aq=new Float32Array(1),V$=new Uint8Array(aq.buffer,0,4);function PJ(){let $=V[C++],q=V[C++],J=($&127)>>2;if(J===31){if(q||$&3)return NaN;return $&128?-1/0:1/0}if(J===0){let f=(($&3)<<8|q)/16777216;return $&128?-f:f}return V$[3]=$&128|(J>>1)+56,V$[2]=($&7)<<5|q>>3,V$[1]=q<<5,V$[0]=0,aq[0]}var sf=new Array(4096);class g0{constructor($,q){this.value=$,this.tag=q}}o[0]=($)=>{return new Date($)};o[1]=($)=>{return new Date(Math.round($*1000))};o[2]=($)=>{let q=BigInt(0);for(let J=0,f=$.byteLength;J<f;J++)q=BigInt($[J])+(q<<BigInt(8));return q};o[3]=($)=>{return BigInt(-1)-o[2]($)};o[4]=($)=>{return+($[1]+"e"+$[0])};o[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var E8=($,q)=>{$=$-57344;let J=r[$];if(J&&J.isShared)(r.restoreStructures||(r.restoreStructures=[]))[$]=J;r[$]=q,q.read=C8(q)};o[BJ]=($)=>{let q=$.length,J=$[1];E8($[0],J);let f={};for(let Q=2;Q<q;Q++){let U=J[Q-2];f[w0(U)]=$[Q]}return f};o[14]=($)=>{if(a)return a[0].slice(a.position0,a.position0+=$);return new g0($,14)};o[15]=($)=>{if(a)return a[1].slice(a.position1,a.position1+=$);return new g0($,15)};var mJ={Error,RegExp};o[27]=($)=>{return(mJ[$[0]]||Error)($[1],$[2])};var sq=($)=>{if(V[C++]!=132){let J=new Error("Packed values structure must be followed by a 4 element array");if(V.length<C)J.incomplete=!0;throw J}let q=$();if(!q||!q.length){let J=new Error("Packed values structure must be followed by a 4 element array");throw J.incomplete=!0,J}return K0=K0?q.concat(K0.slice(q.length)):q,K0.prefixes=$(),K0.suffixes=$(),$()};sq.handlesRead=!0;o[51]=sq;o[nq]=($)=>{if(!K0)if(p.getShared)g8();else return new g0($,nq);if(typeof $=="number")return K0[16+($>=0?2*$:-2*$-1)];let q=new Error("No support for non-integer packed references yet");if($===void 0)q.incomplete=!0;throw q};o[28]=($)=>{if(!O0)O0=new Map,O0.id=0;let q=O0.id++,J=C,f=V[C],Q;if(f>>5==4)Q=[];else Q={};let U={target:Q};O0.set(q,U);let G=$();if(U.used){if(Object.getPrototypeOf(Q)!==Object.getPrototypeOf(G))C=J,Q=G,O0.set(q,{target:Q}),G=$();return Object.assign(Q,G)}return U.target=G,G};o[28].handlesRead=!0;o[29]=($)=>{let q=O0.get($);return q.used=!0,q.target};o[258]=($)=>new Set($);(o[259]=($)=>{if(p.mapsAsObjects)p.mapsAsObjects=!1,K$=!0;return $()}).handlesRead=!0;function o0($,q){if(typeof $==="string")return $+q;if($ instanceof Array)return $.concat(q);return Object.assign({},$,q)}function c0(){if(!K0)if(p.getShared)g8();else throw new Error("No packed values available");return K0}var FJ=1399353956;w8.push(($,q)=>{if($>=225&&$<=255)return o0(c0().prefixes[$-224],q);if($>=28704&&$<=32767)return o0(c0().prefixes[$-28672],q);if($>=1879052288&&$<=2147483647)return o0(c0().prefixes[$-1879048192],q);if($>=216&&$<=223)return o0(q,c0().suffixes[$-216]);if($>=27647&&$<=28671)return o0(q,c0().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return o0(q,c0().suffixes[$-1811939328]);if($==FJ)return{packedValues:K0,structures:r.slice(0),version:q};if($==55799)return q});var vJ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,H8=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],kJ=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<H8.length;$++)_J(H8[$],kJ[$]);function _J($,q){let J="get"+$.name.slice(0,-5),f;if(typeof $==="function")f=$.BYTES_PER_ELEMENT;else $=null;for(let Q=0;Q<2;Q++){if(!Q&&f==1)continue;let U=f==2?1:f==4?2:f==8?3:0;o[Q?q:q-4]=f==1||Q==vJ?(G)=>{if(!$)throw new Error("Could not find typed array for code "+q);if(!p.copyBuffers){if(f===1||f===2&&!(G.byteOffset&1)||f===4&&!(G.byteOffset&3)||f===8&&!(G.byteOffset&7))return new $(G.buffer,G.byteOffset,G.byteLength>>U)}return new $(Uint8Array.prototype.slice.call(G,0).buffer)}:(G)=>{if(!$)throw new Error("Could not find typed array for code "+q);let X=new DataView(G.buffer,G.byteOffset,G.byteLength),N=G.length>>U,M=new $(N),K=X[J];for(let O=0;O<N;O++)M[O]=K.call(X,O<<U,Q);return M}}}function SJ(){let $=a0(),q=C+n();for(let f=2;f<$;f++){let Q=a0();C+=Q}let J=C;return C=q,a=[W8(a0()),W8(a0())],a.position0=0,a.position1=0,a.postBundlePosition=C,C=J,n()}function a0(){let $=V[C++]&31;if($>23)switch($){case 24:$=V[C++];break;case 25:$=N0.getUint16(C),C+=2;break;case 26:$=N0.getUint32(C),C+=4;break}return $}function g8(){if(p.getShared){let $=tq(()=>{return V=null,p.getShared()})||{},q=$.structures||[];if(p.sharedVersion=$.version,K0=p.sharedValues=$.packedValues,r===!0)p.structures=r=q;else r.splice.apply(r,[0,q.length].concat(q))}}function tq($){let q=u0,J=C,f=O8,Q=m$,U=Y$,G=P$,X=L8,N=O0,M=a,K=new Uint8Array(V.slice(0,u0)),O=r,W=p,T=Z$,z=$();return u0=q,C=J,O8=f,m$=Q,Y$=U,P$=G,L8=X,O0=N,a=M,V=K,Z$=T,r=O,p=W,N0=new DataView(V.buffer,V.byteOffset,V.byteLength),z}function F$(){V=null,O0=null,r=null}var v$=new Array(147);for(let $=0;$<256;$++)v$[$]=+("1e"+Math.floor(45.15-$*0.30103));var T8=new F0({useRecords:!1}),k$=T8.decode,bJ=T8.decodeMultiple;var _$;try{_$=new TextEncoder}catch($){}var B8,U1,b$=typeof globalThis==="object"&&globalThis.Buffer,M$=typeof b$!=="undefined",R8=M$?b$.allocUnsafeSlow:Uint8Array,eq=M$?b$:Uint8Array,$1=256,q1=M$?4294967296:2144337920;var D8,L,h,Y=0,v0,s=null,lJ=61440,cJ=/[\u0080-\uFFFF]/,Z0=Symbol("record-id");class l$ extends F0{constructor($){super($);this.offset=0;let q,J,f,Q,U,G;$=$||{};let X=eq.prototype.utf8Write?function(Z,H,w){return L.utf8Write(Z,H,w)}:_$&&_$.encodeInto?function(Z,H){return _$.encodeInto(Z,L.subarray(H)).written}:!1,N=this,M=$.structures||$.saveStructures,K=$.maxSharedStructures;if(K==null)K=M?128:0;if(K>8190)throw new Error("Maximum maxSharedStructure is 8190");let O=$.sequential;if(O)K=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let W,T,z=$.sharedValues,x;if(z){x=Object.create(null);for(let Z=0,H=z.length;Z<H;Z++)x[z[Z]]=Z}let E=[],y=0,R=0;this.mapEncode=function(Z,H){if(this._keyMap&&!this._mapped)switch(Z.constructor.name){case"Array":Z=Z.map((w)=>this.encodeKeys(w));break}return this.encode(Z,H)},this.encode=function(Z,H){if(!L)L=new R8(8192),h=new DataView(L.buffer,0,8192),Y=0;if(v0=L.length-10,v0-Y<2048)L=new R8(L.length),h=new DataView(L.buffer,0,L.length),v0=L.length-10,Y=0;else if(H===j8)Y=Y+7&2147483640;if(J=Y,N.useSelfDescribedHeader)h.setUint32(Y,3654940416),Y+=3;if(G=N.structuredClone?new Map:null,N.bundleStrings&&typeof Z!=="string")s=[],s.size=1/0;else s=null;if(f=N.structures,f){if(f.uninitialized){let g=N.getShared()||{};N.structures=f=g.structures||[],N.sharedVersion=g.version;let D=N.sharedValues=g.packedValues;if(D){x={};for(let j=0,m=D.length;j<m;j++)x[D[j]]=j}}let w=f.length;if(w>K&&!O)w=K;if(!f.transitions){f.transitions=Object.create(null);for(let g=0;g<w;g++){let D=f[g];if(!D)continue;let j,m=f.transitions;for(let v=0,S=D.length;v<S;v++){if(m[Z0]===void 0)m[Z0]=g;let c=D[v];if(j=m[c],!j)j=m[c]=Object.create(null);m=j}m[Z0]=g|1048576}}if(!O)f.nextId=w}if(Q)Q=!1;if(U=f||[],T=x,$.pack){let w=new Map;if(w.values=[],w.encoder=N,w.maxValues=$.maxPrivatePackedValues||(x?16:1/0),w.objectMap=x||!1,w.samplingPackedValues=W,S$(Z,w),w.values.length>0){L[Y++]=216,L[Y++]=51,R0(4);let g=w.values;A(g),R0(0),R0(0),T=Object.create(x||null);for(let D=0,j=g.length;D<j;D++)T[g[D]]=D}}D8=H&z8;try{if(D8)return;if(A(Z),s)f1(J,A);if(N.offset=Y,G&&G.idsToInsert){if(Y+=G.idsToInsert.length*2,Y>v0)F(Y);N.offset=Y;let w=nJ(L.subarray(J,Y),G.idsToInsert);return G=null,w}if(H&j8)return L.start=J,L.end=Y,L;return L.subarray(J,Y)}finally{if(f){if(R<10)R++;if(f.length>K)f.length=K;if(y>1e4){if(f.transitions=null,R=0,y=0,E.length>0)E=[]}else if(E.length>0&&!O){for(let w=0,g=E.length;w<g;w++)E[w][Z0]=void 0;E=[]}}if(Q&&N.saveShared){if(N.structures.length>K)N.structures=N.structures.slice(0,K);let w=L.subarray(J,Y);if(N.updateSharedData()===!1)return N.encode(Z);return w}if(H&rJ)Y=J}},this.findCommonStringsToPack=()=>{if(W=new Map,!x)x=Object.create(null);return(Z)=>{let H=Z&&Z.threshold||4,w=this.pack?Z.maxPrivatePackedValues||16:0;if(!z)z=this.sharedValues=[];for(let[g,D]of W)if(D.count>H)x[g]=w++,z.push(g),Q=!0;while(this.saveShared&&this.updateSharedData()===!1);W=null}};let A=(Z)=>{if(Y>v0)L=F(Y);var H=typeof Z,w;if(H==="string"){if(T){let m=T[Z];if(m>=0){if(m<16)L[Y++]=m+224;else if(L[Y++]=198,m&1)A(15-m>>1);else A(m-16>>1);return}else if(W&&!$.pack){let v=W.get(Z);if(v)v.count++;else W.set(Z,{count:1})}}let g=Z.length;if(s&&g>=4&&g<1024){if((s.size+=g)>lJ){let v,S=(s[0]?s[0].length*3+s[1].length:0)+10;if(Y+S>v0)L=F(Y+S);if(L[Y++]=217,L[Y++]=223,L[Y++]=249,L[Y++]=s.position?132:130,L[Y++]=26,v=Y-J,Y+=4,s.position)f1(J,A);s=["",""],s.size=0,s.position=v}let m=cJ.test(Z);s[m?0:1]+=Z,L[Y++]=m?206:207,A(g);return}let D;if(g<32)D=1;else if(g<256)D=2;else if(g<65536)D=3;else D=5;let j=g*3;if(Y+j>v0)L=F(Y+j);if(g<64||!X){let m,v,S,c=Y+D;for(m=0;m<g;m++)if(v=Z.charCodeAt(m),v<128)L[c++]=v;else if(v<2048)L[c++]=v>>6|192,L[c++]=v&63|128;else if((v&64512)===55296&&((S=Z.charCodeAt(m+1))&64512)===56320)v=65536+((v&1023)<<10)+(S&1023),m++,L[c++]=v>>18|240,L[c++]=v>>12&63|128,L[c++]=v>>6&63|128,L[c++]=v&63|128;else L[c++]=v>>12|224,L[c++]=v>>6&63|128,L[c++]=v&63|128;w=c-Y-D}else w=X(Z,Y+D,j);if(w<24)L[Y++]=96|w;else if(w<256){if(D<2)L.copyWithin(Y+2,Y+1,Y+1+w);L[Y++]=120,L[Y++]=w}else if(w<65536){if(D<3)L.copyWithin(Y+3,Y+2,Y+2+w);L[Y++]=121,L[Y++]=w>>8,L[Y++]=w&255}else{if(D<5)L.copyWithin(Y+5,Y+3,Y+3+w);L[Y++]=122,h.setUint32(Y,w),Y+=4}Y+=w}else if(H==="number")if(!this.alwaysUseFloat&&Z>>>0===Z)if(Z<24)L[Y++]=Z;else if(Z<256)L[Y++]=24,L[Y++]=Z;else if(Z<65536)L[Y++]=25,L[Y++]=Z>>8,L[Y++]=Z&255;else L[Y++]=26,h.setUint32(Y,Z),Y+=4;else if(!this.alwaysUseFloat&&Z>>0===Z)if(Z>=-24)L[Y++]=31-Z;else if(Z>=-256)L[Y++]=56,L[Y++]=~Z;else if(Z>=-65536)L[Y++]=57,h.setUint16(Y,~Z),Y+=2;else L[Y++]=58,h.setUint32(Y,~Z),Y+=4;else{let g;if((g=this.useFloat32)>0&&Z<4294967296&&Z>=-2147483648){L[Y++]=250,h.setFloat32(Y,Z);let D;if(g<4||(D=Z*v$[(L[Y]&127)<<1|L[Y+1]>>7])>>0===D){Y+=4;return}else Y--}L[Y++]=251,h.setFloat64(Y,Z),Y+=8}else if(H==="object")if(!Z)L[Y++]=246;else{if(G){let D=G.get(Z);if(D){if(L[Y++]=216,L[Y++]=29,L[Y++]=25,!D.references){let j=G.idsToInsert||(G.idsToInsert=[]);D.references=[],j.push(D)}D.references.push(Y-J),Y+=2;return}else G.set(Z,{offset:Y-J})}let g=Z.constructor;if(g===Object)I(Z);else if(g===Array){if(w=Z.length,w<24)L[Y++]=128|w;else R0(w);for(let D=0;D<w;D++)A(Z[D])}else if(g===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)L[Y++]=217,L[Y++]=1,L[Y++]=3;if(w=Z.size,w<24)L[Y++]=160|w;else if(w<256)L[Y++]=184,L[Y++]=w;else if(w<65536)L[Y++]=185,L[Y++]=w>>8,L[Y++]=w&255;else L[Y++]=186,h.setUint32(Y,w),Y+=4;if(N.keyMap)for(let[D,j]of Z)A(N.encodeKey(D)),A(j);else for(let[D,j]of Z)A(D),A(j)}else{for(let D=0,j=B8.length;D<j;D++){let m=U1[D];if(Z instanceof m){let v=B8[D],S=v.tag;if(S==null)S=v.getTag&&v.getTag.call(this,Z);if(S<24)L[Y++]=192|S;else if(S<256)L[Y++]=216,L[Y++]=S;else if(S<65536)L[Y++]=217,L[Y++]=S>>8,L[Y++]=S&255;else if(S>-1)L[Y++]=218,h.setUint32(Y,S),Y+=4;v.encode.call(this,Z,A,F);return}}if(Z[Symbol.iterator]){if(D8){let D=new Error("Iterable should be serialized as iterator");throw D.iteratorNotHandled=!0,D}L[Y++]=159;for(let D of Z)A(D);L[Y++]=255;return}if(Z[Symbol.asyncIterator]||A8(Z)){let D=new Error("Iterable/blob should be serialized as iterator");throw D.iteratorNotHandled=!0,D}if(this.useToJSON&&Z.toJSON){let D=Z.toJSON();if(D!==Z)return A(D)}I(Z)}}else if(H==="boolean")L[Y++]=Z?245:244;else if(H==="bigint"){if(Z<BigInt(1)<<BigInt(64)&&Z>=0)L[Y++]=27,h.setBigUint64(Y,Z);else if(Z>-(BigInt(1)<<BigInt(64))&&Z<0)L[Y++]=59,h.setBigUint64(Y,-Z-BigInt(1));else if(this.largeBigIntToFloat)L[Y++]=251,h.setFloat64(Y,Number(Z));else{if(Z>=BigInt(0))L[Y++]=194;else L[Y++]=195,Z=BigInt(-1)-Z;let g=[];while(Z)g.push(Number(Z&BigInt(255))),Z>>=BigInt(8);I8(new Uint8Array(g.reverse()),F);return}Y+=8}else if(H==="undefined")L[Y++]=247;else throw new Error("Unknown type: "+H)},I=this.useRecords===!1?this.variableMapSize?(Z)=>{let H=Object.keys(Z),w=Object.values(Z),g=H.length;if(g<24)L[Y++]=160|g;else if(g<256)L[Y++]=184,L[Y++]=g;else if(g<65536)L[Y++]=185,L[Y++]=g>>8,L[Y++]=g&255;else L[Y++]=186,h.setUint32(Y,g),Y+=4;let D;if(N.keyMap)for(let j=0;j<g;j++)A(N.encodeKey(H[j])),A(w[j]);else for(let j=0;j<g;j++)A(H[j]),A(w[j])}:(Z)=>{L[Y++]=185;let H=Y-J;Y+=2;let w=0;if(N.keyMap){for(let g in Z)if(typeof Z.hasOwnProperty!=="function"||Z.hasOwnProperty(g))A(N.encodeKey(g)),A(Z[g]),w++}else for(let g in Z)if(typeof Z.hasOwnProperty!=="function"||Z.hasOwnProperty(g))A(g),A(Z[g]),w++;L[H+++J]=w>>8,L[H+J]=w&255}:(Z,H)=>{let w,g=U.transitions||(U.transitions=Object.create(null)),D=0,j=0,m,v;if(this.keyMap){v=Object.keys(Z).map((c)=>this.encodeKey(c)),j=v.length;for(let c=0;c<j;c++){let t0=v[c];if(w=g[t0],!w)w=g[t0]=Object.create(null),D++;g=w}}else for(let c in Z)if(typeof Z.hasOwnProperty!=="function"||Z.hasOwnProperty(c)){if(w=g[c],!w){if(g[Z0]&1048576)m=g[Z0]&65535;w=g[c]=Object.create(null),D++}g=w,j++}let S=g[Z0];if(S!==void 0)S&=65535,L[Y++]=217,L[Y++]=S>>8|224,L[Y++]=S&255;else{if(!v)v=g.__keys__||(g.__keys__=Object.keys(Z));if(m===void 0){if(S=U.nextId++,!S)S=0,U.nextId=1;if(S>=$1)U.nextId=(S=K)+1}else S=m;if(U[S]=v,S<K){L[Y++]=217,L[Y++]=S>>8|224,L[Y++]=S&255,g=U.transitions;for(let c=0;c<j;c++){if(g[Z0]===void 0||g[Z0]&1048576)g[Z0]=S;g=g[v[c]]}g[Z0]=S|1048576,Q=!0}else{if(g[Z0]=S,h.setUint32(Y,3655335680),Y+=3,D)y+=R*D;if(E.length>=$1-K)E.shift()[Z0]=void 0;if(E.push(g),R0(j+2),A(57344+S),A(v),H)return;for(let c in Z)if(typeof Z.hasOwnProperty!=="function"||Z.hasOwnProperty(c))A(Z[c]);return}}if(j<24)L[Y++]=128|j;else R0(j);if(H)return;for(let c in Z)if(typeof Z.hasOwnProperty!=="function"||Z.hasOwnProperty(c))A(Z[c])},F=(Z)=>{let H;if(Z>16777216){if(Z-J>q1)throw new Error("Encoded buffer would be larger than maximum buffer size");H=Math.min(q1,Math.round(Math.max((Z-J)*(Z>67108864?1.25:2),4194304)/4096)*4096)}else H=(Math.max(Z-J<<2,L.length-1)>>12)+1<<12;let w=new R8(H);if(h=new DataView(w.buffer,0,H),L.copy)L.copy(w,0,J,Z);else w.set(L.slice(J,Z));return Y-=J,J=0,v0=w.length-10,L=w},k=100,l=1000;this.encodeAsIterable=function(Z,H){return b(Z,H,B)},this.encodeAsAsyncIterable=function(Z,H){return b(Z,H,u)};function*B(Z,H,w){let g=Z.constructor;if(g===Object){let D=N.useRecords!==!1;if(D)I(Z,!0);else J1(Object.keys(Z).length,160);for(let j in Z){let m=Z[j];if(!D)A(j);if(m&&typeof m==="object")if(H[j])yield*B(m,H[j]);else yield*P(m,H,j);else A(m)}}else if(g===Array){let D=Z.length;R0(D);for(let j=0;j<D;j++){let m=Z[j];if(m&&(typeof m==="object"||Y-J>k))if(H.element)yield*B(m,H.element);else yield*P(m,H,"element");else A(m)}}else if(Z[Symbol.iterator]&&!Z.buffer){L[Y++]=159;for(let D of Z)if(D&&(typeof D==="object"||Y-J>k))if(H.element)yield*B(D,H.element);else yield*P(D,H,"element");else A(D);L[Y++]=255}else if(A8(Z))J1(Z.size,64),yield L.subarray(J,Y),yield Z,_();else if(Z[Symbol.asyncIterator])L[Y++]=159,yield L.subarray(J,Y),yield Z,_(),L[Y++]=255;else A(Z);if(w&&Y>J)yield L.subarray(J,Y);else if(Y-J>k)yield L.subarray(J,Y),_()}function*P(Z,H,w){let g=Y-J;try{if(A(Z),Y-J>k)yield L.subarray(J,Y),_()}catch(D){if(D.iteratorNotHandled)H[w]={},Y=J+g,yield*B.call(this,Z,H[w]);else throw D}}function _(){k=l,N.encode(null,z8)}function b(Z,H,w){if(H&&H.chunkThreshold)k=l=H.chunkThreshold;else k=100;if(Z&&typeof Z==="object")return N.encode(null,z8),w(Z,N.iterateProperties||(N.iterateProperties={}),!0);return[N.encode(Z)]}async function*u(Z,H){for(let w of B(Z,H,!0)){let g=w.constructor;if(g===eq||g===Uint8Array)yield w;else if(A8(w)){let D=w.stream().getReader(),j;while(!(j=await D.read()).done)yield j.value}else if(w[Symbol.asyncIterator])for await(let D of w)if(_(),D)yield*u(D,H.async||(H.async={}));else yield N.encode(D);else yield w}}}useBuffer($){L=$,h=new DataView(L.buffer,L.byteOffset,L.byteLength),Y=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let q=this.structures.slice(0),J=new y8(q,this.sharedValues,this.sharedVersion),f=this.saveShared(J,(Q)=>(Q&&Q.version||0)==$);if(f===!1)J=this.getShared()||{},this.structures=J.structures||[],this.sharedValues=J.packedValues,this.sharedVersion=J.version,this.structures.nextId=this.structures.length;else q.forEach((Q,U)=>this.structures[U]=Q);return f}}function J1($,q){if($<24)L[Y++]=q|$;else if($<256)L[Y++]=q|24,L[Y++]=$;else if($<65536)L[Y++]=q|25,L[Y++]=$>>8,L[Y++]=$&255;else L[Y++]=q|26,h.setUint32(Y,$),Y+=4}class y8{constructor($,q,J){this.structures=$,this.packedValues=q,this.version=J}}function R0($){if($<24)L[Y++]=128|$;else if($<256)L[Y++]=152,L[Y++]=$;else if($<65536)L[Y++]=153,L[Y++]=$>>8,L[Y++]=$&255;else L[Y++]=154,h.setUint32(Y,$),Y+=4}var uJ=typeof Blob==="undefined"?function(){}:Blob;function A8($){if($ instanceof uJ)return!0;let q=$[Symbol.toStringTag];return q==="Blob"||q==="File"}function S$($,q){switch(typeof $){case"string":if($.length>3){if(q.objectMap[$]>-1||q.values.length>=q.maxValues)return;let f=q.get($);if(f){if(++f.count==2)q.values.push($)}else if(q.set($,{count:1}),q.samplingPackedValues){let Q=q.samplingPackedValues.get($);if(Q)Q.count++;else q.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let f=0,Q=$.length;f<Q;f++)S$($[f],q);else{let f=!q.encoder.useRecords;for(var J in $)if($.hasOwnProperty(J)){if(f)S$(J,q);S$($[J],q)}}break;case"function":console.log($)}}var pJ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;U1=[Date,Set,Error,RegExp,g0,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,y8];B8=[{tag:1,encode($,q){let J=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&J>=0&&J<4294967296)L[Y++]=26,h.setUint32(Y,J),Y+=4;else L[Y++]=251,h.setFloat64(Y,J),Y+=8}},{tag:258,encode($,q){let J=Array.from($);q(J)}},{tag:27,encode($,q){q([$.name,$.message])}},{tag:27,encode($,q){q(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,q){q($.value)}},{encode($,q,J){I8($,J)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||M$&&this.tagUint8Array!==!1)return 64}},encode($,q,J){I8($,J)}},T0(68,1),T0(69,2),T0(70,4),T0(71,8),T0(72,1),T0(77,2),T0(78,4),T0(79,8),T0(85,4),T0(86,8),{encode($,q){let J=$.packedValues||[],f=$.structures||[];if(J.values.length>0){L[Y++]=216,L[Y++]=51,R0(4);let Q=J.values;q(Q),R0(0),R0(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let U=0,G=Q.length;U<G;U++)packedObjectMap[Q[U]]=U}if(f){h.setUint32(Y,3655335424),Y+=3;let Q=f.slice(0);Q.unshift(57344),Q.push(new g0($.version,1399353956)),q(Q)}else q(new g0($.version,1399353956))}}];function T0($,q){if(!pJ&&q>1)$-=4;return{tag:$,encode:function J(f,Q){let U=f.byteLength,G=f.byteOffset||0,X=f.buffer||f;Q(M$?b$.from(X,G,U):new Uint8Array(X,G,U))}}}function I8($,q){let J=$.byteLength;if(J<24)L[Y++]=64+J;else if(J<256)L[Y++]=88,L[Y++]=J;else if(J<65536)L[Y++]=89,L[Y++]=J>>8,L[Y++]=J&255;else L[Y++]=90,h.setUint32(Y,J),Y+=4;if(Y+J>=L.length)q(Y+J);L.set($.buffer?$:new Uint8Array($),Y),Y+=J}function nJ($,q){let J,f=q.length*2,Q=$.length-f;q.sort((U,G)=>U.offset>G.offset?1:-1);for(let U=0;U<q.length;U++){let G=q[U];G.id=U;for(let X of G.references)$[X++]=U>>8,$[X]=U&255}while(J=q.pop()){let U=J.offset;$.copyWithin(U+f,U,Q),f-=2;let G=U+f;$[G++]=216,$[G++]=28,Q=U}return $}function f1($,q){h.setUint32(s.position+$,Y-s.position-$+1);let J=s;s=null,q(J[0]),q(J[1])}var x8=new l$({useRecords:!1}),dJ=x8.encode,hJ=x8.encodeAsIterable,iJ=x8.encodeAsAsyncIterable;var j8=512,rJ=1024,z8=2048;var c$=($)=>{let q=new Uint8Array($),J="";for(let f=0;f<q.byteLength;f++)J+=String.fromCharCode(q[f]);return btoa(J).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},G1=($)=>{let q=atob($.replace(/-/g,"+").replace(/_/g,"/")),J=new Uint8Array(q.length);for(let f=0;f<q.length;f++)J[f]=q.charCodeAt(f);return J.buffer};async function N1($){let q=crypto.getRandomValues(new Uint8Array(32)),J=crypto.getRandomValues(new Uint8Array(16)),f=await navigator.credentials.create({publicKey:{challenge:q,rp:{name:"Sorane Web/A Form"},user:{id:J,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:60000,attestation:"none"}});if(!f)throw new Error("Credential creation failed");return{id:f.id,rawId:c$(f.rawId),response:f.response}}async function X1($,q){let J=await navigator.credentials.get({publicKey:{challenge:q,allowCredentials:[{id:G1($),type:"public-key"}],userVerification:"required"}});if(!J)throw new Error("Assertion failed");let f=J.response;return{id:J.id,signature:c$(f.signature),authenticatorData:c$(f.authenticatorData),clientDataJSON:c$(f.clientDataJSON)}}async function u$($,q){let J=crypto.getRandomValues(new Uint8Array(32)),f=await navigator.credentials.get({publicKey:{challenge:J,allowCredentials:[{id:G1($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:q}}}}});if(!f)throw new Error("Assertion failed");let U=f.getClientExtensionResults()?.prf?.results?.first;if(!U)throw new Error("PRF extension not available");return new Uint8Array(U)}function L$($){return Array.from($).map((q)=>q.toString(16).padStart(2,"0")).join("")}function K1($){let q=new Uint8Array($.length/2);for(let J=0;J<q.length;J++)q[J]=parseInt($.substring(J*2,J*2+2),16);return q}class Z1{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),q=localStorage.getItem("weba_passkey_pub");if($&&q){this.credentialId=$,this.publicKey=K1(q),this.publicKeyType="p256",this.usePasskey=!0;return}let J=localStorage.getItem("weba_private_key");if(J)this.edPrivateKey=K1(J),this.publicKey=m0.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey...");let $=await N1("User"),q=new Uint8Array($.response.attestationObject),f=k$(q).authData,Q=new DataView(f.buffer,f.byteOffset,f.byteLength),U=53,G=Q.getUint16(U);U+=2,U+=G;let X=f.slice(U),N=k$(X),M=N.get(-2),K=N.get(-3);if(!M||!K)throw new Error("Invalid COSE Key: x or y missing");let O=new Uint8Array(65);if(O[0]=4,O.set(M,1),O.set(K,33),this.credentialId=$.rawId,this.publicKey=O,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",L$(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=m0.utils.randomSecretKey(),this.publicKey=m0.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",L$(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${L$(this.publicKey)}`}getPublicKey(){return this.publicKey?L$(this.publicKey):""}async sign($,q="authentication"){if(!this.publicKey)await this.register();let J=Y1.default($),f=new TextEncoder().encode(J);if(this.usePasskey&&this.credentialId){let Q=await crypto.subtle.digest("SHA-256",f),U=await X1(this.credentialId,Q);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:U.signature,"srn:authenticatorData":U.authenticatorData,"srn:clientDataJSON":U.clientDataJSON,"srn:credentialId":U.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let Q=m0.sign(f,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:L$(Q)}}}}}var s0=new Z1;class V8{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,q){if(e0($),d(q,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let J=this.blockLen,f=new Uint8Array(J);f.set(q.length>J?$.create().update(q).digest():q);for(let Q=0;Q<f.length;Q++)f[Q]^=54;this.iHash.update(f),this.oHash=$.create();for(let Q=0;Q<f.length;Q++)f[Q]^=106;this.oHash.update(f),C0(f)}update($){return n0(this),this.iHash.update($),this}digestInto($){n0(this),d($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:q,iHash:J,finished:f,destroyed:Q,blockLen:U,outputLen:G}=this;return $=$,$.finished=f,$.destroyed=Q,$.blockLen=U,$.outputLen=G,$.oHash=q._cloneInto($.oHash),$.iHash=J._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var p$=($,q,J)=>new V8($,q).update(J).digest();p$.create=($,q)=>new V8($,q);function oJ($,q,J){if(e0($),J===void 0)J=new Uint8Array($.outputLen);return p$($,J,q)}var P8=Uint8Array.of(0),M1=Uint8Array.of();function aJ($,q,J,f=32){e0($),E0(f,"length");let Q=$.outputLen;if(f>255*Q)throw new Error("Length must be <= 255*HashLen");let U=Math.ceil(f/Q);if(J===void 0)J=M1;else d(J,void 0,"info");let G=new Uint8Array(U*Q),X=p$.create($,q),N=X._cloneInto(),M=new Uint8Array(X.outputLen);for(let K=0;K<U;K++)P8[0]=K+1,N.update(K===0?M1:M).update(J).update(P8).digestInto(M),G.set(M,Q*K),X._cloneInto(N);return X.destroy(),N.destroy(),C0(M,P8),G.slice(0,f)}var Y0=($,q,J,f,Q)=>aJ($,oJ($,q,J),f,Q);var w1=i8(Z8(),1),L1="weba_l2_ed25519_sk";function M0($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let q="";return $.forEach((f)=>{q+=String.fromCharCode(f)}),btoa(q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function t($){let q=$.length%4===0?"":"=".repeat(4-$.length%4),J=$.replace(/-/g,"+").replace(/_/g,"/")+q;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(J,"base64"));let f=atob(J),Q=new Uint8Array(f.length);for(let U=0;U<f.length;U+=1)Q[U]=f.charCodeAt(U);return Q}function O$($){let q=w1.default($);if(q===void 0)throw new Error("Failed to canonicalize JSON");return q}function O1($){let q=new Uint8Array($);return crypto.getRandomValues(q),q}function sJ(){let $=localStorage.getItem(L1);if($)return t($);let q=m0.utils.randomSecretKey();return localStorage.setItem(L1,M0(q)),q}function tJ($,q,J){let f={layer1_ref:$,recipient:q,weba_version:J};return new TextEncoder().encode(O$(f))}function C1($,q){let J=new Uint8Array($.length+q.length);return J.set($,0),J.set(q,$.length),J}function W1($){let q=$.keyPolicy??"campaign+layer1";if(q==="campaign+layer1"&&!$.layer1Ref)throw new Error("layer1_ref is required for campaign+layer1 policy");let J=O$({domain:"weba-l2/org-x25519",campaign_id:$.campaignId,key_policy:q,layer1_ref:q==="campaign+layer1"?$.layer1Ref:void 0}),f=new TextEncoder().encode(J),Q=Y0(X0,$.orgRootKey,void 0,f,32);return{publicKey:N$.getPublicKey(Q),privateKey:Q,keyPolicy:q}}function E1(){return globalThis.webaPqcKem||null}async function H1($,q,J,f){let Q=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["encrypt"]),U=await crypto.subtle.encrypt({name:"AES-GCM",iv:J,additionalData:f},Q,$);return new Uint8Array(U)}async function g1($){let q=Y0(X0,$.prfKey,void 0,void 0,32),J=Y0(X0,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),f=Y0(X0,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),Q=$.aad??new Uint8Array;return H1($.recipientSk,J,f,Q)}async function T1($,q,J,f){let Q=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["decrypt"]),U=await crypto.subtle.decrypt({name:"AES-GCM",iv:J,additionalData:f},Q,$);return new Uint8Array(U)}async function R1($){let q=$.config.weba_version??"0.1",J=$.config.recipient_kid,f=$.config.layer1_ref,Q=$.user_kid??"user#sig-1",U=sJ(),G=O$($.layer2_plain),X=new TextEncoder().encode(G),N=m0.sign(X,U),M={alg:"Ed25519",kid:Q,sig:M0(N),created_at:new Date().toISOString()},K={layer2_plain:$.layer2_plain,layer2_sig:M},O=tJ(f,J,q),W=new TextEncoder().encode(O$(K)),T=t($.config.recipient_x25519),z=O1(32),x=N$.getPublicKey(z),E=N$.getSharedSecret(z,T),y=E,R,A="X25519";if($.config.recipient_pqc){let B=$.pqcProvider??E1();if(!B)throw new Error("PQC requested but no provider is available");let P=t($.config.recipient_pqc),_=B.encapsulate(P);R=_.encapsulation,y=C1(E,_.sharedSecret),A=`X25519+${B.kemId}`}let I=Y0(X0,y,O,void 0,32),F=Y0(X0,I,void 0,new TextEncoder().encode("weba-l2/key"),32),k=Y0(X0,I,void 0,new TextEncoder().encode("weba-l2/iv"),12),l=await H1(W,F,k,O);return{weba_version:q,layer1_ref:f,layer2:{enc:"HPKE-v1",suite:{kem:A,kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:J,encapsulated:{classical:M0(x),...R?{pqc:M0(R)}:{}},ciphertext:M0(l),aad:M0(O)},meta:{created_at:new Date().toISOString(),nonce:M0(O1(16)),...$.config.campaign_id?{campaign_id:$.config.campaign_id}:{},...$.config.key_policy?{key_policy:$.config.key_policy}:{}}}}function D1(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function n$($,q,J){let f=t($.layer2.aad),Q={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},U=new TextEncoder().encode(O$(Q));if(M0(U)!==$.layer2.aad)throw new Error("AAD mismatch");let G=t($.layer2.encapsulated.classical),X=N$.getSharedSecret(q,G),N=X;if($.layer2.encapsulated.pqc){let z=J?.pqcProvider??E1(),x=J?.pqcRecipientSk;if(!z||!x)throw new Error("Missing PQC KEM for envelope");let E=t($.layer2.encapsulated.pqc),y=z.decapsulate(x,E);N=C1(X,y)}let M=Y0(X0,N,f,void 0,32),K=Y0(X0,M,void 0,new TextEncoder().encode("weba-l2/key"),32),O=Y0(X0,M,void 0,new TextEncoder().encode("weba-l2/iv"),12),W=t($.layer2.ciphertext),T=await T1(W,K,O,f);return JSON.parse(new TextDecoder().decode(T))}async function A1($){let q=Y0(X0,$.prfKey,void 0,void 0,32),J=Y0(X0,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),f=Y0(X0,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),Q=$.keywrap.aad?t($.keywrap.aad):new Uint8Array,U=t($.keywrap.wrapped_key);return T1(U,J,f,Q)}function eJ($){$.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.checked=!1,J.removeAttribute("checked");else J.value="",J.removeAttribute("value")}),$.querySelectorAll("textarea").forEach((J)=>{J.value="",J.textContent=""}),$.querySelectorAll("select").forEach((J)=>{J.selectedIndex=-1,J.querySelectorAll("option").forEach((f)=>f.removeAttribute("selected"))}),$.getElementById("json-ld")?.remove(),$.getElementById("data-layer")?.remove();let q=$.getElementById("json-debug");if(q)q.textContent=""}function $f($,q){let J=JSON.stringify(q,null,2),f=$.createElement("script");f.type="application/ld+json",f.id="weba-user-vc",f.textContent=J,$.body.appendChild(f);let Q=$.createElement("div");Q.className="weba-user-verification no-print",Q.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",Q.innerHTML=`
    <details>
      <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
        <span></span> 
      </summary>
      <div style="padding: 1rem 0;">
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
      </div>
    </details>
  `;let U=Q.querySelector("pre");if(U)U.textContent=J;$.body.appendChild(Q)}function qf($,q){let J=$.createElement("script");J.id="weba-l2-envelope",J.type="application/json",J.textContent=JSON.stringify(q,null,2),$.body.appendChild(J)}function Jf($,q){let J=new Date,f=J.getFullYear()+("0"+(J.getMonth()+1)).slice(-2)+("0"+J.getDate()).slice(-2)+"-"+("0"+J.getHours()).slice(-2)+("0"+J.getMinutes()).slice(-2),Q=Math.random().toString(36).substring(2,8);return`${$}_${f}_${q}_${Q}.html`}function ff($,q){let f=new DOMParser().parseFromString($,"text/html");if(q?.stripPlaintext)eJ(f);if(q?.embeddedVc)$f(f,q.embeddedVc);if(q?.l2Envelope)qf(f,q.l2Envelope);return f.documentElement.outerHTML}function z1($){let q=ff($.documentHtml,$.options),J=new Blob([q],{type:"text/html"}),f=URL.createObjectURL(J),Q=document.createElement("a");if(Q.href=f,Q.download=Jf($.title,$.filenameSuffix),Q.click(),$.isFinal)setTimeout(()=>window.location.reload(),1000)}class m8{formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let q=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((Q)=>{let U=Q.dataset.jsonPath;if(U)q[U]=Q.value}),document.querySelectorAll('[type="radio"]:checked').forEach((Q)=>{q[Q.name]=Q.value}),document.querySelectorAll("table.data-table.dynamic").forEach((Q)=>{let U=Q.dataset.tableKey;if(U){let G=[];Q.querySelectorAll("tbody tr").forEach((X)=>{let N={},M=!1;if(X.querySelectorAll("[data-base-key]").forEach((K)=>{if(K.type==="checkbox"){if(N[K.dataset.baseKey]=K.checked,K.checked)M=!0}else if(N[K.dataset.baseKey]=K.value,K.value)M=!0}),M)G.push(N)}),q[U]=G}});let J=document.getElementById("json-ld");if(J)J.textContent=JSON.stringify(q,null,2);let f=document.getElementById("json-debug");if(f)f.textContent=JSON.stringify(q,null,2);return q}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),q=window,J=q.generatedJsonStructure&&q.generatedJsonStructure.name||"Response",f=window.location.href.split("#")[0],Q=this.getL2Config(),U=document.getElementById("weba-l2-encrypt");if(!!(Q?.enabled&&(U?U.checked:Q.default_enabled))){if(!Q?.recipient_kid||!Q?.recipient_x25519||!Q?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let N=await R1({layer2_plain:$,config:Q,user_kid:Q.user_kid});this.downloadHtml("submit",!0,{l2Envelope:N,stripPlaintext:!0})}catch(N){console.error(N),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!s0.getPublicKey()){if(!await s0.register()){alert("Key registration failed.");return}}let X={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:s0.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:f,answers:$}};try{let N=await s0.sign(X);this.downloadHtml("submitted",!0,{embeddedVc:N})}catch(N){console.error(N),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let q=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((J)=>{let f=J.dataset.jsonPath;if(q[f]!==void 0)J.value=q[f]}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let f=J.dataset.tableKey,Q=q[f];if(Array.isArray(Q)){let U=J.querySelector("tbody");if(!U)return;let G=U.querySelectorAll(".template-row");Q.forEach((X,N)=>{let M;if(N===0)M=U.querySelector(".template-row");else{let K=U.querySelector(".template-row");if(K){M=K.cloneNode(!0),M.classList.remove("template-row");let O=M.querySelector(".remove-row-btn");if(O)O.style.visibility="visible";U.appendChild(M)}}if(M)M.querySelectorAll("input, select").forEach((K)=>{let O=K.dataset.baseKey;if(O&&X[O]!==void 0)if(K.type==="checkbox")K.checked=!!X[O];else K.value=X[O]})})}})}catch(q){console.error(q)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,q,J){let f=window,Q=f.generatedJsonStructure&&f.generatedJsonStructure.name||"web-a-form";z1({documentHtml:document.documentElement.outerHTML,title:Q,filenameSuffix:$,isFinal:q,options:J})}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class F8{calc;data;constructor($,q){this.calc=$,this.data=q}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},q=(navigator.language||"en").startsWith("ja")?"ja":"en",J=$[q]||$.en;document.querySelectorAll("[data-i18n]").forEach((f)=>{let Q=f.dataset.i18n;if(J[Q])f.textContent=J[Q]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((J)=>{return J.querySelectorAll("td").length>0}).forEach((J,f)=>{let Q=f+1;J.querySelectorAll(".auto-num").forEach((U)=>{if(U.value!=Q)U.value=Q.toString(),U.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let q=$.closest("tr"),J=q.parentElement;if(q.classList.contains("template-row"))q.querySelectorAll("input").forEach((f)=>{if(f.type==="checkbox")f.checked=!1;else f.value=""});else{if(q.remove(),J)this.renumberRows(J);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,q){let J=document.getElementById("tbl_"+q);if(!J)return;let f=J.querySelector("tbody");if(!f)return;let Q=f.querySelector(".template-row");if(!Q)return;let U=Q.cloneNode(!0);U.classList.remove("template-row"),U.querySelectorAll("input").forEach((X)=>{if(X.type==="checkbox")X.checked=X.hasAttribute("checked");else X.value=X.getAttribute("value")||""});let G=U.querySelector(".remove-row-btn");if(G)G.style.visibility="visible";U.querySelectorAll("[data-copy-from]").forEach((X)=>{let N=X.dataset.copyFrom;if(N){let M=U.querySelector(`[data-base-key="${N}"]`);if(M&&M.value)X.value=M.value}}),f.appendChild(U),this.renumberRows(f),this.calc.recalculate()}switchTab($,q){document.querySelectorAll(".tab-btn").forEach((f)=>f.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((f)=>f.classList.remove("active")),$.classList.add("active");let J=document.getElementById(q);if(J)J.classList.add("active")}}function B1($){let q=document.getElementById($);if(!q||!q.textContent)return null;try{return JSON.parse(q.textContent)}catch{return null}}function I1(){let $=B1("weba-l2-envelope");if(!$)return;let q=B1("weba-l2-keywrap"),J=document.querySelector(".weba-form-container")||document.body,f=document.createElement("div");f.className="weba-l2-unlock",f.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let Q=document.createElement("div");Q.textContent="Encrypted Submission",Q.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",f.appendChild(Q);let U=document.createElement("div");U.textContent="Locked. Unlock with Passkey.",U.style.cssText="color:#64748b;margin-bottom:0.75rem;",f.appendChild(U);let G=document.createElement("button");G.textContent="Unlock (Passkey)",G.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",f.appendChild(G);let X=document.createElement("pre");X.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",f.appendChild(X);let N=document.createElement("details");N.style.cssText="margin-top:0.75rem; display:none;",N.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',f.appendChild(N);let M=document.createElement("button");M.textContent="Export JSON",M.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",M.disabled=!0,f.appendChild(M),G.addEventListener("click",async()=>{if(!q){U.textContent="Key wrap package not found.";return}G.disabled=!0,U.textContent="Waiting for passkey...";try{let K=t(q.prf_salt),O=await u$(q.credential_id,K),W=await A1({keywrap:q,prfKey:O}),T=await n$($,W);Qf(T.layer2_plain),document.body.classList.add("weba-l2-readonly"),X.textContent=JSON.stringify(T.layer2_plain,null,2),X.style.display="block";let z=N.querySelector("pre");if(z)z.textContent=JSON.stringify(T.layer2_sig,null,2);N.style.display="block",M.style.display="inline-block",M.disabled=!1,U.textContent="Unlocked.",M.onclick=()=>{let x=new Blob([JSON.stringify(T,null,2)],{type:"application/json"}),E=URL.createObjectURL(x),y=document.createElement("a");y.href=E,y.download="weba-l2-decrypted.json",y.click()}}catch(K){console.error(K),U.textContent="Unlock failed.",G.disabled=!1}}),J.appendChild(f)}function Qf($){if(!$||typeof $!=="object")return;let q=$;document.querySelectorAll("[data-json-path]").forEach((J)=>{let f=J.dataset.jsonPath;if(!f||!(f in q))return;let Q=q[f];if(J.type==="checkbox")J.checked=Boolean(Q);else if(J.type==="radio")J.checked=J.value===String(Q);else J.value=Q===null||Q===void 0?"":String(Q)}),document.querySelectorAll('input[type="radio"]').forEach((J)=>{let f=J.name;if(!f||!(f in q))return;let Q=q[f];J.checked=J.value===String(Q)}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let f=J.dataset.tableKey;if(!f)return;let Q=q[f];if(!Array.isArray(Q))return;let U=J.querySelector("tbody");if(!U)return;let G=U.querySelector("tr.template-row");if(!G)return;Array.from(U.querySelectorAll("tr")).forEach((X)=>{if(!X.classList.contains("template-row"))X.remove()}),Q.forEach((X,N)=>{let M=N===0?G:G.cloneNode(!0);if(N>0){M.classList.remove("template-row");let K=M.querySelector(".remove-row-btn");if(K)K.style.visibility="visible";U.appendChild(M)}if(X&&typeof X==="object")M.querySelectorAll("input, select, textarea").forEach((K)=>{let O=K.dataset.baseKey;if(!O)return;let W=X[O];if(K.type==="checkbox")K.checked=Boolean(W);else K.value=W===null||W===void 0?"":String(W)})})}),document.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.disabled=!0;else J.readOnly=!0}),document.querySelectorAll("textarea").forEach((J)=>{J.readOnly=!0}),document.querySelectorAll("select").forEach((J)=>{J.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((J)=>{J.disabled=!0})}function D0($){return document.getElementById($)}function j1(){if(!D0("weba-l2-keywrap-tool"))return;let q=D0("kwp-recipient-sk"),J=D0("kwp-credential-id"),f=D0("kwp-prf-salt"),Q=D0("kwp-aad"),U=D0("kwp-kid"),G=D0("kwp-status"),X=D0("kwp-output"),N=D0("kwp-generate-salt"),M=D0("kwp-wrap");if(!q||!J||!f||!G||!X||!M)return;N?.addEventListener("click",()=>{let K=new Uint8Array(32);crypto.getRandomValues(K),f.value=M0(K)}),M.addEventListener("click",async()=>{G.textContent="Waiting for passkey...",M.disabled=!0;try{if(!q.value||!J.value||!f.value)throw new Error("Missing required fields.");let K=t(q.value.trim()),O=t(f.value.trim()),W=await u$(J.value.trim(),O),T=Q?.value?t(Q.value.trim()):void 0,z=await g1({recipientSk:K,prfKey:W,aad:T}),x={alg:"WebAuthn-PRF-AESGCM-v1",kid:U?.value||"issuer#passkey-1",credential_id:J.value.trim(),prf_salt:M0(O),wrapped_key:M0(z),...T?{aad:M0(T)}:{}};X.textContent=JSON.stringify(x,null,2),G.textContent="Key wrap ready."}catch(K){console.error(K),G.textContent="Key wrap failed."}finally{M.disabled=!1}})}function x1($){let q={},J=(f,Q)=>{if(f===null||f===void 0){q[Q]=null;return}if(Array.isArray(f)){f.forEach((U,G)=>{J(U,Q?`${Q}[${G}]`:`[${G}]`)});return}if(typeof f==="object"){Object.entries(f).forEach(([U,G])=>{let X=Q?`${Q}.${U}`:U;J(G,X)});return}q[Q]=f};if(J($,""),""in q)delete q[""];return q}function v8($){let q={_filename:$.filename},J=new Set(["_filename"]);if($.includeJson)J.add("_json"),q._json=JSON.stringify($.plain);let f=x1($.plain||{});for(let Q of Object.keys(f)){if($.omitKey&&$.omitKey(Q))continue;J.add(Q),q[Q]=f[Q]}if($.sig)J.add("_l2_sig"),q._l2_sig=JSON.stringify($.sig);return{row:q,keys:J}}function y1($){if($===null||$===void 0)return"";let q=String($);if(/[",\n]/.test(q))return`"${q.replace(/"/g,'""')}"`;return q}function V1($,q){let J=[];return J.push(q.map(y1).join(",")),$.forEach((f)=>{let Q=q.map((U)=>y1(f[U])).join(",");J.push(Q)}),"\uFEFF"+J.join(`
`)}function P1($){if(typeof DOMParser!=="undefined")return new DOMParser().parseFromString($,"text/html");if(typeof document!=="undefined"){let q=document.implementation.createHTMLDocument("");return q.documentElement.innerHTML=$,q}return null}function m1($,q){let J=P1($);if(J)return J.getElementById(q)?.textContent??null;let f=new RegExp(`<script[^>]*id=["']${q}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),Q=$.match(f);return Q?Q[1]:null}function Uf($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Gf($,q){let J=P1($);if(J)return J.querySelector(`script[type="${q}"]`)?.textContent??null;let f=new RegExp(`<script[^>]*type=["']${Uf(q)}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),Q=$.match(f);return Q?Q[1]:null}function F1($){let q=m1($,"data-layer");if(q)try{return JSON.parse(q)}catch{return null}let J=Gf($,"application/ld+json");if(J)try{return JSON.parse(J)}catch{return null}return null}function v1($){let q=m1($,"weba-l2-envelope");if(!q)return null;try{return JSON.parse(q)}catch{return null}}function Nf($){if(!$.trim())return null;try{let q=JSON.parse($);if(!q.recipient_x25519_private&&!q.org_root_key)return null;return q}catch{return null}}function Xf(){let $=document.getElementById("weba-l2-keys");if(!$?.textContent)return null;return Nf($.textContent)}function Kf(){let $=document.getElementById("weba-agg-spec");if(!$?.textContent)return null;try{let q=JSON.parse($.textContent);if(Array.isArray(q))return q[0]??null;return q}catch{return null}}function p0($,q){let J=q.trim().replace(/^\$\./,"");if(!J)return[];let f=J.split("."),Q=[$];for(let U of f){let G=U.match(/^(.*)\\[(\\d*)\\]$/),X=G?G[1]:U,N=G?G[2]:null,M=G&&N==="",K=G&&N!==""?parseInt(N,10):null,O=[];for(let W of Q){if(W===null||W===void 0)continue;let T=X?W[X]:W;if(M){if(Array.isArray(T))O.push(...T);continue}if(K!==null){if(Array.isArray(T)&&T[K]!==void 0)O.push(T[K]);continue}if(T!==void 0)O.push(T)}Q=O}return Q}function d$($){if(typeof $==="number"&&Number.isFinite($))return $;if(typeof $==="string"&&$.trim()!==""){let q=Number($.replace(/,/g,""));return Number.isFinite(q)?q:null}return null}function Yf($,q){let J=p0($,q.path);if(q.op==="exists")return J.length>0;let f=J[0],Q=q.value;if(q.op==="eq")return f===Q;if(q.op==="neq")return f!==Q;if(q.op==="in"&&Array.isArray(Q))return Q.includes(f);let U=d$(f),G=d$(Q);if(U===null||G===null)return!1;if(q.op==="gt")return U>G;if(q.op==="gte")return U>=G;if(q.op==="lt")return U<G;if(q.op==="lte")return U<=G;return!1}function _8($,q){if(!q)return $;let J=Array.isArray(q)?q:[q];return $.filter((f)=>J.every((Q)=>Yf(f,Q)))}function k1($,q){let J=_8($,q.filter);if(q.op==="count"){if(q.path)return J.reduce((U,G)=>U+p0(G,q.path).length,0);return J.length}let Q=(q.path?J.flatMap((U)=>p0(U,q.path)):J).map((U)=>d$(U)).filter((U)=>U!==null);if(Q.length===0)return null;if(q.op==="sum")return Q.reduce((U,G)=>U+G,0);if(q.op==="avg")return Q.reduce((U,G)=>U+G,0)/Q.length;if(q.op==="min")return Math.min(...Q);if(q.op==="max")return Math.max(...Q);return null}function k8($,q){if($===null)return"-";if(q==="currency")return new Intl.NumberFormat(void 0,{style:"currency",currency:"JPY"}).format($);if(q==="percent")return new Intl.NumberFormat(void 0,{style:"percent",maximumFractionDigits:1}).format($);return new Intl.NumberFormat().format($)}function w$($,q){return k8($,q)}function S1($,q){if(!q)return $;let J=[];for(let f of $){let Q=p0(f,q);for(let U of Q)if(Array.isArray(U))J.push(...U);else if(U!==void 0&&U!==null)J.push(U)}return J}function Zf($,q){let J=S1($,q.source),f=_8(J,q.filter),Q=new Map;for(let G of f){let X=p0(G,q.x);if(X.length===0)continue;for(let N of X){let M=N===void 0||N===null||N===""?"Unknown":String(N);Q.set(M,(Q.get(M)||0)+1)}}let U=Array.from(Q.entries()).map(([G,X])=>({label:G,value:X}));if(q.sort){let G=q.sort.order==="asc"?1:-1;U.sort((X,N)=>{if(q.sort?.by==="label")return X.label.localeCompare(N.label)*G;return(X.value-N.value)*G})}if(q.limit)U=U.slice(0,q.limit);return U}function Mf($,q){let J=S1($,q.source),f=_8(J,q.filter),Q=[];for(let O of f){let W=p0(O,q.value);for(let T of W){let z=d$(T);if(z!==null)Q.push(z)}}if(Q.length===0||q.bin<=0)return[];let U=q.min??0,G=q.max??Math.max(...Q),X=new Map,N=0;for(let O of Q){if(q.max!==void 0&&O>q.max){N+=1;continue}let W=Math.max(0,Math.floor((O-U)/q.bin)),T=U+W*q.bin;X.set(T,(X.get(T)||0)+1)}let M=[],K=Math.max(1,Math.ceil((G-U+1)/q.bin));for(let O=0;O<K;O+=1){let W=U+O*q.bin,T=W+q.bin-1,z=`${w$(W,q.format)} - ${w$(T,q.format)}`;M.push({label:z,value:X.get(W)||0})}if(N>0&&q.max!==void 0)M.push({label:`${w$(q.max,q.format)}+`,value:N});return M}function Lf($,q){if(q.length===0)return"";let J=Math.max(...q.map((U)=>U.value)),f=$.title?`<div class="agg-chart-title">${$.title}</div>`:"",Q=q.map((U)=>{let G=J>0?U.value/J*100:0,X=w$(U.value,$.format);return`<div class="agg-bar"><div class="agg-bar-label">${U.label}</div><div class="agg-bar-track"><div class="agg-bar-fill" style="width:${G}%"></div></div><div class="agg-bar-value">${X}</div></div>`}).join("");return`<div class="agg-chart">${f}<div class="agg-bar-list">${Q}</div></div>`}function Of($,q){if(q.length===0)return"";let J=Math.max(...q.map((U)=>U.value)),f=$.title?`<div class="agg-chart-title">${$.title}</div>`:"",Q=q.map((U)=>{let G=J>0?U.value/J*100:0,X=w$(U.value,$.format);return`<div class="agg-bar"><div class="agg-bar-label">${U.label}</div><div class="agg-bar-track"><div class="agg-bar-fill" style="width:${G}%"></div></div><div class="agg-bar-value">${X}</div></div>`}).join("");return`<div class="agg-chart">${f}<div class="agg-bar-list">${Q}</div></div>`}function _1($,q,J){if(!q?.dashboard||J.length===0){$.innerHTML="";return}let f=J.map((K)=>K.plain),Q=q.dashboard.title?`<div class="agg-dashboard-title">${q.dashboard.title}</div>`:"",U=(q.dashboard.cards||[]).map((K)=>{let O=k1(f,K),W=k8(O,K.format);return`<div class="agg-card"><div class="agg-card-label">${K.label}</div><div class="agg-card-value">${W}</div></div>`}).join(""),G=U?`<div class="agg-card-grid">${U}</div>`:"",X=(q.dashboard.charts||[]).map((K)=>{if(K.type==="bar"){let O=Zf(f,K);return Lf(K,O)}if(K.type==="hist"){let O=Mf(f,K);return Of(K,O)}return""}).filter(Boolean).join(""),N=X?`<div class="agg-chart-grid">${X}</div>`:"",M=(q.dashboard.tables||[]).map((K)=>{let O=new Map;for(let R of f){let A=p0(R,K.group_by)[0],I=A===void 0||A===null||A===""?"Unknown":String(A);if(!O.has(I))O.set(I,[]);O.get(I).push(R)}let W=Array.from(O.entries()).map(([R,A])=>{let I={};return K.metrics.forEach((F)=>{let k=k1(A,F);I[F.id]=k8(k,F.format)}),{groupKey:R,metricValues:I}});if(K.sort){let R=K.sort.order==="asc"?1:-1;W.sort((A,I)=>{let F=A.metricValues[K.sort.by],k=I.metricValues[K.sort.by];if(F===k)return 0;return F>k?R:-R})}let T=K.limit?W.slice(0,K.limit):W,x=["Group",...K.metrics.map((R)=>R.label||R.id)].map((R)=>`<th>${R}</th>`).join(""),E=T.map((R)=>{return`<tr>${[`<td>${R.groupKey}</td>`,...K.metrics.map((I)=>`<td>${R.metricValues[I.id]}</td>`)].join("")}</tr>`}).join("");return`<div class="agg-dashboard-table">${K.label?`<div class="agg-table-title">${K.label}</div>`:""}<table class="agg-table"><thead><tr>${x}</tr></thead><tbody>${E}</tbody></table></div>`}).join("");$.innerHTML=`${Q}${G}${N}${M}`}async function wf($,q){let J=v1($);if(J&&q){if(q.recipient_kid&&J.layer2?.recipient&&q.recipient_kid!==J.layer2.recipient)throw new Error(`recipient_kid mismatch (${J.layer2.recipient})`);let Q=null;if(q.org_root_key){let X=q.org_campaign_id||J.meta?.campaign_id;if(!X)throw new Error("org_campaign_id is required for org_root_key");Q=W1({orgRootKey:t(q.org_root_key),campaignId:X,layer1Ref:J.layer1_ref,keyPolicy:q.org_key_policy||J.meta?.key_policy}).privateKey}else if(q.recipient_x25519_private)Q=t(q.recipient_x25519_private);else throw new Error("No recipient key provided");let U=q.recipient_pqc_private&&q.recipient_pqc_kem==="ML-KEM-768"?{pqcProvider:globalThis.webaPqcKem??null,pqcRecipientSk:t(q.recipient_pqc_private)}:void 0,G=await n$(J,Q,U);return{plain:G.layer2_plain??G,sig:G.layer2_sig,source:"l2"}}let f=F1($);if(f)return{plain:f,source:"jsonld"};return{source:null}}function Cf($,q,J){if(q.length===0){$.innerHTML='<div class="agg-empty">No rows to display.</div>';return}let f=J.map((U)=>`<th>${U}</th>`).join(""),Q=q.slice(0,20).map((U)=>{return`<tr>${J.map((X)=>`<td>${U[X]??""}</td>`).join("")}</tr>`}).join("");$.innerHTML=`<table class="agg-table"><thead><tr>${f}</tr></thead><tbody>${Q}</tbody></table>`}function b1(){let $=document.getElementById("aggregator-root");if(!$)return;$.innerHTML=`
    <div class="agg-panel">
      <div class="agg-row">
        <label class="agg-label">Input HTML</label>
        <input id="weba-agg-files" type="file" accept=".html" multiple />
      </div>
      <div class="agg-row">
        <label class="agg-label">L2 Key (embedded)</label>
        <div id="weba-agg-key-status" class="agg-chip">Not loaded</div>
        <div class="agg-note">Use <code>&lt;script id="weba-l2-keys"&gt;</code> to embed.</div>
      </div>
      <div class="agg-row">
        <label class="agg-label">Include JSON</label>
        <input id="weba-agg-include-json" type="checkbox" />
      </div>
      <div class="agg-row">
        <button id="weba-agg-run" class="agg-btn">Decrypt & Aggregate</button>
        <button id="weba-agg-download" class="agg-btn secondary" disabled>Download CSV</button>
        <button id="weba-agg-download-jsonl" class="agg-btn secondary" disabled>Download JSONL</button>
        <button id="weba-agg-download-parquet" class="agg-btn secondary" disabled>Download Parquet</button>
      </div>
      <div id="weba-agg-status" class="agg-status">Ready.</div>
    </div>
    <div id="weba-agg-dashboard" class="agg-dashboard"></div>
    <div id="weba-agg-output" class="agg-output"></div>
  `;let q=$.querySelector("#weba-agg-files"),J=$.querySelector("#weba-agg-status"),f=$.querySelector("#weba-agg-output"),Q=$.querySelector("#weba-agg-dashboard"),U=$.querySelector("#weba-agg-include-json"),G=$.querySelector("#weba-agg-run"),X=$.querySelector("#weba-agg-download"),N=$.querySelector("#weba-agg-download-jsonl"),M=$.querySelector("#weba-agg-download-parquet"),K=$.querySelector("#weba-agg-key-status"),O="",W="",T=[],z=Xf(),x=Kf(),E=Array.isArray(x?.samples)?x.samples.map((I,F)=>({filename:`sample-${F+1}.json`,plain:I})):[];if(K)K.textContent=z?.recipient_kid?`Loaded (${z.recipient_kid})`:z?"Loaded":"Not loaded",K.classList.toggle("ready",!!z);if(x?.export?.jsonl===!1&&N)N.disabled=!0;let y=()=>{let I=globalThis.webaParquet;return!!(x?.export?.parquet&&I?.export)},R=y();if(M)M.disabled=!R,M.title=R?"":"Parquet export is loading";if(!R&&x?.export?.parquet){let I=window.setInterval(()=>{if(R=y(),R){if(M)M.disabled=!1,M.title="";window.clearInterval(I)}},300)}let A=async()=>{if((!q?.files||q.files.length===0)&&E.length===0){if(J)J.textContent="Select HTML files first.";return}if(J)J.textContent="Processing...";if(X)X.disabled=!0;if(N)N.disabled=!0;if(M)M.disabled=!R;let I=[],F=new Set(["_filename"]),k=0,l=0;T=[...E];let B=z;for(let b of Array.from(q.files))try{let u=await b.text(),Z=await wf(u,B);if(Z.source==="l2"&&Z.plain){T.push({filename:b.name,plain:Z.plain,sig:Z.sig});let H=v8({plain:Z.plain,filename:b.name,includeJson:U?.checked,sig:Z.sig});H.keys.forEach((w)=>F.add(w)),I.push(H.row),k+=1;continue}if(Z.source==="jsonld"&&Z.plain){T.push({filename:b.name,plain:Z.plain});let H=v8({plain:Z.plain,filename:b.name,includeJson:U?.checked,omitKey:(w)=>w.startsWith("@")});H.keys.forEach((w)=>F.add(w)),I.push(H.row),k+=1;continue}l+=1}catch(u){console.error(u),l+=1}let P=Array.from(F).sort((b,u)=>{if(b==="_filename")return-1;if(u==="_filename")return 1;return b.localeCompare(u)});if(O=V1(I,P),X)X.disabled=I.length===0;let _=x?.export?.jsonl!==!1;if(W=T.map((b)=>JSON.stringify({_filename:b.filename,_l2_sig:b.sig??null,...b.plain})).join(`
`),N)N.disabled=T.length===0||!_;if(J)J.textContent=`Processed ${k} files. Errors: ${l}.`;if(Q)_1(Q,x,T);if(f)Cf(f,I,P)};if(E.length>0){if(T=[...E],W=T.map((I)=>JSON.stringify({_filename:I.filename,_l2_sig:I.sig??null,...I.plain})).join(`
`),Q)_1(Q,x,T);if(N)N.disabled=W.length===0||x?.export?.jsonl===!1;if(J)J.textContent=`Loaded ${E.length} sample records.`}G?.addEventListener("click",()=>{A().catch((I)=>{if(J)J.textContent="Failed to aggregate.";console.error(I)})}),X?.addEventListener("click",()=>{if(!O)return;let I=new Blob([O],{type:"text/csv"}),F=URL.createObjectURL(I),k=document.createElement("a");k.href=F,k.download="weba-aggregated.csv",k.click(),URL.revokeObjectURL(F)}),N?.addEventListener("click",()=>{if(!W)return;let I=new Blob([W],{type:"application/json"}),F=URL.createObjectURL(I),k=document.createElement("a");k.href=F,k.download="weba-aggregated.jsonl",k.click(),URL.revokeObjectURL(F)}),M?.addEventListener("click",async()=>{if(!R||!T.length){if(J)J.textContent="Parquet export is not ready yet.";return}try{let I=await parquetProvider.export(T.map((B)=>({_filename:B.filename,_l2_sig:B.sig??null,...B.plain}))),F=new Blob([I],{type:"application/octet-stream"}),k=URL.createObjectURL(F),l=document.createElement("a");l.href=k,l.download="weba-aggregated.parquet",l.click(),URL.revokeObjectURL(k)}catch(I){if(J)J.textContent="Parquet export failed.";console.error(I)}})}function l1(){console.log("Web/A Runtime Booting...");let $=new a$,q=new m8,J=new F8($,q),f=window,Q=document.getElementById("weba-structure");if(Q?.textContent)try{f.generatedJsonStructure=JSON.parse(Q.textContent)}catch(X){console.warn("Failed to parse weba structure JSON",X)}let U=D1();if(U)f.webaL2Config=U;f.saveDraft=()=>q.saveDraft(),f.submitDocument=()=>q.submitDocument(),f.signAndDownload=()=>q.signAndDownload(),f.clearData=()=>q.clearData(),f.removeTableRow=(X)=>J.removeTableRow(X),f.addTableRow=(X,N)=>J.addTableRow(X,N),f.switchTab=(X,N)=>J.switchTab(X,N),f.recalculate=()=>$.recalculate(),f.escapeHtml=(X)=>{if(!X)return"";let N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return X.toString().replace(/[&<>"']/g,(M)=>N[M]||M)},q.restoreFromLS(),J.applyI18n(),J.initTables(),$.recalculate(),I1(),j1(),b1();let G;document.addEventListener("input",(X)=>{let N=X.target;if(X.isTrusted)N.dataset.dirty="true";let M=N.dataset.baseKey||N.dataset.jsonPath;if(M)(N.closest("tr")||document).querySelectorAll(`[data-copy-from="${M}"]`).forEach((W)=>{if(!W.dataset.dirty){if(W.value!==N.value)W.value=N.value,W.dispatchEvent(new Event("input"))}});$.recalculate(),q.updateJsonLd(),clearTimeout(G),G=setTimeout(()=>q.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class S8{suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let q=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",q.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let q=$.toString().toLowerCase();return q=q.replace(/[---]/g,(J)=>{return String.fromCharCode(J.charCodeAt(0)-65248)}),q=q.replace(/[-]/g,(J)=>String.fromCharCode(J.charCodeAt(0)-65248)),q.trim()}clean($){if(!$)return"";let q=this.normalize($);return q=q.replace(/(|||||npo||)/g,""),q=q.replace(/(\(\)|\(\)|\(\))/g,""),q.trim()}toIndex($){let q=parseInt($||"",10);return Number.isFinite(q)?q-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let q=window,J=$.dataset.masterSrc,f=$.dataset.suggestSource;if(!J&&!f)return;let Q=this.toIndex($.dataset.masterLabelIndex),U=this.toIndex($.dataset.masterValueIndex),G=$.value;if(!G){this.hideSuggestions();return}let X=[],N=this.normalize(G);if(f==="column"){let M=$.dataset.baseKey,K=$.closest("table");if(K&&M){let O=new Set;K.querySelectorAll(`[data-base-key="${M}"]`).forEach((W)=>{if(W===$)return;let T=W.value;if(T&&this.normalize(T).includes(N)){if(!O.has(T))O.add(T),X.push({val:T,row:[T],label:T,score:10})}})}}else if(J){let M=q.generatedJsonStructure.masterData;if(!M||!M[J])return;M[J].forEach((O,W)=>{if(W===0)return;if(O.some((z)=>this.normalize(z||"").includes(N))){let z=Q>=0?O[Q]||"":"",x=U>=0?O[U]||"":"",E=U>=0?x:Q>=0?z:O[1]||O[0]||"";X.push({val:E,row:O,label:z,score:10,idx:W})}})}this.renderSuggestions($,X,Q)}renderSuggestions($,q,J){if(q.length===0){this.hideSuggestions();return}let f=window,Q=q.slice(0,10),U="";Q.forEach((K)=>{let O=f.escapeHtml(JSON.stringify(K.row)),W=J>=0?K.label||K.row.join(" : "):K.row.join(" : ");U+=`<div class="suggestion-item" data-val="${f.escapeHtml(K.val)}" data-row="${O}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${f.escapeHtml(W)}</div>`});let G=this.getGlobalBox();G.innerHTML=U;let X=$.getBoundingClientRect(),N=window.scrollY||document.documentElement.scrollTop,M=window.scrollX||document.documentElement.scrollLeft;G.style.width=Math.max(X.width,200)+"px",G.style.left=X.left+M+"px",G.style.top=X.bottom+N+"px",G.querySelectorAll(".suggestion-item").forEach((K)=>{K.onmouseenter=()=>K.style.background="#f0f8ff",K.onmouseleave=()=>K.style.background="white"}),G.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let q=window,J=this.activeSearchInput,f=$.dataset.val||"",Q=$.dataset.row||"[]";try{let U=JSON.parse(Q),G=J.dataset.masterSrc,X=G?q.generatedJsonStructure.masterData[G][0]:[],N=!1;if(X.length>0&&U.length>0){let M=J.closest("tr");if(M){let K=Array.from(M.querySelectorAll("input, select, textarea"));X.forEach((O,W)=>{if(!O)return;let T=U[W];this.fillField(K,O,T,J,()=>{N=!0})})}}if(!N)J.value=f,J.dispatchEvent(new Event("input",{bubbles:!0}))}catch(U){console.error(U)}this.hideSuggestions()}fillField($,q,J,f,Q){let U=this.normalize(q),G=$.find((X)=>{let N=X.dataset.baseKey||X.dataset.jsonPath,M=this.normalize(X.getAttribute("placeholder")||"");return N&&this.normalize(N)===U||M===U});if(G){if(G.value=J||"",G.dispatchEvent(new Event("input",{bubbles:!0})),G===f)Q()}}}var c1=new S8;window.GlobalSearch=c1;l1();c1.init();
