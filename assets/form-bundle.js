var Vq=Object.create;var{getPrototypeOf:xq,defineProperty:h$,getOwnPropertyNames:Fq}=Object;var Pq=Object.prototype.hasOwnProperty;var c$=($,J,q)=>{q=$!=null?Vq(xq($)):{};let Q=J||!$||!$.__esModule?h$(q,"default",{value:$,enumerable:!0}):q;for(let G of Fq($))if(!Pq.call(Q,G))h$(Q,G,{get:()=>$[G],enumerable:!0});return Q};var kq=($,J)=>()=>(J||$((J={exports:{}}).exports,J),J.exports);var Y$=kq((f9,vJ)=>{vJ.exports=function $(J){if(typeof J==="number"&&isNaN(J))throw new Error("NaN is not allowed");if(typeof J==="number"&&!isFinite(J))throw new Error("Infinity is not allowed");if(J===null||typeof J!=="object")return JSON.stringify(J);if(J.toJSON instanceof Function)return $(J.toJSON());if(Array.isArray(J))return`[${J.reduce((G,X,U)=>{return`${G}${U===0?"":","}${$(X===void 0||typeof X==="symbol"?null:X)}`},"")}]`;return`{${Object.keys(J).sort().reduce((Q,G)=>{if(J[G]===void 0||typeof J[G]==="symbol")return Q;let X=Q.length===0?"":",";return`${Q}${X}${$(G)}:${$(J[G])}`},"")}}`}});class i0{runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let J=$.dataset.copyFrom;if(J){let G=($.closest("tr")||document).querySelector(`[data-base-key="${J}"], [data-json-path="${J}"]`);if(G&&G.value!==$.value)$.value=G.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let J=$.dataset.formula;if(!J)return;let q=$.closest("tr"),Q=$.closest("table"),G=(U)=>{let Y=0,N="none";if(q){let O=`[data-base-key="${U}"], [data-json-path="${U}"]`,K=q.querySelector(O);if(K){if(N="row-input",K.value!=="")Y=parseFloat(K.value)}}if(N==="none"){let O=document.querySelector(`[data-json-path="${U}"]`);if(O){if(N="static-input",O.value!=="")Y=parseFloat(O.value)}}return Y},X=J.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(U,Y)=>{let N=0,O=Q||document,K=O.querySelectorAll(`[data-base-key="${Y}"], [data-json-path="${Y}"]`);if(K.length===0&&O!==document)K=document.querySelectorAll(`[data-base-key="${Y}"], [data-json-path="${Y}"]`);return K.forEach((W)=>{let T=parseFloat(W.value);if(!isNaN(T))N+=T}),N});X=X.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(U)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(U))return U;return String(G(U))});try{let U=new Function("return "+X)();if(typeof U==="number"&&!isNaN(U))$.value=Number.isInteger(U)?U:U.toFixed(0);else $.value=""}catch(U){console.error("Calc Error:",U),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function O0($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function z8($,J=""){if(!Number.isSafeInteger($)||$<0){let q=J&&`"${J}" `;throw new Error(`${q}expected integer >= 0, got ${$}`)}}function l($,J,q=""){let Q=O0($),G=$?.length,X=J!==void 0;if(!Q||X&&G!==J){let U=q&&`"${q}" `,Y=X?` of length ${J}`:"",N=Q?`length=${G}`:`type=${typeof $}`;throw new Error(U+"expected Uint8Array"+Y+", got "+N)}return $}function t8($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");z8($.outputLen),z8($.blockLen)}function l8($,J=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(J&&$.finished)throw new Error("Hash#digest() has already been called")}function l$($,J){l($,void 0,"digestInto() output");let q=J.outputLen;if($.length<q)throw new Error('"digestInto() output" expected to be of length >='+q)}function E8(...$){for(let J=0;J<$.length;J++)$[J].fill(0)}function L0($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function H8($,J){return $<<32-J|$>>>J}var u$=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),_q=Array.from({length:256},($,J)=>J.toString(16).padStart(2,"0"));function u8($){if(l($),u$)return $.toHex();let J="";for(let q=0;q<$.length;q++)J+=_q[$[q]];return J}var I8={_0:48,_9:57,A:65,F:70,a:97,f:102};function p$($){if($>=I8._0&&$<=I8._9)return $-I8._0;if($>=I8.A&&$<=I8.F)return $-(I8.A-10);if($>=I8.a&&$<=I8.f)return $-(I8.a-10);return}function e8($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(u$)return Uint8Array.fromHex($);let J=$.length,q=J/2;if(J%2)throw new Error("hex string expected, got unpadded hex of length "+J);let Q=new Uint8Array(q);for(let G=0,X=0;G<q;G++,X+=2){let U=p$($.charCodeAt(X)),Y=p$($.charCodeAt(X+1));if(U===void 0||Y===void 0){let N=$[X]+$[X+1];throw new Error('hex string expected, got non-hex character "'+N+'" at index '+X)}Q[G]=U*16+Y}return Q}function $0(...$){let J=0;for(let Q=0;Q<$.length;Q++){let G=$[Q];l(G),J+=G.length}let q=new Uint8Array(J);for(let Q=0,G=0;Q<$.length;Q++){let X=$[Q];q.set(X,G),G+=X.length}return q}function o0($,J={}){let q=(G,X)=>$(X).update(G).digest(),Q=$(void 0);return q.outputLen=Q.outputLen,q.blockLen=Q.blockLen,q.create=(G)=>$(G),Object.assign(q,J),Object.freeze(q)}function J0($=32){let J=typeof globalThis==="object"?globalThis.crypto:null;if(typeof J?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return J.getRandomValues(new Uint8Array($))}var r0=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function d$($,J,q){return $&J^~$&q}function n$($,J,q){return $&J^$&q^J&q}class W0{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,J,q,Q){this.blockLen=$,this.outputLen=J,this.padOffset=q,this.isLE=Q,this.buffer=new Uint8Array($),this.view=L0(this.buffer)}update($){l8(this),l($);let{view:J,buffer:q,blockLen:Q}=this,G=$.length;for(let X=0;X<G;){let U=Math.min(Q-this.pos,G-X);if(U===Q){let Y=L0($);for(;Q<=G-X;X+=Q)this.process(Y,X);continue}if(q.set($.subarray(X,X+U),this.pos),this.pos+=U,X+=U,this.pos===Q)this.process(J,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){l8(this),l$($,this),this.finished=!0;let{buffer:J,view:q,blockLen:Q,isLE:G}=this,{pos:X}=this;if(J[X++]=128,E8(this.buffer.subarray(X)),this.padOffset>Q-X)this.process(q,0),X=0;for(let K=X;K<Q;K++)J[K]=0;q.setBigUint64(Q-8,BigInt(this.length*8),G),this.process(q,0);let U=L0($),Y=this.outputLen;if(Y%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let N=Y/4,O=this.get();if(N>O.length)throw new Error("_sha2: outputLen bigger than state");for(let K=0;K<N;K++)U.setUint32(4*K,O[K],G)}digest(){let{buffer:$,outputLen:J}=this;this.digestInto($);let q=$.slice(0,J);return this.destroy(),q}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:J,buffer:q,length:Q,finished:G,destroyed:X,pos:U}=this;if($.destroyed=X,$.finished=G,$.length=Q,$.pos=U,Q%J)$.buffer.set(q);return $}clone(){return this._cloneInto()}}var j8=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),f8=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),$8=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J8=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var C0=BigInt(4294967295),i$=BigInt(32);function Sq($,J=!1){if(J)return{h:Number($&C0),l:Number($>>i$&C0)};return{h:Number($>>i$&C0)|0,l:Number($&C0)|0}}function o$($,J=!1){let q=$.length,Q=new Uint32Array(q),G=new Uint32Array(q);for(let X=0;X<q;X++){let{h:U,l:Y}=Sq($[X],J);[Q[X],G[X]]=[U,Y]}return[Q,G]}var a0=($,J,q)=>$>>>q,s0=($,J,q)=>$<<32-q|J>>>q,v8=($,J,q)=>$>>>q|J<<32-q,g8=($,J,q)=>$<<32-q|J>>>q,q0=($,J,q)=>$<<64-q|J>>>q-32,Q0=($,J,q)=>$>>>q-32|J<<64-q;function D8($,J,q,Q){let G=(J>>>0)+(Q>>>0);return{h:$+q+(G/4294967296|0)|0,l:G|0}}var r$=($,J,q)=>($>>>0)+(J>>>0)+(q>>>0),a$=($,J,q,Q)=>J+q+Q+($/4294967296|0)|0,s$=($,J,q,Q)=>($>>>0)+(J>>>0)+(q>>>0)+(Q>>>0),t$=($,J,q,Q,G)=>J+q+Q+G+($/4294967296|0)|0,e$=($,J,q,Q,G)=>($>>>0)+(J>>>0)+(q>>>0)+(Q>>>0)+(G>>>0),$J=($,J,q,Q,G,X)=>J+q+Q+G+X+($/4294967296|0)|0;var vq=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),x8=new Uint32Array(64);class t0 extends W0{constructor($){super(64,$,8,!1)}get(){let{A:$,B:J,C:q,D:Q,E:G,F:X,G:U,H:Y}=this;return[$,J,q,Q,G,X,U,Y]}set($,J,q,Q,G,X,U,Y){this.A=$|0,this.B=J|0,this.C=q|0,this.D=Q|0,this.E=G|0,this.F=X|0,this.G=U|0,this.H=Y|0}process($,J){for(let K=0;K<16;K++,J+=4)x8[K]=$.getUint32(J,!1);for(let K=16;K<64;K++){let W=x8[K-15],T=x8[K-2],f=H8(W,7)^H8(W,18)^W>>>3,B=H8(T,17)^H8(T,19)^T>>>10;x8[K]=B+x8[K-7]+f+x8[K-16]|0}let{A:q,B:Q,C:G,D:X,E:U,F:Y,G:N,H:O}=this;for(let K=0;K<64;K++){let W=H8(U,6)^H8(U,11)^H8(U,25),T=O+W+d$(U,Y,N)+vq[K]+x8[K]|0,B=(H8(q,2)^H8(q,13)^H8(q,22))+n$(q,Q,G)|0;O=N,N=Y,Y=U,U=X+T|0,X=G,G=Q,Q=q,q=T+B|0}q=q+this.A|0,Q=Q+this.B|0,G=G+this.C|0,X=X+this.D|0,U=U+this.E|0,Y=Y+this.F|0,N=N+this.G|0,O=O+this.H|0,this.set(q,Q,G,X,U,Y,N,O)}roundClean(){E8(x8)}destroy(){this.set(0,0,0,0,0,0,0,0),E8(this.buffer)}}class JJ extends t0{A=j8[0]|0;B=j8[1]|0;C=j8[2]|0;D=j8[3]|0;E=j8[4]|0;F=j8[5]|0;G=j8[6]|0;H=j8[7]|0;constructor(){super(32)}}class gq extends t0{A=f8[0]|0;B=f8[1]|0;C=f8[2]|0;D=f8[3]|0;E=f8[4]|0;F=f8[5]|0;G=f8[6]|0;H=f8[7]|0;constructor(){super(28)}}var qJ=(()=>o$(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),mq=(()=>qJ[0])(),bq=(()=>qJ[1])(),F8=new Uint32Array(80),P8=new Uint32Array(80);class G0 extends W0{constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:J,Bh:q,Bl:Q,Ch:G,Cl:X,Dh:U,Dl:Y,Eh:N,El:O,Fh:K,Fl:W,Gh:T,Gl:f,Hh:B,Hl:F}=this;return[$,J,q,Q,G,X,U,Y,N,O,K,W,T,f,B,F]}set($,J,q,Q,G,X,U,Y,N,O,K,W,T,f,B,F){this.Ah=$|0,this.Al=J|0,this.Bh=q|0,this.Bl=Q|0,this.Ch=G|0,this.Cl=X|0,this.Dh=U|0,this.Dl=Y|0,this.Eh=N|0,this.El=O|0,this.Fh=K|0,this.Fl=W|0,this.Gh=T|0,this.Gl=f|0,this.Hh=B|0,this.Hl=F|0}process($,J){for(let I=0;I<16;I++,J+=4)F8[I]=$.getUint32(J),P8[I]=$.getUint32(J+=4);for(let I=16;I<80;I++){let R=F8[I-15]|0,g=P8[I-15]|0,m=v8(R,g,1)^v8(R,g,8)^a0(R,g,7),u=g8(R,g,1)^g8(R,g,8)^s0(R,g,7),h=F8[I-2]|0,V=P8[I-2]|0,k=v8(h,V,19)^q0(h,V,61)^a0(h,V,6),y=g8(h,V,19)^Q0(h,V,61)^s0(h,V,6),p=s$(u,y,P8[I-7],P8[I-16]),d=t$(p,m,k,F8[I-7],F8[I-16]);F8[I]=d|0,P8[I]=p|0}let{Ah:q,Al:Q,Bh:G,Bl:X,Ch:U,Cl:Y,Dh:N,Dl:O,Eh:K,El:W,Fh:T,Fl:f,Gh:B,Gl:F,Hh:H,Hl:j}=this;for(let I=0;I<80;I++){let R=v8(K,W,14)^v8(K,W,18)^q0(K,W,41),g=g8(K,W,14)^g8(K,W,18)^Q0(K,W,41),m=K&T^~K&B,u=W&f^~W&F,h=e$(j,g,u,bq[I],P8[I]),V=$J(h,H,R,m,mq[I],F8[I]),k=h|0,y=v8(q,Q,28)^q0(q,Q,34)^q0(q,Q,39),p=g8(q,Q,28)^Q0(q,Q,34)^Q0(q,Q,39),d=q&G^q&U^G&U,M=Q&X^Q&Y^X&Y;H=B|0,j=F|0,B=T|0,F=f|0,T=K|0,f=W|0,{h:K,l:W}=D8(N|0,O|0,V|0,k|0),N=U|0,O=Y|0,U=G|0,Y=X|0,G=q|0,X=Q|0;let D=r$(k,p,M);q=a$(D,V,y,d),Q=D|0}({h:q,l:Q}=D8(this.Ah|0,this.Al|0,q|0,Q|0)),{h:G,l:X}=D8(this.Bh|0,this.Bl|0,G|0,X|0),{h:U,l:Y}=D8(this.Ch|0,this.Cl|0,U|0,Y|0),{h:N,l:O}=D8(this.Dh|0,this.Dl|0,N|0,O|0),{h:K,l:W}=D8(this.Eh|0,this.El|0,K|0,W|0),{h:T,l:f}=D8(this.Fh|0,this.Fl|0,T|0,f|0),{h:B,l:F}=D8(this.Gh|0,this.Gl|0,B|0,F|0),{h:H,l:j}=D8(this.Hh|0,this.Hl|0,H|0,j|0),this.set(q,Q,G,X,U,Y,N,O,K,W,T,f,B,F,H,j)}roundClean(){E8(F8,P8)}destroy(){E8(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class QJ extends G0{Ah=J8[0]|0;Al=J8[1]|0;Bh=J8[2]|0;Bl=J8[3]|0;Ch=J8[4]|0;Cl=J8[5]|0;Dh=J8[6]|0;Dl=J8[7]|0;Eh=J8[8]|0;El=J8[9]|0;Fh=J8[10]|0;Fl=J8[11]|0;Gh=J8[12]|0;Gl=J8[13]|0;Hh=J8[14]|0;Hl=J8[15]|0;constructor(){super(64)}}class hq extends G0{Ah=$8[0]|0;Al=$8[1]|0;Bh=$8[2]|0;Bl=$8[3]|0;Ch=$8[4]|0;Cl=$8[5]|0;Dh=$8[6]|0;Dl=$8[7]|0;Eh=$8[8]|0;El=$8[9]|0;Fh=$8[10]|0;Fl=$8[11]|0;Gh=$8[12]|0;Gl=$8[13]|0;Hh=$8[14]|0;Hl=$8[15]|0;constructor(){super(48)}}var q8=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),Q8=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class cq extends G0{Ah=q8[0]|0;Al=q8[1]|0;Bh=q8[2]|0;Bl=q8[3]|0;Ch=q8[4]|0;Cl=q8[5]|0;Dh=q8[6]|0;Dl=q8[7]|0;Eh=q8[8]|0;El=q8[9]|0;Fh=q8[10]|0;Fl=q8[11]|0;Gh=q8[12]|0;Gl=q8[13]|0;Hh=q8[14]|0;Hl=q8[15]|0;constructor(){super(28)}}class pq extends G0{Ah=Q8[0]|0;Al=Q8[1]|0;Bh=Q8[2]|0;Bl=Q8[3]|0;Ch=Q8[4]|0;Cl=Q8[5]|0;Dh=Q8[6]|0;Dl=Q8[7]|0;Eh=Q8[8]|0;El=Q8[9]|0;Fh=Q8[10]|0;Fl=Q8[11]|0;Gh=Q8[12]|0;Gl=Q8[13]|0;Hh=Q8[14]|0;Hl=Q8[15]|0;constructor(){super(32)}}var Z8=o0(()=>new JJ,r0(1));var GJ=o0(()=>new QJ,r0(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var UJ=BigInt(0),XJ=BigInt(1);function H0($,J=""){if(typeof $!=="boolean"){let q=J&&`"${J}" `;throw new Error(q+"expected boolean, got type="+typeof $)}return $}function lq($){if(typeof $==="bigint"){if(!E0($))throw new Error("positive bigint expected, got "+$)}else z8($);return $}function NJ($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?UJ:BigInt("0x"+$)}function YJ($){return NJ(u8($))}function A8($){return NJ(u8(m8(l($)).reverse()))}function e0($,J){z8(J),$=lq($);let q=e8($.toString(16).padStart(J*2,"0"));if(q.length!==J)throw new Error("number too large");return q}function z0($,J){return e0($,J).reverse()}function m8($){return Uint8Array.from($)}var E0=($)=>typeof $==="bigint"&&UJ<=$;function uq($,J,q){return E0($)&&E0(J)&&E0(q)&&J<=$&&$<q}function d8($,J,q,Q){if(!uq(J,q,Q))throw new Error("expected valid "+$+": "+q+" <= n < "+Q+", got "+J)}var ZJ=($)=>(XJ<<BigInt($))-XJ;function b8($,J={},q={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function Q(X,U,Y){let N=$[X];if(Y&&N===void 0)return;let O=typeof N;if(O!==U||N===null)throw new Error(`param "${X}" is invalid: expected ${U}, got ${O}`)}let G=(X,U)=>Object.entries(X).forEach(([Y,N])=>Q(Y,N,U));G(J,!1),G(q,!0)}function $$($){let J=new WeakMap;return(q,...Q)=>{let G=J.get(q);if(G!==void 0)return G;let X=$(q,...Q);return J.set(q,X),X}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var X8=BigInt(0),G8=BigInt(1),h8=BigInt(2),OJ=BigInt(3),LJ=BigInt(4),WJ=BigInt(5),dq=BigInt(7),CJ=BigInt(8),nq=BigInt(9),EJ=BigInt(16);function i($,J){let q=$%J;return q>=X8?q:J+q}function O8($,J,q){let Q=$;while(J-- >X8)Q*=Q,Q%=q;return Q}function KJ($,J){if($===X8)throw new Error("invert: expected non-zero number");if(J<=X8)throw new Error("invert: expected positive modulus, got "+J);let q=i($,J),Q=J,G=X8,X=G8,U=G8,Y=X8;while(q!==X8){let O=Q/q,K=Q%q,W=G-U*O,T=X-Y*O;Q=q,q=K,G=U,X=Y,U=W,Y=T}if(Q!==G8)throw new Error("invert: does not exist");return i(G,J)}function J$($,J,q){if(!$.eql($.sqr(J),q))throw new Error("Cannot find square root")}function HJ($,J){let q=($.ORDER+G8)/LJ,Q=$.pow(J,q);return J$($,Q,J),Q}function iq($,J){let q=($.ORDER-WJ)/CJ,Q=$.mul(J,h8),G=$.pow(Q,q),X=$.mul(J,G),U=$.mul($.mul(X,h8),G),Y=$.mul(X,$.sub(U,$.ONE));return J$($,Y,J),Y}function oq($){let J=T0($),q=zJ($),Q=q(J,J.neg(J.ONE)),G=q(J,Q),X=q(J,J.neg(Q)),U=($+dq)/EJ;return(Y,N)=>{let O=Y.pow(N,U),K=Y.mul(O,Q),W=Y.mul(O,G),T=Y.mul(O,X),f=Y.eql(Y.sqr(K),N),B=Y.eql(Y.sqr(W),N);O=Y.cmov(O,K,f),K=Y.cmov(T,W,B);let F=Y.eql(Y.sqr(K),N),H=Y.cmov(O,K,F);return J$(Y,H,N),H}}function zJ($){if($<OJ)throw new Error("sqrt is not defined for small field");let J=$-G8,q=0;while(J%h8===X8)J/=h8,q++;let Q=h8,G=T0($);while(MJ(G,Q)===1)if(Q++>1000)throw new Error("Cannot find square root: probably non-prime P");if(q===1)return HJ;let X=G.pow(Q,J),U=(J+G8)/h8;return function Y(N,O){if(N.is0(O))return O;if(MJ(N,O)!==1)throw new Error("Cannot find square root");let K=q,W=N.mul(N.ONE,X),T=N.pow(O,J),f=N.pow(O,U);while(!N.eql(T,N.ONE)){if(N.is0(T))return N.ZERO;let B=1,F=N.sqr(T);while(!N.eql(F,N.ONE))if(B++,F=N.sqr(F),B===K)throw new Error("Cannot find square root");let H=G8<<BigInt(K-B-1),j=N.pow(W,H);K=B,W=N.sqr(j),T=N.mul(T,W),f=N.mul(f,j)}return f}}function rq($){if($%LJ===OJ)return HJ;if($%CJ===WJ)return iq;if($%EJ===nq)return oq($);return zJ($)}var DJ=($,J)=>(i($,J)&G8)===G8,aq=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function TJ($){let J={ORDER:"bigint",BYTES:"number",BITS:"number"},q=aq.reduce((Q,G)=>{return Q[G]="function",Q},J);return b8($,q),$}function sq($,J,q){if(q<X8)throw new Error("invalid exponent, negatives unsupported");if(q===X8)return $.ONE;if(q===G8)return J;let Q=$.ONE,G=J;while(q>X8){if(q&G8)Q=$.mul(Q,G);G=$.sqr(G),q>>=G8}return Q}function D0($,J,q=!1){let Q=new Array(J.length).fill(q?$.ZERO:void 0),G=J.reduce((U,Y,N)=>{if($.is0(Y))return U;return Q[N]=U,$.mul(U,Y)},$.ONE),X=$.inv(G);return J.reduceRight((U,Y,N)=>{if($.is0(Y))return U;return Q[N]=$.mul(U,Q[N]),$.mul(U,Y)},X),Q}function MJ($,J){let q=($.ORDER-G8)/h8,Q=$.pow(J,q),G=$.eql(Q,$.ONE),X=$.eql(Q,$.ZERO),U=$.eql(Q,$.neg($.ONE));if(!G&&!X&&!U)throw new Error("invalid Legendre symbol result");return G?1:X?0:-1}function tq($,J){if(J!==void 0)z8(J);let q=J!==void 0?J:$.toString(2).length,Q=Math.ceil(q/8);return{nBitLength:q,nByteLength:Q}}class wJ{ORDER;BITS;BYTES;isLE;ZERO=X8;ONE=G8;_lengths;_sqrt;_mod;constructor($,J={}){if($<=X8)throw new Error("invalid field: expected ORDER > 0, got "+$);let q=void 0;if(this.isLE=!1,J!=null&&typeof J==="object"){if(typeof J.BITS==="number")q=J.BITS;if(typeof J.sqrt==="function")this.sqrt=J.sqrt;if(typeof J.isLE==="boolean")this.isLE=J.isLE;if(J.allowedLengths)this._lengths=J.allowedLengths?.slice();if(typeof J.modFromBytes==="boolean")this._mod=J.modFromBytes}let{nBitLength:Q,nByteLength:G}=tq($,q);if(G>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=Q,this.BYTES=G,this._sqrt=void 0,Object.preventExtensions(this)}create($){return i($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return X8<=$&&$<this.ORDER}is0($){return $===X8}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&G8)===G8}neg($){return i(-$,this.ORDER)}eql($,J){return $===J}sqr($){return i($*$,this.ORDER)}add($,J){return i($+J,this.ORDER)}sub($,J){return i($-J,this.ORDER)}mul($,J){return i($*J,this.ORDER)}pow($,J){return sq(this,$,J)}div($,J){return i($*KJ(J,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,J){return $+J}subN($,J){return $-J}mulN($,J){return $*J}inv($){return KJ($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=rq(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?z0($,this.BYTES):e0($,this.BYTES)}fromBytes($,J=!1){l($);let{_lengths:q,BYTES:Q,isLE:G,ORDER:X,_mod:U}=this;if(q){if(!q.includes($.length)||$.length>Q)throw new Error("Field.fromBytes: expected "+q+" bytes, got "+$.length);let N=new Uint8Array(Q);N.set($,G?0:N.length-$.length),$=N}if($.length!==Q)throw new Error("Field.fromBytes: expected "+Q+" bytes, got "+$.length);let Y=G?A8($):YJ($);if(U)Y=i(Y,X);if(!J){if(!this.isValid(Y))throw new Error("invalid field element: outside of range 0..ORDER")}return Y}invertBatch($){return D0(this,$)}cmov($,J,q){return q?J:$}}function T0($,J={}){return new wJ($,J)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var w0=BigInt(0),X$=BigInt(1);function RJ($,J){let q=J.negate();return $?q:J}function R0($,J){let q=D0($.Fp,J.map((Q)=>Q.Z));return J.map((Q,G)=>$.fromAffine(Q.toAffine(q[G])))}function fJ($,J){if(!Number.isSafeInteger($)||$<=0||$>J)throw new Error("invalid window size, expected [1.."+J+"], got W="+$)}function q$($,J){fJ($,J);let q=Math.ceil(J/$)+1,Q=2**($-1),G=2**$,X=ZJ($),U=BigInt($);return{windows:q,windowSize:Q,mask:X,maxNumber:G,shiftBy:U}}function BJ($,J,q){let{windowSize:Q,mask:G,maxNumber:X,shiftBy:U}=q,Y=Number($&G),N=$>>U;if(Y>Q)Y-=X,N+=X$;let O=J*Q,K=O+Math.abs(Y)-1,W=Y===0,T=Y<0,f=J%2!==0;return{nextN:N,offset:K,isZero:W,isNeg:T,isNegF:f,offsetF:O}}var Q$=new WeakMap,AJ=new WeakMap;function G$($){return AJ.get($)||1}function IJ($){if($!==w0)throw new Error("invalid wNAF")}class U${BASE;ZERO;Fn;bits;constructor($,J){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=J}_unsafeLadder($,J,q=this.ZERO){let Q=$;while(J>w0){if(J&X$)q=q.add(Q);Q=Q.double(),J>>=X$}return q}precomputeWindow($,J){let{windows:q,windowSize:Q}=q$(J,this.bits),G=[],X=$,U=X;for(let Y=0;Y<q;Y++){U=X,G.push(U);for(let N=1;N<Q;N++)U=U.add(X),G.push(U);X=U.double()}return G}wNAF($,J,q){if(!this.Fn.isValid(q))throw new Error("invalid scalar");let Q=this.ZERO,G=this.BASE,X=q$($,this.bits);for(let U=0;U<X.windows;U++){let{nextN:Y,offset:N,isZero:O,isNeg:K,isNegF:W,offsetF:T}=BJ(q,U,X);if(q=Y,O)G=G.add(RJ(W,J[T]));else Q=Q.add(RJ(K,J[N]))}return IJ(q),{p:Q,f:G}}wNAFUnsafe($,J,q,Q=this.ZERO){let G=q$($,this.bits);for(let X=0;X<G.windows;X++){if(q===w0)break;let{nextN:U,offset:Y,isZero:N,isNeg:O}=BJ(q,X,G);if(q=U,N)continue;else{let K=J[Y];Q=Q.add(O?K.negate():K)}}return IJ(q),Q}getPrecomputes($,J,q){let Q=Q$.get(J);if(!Q){if(Q=this.precomputeWindow(J,$),$!==1){if(typeof q==="function")Q=q(Q);Q$.set(J,Q)}}return Q}cached($,J,q){let Q=G$($);return this.wNAF(Q,this.getPrecomputes(Q,$,q),J)}unsafe($,J,q,Q){let G=G$($);if(G===1)return this._unsafeLadder($,J,Q);return this.wNAFUnsafe(G,this.getPrecomputes(G,$,q),J,Q)}createCache($,J){fJ(J,this.bits),AJ.set($,J),Q$.delete($)}hasCache($){return G$($)!==1}}function jJ($,J,q){if(J){if(J.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return TJ(J),J}else return T0($,{isLE:q})}function VJ($,J,q={},Q){if(Q===void 0)Q=$==="edwards";if(!J||typeof J!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let N of["p","n","h"]){let O=J[N];if(!(typeof O==="bigint"&&O>w0))throw new Error(`CURVE.${N} must be positive bigint`)}let G=jJ(J.p,q.Fp,Q),X=jJ(J.n,q.Fn,Q),Y=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let N of Y)if(!G.isValid(J[N]))throw new Error(`CURVE.${N} must be valid field element of CURVE.Fp`);return J=Object.freeze(Object.assign({},J)),{CURVE:J,Fp:G,Fn:X}}function B0($,J){return function q(Q){let G=$(Q);return{secretKey:G,publicKey:J(G)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var k8=BigInt(0),t=BigInt(1),N$=BigInt(2),eq=BigInt(8);function $Q($,J,q,Q){let G=$.sqr(q),X=$.sqr(Q),U=$.add($.mul(J.a,G),X),Y=$.add($.ONE,$.mul(J.d,$.mul(G,X)));return $.eql(U,Y)}function xJ($,J={}){let q=VJ("edwards",$,J,J.FpFnLE),{Fp:Q,Fn:G}=q,X=q.CURVE,{h:U}=X;b8(J,{},{uvRatio:"function"});let Y=N$<<BigInt(G.BYTES*8)-t,N=(H)=>Q.create(H),O=J.uvRatio||((H,j)=>{try{return{isValid:!0,value:Q.sqrt(Q.div(H,j))}}catch(I){return{isValid:!1,value:k8}}});if(!$Q(Q,X,X.Gx,X.Gy))throw new Error("bad curve params: generator point");function K(H,j,I=!1){let R=I?t:k8;return d8("coordinate "+H,j,R,Y),j}function W(H){if(!(H instanceof B))throw new Error("EdwardsPoint expected")}let T=$$((H,j)=>{let{X:I,Y:R,Z:g}=H,m=H.is0();if(j==null)j=m?eq:Q.inv(g);let u=N(I*j),h=N(R*j),V=Q.mul(g,j);if(m)return{x:k8,y:t};if(V!==t)throw new Error("invZ was invalid");return{x:u,y:h}}),f=$$((H)=>{let{a:j,d:I}=X;if(H.is0())throw new Error("bad point: ZERO");let{X:R,Y:g,Z:m,T:u}=H,h=N(R*R),V=N(g*g),k=N(m*m),y=N(k*k),p=N(h*j),d=N(k*N(p+V)),M=N(y+N(I*N(h*V)));if(d!==M)throw new Error("bad point: equation left != right (1)");let D=N(R*g),C=N(m*u);if(D!==C)throw new Error("bad point: equation left != right (2)");return!0});class B{static BASE=new B(X.Gx,X.Gy,t,N(X.Gx*X.Gy));static ZERO=new B(k8,t,t,k8);static Fp=Q;static Fn=G;X;Y;Z;T;constructor(H,j,I,R){this.X=K("x",H),this.Y=K("y",j),this.Z=K("z",I,!0),this.T=K("t",R),Object.freeze(this)}static CURVE(){return X}static fromAffine(H){if(H instanceof B)throw new Error("extended point not allowed");let{x:j,y:I}=H||{};return K("x",j),K("y",I),new B(j,I,t,N(j*I))}static fromBytes(H,j=!1){let I=Q.BYTES,{a:R,d:g}=X;H=m8(l(H,I,"point")),H0(j,"zip215");let m=m8(H),u=H[I-1];m[I-1]=u&-129;let h=A8(m),V=j?Y:Q.ORDER;d8("point.y",h,k8,V);let k=N(h*h),y=N(k-t),p=N(g*k-R),{isValid:d,value:M}=O(y,p);if(!d)throw new Error("bad point: invalid y coordinate");let D=(M&t)===t,C=(u&128)!==0;if(!j&&M===k8&&C)throw new Error("bad point: x=0 and x_0=1");if(C!==D)M=N(-M);return B.fromAffine({x:M,y:h})}static fromHex(H,j=!1){return B.fromBytes(e8(H),j)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(H=8,j=!0){if(F.createCache(this,H),!j)this.multiply(N$);return this}assertValidity(){f(this)}equals(H){W(H);let{X:j,Y:I,Z:R}=this,{X:g,Y:m,Z:u}=H,h=N(j*u),V=N(g*R),k=N(I*u),y=N(m*R);return h===V&&k===y}is0(){return this.equals(B.ZERO)}negate(){return new B(N(-this.X),this.Y,this.Z,N(-this.T))}double(){let{a:H}=X,{X:j,Y:I,Z:R}=this,g=N(j*j),m=N(I*I),u=N(N$*N(R*R)),h=N(H*g),V=j+I,k=N(N(V*V)-g-m),y=h+m,p=y-u,d=h-m,M=N(k*p),D=N(y*d),C=N(k*d),z=N(p*y);return new B(M,D,z,C)}add(H){W(H);let{a:j,d:I}=X,{X:R,Y:g,Z:m,T:u}=this,{X:h,Y:V,Z:k,T:y}=H,p=N(R*h),d=N(g*V),M=N(u*I*y),D=N(m*k),C=N((R+g)*(h+V)-p-d),z=D-M,w=D+M,A=N(d-j*p),P=N(C*z),_=N(w*A),S=N(C*A),v=N(z*w);return new B(P,_,v,S)}subtract(H){return this.add(H.negate())}multiply(H){if(!G.isValidNot0(H))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:j,f:I}=F.cached(this,H,(R)=>R0(B,R));return R0(B,[j,I])[0]}multiplyUnsafe(H,j=B.ZERO){if(!G.isValid(H))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(H===k8)return B.ZERO;if(this.is0()||H===t)return this;return F.unsafe(this,H,(I)=>R0(B,I),j)}isSmallOrder(){return this.multiplyUnsafe(U).is0()}isTorsionFree(){return F.unsafe(this,X.n).is0()}toAffine(H){return T(this,H)}clearCofactor(){if(U===t)return this;return this.multiplyUnsafe(U)}toBytes(){let{x:H,y:j}=this.toAffine(),I=Q.toBytes(j);return I[I.length-1]|=H&t?128:0,I}toHex(){return u8(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let F=new U$(B,G.BITS);return B.BASE.precompute(8),B}function FJ($,J,q={}){if(typeof J!=="function")throw new Error('"hash" function param is required');b8(q,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:Q}=q,{BASE:G,Fp:X,Fn:U}=$,Y=q.randomBytes||J0,N=q.adjustScalarBytes||((V)=>V),O=q.domain||((V,k,y)=>{if(H0(y,"phflag"),k.length||y)throw new Error("Contexts/pre-hash are not supported");return V});function K(V){return U.create(A8(V))}function W(V){let k=R.secretKey;l(V,R.secretKey,"secretKey");let y=l(J(V),2*k,"hashedSecretKey"),p=N(y.slice(0,k)),d=y.slice(k,2*k),M=K(p);return{head:p,prefix:d,scalar:M}}function T(V){let{head:k,prefix:y,scalar:p}=W(V),d=G.multiply(p),M=d.toBytes();return{head:k,prefix:y,scalar:p,point:d,pointBytes:M}}function f(V){return T(V).pointBytes}function B(V=Uint8Array.of(),...k){let y=$0(...k);return K(J(O(y,l(V,void 0,"context"),!!Q)))}function F(V,k,y={}){if(V=l(V,void 0,"message"),Q)V=Q(V);let{prefix:p,scalar:d,pointBytes:M}=T(k),D=B(y.context,p,V),C=G.multiply(D).toBytes(),z=B(y.context,C,M,V),w=U.create(D+z*d);if(!U.isValid(w))throw new Error("sign failed: invalid s");let A=$0(C,U.toBytes(w));return l(A,R.signature,"result")}let H={zip215:!0};function j(V,k,y,p=H){let{context:d,zip215:M}=p,D=R.signature;if(V=l(V,D,"signature"),k=l(k,void 0,"message"),y=l(y,R.publicKey,"publicKey"),M!==void 0)H0(M,"zip215");if(Q)k=Q(k);let C=D/2,z=V.subarray(0,C),w=A8(V.subarray(C,D)),A,P,_;try{A=$.fromBytes(y,M),P=$.fromBytes(z,M),_=G.multiplyUnsafe(w)}catch(s8){return!1}if(!M&&A.isSmallOrder())return!1;let S=B(d,P.toBytes(),A.toBytes(),k);return P.add(A.multiplyUnsafe(S)).subtract(_).clearCofactor().is0()}let I=X.BYTES,R={secretKey:I,publicKey:I,signature:2*I,seed:I};function g(V=Y(R.seed)){return l(V,R.seed,"seed")}function m(V){return O0(V)&&V.length===U.BYTES}function u(V,k){try{return!!$.fromBytes(V,k)}catch(y){return!1}}let h={getExtendedPublicKey:T,randomSecretKey:g,isValidSecretKey:m,isValidPublicKey:u,toMontgomery(V){let{y:k}=$.fromBytes(V),y=R.publicKey,p=y===32;if(!p&&y!==57)throw new Error("only defined for 25519 and 448");let d=p?X.div(t+k,t-k):X.div(k-t,k+t);return X.toBytes(d)},toMontgomerySecret(V){let k=R.secretKey;l(V,k);let y=J(V.subarray(0,k));return N(y).subarray(0,k)}};return Object.freeze({keygen:B0(g,f),getPublicKey:f,sign:F,verify:j,utils:h,Point:$,lengths:R})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var X0=BigInt(0),n8=BigInt(1),I0=BigInt(2);function JQ($){return b8($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function PJ($){let J=JQ($),{P:q,type:Q,adjustScalarBytes:G,powPminus2:X,randomBytes:U}=J,Y=Q==="x25519";if(!Y&&Q!=="x448")throw new Error("invalid type");let N=U||J0,O=Y?255:448,K=Y?32:56,W=Y?BigInt(9):BigInt(5),T=Y?BigInt(121665):BigInt(39081),f=Y?I0**BigInt(254):I0**BigInt(447),B=Y?BigInt(8)*I0**BigInt(251)-n8:BigInt(4)*I0**BigInt(445)-n8,F=f+B+n8,H=(D)=>i(D,q),j=I(W);function I(D){return z0(H(D),K)}function R(D){let C=m8(l(D,K,"uCoordinate"));if(Y)C[31]&=127;return H(A8(C))}function g(D){return A8(G(m8(l(D,K,"scalar"))))}function m(D,C){let z=y(R(C),g(D));if(z===X0)throw new Error("invalid private or public key received");return I(z)}function u(D){return m(D,j)}let h=u,V=m;function k(D,C,z){let w=H(D*(C-z));return C=H(C-w),z=H(z+w),{x_2:C,x_3:z}}function y(D,C){d8("u",D,X0,q),d8("scalar",C,f,F);let z=C,w=D,A=n8,P=X0,_=D,S=n8,v=X0;for(let l0=BigInt(O-1);l0>=X0;l0--){let _$=z>>l0&n8;v^=_$,{x_2:A,x_3:_}=k(v,A,_),{x_2:P,x_3:S}=k(v,P,S),v=_$;let u0=A+P,d0=H(u0*u0),n0=A-P,S$=H(n0*n0),y$=d0-S$,fq=_+S,Aq=_-S,v$=H(Aq*u0),g$=H(fq*n0),m$=v$+g$,b$=v$-g$;_=H(m$*m$),S=H(w*H(b$*b$)),A=H(d0*S$),P=H(y$*(d0+H(T*y$)))}({x_2:A,x_3:_}=k(v,A,_)),{x_2:P,x_3:S}=k(v,P,S);let s8=X(P);return H(A*s8)}let p={secretKey:K,publicKey:K,seed:K},d=(D=N(K))=>{return l(D,p.seed,"seed"),D},M={randomSecretKey:d};return Object.freeze({keygen:B0(d,h),getSharedSecret:V,getPublicKey:h,scalarMult:m,scalarMultBase:u,utils:M,GuBytes:j.slice(),lengths:p})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var qQ=BigInt(1),kJ=BigInt(2),QQ=BigInt(3),GQ=BigInt(5),XQ=BigInt(8),j0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),UQ=(()=>({p:j0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:XQ,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function SJ($){let J=BigInt(10),q=BigInt(20),Q=BigInt(40),G=BigInt(80),X=j0,Y=$*$%X*$%X,N=O8(Y,kJ,X)*Y%X,O=O8(N,qQ,X)*$%X,K=O8(O,GQ,X)*O%X,W=O8(K,J,X)*K%X,T=O8(W,q,X)*W%X,f=O8(T,Q,X)*T%X,B=O8(f,G,X)*f%X,F=O8(B,G,X)*f%X,H=O8(F,J,X)*K%X;return{pow_p_5_8:O8(H,kJ,X)*$%X,b2:Y}}function yJ($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var _J=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function NQ($,J){let q=j0,Q=i(J*J*J,q),G=i(Q*Q*J,q),X=SJ($*G).pow_p_5_8,U=i($*Q*X,q),Y=i(J*U*U,q),N=U,O=i(U*_J,q),K=Y===$,W=Y===i(-$,q),T=Y===i(-$*_J,q);if(K)U=N;if(W||T)U=O;if(DJ(U,q))U=i(-U,q);return{isValid:K||W,value:U}}var YQ=xJ(UQ,{uvRatio:NQ});function ZQ($){return FJ(YQ,GJ,Object.assign({adjustScalarBytes:yJ},$))}var _8=ZQ({});var f0=(()=>{let $=j0;return PJ({P:$,type:"x25519",powPminus2:(J)=>{let{pow_p_5_8:q,b2:Q}=SJ(J);return i(O8(q,QQ,$)*Q,$)},adjustScalarBytes:yJ})})();var Gq=c$(Y$(),1);var Z$;try{Z$=new TextDecoder}catch($){}var x,p8,E=0;var cJ=[],KQ=105,MQ=57342,OQ=57343,gJ=57337;var mJ=6,i8={},U0=112810000,V8=16810000;var K$=cJ,M$=0,b={},o,x0,F0=0,Y0=0,a,L8,r=[],O$=[],Y8,U8,N0,bJ={useRecords:!1,mapsAsObjects:!0},Z0=!1,pJ=2;try{new Function("")}catch($){pJ=1/0}class S8{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[J,q]of Object.entries($.keyMap))this.mapKey.set(q,J)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let J=new Map;for(let[q,Q]of Object.entries($))J.set(this._keyMap.hasOwnProperty(q)?this._keyMap[q]:q,Q);return J}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[q,Q]of Object.entries(this._keyMap))this._mapKey.set(Q,q)}let J={};return $.forEach((q,Q)=>J[W8(this._mapKey.has(Q)?this._mapKey.get(Q):Q)]=q),J}mapDecode($,J){let q=this.decode($);if(this._keyMap)switch(q.constructor.name){case"Array":return q.map((Q)=>this.decodeKeys(Q))}return q}decode($,J){if(x)return nJ(()=>{return P0(),this?this.decode($,J):S8.prototype.decode.call(bJ,$,J)});p8=J>-1?J:$.length,E=0,M$=0,Y0=0,x0=null,K$=cJ,a=null,x=$;try{U8=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(q){if(x=null,$ instanceof Uint8Array)throw q;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof S8){if(b=this,Y8=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return o=this.structures,A0();else if(!o||o.length>0)o=[]}else{if(b=bJ,!o||o.length>0)o=[];Y8=null}return A0()}decodeMultiple($,J){let q,Q=0;try{let G=$.length;Z0=!0;let X=this?this.decode($,G):z$.decode($,G);if(J){if(J(X)===!1)return;while(E<G)if(Q=E,J(A0())===!1)return}else{q=[X];while(E<G)Q=E,q.push(A0());return q}}catch(G){throw G.lastPosition=Q,G.values=q,G}finally{Z0=!1,P0()}}}function A0(){try{let $=c();if(a){if(E>=a.postBundlePosition){let J=new Error("Unexpected bundle position");throw J.incomplete=!0,J}E=a.postBundlePosition,a=null}if(E==p8){if(o=null,x=null,L8)L8=null}else if(E>p8){let J=new Error("Unexpected end of CBOR data");throw J.incomplete=!0,J}else if(!Z0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(P0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function c(){let $=x[E++],J=$>>5;if($=$&31,$>23)switch($){case 24:$=x[E++];break;case 25:if(J==7)return EQ();$=U8.getUint16(E),E+=2;break;case 26:if(J==7){let q=U8.getFloat32(E);if(b.useFloat32>2){let Q=k0[(x[E]&127)<<1|x[E+1]>>7];return E+=4,(Q*q+(q>0?0.5:-0.5)>>0)/Q}return E+=4,q}$=U8.getUint32(E),E+=4;break;case 27:if(J==7){let q=U8.getFloat64(E);return E+=8,q}if(J>1){if(U8.getUint32(E)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=U8.getUint32(E+4)}else if(b.int64AsNumber)$=U8.getUint32(E)*4294967296,$+=U8.getUint32(E+4);else $=U8.getBigUint64(E);E+=8;break;case 31:switch(J){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let q=[],Q,G=0;while((Q=c())!=i8){if(G>=U0)throw new Error(`Array length exceeds ${U0}`);q[G++]=Q}return J==4?q:J==3?q.join(""):Buffer.concat(q);case 5:let X;if(b.mapsAsObjects){let U={},Y=0;if(b.keyMap)while((X=c())!=i8){if(Y++>=V8)throw new Error(`Property count exceeds ${V8}`);U[W8(b.decodeKey(X))]=c()}else while((X=c())!=i8){if(Y++>=V8)throw new Error(`Property count exceeds ${V8}`);U[W8(X)]=c()}return U}else{if(N0)b.mapsAsObjects=!0,N0=!1;let U=new Map;if(b.keyMap){let Y=0;while((X=c())!=i8){if(Y++>=V8)throw new Error(`Map size exceeds ${V8}`);U.set(b.decodeKey(X),c())}}else{let Y=0;while((X=c())!=i8){if(Y++>=V8)throw new Error(`Map size exceeds ${V8}`);U.set(X,c())}}return U}case 7:return i8;default:throw new Error("Invalid major type for indefinite length "+J)}default:throw new Error("Unknown token "+$)}switch(J){case 0:return $;case 1:return~$;case 2:return CQ($);case 3:if(Y0>=E)return x0.slice(E-F0,(E+=$)-F0);if(Y0==0&&p8<140&&$<32){let G=$<16?lJ($):WQ($);if(G!=null)return G}return LQ($);case 4:if($>=U0)throw new Error(`Array length exceeds ${U0}`);let q=new Array($);for(let G=0;G<$;G++)q[G]=c();return q;case 5:if($>=V8)throw new Error(`Map size exceeds ${U0}`);if(b.mapsAsObjects){let G={};if(b.keyMap)for(let X=0;X<$;X++)G[W8(b.decodeKey(c()))]=c();else for(let X=0;X<$;X++)G[W8(c())]=c();return G}else{if(N0)b.mapsAsObjects=!0,N0=!1;let G=new Map;if(b.keyMap)for(let X=0;X<$;X++)G.set(b.decodeKey(c()),c());else for(let X=0;X<$;X++)G.set(c(),c());return G}case 6:if($>=gJ){let G=o[$&8191];if(G){if(!G.read)G.read=L$(G);return G.read()}if($<65536){if($==OQ){let X=r8(),U=c(),Y=c();C$(U,Y);let N={};if(b.keyMap)for(let O=2;O<X;O++){let K=b.decodeKey(Y[O-2]);N[W8(K)]=c()}else for(let O=2;O<X;O++){let K=Y[O-2];N[W8(K)]=c()}return N}else if($==MQ){let X=r8(),U=c();for(let Y=2;Y<X;Y++)C$(U++,c());return c()}else if($==gJ)return RQ();if(b.getShared){if(H$(),G=o[$&8191],G){if(!G.read)G.read=L$(G);return G.read()}}}}let Q=r[$];if(Q)if(Q.handlesRead)return Q(c);else return Q(c());else{let G=c();for(let X=0;X<O$.length;X++){let U=O$[X]($,G);if(U!==void 0)return U}return new T8(G,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let G=(Y8||c8())[$];if(G!==void 0)return G;throw new Error("Unknown token "+$)}default:if(isNaN($)){let G=new Error("Unexpected end of CBOR data");throw G.incomplete=!0,G}throw new Error("Unknown CBOR token "+$)}}var hJ=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function L$($){if(!$)throw new Error("Structure is required in record definition");function J(){let q=x[E++];if(q=q&31,q>23)switch(q){case 24:q=x[E++];break;case 25:q=U8.getUint16(E),E+=2;break;case 26:q=U8.getUint32(E),E+=4;break;default:throw new Error("Expected array header, but got "+x[E-1])}let Q=this.compiledReader;while(Q){if(Q.propertyCount===q)return Q(c);Q=Q.next}if(this.slowReads++>=pJ){let X=this.length==q?this:this.slice(0,q);if(Q=b.keyMap?new Function("r","return {"+X.map((U)=>b.decodeKey(U)).map((U)=>hJ.test(U)?W8(U)+":r()":"["+JSON.stringify(U)+"]:r()").join(",")+"}"):new Function("r","return {"+X.map((U)=>hJ.test(U)?W8(U)+":r()":"["+JSON.stringify(U)+"]:r()").join(",")+"}"),this.compiledReader)Q.next=this.compiledReader;return Q.propertyCount=q,this.compiledReader=Q,Q(c)}let G={};if(b.keyMap)for(let X=0;X<q;X++)G[W8(b.decodeKey(this[X]))]=c();else for(let X=0;X<q;X++)G[W8(this[X])]=c();return G}return $.slowReads=0,J}function W8($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var LQ=W$;function W$($){let J;if($<16){if(J=lJ($))return J}if($>64&&Z$)return Z$.decode(x.subarray(E,E+=$));let q=E+$,Q=[];J="";while(E<q){let G=x[E++];if((G&128)===0)Q.push(G);else if((G&224)===192){let X=x[E++]&63;Q.push((G&31)<<6|X)}else if((G&240)===224){let X=x[E++]&63,U=x[E++]&63;Q.push((G&31)<<12|X<<6|U)}else if((G&248)===240){let X=x[E++]&63,U=x[E++]&63,Y=x[E++]&63,N=(G&7)<<18|X<<12|U<<6|Y;if(N>65535)N-=65536,Q.push(N>>>10&1023|55296),N=56320|N&1023;Q.push(N)}else Q.push(G);if(Q.length>=4096)J+=e.apply(String,Q),Q.length=0}if(Q.length>0)J+=e.apply(String,Q);return J}var e=String.fromCharCode;function WQ($){let J=E,q=new Array($);for(let Q=0;Q<$;Q++){let G=x[E++];if((G&128)>0){E=J;return}q[Q]=G}return e.apply(String,q)}function lJ($){if($<4)if($<2)if($===0)return"";else{let J=x[E++];if((J&128)>1){E-=1;return}return e(J)}else{let J=x[E++],q=x[E++];if((J&128)>0||(q&128)>0){E-=2;return}if($<3)return e(J,q);let Q=x[E++];if((Q&128)>0){E-=3;return}return e(J,q,Q)}else{let J=x[E++],q=x[E++],Q=x[E++],G=x[E++];if((J&128)>0||(q&128)>0||(Q&128)>0||(G&128)>0){E-=4;return}if($<6)if($===4)return e(J,q,Q,G);else{let X=x[E++];if((X&128)>0){E-=5;return}return e(J,q,Q,G,X)}else if($<8){let X=x[E++],U=x[E++];if((X&128)>0||(U&128)>0){E-=6;return}if($<7)return e(J,q,Q,G,X,U);let Y=x[E++];if((Y&128)>0){E-=7;return}return e(J,q,Q,G,X,U,Y)}else{let X=x[E++],U=x[E++],Y=x[E++],N=x[E++];if((X&128)>0||(U&128)>0||(Y&128)>0||(N&128)>0){E-=8;return}if($<10)if($===8)return e(J,q,Q,G,X,U,Y,N);else{let O=x[E++];if((O&128)>0){E-=9;return}return e(J,q,Q,G,X,U,Y,N,O)}else if($<12){let O=x[E++],K=x[E++];if((O&128)>0||(K&128)>0){E-=10;return}if($<11)return e(J,q,Q,G,X,U,Y,N,O,K);let W=x[E++];if((W&128)>0){E-=11;return}return e(J,q,Q,G,X,U,Y,N,O,K,W)}else{let O=x[E++],K=x[E++],W=x[E++],T=x[E++];if((O&128)>0||(K&128)>0||(W&128)>0||(T&128)>0){E-=12;return}if($<14)if($===12)return e(J,q,Q,G,X,U,Y,N,O,K,W,T);else{let f=x[E++];if((f&128)>0){E-=13;return}return e(J,q,Q,G,X,U,Y,N,O,K,W,T,f)}else{let f=x[E++],B=x[E++];if((f&128)>0||(B&128)>0){E-=14;return}if($<15)return e(J,q,Q,G,X,U,Y,N,O,K,W,T,f,B);let F=x[E++];if((F&128)>0){E-=15;return}return e(J,q,Q,G,X,U,Y,N,O,K,W,T,f,B,F)}}}}}function CQ($){return b.copyBuffers?Uint8Array.prototype.slice.call(x,E,E+=$):x.subarray(E,E+=$)}var uJ=new Float32Array(1),V0=new Uint8Array(uJ.buffer,0,4);function EQ(){let $=x[E++],J=x[E++],q=($&127)>>2;if(q===31){if(J||$&3)return NaN;return $&128?-1/0:1/0}if(q===0){let Q=(($&3)<<8|J)/16777216;return $&128?-Q:Q}return V0[3]=$&128|(q>>1)+56,V0[2]=($&7)<<5|J>>3,V0[1]=J<<5,V0[0]=0,uJ[0]}var A9=new Array(4096);class T8{constructor($,J){this.value=$,this.tag=J}}r[0]=($)=>{return new Date($)};r[1]=($)=>{return new Date(Math.round($*1000))};r[2]=($)=>{let J=BigInt(0);for(let q=0,Q=$.byteLength;q<Q;q++)J=BigInt($[q])+(J<<BigInt(8));return J};r[3]=($)=>{return BigInt(-1)-r[2]($)};r[4]=($)=>{return+($[1]+"e"+$[0])};r[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var C$=($,J)=>{$=$-57344;let q=o[$];if(q&&q.isShared)(o.restoreStructures||(o.restoreStructures=[]))[$]=q;o[$]=J,J.read=L$(J)};r[KQ]=($)=>{let J=$.length,q=$[1];C$($[0],q);let Q={};for(let G=2;G<J;G++){let X=q[G-2];Q[W8(X)]=$[G]}return Q};r[14]=($)=>{if(a)return a[0].slice(a.position0,a.position0+=$);return new T8($,14)};r[15]=($)=>{if(a)return a[1].slice(a.position1,a.position1+=$);return new T8($,15)};var HQ={Error,RegExp};r[27]=($)=>{return(HQ[$[0]]||Error)($[1],$[2])};var dJ=($)=>{if(x[E++]!=132){let q=new Error("Packed values structure must be followed by a 4 element array");if(x.length<E)q.incomplete=!0;throw q}let J=$();if(!J||!J.length){let q=new Error("Packed values structure must be followed by a 4 element array");throw q.incomplete=!0,q}return Y8=Y8?J.concat(Y8.slice(J.length)):J,Y8.prefixes=$(),Y8.suffixes=$(),$()};dJ.handlesRead=!0;r[51]=dJ;r[mJ]=($)=>{if(!Y8)if(b.getShared)H$();else return new T8($,mJ);if(typeof $=="number")return Y8[16+($>=0?2*$:-2*$-1)];let J=new Error("No support for non-integer packed references yet");if($===void 0)J.incomplete=!0;throw J};r[28]=($)=>{if(!L8)L8=new Map,L8.id=0;let J=L8.id++,q=E,Q=x[E],G;if(Q>>5==4)G=[];else G={};let X={target:G};L8.set(J,X);let U=$();if(X.used){if(Object.getPrototypeOf(G)!==Object.getPrototypeOf(U))E=q,G=U,L8.set(J,{target:G}),U=$();return Object.assign(G,U)}return X.target=U,U};r[28].handlesRead=!0;r[29]=($)=>{let J=L8.get($);return J.used=!0,J.target};r[258]=($)=>new Set($);(r[259]=($)=>{if(b.mapsAsObjects)b.mapsAsObjects=!1,N0=!0;return $()}).handlesRead=!0;function o8($,J){if(typeof $==="string")return $+J;if($ instanceof Array)return $.concat(J);return Object.assign({},$,J)}function c8(){if(!Y8)if(b.getShared)H$();else throw new Error("No packed values available");return Y8}var zQ=1399353956;O$.push(($,J)=>{if($>=225&&$<=255)return o8(c8().prefixes[$-224],J);if($>=28704&&$<=32767)return o8(c8().prefixes[$-28672],J);if($>=1879052288&&$<=2147483647)return o8(c8().prefixes[$-1879048192],J);if($>=216&&$<=223)return o8(J,c8().suffixes[$-216]);if($>=27647&&$<=28671)return o8(J,c8().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return o8(J,c8().suffixes[$-1811939328]);if($==zQ)return{packedValues:Y8,structures:o.slice(0),version:J};if($==55799)return J});var DQ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,E$=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],TQ=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<E$.length;$++)wQ(E$[$],TQ[$]);function wQ($,J){let q="get"+$.name.slice(0,-5),Q;if(typeof $==="function")Q=$.BYTES_PER_ELEMENT;else $=null;for(let G=0;G<2;G++){if(!G&&Q==1)continue;let X=Q==2?1:Q==4?2:Q==8?3:0;r[G?J:J-4]=Q==1||G==DQ?(U)=>{if(!$)throw new Error("Could not find typed array for code "+J);if(!b.copyBuffers){if(Q===1||Q===2&&!(U.byteOffset&1)||Q===4&&!(U.byteOffset&3)||Q===8&&!(U.byteOffset&7))return new $(U.buffer,U.byteOffset,U.byteLength>>X)}return new $(Uint8Array.prototype.slice.call(U,0).buffer)}:(U)=>{if(!$)throw new Error("Could not find typed array for code "+J);let Y=new DataView(U.buffer,U.byteOffset,U.byteLength),N=U.length>>X,O=new $(N),K=Y[q];for(let W=0;W<N;W++)O[W]=K.call(Y,W<<X,G);return O}}}function RQ(){let $=r8(),J=E+c();for(let Q=2;Q<$;Q++){let G=r8();E+=G}let q=E;return E=J,a=[W$(r8()),W$(r8())],a.position0=0,a.position1=0,a.postBundlePosition=E,E=q,c()}function r8(){let $=x[E++]&31;if($>23)switch($){case 24:$=x[E++];break;case 25:$=U8.getUint16(E),E+=2;break;case 26:$=U8.getUint32(E),E+=4;break}return $}function H$(){if(b.getShared){let $=nJ(()=>{return x=null,b.getShared()})||{},J=$.structures||[];if(b.sharedVersion=$.version,Y8=b.sharedValues=$.packedValues,o===!0)b.structures=o=J;else o.splice.apply(o,[0,J.length].concat(J))}}function nJ($){let J=p8,q=E,Q=M$,G=F0,X=Y0,U=x0,Y=K$,N=L8,O=a,K=new Uint8Array(x.slice(0,p8)),W=o,T=b,f=Z0,B=$();return p8=J,E=q,M$=Q,F0=G,Y0=X,x0=U,K$=Y,L8=N,a=O,x=K,Z0=f,o=W,b=T,U8=new DataView(x.buffer,x.byteOffset,x.byteLength),B}function P0(){x=null,L8=null,o=null}var k0=new Array(147);for(let $=0;$<256;$++)k0[$]=+("1e"+Math.floor(45.15-$*0.30103));var z$=new S8({useRecords:!1}),_0=z$.decode,BQ=z$.decodeMultiple;var S0;try{S0=new TextEncoder}catch($){}var B$,eJ,v0=typeof globalThis==="object"&&globalThis.Buffer,K0=typeof v0!=="undefined",D$=K0?v0.allocUnsafeSlow:Uint8Array,iJ=K0?v0:Uint8Array,oJ=256,rJ=K0?4294967296:2144337920;var T$,L,n,Z=0,y8,s=null,IQ=61440,jQ=/[\u0080-\uFFFF]/,K8=Symbol("record-id");class g0 extends S8{constructor($){super($);this.offset=0;let J,q,Q,G,X,U;$=$||{};let Y=iJ.prototype.utf8Write?function(M,D,C){return L.utf8Write(M,D,C)}:S0&&S0.encodeInto?function(M,D){return S0.encodeInto(M,L.subarray(D)).written}:!1,N=this,O=$.structures||$.saveStructures,K=$.maxSharedStructures;if(K==null)K=O?128:0;if(K>8190)throw new Error("Maximum maxSharedStructure is 8190");let W=$.sequential;if(W)K=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let T,f,B=$.sharedValues,F;if(B){F=Object.create(null);for(let M=0,D=B.length;M<D;M++)F[B[M]]=M}let H=[],j=0,I=0;this.mapEncode=function(M,D){if(this._keyMap&&!this._mapped)switch(M.constructor.name){case"Array":M=M.map((C)=>this.encodeKeys(C));break}return this.encode(M,D)},this.encode=function(M,D){if(!L)L=new D$(8192),n=new DataView(L.buffer,0,8192),Z=0;if(y8=L.length-10,y8-Z<2048)L=new D$(L.length),n=new DataView(L.buffer,0,L.length),y8=L.length-10,Z=0;else if(D===j$)Z=Z+7&2147483640;if(q=Z,N.useSelfDescribedHeader)n.setUint32(Z,3654940416),Z+=3;if(U=N.structuredClone?new Map:null,N.bundleStrings&&typeof M!=="string")s=[],s.size=1/0;else s=null;if(Q=N.structures,Q){if(Q.uninitialized){let z=N.getShared()||{};N.structures=Q=z.structures||[],N.sharedVersion=z.version;let w=N.sharedValues=z.packedValues;if(w){F={};for(let A=0,P=w.length;A<P;A++)F[w[A]]=A}}let C=Q.length;if(C>K&&!W)C=K;if(!Q.transitions){Q.transitions=Object.create(null);for(let z=0;z<C;z++){let w=Q[z];if(!w)continue;let A,P=Q.transitions;for(let _=0,S=w.length;_<S;_++){if(P[K8]===void 0)P[K8]=z;let v=w[_];if(A=P[v],!A)A=P[v]=Object.create(null);P=A}P[K8]=z|1048576}}if(!W)Q.nextId=C}if(G)G=!1;if(X=Q||[],f=F,$.pack){let C=new Map;if(C.values=[],C.encoder=N,C.maxValues=$.maxPrivatePackedValues||(F?16:1/0),C.objectMap=F||!1,C.samplingPackedValues=T,y0(M,C),C.values.length>0){L[Z++]=216,L[Z++]=51,R8(4);let z=C.values;R(z),R8(0),R8(0),f=Object.create(F||null);for(let w=0,A=z.length;w<A;w++)f[z[w]]=w}}T$=D&R$;try{if(T$)return;if(R(M),s)sJ(q,R);if(N.offset=Z,U&&U.idsToInsert){if(Z+=U.idsToInsert.length*2,Z>y8)m(Z);N.offset=Z;let C=VQ(L.subarray(q,Z),U.idsToInsert);return U=null,C}if(D&j$)return L.start=q,L.end=Z,L;return L.subarray(q,Z)}finally{if(Q){if(I<10)I++;if(Q.length>K)Q.length=K;if(j>1e4){if(Q.transitions=null,I=0,j=0,H.length>0)H=[]}else if(H.length>0&&!W){for(let C=0,z=H.length;C<z;C++)H[C][K8]=void 0;H=[]}}if(G&&N.saveShared){if(N.structures.length>K)N.structures=N.structures.slice(0,K);let C=L.subarray(q,Z);if(N.updateSharedData()===!1)return N.encode(M);return C}if(D&kQ)Z=q}},this.findCommonStringsToPack=()=>{if(T=new Map,!F)F=Object.create(null);return(M)=>{let D=M&&M.threshold||4,C=this.pack?M.maxPrivatePackedValues||16:0;if(!B)B=this.sharedValues=[];for(let[z,w]of T)if(w.count>D)F[z]=C++,B.push(z),G=!0;while(this.saveShared&&this.updateSharedData()===!1);T=null}};let R=(M)=>{if(Z>y8)L=m(Z);var D=typeof M,C;if(D==="string"){if(f){let P=f[M];if(P>=0){if(P<16)L[Z++]=P+224;else if(L[Z++]=198,P&1)R(15-P>>1);else R(P-16>>1);return}else if(T&&!$.pack){let _=T.get(M);if(_)_.count++;else T.set(M,{count:1})}}let z=M.length;if(s&&z>=4&&z<1024){if((s.size+=z)>IQ){let _,S=(s[0]?s[0].length*3+s[1].length:0)+10;if(Z+S>y8)L=m(Z+S);if(L[Z++]=217,L[Z++]=223,L[Z++]=249,L[Z++]=s.position?132:130,L[Z++]=26,_=Z-q,Z+=4,s.position)sJ(q,R);s=["",""],s.size=0,s.position=_}let P=jQ.test(M);s[P?0:1]+=M,L[Z++]=P?206:207,R(z);return}let w;if(z<32)w=1;else if(z<256)w=2;else if(z<65536)w=3;else w=5;let A=z*3;if(Z+A>y8)L=m(Z+A);if(z<64||!Y){let P,_,S,v=Z+w;for(P=0;P<z;P++)if(_=M.charCodeAt(P),_<128)L[v++]=_;else if(_<2048)L[v++]=_>>6|192,L[v++]=_&63|128;else if((_&64512)===55296&&((S=M.charCodeAt(P+1))&64512)===56320)_=65536+((_&1023)<<10)+(S&1023),P++,L[v++]=_>>18|240,L[v++]=_>>12&63|128,L[v++]=_>>6&63|128,L[v++]=_&63|128;else L[v++]=_>>12|224,L[v++]=_>>6&63|128,L[v++]=_&63|128;C=v-Z-w}else C=Y(M,Z+w,A);if(C<24)L[Z++]=96|C;else if(C<256){if(w<2)L.copyWithin(Z+2,Z+1,Z+1+C);L[Z++]=120,L[Z++]=C}else if(C<65536){if(w<3)L.copyWithin(Z+3,Z+2,Z+2+C);L[Z++]=121,L[Z++]=C>>8,L[Z++]=C&255}else{if(w<5)L.copyWithin(Z+5,Z+3,Z+3+C);L[Z++]=122,n.setUint32(Z,C),Z+=4}Z+=C}else if(D==="number")if(!this.alwaysUseFloat&&M>>>0===M)if(M<24)L[Z++]=M;else if(M<256)L[Z++]=24,L[Z++]=M;else if(M<65536)L[Z++]=25,L[Z++]=M>>8,L[Z++]=M&255;else L[Z++]=26,n.setUint32(Z,M),Z+=4;else if(!this.alwaysUseFloat&&M>>0===M)if(M>=-24)L[Z++]=31-M;else if(M>=-256)L[Z++]=56,L[Z++]=~M;else if(M>=-65536)L[Z++]=57,n.setUint16(Z,~M),Z+=2;else L[Z++]=58,n.setUint32(Z,~M),Z+=4;else{let z;if((z=this.useFloat32)>0&&M<4294967296&&M>=-2147483648){L[Z++]=250,n.setFloat32(Z,M);let w;if(z<4||(w=M*k0[(L[Z]&127)<<1|L[Z+1]>>7])>>0===w){Z+=4;return}else Z--}L[Z++]=251,n.setFloat64(Z,M),Z+=8}else if(D==="object")if(!M)L[Z++]=246;else{if(U){let w=U.get(M);if(w){if(L[Z++]=216,L[Z++]=29,L[Z++]=25,!w.references){let A=U.idsToInsert||(U.idsToInsert=[]);w.references=[],A.push(w)}w.references.push(Z-q),Z+=2;return}else U.set(M,{offset:Z-q})}let z=M.constructor;if(z===Object)g(M);else if(z===Array){if(C=M.length,C<24)L[Z++]=128|C;else R8(C);for(let w=0;w<C;w++)R(M[w])}else if(z===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)L[Z++]=217,L[Z++]=1,L[Z++]=3;if(C=M.size,C<24)L[Z++]=160|C;else if(C<256)L[Z++]=184,L[Z++]=C;else if(C<65536)L[Z++]=185,L[Z++]=C>>8,L[Z++]=C&255;else L[Z++]=186,n.setUint32(Z,C),Z+=4;if(N.keyMap)for(let[w,A]of M)R(N.encodeKey(w)),R(A);else for(let[w,A]of M)R(w),R(A)}else{for(let w=0,A=B$.length;w<A;w++){let P=eJ[w];if(M instanceof P){let _=B$[w],S=_.tag;if(S==null)S=_.getTag&&_.getTag.call(this,M);if(S<24)L[Z++]=192|S;else if(S<256)L[Z++]=216,L[Z++]=S;else if(S<65536)L[Z++]=217,L[Z++]=S>>8,L[Z++]=S&255;else if(S>-1)L[Z++]=218,n.setUint32(Z,S),Z+=4;_.encode.call(this,M,R,m);return}}if(M[Symbol.iterator]){if(T$){let w=new Error("Iterable should be serialized as iterator");throw w.iteratorNotHandled=!0,w}L[Z++]=159;for(let w of M)R(w);L[Z++]=255;return}if(M[Symbol.asyncIterator]||w$(M)){let w=new Error("Iterable/blob should be serialized as iterator");throw w.iteratorNotHandled=!0,w}if(this.useToJSON&&M.toJSON){let w=M.toJSON();if(w!==M)return R(w)}g(M)}}else if(D==="boolean")L[Z++]=M?245:244;else if(D==="bigint"){if(M<BigInt(1)<<BigInt(64)&&M>=0)L[Z++]=27,n.setBigUint64(Z,M);else if(M>-(BigInt(1)<<BigInt(64))&&M<0)L[Z++]=59,n.setBigUint64(Z,-M-BigInt(1));else if(this.largeBigIntToFloat)L[Z++]=251,n.setFloat64(Z,Number(M));else{if(M>=BigInt(0))L[Z++]=194;else L[Z++]=195,M=BigInt(-1)-M;let z=[];while(M)z.push(Number(M&BigInt(255))),M>>=BigInt(8);I$(new Uint8Array(z.reverse()),m);return}Z+=8}else if(D==="undefined")L[Z++]=247;else throw new Error("Unknown type: "+D)},g=this.useRecords===!1?this.variableMapSize?(M)=>{let D=Object.keys(M),C=Object.values(M),z=D.length;if(z<24)L[Z++]=160|z;else if(z<256)L[Z++]=184,L[Z++]=z;else if(z<65536)L[Z++]=185,L[Z++]=z>>8,L[Z++]=z&255;else L[Z++]=186,n.setUint32(Z,z),Z+=4;let w;if(N.keyMap)for(let A=0;A<z;A++)R(N.encodeKey(D[A])),R(C[A]);else for(let A=0;A<z;A++)R(D[A]),R(C[A])}:(M)=>{L[Z++]=185;let D=Z-q;Z+=2;let C=0;if(N.keyMap){for(let z in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(z))R(N.encodeKey(z)),R(M[z]),C++}else for(let z in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(z))R(z),R(M[z]),C++;L[D+++q]=C>>8,L[D+q]=C&255}:(M,D)=>{let C,z=X.transitions||(X.transitions=Object.create(null)),w=0,A=0,P,_;if(this.keyMap){_=Object.keys(M).map((v)=>this.encodeKey(v)),A=_.length;for(let v=0;v<A;v++){let s8=_[v];if(C=z[s8],!C)C=z[s8]=Object.create(null),w++;z=C}}else for(let v in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(v)){if(C=z[v],!C){if(z[K8]&1048576)P=z[K8]&65535;C=z[v]=Object.create(null),w++}z=C,A++}let S=z[K8];if(S!==void 0)S&=65535,L[Z++]=217,L[Z++]=S>>8|224,L[Z++]=S&255;else{if(!_)_=z.__keys__||(z.__keys__=Object.keys(M));if(P===void 0){if(S=X.nextId++,!S)S=0,X.nextId=1;if(S>=oJ)X.nextId=(S=K)+1}else S=P;if(X[S]=_,S<K){L[Z++]=217,L[Z++]=S>>8|224,L[Z++]=S&255,z=X.transitions;for(let v=0;v<A;v++){if(z[K8]===void 0||z[K8]&1048576)z[K8]=S;z=z[_[v]]}z[K8]=S|1048576,G=!0}else{if(z[K8]=S,n.setUint32(Z,3655335680),Z+=3,w)j+=I*w;if(H.length>=oJ-K)H.shift()[K8]=void 0;if(H.push(z),R8(A+2),R(57344+S),R(_),D)return;for(let v in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(v))R(M[v]);return}}if(A<24)L[Z++]=128|A;else R8(A);if(D)return;for(let v in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(v))R(M[v])},m=(M)=>{let D;if(M>16777216){if(M-q>rJ)throw new Error("Encoded buffer would be larger than maximum buffer size");D=Math.min(rJ,Math.round(Math.max((M-q)*(M>67108864?1.25:2),4194304)/4096)*4096)}else D=(Math.max(M-q<<2,L.length-1)>>12)+1<<12;let C=new D$(D);if(n=new DataView(C.buffer,0,D),L.copy)L.copy(C,0,q,M);else C.set(L.slice(q,M));return Z-=q,q=0,y8=C.length-10,L=C},u=100,h=1000;this.encodeAsIterable=function(M,D){return p(M,D,V)},this.encodeAsAsyncIterable=function(M,D){return p(M,D,d)};function*V(M,D,C){let z=M.constructor;if(z===Object){let w=N.useRecords!==!1;if(w)g(M,!0);else aJ(Object.keys(M).length,160);for(let A in M){let P=M[A];if(!w)R(A);if(P&&typeof P==="object")if(D[A])yield*V(P,D[A]);else yield*k(P,D,A);else R(P)}}else if(z===Array){let w=M.length;R8(w);for(let A=0;A<w;A++){let P=M[A];if(P&&(typeof P==="object"||Z-q>u))if(D.element)yield*V(P,D.element);else yield*k(P,D,"element");else R(P)}}else if(M[Symbol.iterator]&&!M.buffer){L[Z++]=159;for(let w of M)if(w&&(typeof w==="object"||Z-q>u))if(D.element)yield*V(w,D.element);else yield*k(w,D,"element");else R(w);L[Z++]=255}else if(w$(M))aJ(M.size,64),yield L.subarray(q,Z),yield M,y();else if(M[Symbol.asyncIterator])L[Z++]=159,yield L.subarray(q,Z),yield M,y(),L[Z++]=255;else R(M);if(C&&Z>q)yield L.subarray(q,Z);else if(Z-q>u)yield L.subarray(q,Z),y()}function*k(M,D,C){let z=Z-q;try{if(R(M),Z-q>u)yield L.subarray(q,Z),y()}catch(w){if(w.iteratorNotHandled)D[C]={},Z=q+z,yield*V.call(this,M,D[C]);else throw w}}function y(){u=h,N.encode(null,R$)}function p(M,D,C){if(D&&D.chunkThreshold)u=h=D.chunkThreshold;else u=100;if(M&&typeof M==="object")return N.encode(null,R$),C(M,N.iterateProperties||(N.iterateProperties={}),!0);return[N.encode(M)]}async function*d(M,D){for(let C of V(M,D,!0)){let z=C.constructor;if(z===iJ||z===Uint8Array)yield C;else if(w$(C)){let w=C.stream().getReader(),A;while(!(A=await w.read()).done)yield A.value}else if(C[Symbol.asyncIterator])for await(let w of C)if(y(),w)yield*d(w,D.async||(D.async={}));else yield N.encode(w);else yield C}}}useBuffer($){L=$,n=new DataView(L.buffer,L.byteOffset,L.byteLength),Z=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let J=this.structures.slice(0),q=new f$(J,this.sharedValues,this.sharedVersion),Q=this.saveShared(q,(G)=>(G&&G.version||0)==$);if(Q===!1)q=this.getShared()||{},this.structures=q.structures||[],this.sharedValues=q.packedValues,this.sharedVersion=q.version,this.structures.nextId=this.structures.length;else J.forEach((G,X)=>this.structures[X]=G);return Q}}function aJ($,J){if($<24)L[Z++]=J|$;else if($<256)L[Z++]=J|24,L[Z++]=$;else if($<65536)L[Z++]=J|25,L[Z++]=$>>8,L[Z++]=$&255;else L[Z++]=J|26,n.setUint32(Z,$),Z+=4}class f${constructor($,J,q){this.structures=$,this.packedValues=J,this.version=q}}function R8($){if($<24)L[Z++]=128|$;else if($<256)L[Z++]=152,L[Z++]=$;else if($<65536)L[Z++]=153,L[Z++]=$>>8,L[Z++]=$&255;else L[Z++]=154,n.setUint32(Z,$),Z+=4}var fQ=typeof Blob==="undefined"?function(){}:Blob;function w$($){if($ instanceof fQ)return!0;let J=$[Symbol.toStringTag];return J==="Blob"||J==="File"}function y0($,J){switch(typeof $){case"string":if($.length>3){if(J.objectMap[$]>-1||J.values.length>=J.maxValues)return;let Q=J.get($);if(Q){if(++Q.count==2)J.values.push($)}else if(J.set($,{count:1}),J.samplingPackedValues){let G=J.samplingPackedValues.get($);if(G)G.count++;else J.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let Q=0,G=$.length;Q<G;Q++)y0($[Q],J);else{let Q=!J.encoder.useRecords;for(var q in $)if($.hasOwnProperty(q)){if(Q)y0(q,J);y0($[q],J)}}break;case"function":console.log($)}}var AQ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;eJ=[Date,Set,Error,RegExp,T8,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,f$];B$=[{tag:1,encode($,J){let q=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&q>=0&&q<4294967296)L[Z++]=26,n.setUint32(Z,q),Z+=4;else L[Z++]=251,n.setFloat64(Z,q),Z+=8}},{tag:258,encode($,J){let q=Array.from($);J(q)}},{tag:27,encode($,J){J([$.name,$.message])}},{tag:27,encode($,J){J(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,J){J($.value)}},{encode($,J,q){I$($,q)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||K0&&this.tagUint8Array!==!1)return 64}},encode($,J,q){I$($,q)}},w8(68,1),w8(69,2),w8(70,4),w8(71,8),w8(72,1),w8(77,2),w8(78,4),w8(79,8),w8(85,4),w8(86,8),{encode($,J){let q=$.packedValues||[],Q=$.structures||[];if(q.values.length>0){L[Z++]=216,L[Z++]=51,R8(4);let G=q.values;J(G),R8(0),R8(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let X=0,U=G.length;X<U;X++)packedObjectMap[G[X]]=X}if(Q){n.setUint32(Z,3655335424),Z+=3;let G=Q.slice(0);G.unshift(57344),G.push(new T8($.version,1399353956)),J(G)}else J(new T8($.version,1399353956))}}];function w8($,J){if(!AQ&&J>1)$-=4;return{tag:$,encode:function q(Q,G){let X=Q.byteLength,U=Q.byteOffset||0,Y=Q.buffer||Q;G(K0?v0.from(Y,U,X):new Uint8Array(Y,U,X))}}}function I$($,J){let q=$.byteLength;if(q<24)L[Z++]=64+q;else if(q<256)L[Z++]=88,L[Z++]=q;else if(q<65536)L[Z++]=89,L[Z++]=q>>8,L[Z++]=q&255;else L[Z++]=90,n.setUint32(Z,q),Z+=4;if(Z+q>=L.length)J(Z+q);L.set($.buffer?$:new Uint8Array($),Z),Z+=q}function VQ($,J){let q,Q=J.length*2,G=$.length-Q;J.sort((X,U)=>X.offset>U.offset?1:-1);for(let X=0;X<J.length;X++){let U=J[X];U.id=X;for(let Y of U.references)$[Y++]=X>>8,$[Y]=X&255}while(q=J.pop()){let X=q.offset;$.copyWithin(X+Q,X,G),Q-=2;let U=X+Q;$[U++]=216,$[U++]=28,G=X}return $}function sJ($,J){n.setUint32(s.position+$,Z-s.position-$+1);let q=s;s=null,J(q[0]),J(q[1])}var A$=new g0({useRecords:!1}),xQ=A$.encode,FQ=A$.encodeAsIterable,PQ=A$.encodeAsAsyncIterable;var j$=512,kQ=1024,R$=2048;var m0=($)=>{let J=new Uint8Array($),q="";for(let Q=0;Q<J.byteLength;Q++)q+=String.fromCharCode(J[Q]);return btoa(q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},$q=($)=>{let J=atob($.replace(/-/g,"+").replace(/_/g,"/")),q=new Uint8Array(J.length);for(let Q=0;Q<J.length;Q++)q[Q]=J.charCodeAt(Q);return q.buffer};async function Jq($){let J=crypto.getRandomValues(new Uint8Array(32)),q=crypto.getRandomValues(new Uint8Array(16)),Q=await navigator.credentials.create({publicKey:{challenge:J,rp:{name:"Sorane Web/A Form"},user:{id:q,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:60000,attestation:"none"}});if(!Q)throw new Error("Credential creation failed");return{id:Q.id,rawId:m0(Q.rawId),response:Q.response}}async function qq($,J){let q=await navigator.credentials.get({publicKey:{challenge:J,allowCredentials:[{id:$q($),type:"public-key"}],userVerification:"required"}});if(!q)throw new Error("Assertion failed");let Q=q.response;return{id:q.id,signature:m0(Q.signature),authenticatorData:m0(Q.authenticatorData),clientDataJSON:m0(Q.clientDataJSON)}}async function b0($,J){let q=crypto.getRandomValues(new Uint8Array(32)),Q=await navigator.credentials.get({publicKey:{challenge:q,allowCredentials:[{id:$q($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:J}}}}});if(!Q)throw new Error("Assertion failed");let X=Q.getClientExtensionResults()?.prf?.results?.first;if(!X)throw new Error("PRF extension not available");return new Uint8Array(X)}function M0($){return Array.from($).map((J)=>J.toString(16).padStart(2,"0")).join("")}function Qq($){let J=new Uint8Array($.length/2);for(let q=0;q<J.length;q++)J[q]=parseInt($.substring(q*2,q*2+2),16);return J}class Xq{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),J=localStorage.getItem("weba_passkey_pub");if($&&J){this.credentialId=$,this.publicKey=Qq(J),this.publicKeyType="p256",this.usePasskey=!0;return}let q=localStorage.getItem("weba_private_key");if(q)this.edPrivateKey=Qq(q),this.publicKey=_8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey...");let $=await Jq("User"),J=new Uint8Array($.response.attestationObject),Q=_0(J).authData,G=new DataView(Q.buffer,Q.byteOffset,Q.byteLength),X=53,U=G.getUint16(X);X+=2,X+=U;let Y=Q.slice(X),N=_0(Y),O=N.get(-2),K=N.get(-3);if(!O||!K)throw new Error("Invalid COSE Key: x or y missing");let W=new Uint8Array(65);if(W[0]=4,W.set(O,1),W.set(K,33),this.credentialId=$.rawId,this.publicKey=W,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",M0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=_8.utils.randomSecretKey(),this.publicKey=_8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",M0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${M0(this.publicKey)}`}getPublicKey(){return this.publicKey?M0(this.publicKey):""}async sign($,J="authentication"){if(!this.publicKey)await this.register();let q=Gq.default($),Q=new TextEncoder().encode(q);if(this.usePasskey&&this.credentialId){let G=await crypto.subtle.digest("SHA-256",Q),X=await qq(this.credentialId,G);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:J,proofValue:X.signature,"srn:authenticatorData":X.authenticatorData,"srn:clientDataJSON":X.clientDataJSON,"srn:credentialId":X.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let G=_8.sign(Q,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:J,proofValue:M0(G)}}}}}var a8=new Xq;class V${oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,J){if(t8($),l(J,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let q=this.blockLen,Q=new Uint8Array(q);Q.set(J.length>q?$.create().update(J).digest():J);for(let G=0;G<Q.length;G++)Q[G]^=54;this.iHash.update(Q),this.oHash=$.create();for(let G=0;G<Q.length;G++)Q[G]^=106;this.oHash.update(Q),E8(Q)}update($){return l8(this),this.iHash.update($),this}digestInto($){l8(this),l($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:J,iHash:q,finished:Q,destroyed:G,blockLen:X,outputLen:U}=this;return $=$,$.finished=Q,$.destroyed=G,$.blockLen=X,$.outputLen=U,$.oHash=J._cloneInto($.oHash),$.iHash=q._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var h0=($,J,q)=>new V$($,J).update(q).digest();h0.create=($,J)=>new V$($,J);function _Q($,J,q){if(t8($),q===void 0)q=new Uint8Array($.outputLen);return h0($,q,J)}var x$=Uint8Array.of(0),Uq=Uint8Array.of();function SQ($,J,q,Q=32){t8($),z8(Q,"length");let G=$.outputLen;if(Q>255*G)throw new Error("Length must be <= 255*HashLen");let X=Math.ceil(Q/G);if(q===void 0)q=Uq;else l(q,void 0,"info");let U=new Uint8Array(X*G),Y=h0.create($,J),N=Y._cloneInto(),O=new Uint8Array(Y.outputLen);for(let K=0;K<X;K++)x$[0]=K+1,N.update(K===0?Uq:O).update(q).update(x$).digestInto(O),U.set(O,G*K),Y._cloneInto(N);return Y.destroy(),N.destroy(),E8(O,x$),U.slice(0,Q)}var M8=($,J,q,Q,G)=>SQ($,_Q($,J,q),Q,G);var Zq=c$(Y$(),1),Nq="weba_l2_ed25519_sk";function C8($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let J="";return $.forEach((Q)=>{J+=String.fromCharCode(Q)}),btoa(J).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function N8($){let J=$.length%4===0?"":"=".repeat(4-$.length%4),q=$.replace(/-/g,"+").replace(/_/g,"/")+J;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(q,"base64"));let Q=atob(q),G=new Uint8Array(Q.length);for(let X=0;X<Q.length;X+=1)G[X]=Q.charCodeAt(X);return G}function c0($){let J=Zq.default($);if(J===void 0)throw new Error("Failed to canonicalize JSON");return J}function Yq($){let J=new Uint8Array($);return crypto.getRandomValues(J),J}function yQ(){let $=localStorage.getItem(Nq);if($)return N8($);let J=_8.utils.randomSecretKey();return localStorage.setItem(Nq,C8(J)),J}function vQ($,J,q){let Q={layer1_ref:$,recipient:J,weba_version:q};return new TextEncoder().encode(c0(Q))}async function Kq($,J,q,Q){let G=await crypto.subtle.importKey("raw",J,"AES-GCM",!1,["encrypt"]),X=await crypto.subtle.encrypt({name:"AES-GCM",iv:q,additionalData:Q},G,$);return new Uint8Array(X)}async function Mq($){let J=M8(Z8,$.prfKey,void 0,void 0,32),q=M8(Z8,J,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=M8(Z8,J,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.aad??new Uint8Array;return Kq($.recipientSk,q,Q,G)}async function Oq($,J,q,Q){let G=await crypto.subtle.importKey("raw",J,"AES-GCM",!1,["decrypt"]),X=await crypto.subtle.decrypt({name:"AES-GCM",iv:q,additionalData:Q},G,$);return new Uint8Array(X)}async function Lq($){let J=$.config.weba_version??"0.1",q=$.config.recipient_kid,Q=$.config.layer1_ref,G=$.user_kid??"user#sig-1",X=yQ(),U=c0($.layer2_plain),Y=new TextEncoder().encode(U),N=_8.sign(Y,X),O={alg:"Ed25519",kid:G,sig:C8(N),created_at:new Date().toISOString()},K={layer2_plain:$.layer2_plain,layer2_sig:O},W=vQ(Q,q,J),T=new TextEncoder().encode(c0(K)),f=N8($.config.recipient_x25519),B=Yq(32),F=f0.getPublicKey(B),H=f0.getSharedSecret(B,f),j=M8(Z8,H,W,void 0,32),I=M8(Z8,j,void 0,new TextEncoder().encode("weba-l2/key"),32),R=M8(Z8,j,void 0,new TextEncoder().encode("weba-l2/iv"),12),g=await Kq(T,I,R,W);return{weba_version:J,layer1_ref:Q,layer2:{enc:"HPKE-v1",suite:{kem:"X25519",kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:q,encapsulated:{classical:C8(F)},ciphertext:C8(g),aad:C8(W)},meta:{created_at:new Date().toISOString(),nonce:C8(Yq(16))}}}function Wq(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function p0($,J){let q=N8($.layer2.aad),Q={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},G=new TextEncoder().encode(c0(Q));if(C8(G)!==$.layer2.aad)throw new Error("AAD mismatch");let X=N8($.layer2.encapsulated.classical),U=f0.getSharedSecret(J,X),Y=M8(Z8,U,q,void 0,32),N=M8(Z8,Y,void 0,new TextEncoder().encode("weba-l2/key"),32),O=M8(Z8,Y,void 0,new TextEncoder().encode("weba-l2/iv"),12),K=N8($.layer2.ciphertext),W=await Oq(K,N,O,q);return JSON.parse(new TextDecoder().decode(W))}async function Cq($){let J=M8(Z8,$.prfKey,void 0,void 0,32),q=M8(Z8,J,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=M8(Z8,J,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.keywrap.aad?N8($.keywrap.aad):new Uint8Array,X=N8($.keywrap.wrapped_key);return Oq(X,q,Q,G)}class F${formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let J=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((G)=>{let X=G.dataset.jsonPath;if(X)J[X]=G.value}),document.querySelectorAll('[type="radio"]:checked').forEach((G)=>{J[G.name]=G.value}),document.querySelectorAll("table.data-table.dynamic").forEach((G)=>{let X=G.dataset.tableKey;if(X){let U=[];G.querySelectorAll("tbody tr").forEach((Y)=>{let N={},O=!1;if(Y.querySelectorAll("[data-base-key]").forEach((K)=>{if(K.type==="checkbox"){if(N[K.dataset.baseKey]=K.checked,K.checked)O=!0}else if(N[K.dataset.baseKey]=K.value,K.value)O=!0}),O)U.push(N)}),J[X]=U}});let q=document.getElementById("json-ld");if(q)q.textContent=JSON.stringify(J,null,2);let Q=document.getElementById("json-debug");if(Q)Q.textContent=JSON.stringify(J,null,2);return J}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),J=window,q=J.generatedJsonStructure&&J.generatedJsonStructure.name||"Response",Q=window.location.href.split("#")[0],G=this.getL2Config(),X=document.getElementById("weba-l2-encrypt");if(!!(G?.enabled&&(X?X.checked:G.default_enabled))){if(!G?.recipient_kid||!G?.recipient_x25519||!G?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let N=await Lq({layer2_plain:$,config:G,user_kid:G.user_kid});this.downloadHtml("submit",!0,{l2Envelope:N,stripPlaintext:!0})}catch(N){console.error(N),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!a8.getPublicKey()){if(!await a8.register()){alert("Key registration failed.");return}}let Y={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:a8.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:Q,answers:$}};try{let N=await a8.sign(Y);this.downloadHtml("submitted",!0,{embeddedVc:N})}catch(N){console.error(N),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let J=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((q)=>{let Q=q.dataset.jsonPath;if(J[Q]!==void 0)q.value=J[Q]}),document.querySelectorAll("table.data-table.dynamic").forEach((q)=>{let Q=q.dataset.tableKey,G=J[Q];if(Array.isArray(G)){let X=q.querySelector("tbody");if(!X)return;let U=X.querySelectorAll(".template-row");G.forEach((Y,N)=>{let O;if(N===0)O=X.querySelector(".template-row");else{let K=X.querySelector(".template-row");if(K){O=K.cloneNode(!0),O.classList.remove("template-row");let W=O.querySelector(".remove-row-btn");if(W)W.style.visibility="visible";X.appendChild(O)}}if(O)O.querySelectorAll("input, select").forEach((K)=>{let W=K.dataset.baseKey;if(W&&Y[W]!==void 0)if(K.type==="checkbox")K.checked=!!Y[W];else K.value=Y[W]})})}})}catch(J){console.error(J)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,J,q){let Q=window,X=new DOMParser().parseFromString(document.documentElement.outerHTML,"text/html");if(q?.stripPlaintext){X.querySelectorAll("input").forEach((H)=>{if(H.type==="checkbox"||H.type==="radio")H.checked=!1,H.removeAttribute("checked");else H.value="",H.removeAttribute("value")}),X.querySelectorAll("textarea").forEach((H)=>{H.value="",H.textContent=""}),X.querySelectorAll("select").forEach((H)=>{H.selectedIndex=-1,H.querySelectorAll("option").forEach((j)=>j.removeAttribute("selected"))}),X.getElementById("json-ld")?.remove(),X.getElementById("data-layer")?.remove();let F=X.getElementById("json-debug");if(F)F.textContent=""}if(q?.embeddedVc){let F=JSON.stringify(q.embeddedVc,null,2),H=X.createElement("script");H.type="application/ld+json",H.id="weba-user-vc",H.textContent=F,X.body.appendChild(H);let j=X.createElement("div");j.className="weba-user-verification no-print",j.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",j.innerHTML=`
                <details>
                    <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
                        <span></span> 
                    </summary>
                    <div style="padding: 1rem 0;">
                        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
                    </div>
                </details>
            `;let I=j.querySelector("pre");if(I)I.textContent=F;X.body.appendChild(j)}if(q?.l2Envelope){let F=X.createElement("script");F.id="weba-l2-envelope",F.type="application/json",F.textContent=JSON.stringify(q.l2Envelope,null,2),X.body.appendChild(F)}let U=X.documentElement.outerHTML,Y=new Blob([U],{type:"text/html"}),N=URL.createObjectURL(Y),O=document.createElement("a");O.href=N;let K=Q.generatedJsonStructure&&Q.generatedJsonStructure.name||"web-a-form",W=new Date,T=W.getFullYear()+("0"+(W.getMonth()+1)).slice(-2)+("0"+W.getDate()).slice(-2)+"-"+("0"+W.getHours()).slice(-2)+("0"+W.getMinutes()).slice(-2),f=Math.random().toString(36).substring(2,8),B=`${K}_${T}_${$}_${f}.html`;if(O.download=B,O.click(),J)setTimeout(()=>window.location.reload(),1000)}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class P${calc;data;constructor($,J){this.calc=$,this.data=J}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},J=(navigator.language||"en").startsWith("ja")?"ja":"en",q=$[J]||$.en;document.querySelectorAll("[data-i18n]").forEach((Q)=>{let G=Q.dataset.i18n;if(q[G])Q.textContent=q[G]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((q)=>{return q.querySelectorAll("td").length>0}).forEach((q,Q)=>{let G=Q+1;q.querySelectorAll(".auto-num").forEach((X)=>{if(X.value!=G)X.value=G.toString(),X.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let J=$.closest("tr"),q=J.parentElement;if(J.classList.contains("template-row"))J.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox")Q.checked=!1;else Q.value=""});else{if(J.remove(),q)this.renumberRows(q);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,J){let q=document.getElementById("tbl_"+J);if(!q)return;let Q=q.querySelector("tbody");if(!Q)return;let G=Q.querySelector(".template-row");if(!G)return;let X=G.cloneNode(!0);X.classList.remove("template-row"),X.querySelectorAll("input").forEach((Y)=>{if(Y.type==="checkbox")Y.checked=Y.hasAttribute("checked");else Y.value=Y.getAttribute("value")||""});let U=X.querySelector(".remove-row-btn");if(U)U.style.visibility="visible";X.querySelectorAll("[data-copy-from]").forEach((Y)=>{let N=Y.dataset.copyFrom;if(N){let O=X.querySelector(`[data-base-key="${N}"]`);if(O&&O.value)Y.value=O.value}}),Q.appendChild(X),this.renumberRows(Q),this.calc.recalculate()}switchTab($,J){document.querySelectorAll(".tab-btn").forEach((Q)=>Q.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((Q)=>Q.classList.remove("active")),$.classList.add("active");let q=document.getElementById(J);if(q)q.classList.add("active")}}function Eq($){let J=document.getElementById($);if(!J||!J.textContent)return null;try{return JSON.parse(J.textContent)}catch{return null}}function Hq(){let $=Eq("weba-l2-envelope");if(!$)return;let J=Eq("weba-l2-keywrap"),q=document.querySelector(".weba-form-container")||document.body,Q=document.createElement("div");Q.className="weba-l2-unlock",Q.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let G=document.createElement("div");G.textContent="Encrypted Submission",G.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",Q.appendChild(G);let X=document.createElement("div");X.textContent="Locked. Unlock with Passkey.",X.style.cssText="color:#64748b;margin-bottom:0.75rem;",Q.appendChild(X);let U=document.createElement("button");U.textContent="Unlock (Passkey)",U.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",Q.appendChild(U);let Y=document.createElement("pre");Y.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",Q.appendChild(Y);let N=document.createElement("details");N.style.cssText="margin-top:0.75rem; display:none;",N.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',Q.appendChild(N);let O=document.createElement("button");O.textContent="Export JSON",O.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",O.disabled=!0,Q.appendChild(O),U.addEventListener("click",async()=>{if(!J){X.textContent="Key wrap package not found.";return}U.disabled=!0,X.textContent="Waiting for passkey...";try{let K=N8(J.prf_salt),W=await b0(J.credential_id,K),T=await Cq({keywrap:J,prfKey:W}),f=await p0($,T);gQ(f.layer2_plain),document.body.classList.add("weba-l2-readonly"),Y.textContent=JSON.stringify(f.layer2_plain,null,2),Y.style.display="block";let B=N.querySelector("pre");if(B)B.textContent=JSON.stringify(f.layer2_sig,null,2);N.style.display="block",O.style.display="inline-block",O.disabled=!1,X.textContent="Unlocked.",O.onclick=()=>{let F=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),H=URL.createObjectURL(F),j=document.createElement("a");j.href=H,j.download="weba-l2-decrypted.json",j.click()}}catch(K){console.error(K),X.textContent="Unlock failed.",U.disabled=!1}}),q.appendChild(Q)}function gQ($){if(!$||typeof $!=="object")return;let J=$;document.querySelectorAll("[data-json-path]").forEach((q)=>{let Q=q.dataset.jsonPath;if(!Q||!(Q in J))return;let G=J[Q];if(q.type==="checkbox")q.checked=Boolean(G);else if(q.type==="radio")q.checked=q.value===String(G);else q.value=G===null||G===void 0?"":String(G)}),document.querySelectorAll('input[type="radio"]').forEach((q)=>{let Q=q.name;if(!Q||!(Q in J))return;let G=J[Q];q.checked=q.value===String(G)}),document.querySelectorAll("table.data-table.dynamic").forEach((q)=>{let Q=q.dataset.tableKey;if(!Q)return;let G=J[Q];if(!Array.isArray(G))return;let X=q.querySelector("tbody");if(!X)return;let U=X.querySelector("tr.template-row");if(!U)return;Array.from(X.querySelectorAll("tr")).forEach((Y)=>{if(!Y.classList.contains("template-row"))Y.remove()}),G.forEach((Y,N)=>{let O=N===0?U:U.cloneNode(!0);if(N>0){O.classList.remove("template-row");let K=O.querySelector(".remove-row-btn");if(K)K.style.visibility="visible";X.appendChild(O)}if(Y&&typeof Y==="object")O.querySelectorAll("input, select, textarea").forEach((K)=>{let W=K.dataset.baseKey;if(!W)return;let T=Y[W];if(K.type==="checkbox")K.checked=Boolean(T);else K.value=T===null||T===void 0?"":String(T)})})}),document.querySelectorAll("input").forEach((q)=>{if(q.type==="checkbox"||q.type==="radio")q.disabled=!0;else q.readOnly=!0}),document.querySelectorAll("textarea").forEach((q)=>{q.readOnly=!0}),document.querySelectorAll("select").forEach((q)=>{q.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((q)=>{q.disabled=!0})}function B8($){return document.getElementById($)}function zq(){if(!B8("weba-l2-keywrap-tool"))return;let J=B8("kwp-recipient-sk"),q=B8("kwp-credential-id"),Q=B8("kwp-prf-salt"),G=B8("kwp-aad"),X=B8("kwp-kid"),U=B8("kwp-status"),Y=B8("kwp-output"),N=B8("kwp-generate-salt"),O=B8("kwp-wrap");if(!J||!q||!Q||!U||!Y||!O)return;N?.addEventListener("click",()=>{let K=new Uint8Array(32);crypto.getRandomValues(K),Q.value=C8(K)}),O.addEventListener("click",async()=>{U.textContent="Waiting for passkey...",O.disabled=!0;try{if(!J.value||!q.value||!Q.value)throw new Error("Missing required fields.");let K=N8(J.value.trim()),W=N8(Q.value.trim()),T=await b0(q.value.trim(),W),f=G?.value?N8(G.value.trim()):void 0,B=await Mq({recipientSk:K,prfKey:T,aad:f}),F={alg:"WebAuthn-PRF-AESGCM-v1",kid:X?.value||"issuer#passkey-1",credential_id:q.value.trim(),prf_salt:C8(W),wrapped_key:C8(B),...f?{aad:C8(f)}:{}};Y.textContent=JSON.stringify(F,null,2),U.textContent="Key wrap ready."}catch(K){console.error(K),U.textContent="Key wrap failed."}finally{O.disabled=!1}})}function wq($){if(typeof DOMParser!=="undefined")return new DOMParser().parseFromString($,"text/html");if(typeof document!=="undefined"){let J=document.implementation.createHTMLDocument("");return J.documentElement.innerHTML=$,J}return null}function Rq($,J){let q=wq($);if(q)return q.getElementById(J)?.textContent??null;let Q=new RegExp(`<script[^>]*id=["']${J}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),G=$.match(Q);return G?G[1]:null}function mQ($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function bQ($,J){let q=wq($);if(q)return q.querySelector(`script[type="${J}"]`)?.textContent??null;let Q=new RegExp(`<script[^>]*type=["']${mQ(J)}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),G=$.match(Q);return G?G[1]:null}function hQ($){let J=Rq($,"data-layer");if(J)try{return JSON.parse(J)}catch{return null}let q=bQ($,"application/ld+json");if(q)try{return JSON.parse(q)}catch{return null}return null}function cQ($){let J=Rq($,"weba-l2-envelope");if(!J)return null;try{return JSON.parse(J)}catch{return null}}function pQ($){if(!$.trim())return null;try{let J=JSON.parse($);if(!J.recipient_x25519_private)return null;return J}catch{return null}}function lQ(){let $=document.getElementById("weba-l2-keys");if(!$?.textContent)return null;return pQ($.textContent)}function uQ($){let J={},q=(Q,G)=>{if(Q===null||Q===void 0){J[G]=null;return}if(Array.isArray(Q)){Q.forEach((X,U)=>{q(X,G?`${G}[${U}]`:`[${U}]`)});return}if(typeof Q==="object"){Object.entries(Q).forEach(([X,U])=>{let Y=G?`${G}.${X}`:X;q(U,Y)});return}J[G]=Q};if(q($,""),""in J)delete J[""];return J}function Dq($){let J={_filename:$.filename},q=new Set(["_filename"]);if($.includeJson)q.add("_json"),J._json=JSON.stringify($.plain);let Q=uQ($.plain||{});for(let G of Object.keys(Q)){if($.omitKey&&$.omitKey(G))continue;q.add(G),J[G]=Q[G]}if($.sig)q.add("_l2_sig"),J._l2_sig=JSON.stringify($.sig);return{row:J,keys:q}}async function dQ($,J){let q=cQ($);if(q&&J){if(J.recipient_kid&&q.layer2?.recipient&&J.recipient_kid!==q.layer2.recipient)throw new Error(`recipient_kid mismatch (${q.layer2.recipient})`);let G=N8(J.recipient_x25519_private),X=await p0(q,G);return{plain:X.layer2_plain??X,sig:X.layer2_sig,source:"l2"}}let Q=hQ($);if(Q)return{plain:Q,source:"jsonld"};return{source:null}}function Tq($){if($===null||$===void 0)return"";let J=String($);if(/[",\n]/.test(J))return`"${J.replace(/"/g,'""')}"`;return J}function nQ($,J){let q=[];return q.push(J.map(Tq).join(",")),$.forEach((Q)=>{let G=J.map((X)=>Tq(Q[X])).join(",");q.push(G)}),"\uFEFF"+q.join(`
`)}function iQ($,J,q){if(J.length===0){$.innerHTML='<div class="agg-empty">No rows to display.</div>';return}let Q=q.map((X)=>`<th>${X}</th>`).join(""),G=J.slice(0,20).map((X)=>{return`<tr>${q.map((Y)=>`<td>${X[Y]??""}</td>`).join("")}</tr>`}).join("");$.innerHTML=`<table class="agg-table"><thead><tr>${Q}</tr></thead><tbody>${G}</tbody></table>`}function Bq(){let $=document.getElementById("aggregator-root");if(!$)return;$.innerHTML=`
    <div class="agg-panel">
      <div class="agg-row">
        <label class="agg-label">Input HTML</label>
        <input id="weba-agg-files" type="file" accept=".html" multiple />
      </div>
      <div class="agg-row">
        <label class="agg-label">L2 Key (embedded)</label>
        <div id="weba-agg-key-status" class="agg-chip">Not loaded</div>
        <div class="agg-note">Use <code>&lt;script id="weba-l2-keys"&gt;</code> to embed.</div>
      </div>
      <div class="agg-row">
        <label class="agg-label">Include JSON</label>
        <input id="weba-agg-include-json" type="checkbox" />
      </div>
      <div class="agg-row">
        <button id="weba-agg-run" class="agg-btn">Decrypt & Aggregate</button>
        <button id="weba-agg-download" class="agg-btn secondary" disabled>Download CSV</button>
      </div>
      <div id="weba-agg-status" class="agg-status">Ready.</div>
    </div>
    <div id="weba-agg-output" class="agg-output"></div>
  `;let J=$.querySelector("#weba-agg-files"),q=$.querySelector("#weba-agg-status"),Q=$.querySelector("#weba-agg-output"),G=$.querySelector("#weba-agg-include-json"),X=$.querySelector("#weba-agg-run"),U=$.querySelector("#weba-agg-download"),Y=$.querySelector("#weba-agg-key-status"),N="",O=lQ();if(Y)Y.textContent=O?.recipient_kid?`Loaded (${O.recipient_kid})`:O?"Loaded":"Not loaded",Y.classList.toggle("ready",!!O);let K=async()=>{if(!J?.files||J.files.length===0){if(q)q.textContent="Select HTML files first.";return}if(q)q.textContent="Processing...";if(U)U.disabled=!0;let W=[],T=new Set(["_filename"]),f=0,B=0,F=O;for(let j of Array.from(J.files))try{let I=await j.text(),R=await dQ(I,F);if(R.source==="l2"&&R.plain){let g=Dq({plain:R.plain,filename:j.name,includeJson:G?.checked,sig:R.sig});g.keys.forEach((m)=>T.add(m)),W.push(g.row),f+=1;continue}if(R.source==="jsonld"&&R.plain){let g=Dq({plain:R.plain,filename:j.name,includeJson:G?.checked,omitKey:(m)=>m.startsWith("@")});g.keys.forEach((m)=>T.add(m)),W.push(g.row),f+=1;continue}B+=1}catch(I){console.error(I),B+=1}let H=Array.from(T).sort((j,I)=>{if(j==="_filename")return-1;if(I==="_filename")return 1;return j.localeCompare(I)});if(N=nQ(W,H),U)U.disabled=W.length===0;if(q)q.textContent=`Processed ${f} files. Errors: ${B}.`;if(Q)iQ(Q,W,H)};X?.addEventListener("click",()=>{K().catch((W)=>{if(q)q.textContent="Failed to aggregate.";console.error(W)})}),U?.addEventListener("click",()=>{if(!N)return;let W=new Blob([N],{type:"text/csv"}),T=URL.createObjectURL(W),f=document.createElement("a");f.href=T,f.download="weba-aggregated.csv",f.click(),URL.revokeObjectURL(T)})}function Iq(){console.log("Web/A Runtime Booting...");let $=new i0,J=new F$,q=new P$($,J),Q=window,G=document.getElementById("weba-structure");if(G?.textContent)try{Q.generatedJsonStructure=JSON.parse(G.textContent)}catch(Y){console.warn("Failed to parse weba structure JSON",Y)}let X=Wq();if(X)Q.webaL2Config=X;Q.saveDraft=()=>J.saveDraft(),Q.submitDocument=()=>J.submitDocument(),Q.signAndDownload=()=>J.signAndDownload(),Q.clearData=()=>J.clearData(),Q.removeTableRow=(Y)=>q.removeTableRow(Y),Q.addTableRow=(Y,N)=>q.addTableRow(Y,N),Q.switchTab=(Y,N)=>q.switchTab(Y,N),Q.recalculate=()=>$.recalculate(),Q.escapeHtml=(Y)=>{if(!Y)return"";let N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return Y.toString().replace(/[&<>"']/g,(O)=>N[O]||O)},J.restoreFromLS(),q.applyI18n(),q.initTables(),$.recalculate(),Hq(),zq(),Bq();let U;document.addEventListener("input",(Y)=>{let N=Y.target;if(Y.isTrusted)N.dataset.dirty="true";let O=N.dataset.baseKey||N.dataset.jsonPath;if(O)(N.closest("tr")||document).querySelectorAll(`[data-copy-from="${O}"]`).forEach((T)=>{if(!T.dataset.dirty){if(T.value!==N.value)T.value=N.value,T.dispatchEvent(new Event("input"))}});$.recalculate(),J.updateJsonLd(),clearTimeout(U),U=setTimeout(()=>J.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class k${suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let J=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",J.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let J=$.toString().toLowerCase();return J=J.replace(/[---]/g,(q)=>{return String.fromCharCode(q.charCodeAt(0)-65248)}),J=J.replace(/[-]/g,(q)=>String.fromCharCode(q.charCodeAt(0)-65248)),J.trim()}clean($){if(!$)return"";let J=this.normalize($);return J=J.replace(/(|||||npo||)/g,""),J=J.replace(/(\(\)|\(\)|\(\))/g,""),J.trim()}toIndex($){let J=parseInt($||"",10);return Number.isFinite(J)?J-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let J=window,q=$.dataset.masterSrc,Q=$.dataset.suggestSource;if(!q&&!Q)return;let G=this.toIndex($.dataset.masterLabelIndex),X=this.toIndex($.dataset.masterValueIndex),U=$.value;if(!U){this.hideSuggestions();return}let Y=[],N=this.normalize(U);if(Q==="column"){let O=$.dataset.baseKey,K=$.closest("table");if(K&&O){let W=new Set;K.querySelectorAll(`[data-base-key="${O}"]`).forEach((T)=>{if(T===$)return;let f=T.value;if(f&&this.normalize(f).includes(N)){if(!W.has(f))W.add(f),Y.push({val:f,row:[f],label:f,score:10})}})}}else if(q){let O=J.generatedJsonStructure.masterData;if(!O||!O[q])return;O[q].forEach((W,T)=>{if(T===0)return;if(W.some((B)=>this.normalize(B||"").includes(N))){let B=G>=0?W[G]||"":"",F=X>=0?W[X]||"":"",H=X>=0?F:G>=0?B:W[1]||W[0]||"";Y.push({val:H,row:W,label:B,score:10,idx:T})}})}this.renderSuggestions($,Y,G)}renderSuggestions($,J,q){if(J.length===0){this.hideSuggestions();return}let Q=window,G=J.slice(0,10),X="";G.forEach((K)=>{let W=Q.escapeHtml(JSON.stringify(K.row)),T=q>=0?K.label||K.row.join(" : "):K.row.join(" : ");X+=`<div class="suggestion-item" data-val="${Q.escapeHtml(K.val)}" data-row="${W}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${Q.escapeHtml(T)}</div>`});let U=this.getGlobalBox();U.innerHTML=X;let Y=$.getBoundingClientRect(),N=window.scrollY||document.documentElement.scrollTop,O=window.scrollX||document.documentElement.scrollLeft;U.style.width=Math.max(Y.width,200)+"px",U.style.left=Y.left+O+"px",U.style.top=Y.bottom+N+"px",U.querySelectorAll(".suggestion-item").forEach((K)=>{K.onmouseenter=()=>K.style.background="#f0f8ff",K.onmouseleave=()=>K.style.background="white"}),U.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let J=window,q=this.activeSearchInput,Q=$.dataset.val||"",G=$.dataset.row||"[]";try{let X=JSON.parse(G),U=q.dataset.masterSrc,Y=U?J.generatedJsonStructure.masterData[U][0]:[],N=!1;if(Y.length>0&&X.length>0){let O=q.closest("tr");if(O){let K=Array.from(O.querySelectorAll("input, select, textarea"));Y.forEach((W,T)=>{if(!W)return;let f=X[T];this.fillField(K,W,f,q,()=>{N=!0})})}}if(!N)q.value=Q,q.dispatchEvent(new Event("input",{bubbles:!0}))}catch(X){console.error(X)}this.hideSuggestions()}fillField($,J,q,Q,G){let X=this.normalize(J),U=$.find((Y)=>{let N=Y.dataset.baseKey||Y.dataset.jsonPath,O=this.normalize(Y.getAttribute("placeholder")||"");return N&&this.normalize(N)===X||O===X});if(U){if(U.value=q||"",U.dispatchEvent(new Event("input",{bubbles:!0})),U===Q)G()}}}var jq=new k$;window.GlobalSearch=jq;Iq();jq.init();
