var gJ=Object.create;var{getPrototypeOf:vJ,defineProperty:p$,getOwnPropertyNames:mJ}=Object;var bJ=Object.prototype.hasOwnProperty;var l$=($,q,J)=>{J=$!=null?gJ(vJ($)):{};let Q=q||!$||!$.__esModule?p$(J,"default",{value:$,enumerable:!0}):J;for(let U of mJ($))if(!bJ.call(Q,U))p$(Q,U,{get:()=>$[U],enumerable:!0});return Q};var cJ=($,q)=>()=>(q||$((q={exports:{}}).exports,q),q.exports);var N$=cJ((SQ,vq)=>{vq.exports=function $(q){if(typeof q==="number"&&isNaN(q))throw new Error("NaN is not allowed");if(typeof q==="number"&&!isFinite(q))throw new Error("Infinity is not allowed");if(q===null||typeof q!=="object")return JSON.stringify(q);if(q.toJSON instanceof Function)return $(q.toJSON());if(Array.isArray(q))return`[${q.reduce((U,G,X)=>{return`${U}${X===0?"":","}${$(G===void 0||typeof G==="symbol"?null:G)}`},"")}]`;return`{${Object.keys(q).sort().reduce((Q,U)=>{if(q[U]===void 0||typeof q[U]==="symbol")return Q;let G=Q.length===0?"":",";return`${Q}${G}${$(U)}:${$(q[U])}`},"")}}`}});class i0{runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let q=$.dataset.copyFrom;if(q){let U=($.closest("tr")||document).querySelector(`[data-base-key="${q}"], [data-json-path="${q}"]`);if(U&&U.value!==$.value)$.value=U.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let q=$.dataset.formula;if(!q)return;let J=$.closest("tr"),Q=$.closest("table"),U=(X)=>{let N=0,K="none";if(J){let O=`[data-base-key="${X}"], [data-json-path="${X}"]`,Z=J.querySelector(O);if(Z){if(K="row-input",Z.value!=="")N=parseFloat(Z.value)}}if(K==="none"){let O=document.querySelector(`[data-json-path="${X}"]`);if(O){if(K="static-input",O.value!=="")N=parseFloat(O.value)}}return N},G=q.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(X,N)=>{let K=0,O=Q||document,Z=O.querySelectorAll(`[data-base-key="${N}"], [data-json-path="${N}"]`);if(Z.length===0&&O!==document)Z=document.querySelectorAll(`[data-base-key="${N}"], [data-json-path="${N}"]`);return Z.forEach((W)=>{let D=parseFloat(W.value);if(!isNaN(D))K+=D}),K});G=G.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(X)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(X))return X;return String(U(X))});try{let X=new Function("return "+G)();if(typeof X==="number"&&!isNaN(X))$.value=Number.isInteger(X)?X:X.toFixed(0);else $.value=""}catch(X){console.error("Calc Error:",X),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function W0($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function H8($,q=""){if(!Number.isSafeInteger($)||$<0){let J=q&&`"${q}" `;throw new Error(`${J}expected integer >= 0, got ${$}`)}}function u($,q,J=""){let Q=W0($),U=$?.length,G=q!==void 0;if(!Q||G&&U!==q){let X=J&&`"${J}" `,N=G?` of length ${q}`:"",K=Q?`length=${U}`:`type=${typeof $}`;throw new Error(X+"expected Uint8Array"+N+", got "+K)}return $}function t8($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");H8($.outputLen),H8($.blockLen)}function h8($,q=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(q&&$.finished)throw new Error("Hash#digest() has already been called")}function u$($,q){u($,void 0,"digestInto() output");let J=q.outputLen;if($.length<J)throw new Error('"digestInto() output" expected to be of length >='+J)}function E8(...$){for(let q=0;q<$.length;q++)$[q].fill(0)}function C0($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function w8($,q){return $<<32-q|$>>>q}var d$=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),pJ=Array.from({length:256},($,q)=>q.toString(16).padStart(2,"0"));function u8($){if(u($),d$)return $.toHex();let q="";for(let J=0;J<$.length;J++)q+=pJ[$[J]];return q}var B8={_0:48,_9:57,A:65,F:70,a:97,f:102};function h$($){if($>=B8._0&&$<=B8._9)return $-B8._0;if($>=B8.A&&$<=B8.F)return $-(B8.A-10);if($>=B8.a&&$<=B8.f)return $-(B8.a-10);return}function e8($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(d$)return Uint8Array.fromHex($);let q=$.length,J=q/2;if(q%2)throw new Error("hex string expected, got unpadded hex of length "+q);let Q=new Uint8Array(J);for(let U=0,G=0;U<J;U++,G+=2){let X=h$($.charCodeAt(G)),N=h$($.charCodeAt(G+1));if(X===void 0||N===void 0){let K=$[G]+$[G+1];throw new Error('hex string expected, got non-hex character "'+K+'" at index '+G)}Q[U]=X*16+N}return Q}function $0(...$){let q=0;for(let Q=0;Q<$.length;Q++){let U=$[Q];u(U),q+=U.length}let J=new Uint8Array(q);for(let Q=0,U=0;Q<$.length;Q++){let G=$[Q];J.set(G,U),U+=G.length}return J}function r0($,q={}){let J=(U,G)=>$(G).update(U).digest(),Q=$(void 0);return J.outputLen=Q.outputLen,J.blockLen=Q.blockLen,J.create=(U)=>$(U),Object.assign(J,q),Object.freeze(J)}function q0($=32){let q=typeof globalThis==="object"?globalThis.crypto:null;if(typeof q?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return q.getRandomValues(new Uint8Array($))}var o0=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function n$($,q,J){return $&q^~$&J}function i$($,q,J){return $&q^$&J^q&J}class E0{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,q,J,Q){this.blockLen=$,this.outputLen=q,this.padOffset=J,this.isLE=Q,this.buffer=new Uint8Array($),this.view=C0(this.buffer)}update($){h8(this),u($);let{view:q,buffer:J,blockLen:Q}=this,U=$.length;for(let G=0;G<U;){let X=Math.min(Q-this.pos,U-G);if(X===Q){let N=C0($);for(;Q<=U-G;G+=Q)this.process(N,G);continue}if(J.set($.subarray(G,G+X),this.pos),this.pos+=X,G+=X,this.pos===Q)this.process(q,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){h8(this),u$($,this),this.finished=!0;let{buffer:q,view:J,blockLen:Q,isLE:U}=this,{pos:G}=this;if(q[G++]=128,E8(this.buffer.subarray(G)),this.padOffset>Q-G)this.process(J,0),G=0;for(let Z=G;Z<Q;Z++)q[Z]=0;J.setBigUint64(Q-8,BigInt(this.length*8),U),this.process(J,0);let X=C0($),N=this.outputLen;if(N%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let K=N/4,O=this.get();if(K>O.length)throw new Error("_sha2: outputLen bigger than state");for(let Z=0;Z<K;Z++)X.setUint32(4*Z,O[Z],U)}digest(){let{buffer:$,outputLen:q}=this;this.digestInto($);let J=$.slice(0,q);return this.destroy(),J}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:q,buffer:J,length:Q,finished:U,destroyed:G,pos:X}=this;if($.destroyed=G,$.finished=U,$.length=Q,$.pos=X,Q%q)$.buffer.set(J);return $}clone(){return this._cloneInto()}}var I8=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),A8=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),q8=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J8=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var w0=BigInt(4294967295),r$=BigInt(32);function lJ($,q=!1){if(q)return{h:Number($&w0),l:Number($>>r$&w0)};return{h:Number($>>r$&w0)|0,l:Number($&w0)|0}}function o$($,q=!1){let J=$.length,Q=new Uint32Array(J),U=new Uint32Array(J);for(let G=0;G<J;G++){let{h:X,l:N}=lJ($[G],q);[Q[G],U[G]]=[X,N]}return[Q,U]}var a0=($,q,J)=>$>>>J,s0=($,q,J)=>$<<32-J|q>>>J,g8=($,q,J)=>$>>>J|q<<32-J,v8=($,q,J)=>$<<32-J|q>>>J,J0=($,q,J)=>$<<64-J|q>>>J-32,Q0=($,q,J)=>$>>>J-32|q<<64-J;function f8($,q,J,Q){let U=(q>>>0)+(Q>>>0);return{h:$+J+(U/4294967296|0)|0,l:U|0}}var a$=($,q,J)=>($>>>0)+(q>>>0)+(J>>>0),s$=($,q,J,Q)=>q+J+Q+($/4294967296|0)|0,t$=($,q,J,Q)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0),e$=($,q,J,Q,U)=>q+J+Q+U+($/4294967296|0)|0,$q=($,q,J,Q,U)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0)+(U>>>0),qq=($,q,J,Q,U,G)=>q+J+Q+U+G+($/4294967296|0)|0;var uJ=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),x8=new Uint32Array(64);class t0 extends E0{constructor($){super(64,$,8,!1)}get(){let{A:$,B:q,C:J,D:Q,E:U,F:G,G:X,H:N}=this;return[$,q,J,Q,U,G,X,N]}set($,q,J,Q,U,G,X,N){this.A=$|0,this.B=q|0,this.C=J|0,this.D=Q|0,this.E=U|0,this.F=G|0,this.G=X|0,this.H=N|0}process($,q){for(let Z=0;Z<16;Z++,q+=4)x8[Z]=$.getUint32(q,!1);for(let Z=16;Z<64;Z++){let W=x8[Z-15],D=x8[Z-2],I=w8(W,7)^w8(W,18)^W>>>3,z=w8(D,17)^w8(D,19)^D>>>10;x8[Z]=z+x8[Z-7]+I+x8[Z-16]|0}let{A:J,B:Q,C:U,D:G,E:X,F:N,G:K,H:O}=this;for(let Z=0;Z<64;Z++){let W=w8(X,6)^w8(X,11)^w8(X,25),D=O+W+n$(X,N,K)+uJ[Z]+x8[Z]|0,z=(w8(J,2)^w8(J,13)^w8(J,22))+i$(J,Q,U)|0;O=K,K=N,N=X,X=G+D|0,G=U,U=Q,Q=J,J=D+z|0}J=J+this.A|0,Q=Q+this.B|0,U=U+this.C|0,G=G+this.D|0,X=X+this.E|0,N=N+this.F|0,K=K+this.G|0,O=O+this.H|0,this.set(J,Q,U,G,X,N,K,O)}roundClean(){E8(x8)}destroy(){this.set(0,0,0,0,0,0,0,0),E8(this.buffer)}}class Jq extends t0{A=I8[0]|0;B=I8[1]|0;C=I8[2]|0;D=I8[3]|0;E=I8[4]|0;F=I8[5]|0;G=I8[6]|0;H=I8[7]|0;constructor(){super(32)}}class dJ extends t0{A=A8[0]|0;B=A8[1]|0;C=A8[2]|0;D=A8[3]|0;E=A8[4]|0;F=A8[5]|0;G=A8[6]|0;H=A8[7]|0;constructor(){super(28)}}var Qq=(()=>o$(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),nJ=(()=>Qq[0])(),iJ=(()=>Qq[1])(),P8=new Uint32Array(80),y8=new Uint32Array(80);class U0 extends E0{constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:q,Bh:J,Bl:Q,Ch:U,Cl:G,Dh:X,Dl:N,Eh:K,El:O,Fh:Z,Fl:W,Gh:D,Gl:I,Hh:z,Hl:F}=this;return[$,q,J,Q,U,G,X,N,K,O,Z,W,D,I,z,F]}set($,q,J,Q,U,G,X,N,K,O,Z,W,D,I,z,F){this.Ah=$|0,this.Al=q|0,this.Bh=J|0,this.Bl=Q|0,this.Ch=U|0,this.Cl=G|0,this.Dh=X|0,this.Dl=N|0,this.Eh=K|0,this.El=O|0,this.Fh=Z|0,this.Fl=W|0,this.Gh=D|0,this.Gl=I|0,this.Hh=z|0,this.Hl=F|0}process($,q){for(let B=0;B<16;B++,q+=4)P8[B]=$.getUint32(q),y8[B]=$.getUint32(q+=4);for(let B=16;B<80;B++){let R=P8[B-15]|0,v=y8[B-15]|0,m=g8(R,v,1)^g8(R,v,8)^a0(R,v,7),h=v8(R,v,1)^v8(R,v,8)^s0(R,v,7),b=P8[B-2]|0,A=y8[B-2]|0,P=g8(b,A,19)^J0(b,A,61)^a0(b,A,6),S=v8(b,A,19)^Q0(b,A,61)^s0(b,A,6),l=t$(h,S,y8[B-7],y8[B-16]),d=e$(l,m,P,P8[B-7],P8[B-16]);P8[B]=d|0,y8[B]=l|0}let{Ah:J,Al:Q,Bh:U,Bl:G,Ch:X,Cl:N,Dh:K,Dl:O,Eh:Z,El:W,Fh:D,Fl:I,Gh:z,Gl:F,Hh:H,Hl:j}=this;for(let B=0;B<80;B++){let R=g8(Z,W,14)^g8(Z,W,18)^J0(Z,W,41),v=v8(Z,W,14)^v8(Z,W,18)^Q0(Z,W,41),m=Z&D^~Z&z,h=W&I^~W&F,b=$q(j,v,h,iJ[B],y8[B]),A=qq(b,H,R,m,nJ[B],P8[B]),P=b|0,S=g8(J,Q,28)^J0(J,Q,34)^J0(J,Q,39),l=v8(J,Q,28)^Q0(J,Q,34)^Q0(J,Q,39),d=J&U^J&X^U&X,M=Q&G^Q&N^G&N;H=z|0,j=F|0,z=D|0,F=I|0,D=Z|0,I=W|0,{h:Z,l:W}=f8(K|0,O|0,A|0,P|0),K=X|0,O=N|0,X=U|0,N=G|0,U=J|0,G=Q|0;let f=a$(P,l,M);J=s$(f,A,S,d),Q=f|0}({h:J,l:Q}=f8(this.Ah|0,this.Al|0,J|0,Q|0)),{h:U,l:G}=f8(this.Bh|0,this.Bl|0,U|0,G|0),{h:X,l:N}=f8(this.Ch|0,this.Cl|0,X|0,N|0),{h:K,l:O}=f8(this.Dh|0,this.Dl|0,K|0,O|0),{h:Z,l:W}=f8(this.Eh|0,this.El|0,Z|0,W|0),{h:D,l:I}=f8(this.Fh|0,this.Fl|0,D|0,I|0),{h:z,l:F}=f8(this.Gh|0,this.Gl|0,z|0,F|0),{h:H,l:j}=f8(this.Hh|0,this.Hl|0,H|0,j|0),this.set(J,Q,U,G,X,N,K,O,Z,W,D,I,z,F,H,j)}roundClean(){E8(P8,y8)}destroy(){E8(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Uq extends U0{Ah=J8[0]|0;Al=J8[1]|0;Bh=J8[2]|0;Bl=J8[3]|0;Ch=J8[4]|0;Cl=J8[5]|0;Dh=J8[6]|0;Dl=J8[7]|0;Eh=J8[8]|0;El=J8[9]|0;Fh=J8[10]|0;Fl=J8[11]|0;Gh=J8[12]|0;Gl=J8[13]|0;Hh=J8[14]|0;Hl=J8[15]|0;constructor(){super(64)}}class rJ extends U0{Ah=q8[0]|0;Al=q8[1]|0;Bh=q8[2]|0;Bl=q8[3]|0;Ch=q8[4]|0;Cl=q8[5]|0;Dh=q8[6]|0;Dl=q8[7]|0;Eh=q8[8]|0;El=q8[9]|0;Fh=q8[10]|0;Fl=q8[11]|0;Gh=q8[12]|0;Gl=q8[13]|0;Hh=q8[14]|0;Hl=q8[15]|0;constructor(){super(48)}}var Q8=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),U8=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class oJ extends U0{Ah=Q8[0]|0;Al=Q8[1]|0;Bh=Q8[2]|0;Bl=Q8[3]|0;Ch=Q8[4]|0;Cl=Q8[5]|0;Dh=Q8[6]|0;Dl=Q8[7]|0;Eh=Q8[8]|0;El=Q8[9]|0;Fh=Q8[10]|0;Fl=Q8[11]|0;Gh=Q8[12]|0;Gl=Q8[13]|0;Hh=Q8[14]|0;Hl=Q8[15]|0;constructor(){super(28)}}class aJ extends U0{Ah=U8[0]|0;Al=U8[1]|0;Bh=U8[2]|0;Bl=U8[3]|0;Ch=U8[4]|0;Cl=U8[5]|0;Dh=U8[6]|0;Dl=U8[7]|0;Eh=U8[8]|0;El=U8[9]|0;Fh=U8[10]|0;Fl=U8[11]|0;Gh=U8[12]|0;Gl=U8[13]|0;Hh=U8[14]|0;Hl=U8[15]|0;constructor(){super(32)}}var N8=r0(()=>new Jq,o0(1));var Gq=r0(()=>new Uq,o0(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Kq=BigInt(0),Xq=BigInt(1);function f0($,q=""){if(typeof $!=="boolean"){let J=q&&`"${q}" `;throw new Error(J+"expected boolean, got type="+typeof $)}return $}function sJ($){if(typeof $==="bigint"){if(!H0($))throw new Error("positive bigint expected, got "+$)}else H8($);return $}function Nq($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?Kq:BigInt("0x"+$)}function Yq($){return Nq(u8($))}function j8($){return Nq(u8(m8(u($)).reverse()))}function e0($,q){H8(q),$=sJ($);let J=e8($.toString(16).padStart(q*2,"0"));if(J.length!==q)throw new Error("number too large");return J}function D0($,q){return e0($,q).reverse()}function m8($){return Uint8Array.from($)}var H0=($)=>typeof $==="bigint"&&Kq<=$;function tJ($,q,J){return H0($)&&H0(q)&&H0(J)&&q<=$&&$<J}function d8($,q,J,Q){if(!tJ(q,J,Q))throw new Error("expected valid "+$+": "+J+" <= n < "+Q+", got "+q)}var Zq=($)=>(Xq<<BigInt($))-Xq;function b8($,q={},J={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function Q(G,X,N){let K=$[G];if(N&&K===void 0)return;let O=typeof K;if(O!==X||K===null)throw new Error(`param "${G}" is invalid: expected ${X}, got ${O}`)}let U=(G,X)=>Object.entries(G).forEach(([N,K])=>Q(N,K,X));U(q,!1),U(J,!0)}function $$($){let q=new WeakMap;return(J,...Q)=>{let U=q.get(J);if(U!==void 0)return U;let G=$(J,...Q);return q.set(J,G),G}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var X8=BigInt(0),G8=BigInt(1),c8=BigInt(2),Lq=BigInt(3),Wq=BigInt(4),Cq=BigInt(5),eJ=BigInt(7),Eq=BigInt(8),$1=BigInt(9),wq=BigInt(16);function i($,q){let J=$%q;return J>=X8?J:q+J}function L8($,q,J){let Q=$;while(q-- >X8)Q*=Q,Q%=J;return Q}function Mq($,q){if($===X8)throw new Error("invert: expected non-zero number");if(q<=X8)throw new Error("invert: expected positive modulus, got "+q);let J=i($,q),Q=q,U=X8,G=G8,X=G8,N=X8;while(J!==X8){let O=Q/J,Z=Q%J,W=U-X*O,D=G-N*O;Q=J,J=Z,U=X,G=N,X=W,N=D}if(Q!==G8)throw new Error("invert: does not exist");return i(U,q)}function q$($,q,J){if(!$.eql($.sqr(q),J))throw new Error("Cannot find square root")}function Hq($,q){let J=($.ORDER+G8)/Wq,Q=$.pow(q,J);return q$($,Q,q),Q}function q1($,q){let J=($.ORDER-Cq)/Eq,Q=$.mul(q,c8),U=$.pow(Q,J),G=$.mul(q,U),X=$.mul($.mul(G,c8),U),N=$.mul(G,$.sub(X,$.ONE));return q$($,N,q),N}function J1($){let q=R0($),J=fq($),Q=J(q,q.neg(q.ONE)),U=J(q,Q),G=J(q,q.neg(Q)),X=($+eJ)/wq;return(N,K)=>{let O=N.pow(K,X),Z=N.mul(O,Q),W=N.mul(O,U),D=N.mul(O,G),I=N.eql(N.sqr(Z),K),z=N.eql(N.sqr(W),K);O=N.cmov(O,Z,I),Z=N.cmov(D,W,z);let F=N.eql(N.sqr(Z),K),H=N.cmov(O,Z,F);return q$(N,H,K),H}}function fq($){if($<Lq)throw new Error("sqrt is not defined for small field");let q=$-G8,J=0;while(q%c8===X8)q/=c8,J++;let Q=c8,U=R0($);while(Oq(U,Q)===1)if(Q++>1000)throw new Error("Cannot find square root: probably non-prime P");if(J===1)return Hq;let G=U.pow(Q,q),X=(q+G8)/c8;return function N(K,O){if(K.is0(O))return O;if(Oq(K,O)!==1)throw new Error("Cannot find square root");let Z=J,W=K.mul(K.ONE,G),D=K.pow(O,q),I=K.pow(O,X);while(!K.eql(D,K.ONE)){if(K.is0(D))return K.ZERO;let z=1,F=K.sqr(D);while(!K.eql(F,K.ONE))if(z++,F=K.sqr(F),z===Z)throw new Error("Cannot find square root");let H=G8<<BigInt(Z-z-1),j=K.pow(W,H);Z=z,W=K.sqr(j),D=K.mul(D,W),I=K.mul(I,j)}return I}}function Q1($){if($%Wq===Lq)return Hq;if($%Eq===Cq)return q1;if($%wq===$1)return J1($);return fq($)}var Dq=($,q)=>(i($,q)&G8)===G8,U1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Tq($){let q={ORDER:"bigint",BYTES:"number",BITS:"number"},J=U1.reduce((Q,U)=>{return Q[U]="function",Q},q);return b8($,J),$}function G1($,q,J){if(J<X8)throw new Error("invalid exponent, negatives unsupported");if(J===X8)return $.ONE;if(J===G8)return q;let Q=$.ONE,U=q;while(J>X8){if(J&G8)Q=$.mul(Q,U);U=$.sqr(U),J>>=G8}return Q}function T0($,q,J=!1){let Q=new Array(q.length).fill(J?$.ZERO:void 0),U=q.reduce((X,N,K)=>{if($.is0(N))return X;return Q[K]=X,$.mul(X,N)},$.ONE),G=$.inv(U);return q.reduceRight((X,N,K)=>{if($.is0(N))return X;return Q[K]=$.mul(X,Q[K]),$.mul(X,N)},G),Q}function Oq($,q){let J=($.ORDER-G8)/c8,Q=$.pow(q,J),U=$.eql(Q,$.ONE),G=$.eql(Q,$.ZERO),X=$.eql(Q,$.neg($.ONE));if(!U&&!G&&!X)throw new Error("invalid Legendre symbol result");return U?1:G?0:-1}function X1($,q){if(q!==void 0)H8(q);let J=q!==void 0?q:$.toString(2).length,Q=Math.ceil(J/8);return{nBitLength:J,nByteLength:Q}}class Rq{ORDER;BITS;BYTES;isLE;ZERO=X8;ONE=G8;_lengths;_sqrt;_mod;constructor($,q={}){if($<=X8)throw new Error("invalid field: expected ORDER > 0, got "+$);let J=void 0;if(this.isLE=!1,q!=null&&typeof q==="object"){if(typeof q.BITS==="number")J=q.BITS;if(typeof q.sqrt==="function")this.sqrt=q.sqrt;if(typeof q.isLE==="boolean")this.isLE=q.isLE;if(q.allowedLengths)this._lengths=q.allowedLengths?.slice();if(typeof q.modFromBytes==="boolean")this._mod=q.modFromBytes}let{nBitLength:Q,nByteLength:U}=X1($,J);if(U>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=Q,this.BYTES=U,this._sqrt=void 0,Object.preventExtensions(this)}create($){return i($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return X8<=$&&$<this.ORDER}is0($){return $===X8}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&G8)===G8}neg($){return i(-$,this.ORDER)}eql($,q){return $===q}sqr($){return i($*$,this.ORDER)}add($,q){return i($+q,this.ORDER)}sub($,q){return i($-q,this.ORDER)}mul($,q){return i($*q,this.ORDER)}pow($,q){return G1(this,$,q)}div($,q){return i($*Mq(q,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,q){return $+q}subN($,q){return $-q}mulN($,q){return $*q}inv($){return Mq($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=Q1(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?D0($,this.BYTES):e0($,this.BYTES)}fromBytes($,q=!1){u($);let{_lengths:J,BYTES:Q,isLE:U,ORDER:G,_mod:X}=this;if(J){if(!J.includes($.length)||$.length>Q)throw new Error("Field.fromBytes: expected "+J+" bytes, got "+$.length);let K=new Uint8Array(Q);K.set($,U?0:K.length-$.length),$=K}if($.length!==Q)throw new Error("Field.fromBytes: expected "+Q+" bytes, got "+$.length);let N=U?j8($):Yq($);if(X)N=i(N,G);if(!q){if(!this.isValid(N))throw new Error("invalid field element: outside of range 0..ORDER")}return N}invertBatch($){return T0(this,$)}cmov($,q,J){return J?q:$}}function R0($,q={}){return new Rq($,q)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var z0=BigInt(0),G$=BigInt(1);function zq($,q){let J=q.negate();return $?J:q}function B0($,q){let J=T0($.Fp,q.map((Q)=>Q.Z));return q.map((Q,U)=>$.fromAffine(Q.toAffine(J[U])))}function jq($,q){if(!Number.isSafeInteger($)||$<=0||$>q)throw new Error("invalid window size, expected [1.."+q+"], got W="+$)}function J$($,q){jq($,q);let J=Math.ceil(q/$)+1,Q=2**($-1),U=2**$,G=Zq($),X=BigInt($);return{windows:J,windowSize:Q,mask:G,maxNumber:U,shiftBy:X}}function Bq($,q,J){let{windowSize:Q,mask:U,maxNumber:G,shiftBy:X}=J,N=Number($&U),K=$>>X;if(N>Q)N-=G,K+=G$;let O=q*Q,Z=O+Math.abs(N)-1,W=N===0,D=N<0,I=q%2!==0;return{nextN:K,offset:Z,isZero:W,isNeg:D,isNegF:I,offsetF:O}}var Q$=new WeakMap,Vq=new WeakMap;function U$($){return Vq.get($)||1}function Iq($){if($!==z0)throw new Error("invalid wNAF")}class X${BASE;ZERO;Fn;bits;constructor($,q){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=q}_unsafeLadder($,q,J=this.ZERO){let Q=$;while(q>z0){if(q&G$)J=J.add(Q);Q=Q.double(),q>>=G$}return J}precomputeWindow($,q){let{windows:J,windowSize:Q}=J$(q,this.bits),U=[],G=$,X=G;for(let N=0;N<J;N++){X=G,U.push(X);for(let K=1;K<Q;K++)X=X.add(G),U.push(X);G=X.double()}return U}wNAF($,q,J){if(!this.Fn.isValid(J))throw new Error("invalid scalar");let Q=this.ZERO,U=this.BASE,G=J$($,this.bits);for(let X=0;X<G.windows;X++){let{nextN:N,offset:K,isZero:O,isNeg:Z,isNegF:W,offsetF:D}=Bq(J,X,G);if(J=N,O)U=U.add(zq(W,q[D]));else Q=Q.add(zq(Z,q[K]))}return Iq(J),{p:Q,f:U}}wNAFUnsafe($,q,J,Q=this.ZERO){let U=J$($,this.bits);for(let G=0;G<U.windows;G++){if(J===z0)break;let{nextN:X,offset:N,isZero:K,isNeg:O}=Bq(J,G,U);if(J=X,K)continue;else{let Z=q[N];Q=Q.add(O?Z.negate():Z)}}return Iq(J),Q}getPrecomputes($,q,J){let Q=Q$.get(q);if(!Q){if(Q=this.precomputeWindow(q,$),$!==1){if(typeof J==="function")Q=J(Q);Q$.set(q,Q)}}return Q}cached($,q,J){let Q=U$($);return this.wNAF(Q,this.getPrecomputes(Q,$,J),q)}unsafe($,q,J,Q){let U=U$($);if(U===1)return this._unsafeLadder($,q,Q);return this.wNAFUnsafe(U,this.getPrecomputes(U,$,J),q,Q)}createCache($,q){jq(q,this.bits),Vq.set($,q),Q$.delete($)}hasCache($){return U$($)!==1}}function Aq($,q,J){if(q){if(q.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Tq(q),q}else return R0($,{isLE:J})}function xq($,q,J={},Q){if(Q===void 0)Q=$==="edwards";if(!q||typeof q!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let K of["p","n","h"]){let O=q[K];if(!(typeof O==="bigint"&&O>z0))throw new Error(`CURVE.${K} must be positive bigint`)}let U=Aq(q.p,J.Fp,Q),G=Aq(q.n,J.Fn,Q),N=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let K of N)if(!U.isValid(q[K]))throw new Error(`CURVE.${K} must be valid field element of CURVE.Fp`);return q=Object.freeze(Object.assign({},q)),{CURVE:q,Fp:U,Fn:G}}function I0($,q){return function J(Q){let U=$(Q);return{secretKey:U,publicKey:q(U)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var F8=BigInt(0),e=BigInt(1),K$=BigInt(2),K1=BigInt(8);function N1($,q,J,Q){let U=$.sqr(J),G=$.sqr(Q),X=$.add($.mul(q.a,U),G),N=$.add($.ONE,$.mul(q.d,$.mul(U,G)));return $.eql(X,N)}function Pq($,q={}){let J=xq("edwards",$,q,q.FpFnLE),{Fp:Q,Fn:U}=J,G=J.CURVE,{h:X}=G;b8(q,{},{uvRatio:"function"});let N=K$<<BigInt(U.BYTES*8)-e,K=(H)=>Q.create(H),O=q.uvRatio||((H,j)=>{try{return{isValid:!0,value:Q.sqrt(Q.div(H,j))}}catch(B){return{isValid:!1,value:F8}}});if(!N1(Q,G,G.Gx,G.Gy))throw new Error("bad curve params: generator point");function Z(H,j,B=!1){let R=B?e:F8;return d8("coordinate "+H,j,R,N),j}function W(H){if(!(H instanceof z))throw new Error("EdwardsPoint expected")}let D=$$((H,j)=>{let{X:B,Y:R,Z:v}=H,m=H.is0();if(j==null)j=m?K1:Q.inv(v);let h=K(B*j),b=K(R*j),A=Q.mul(v,j);if(m)return{x:F8,y:e};if(A!==e)throw new Error("invZ was invalid");return{x:h,y:b}}),I=$$((H)=>{let{a:j,d:B}=G;if(H.is0())throw new Error("bad point: ZERO");let{X:R,Y:v,Z:m,T:h}=H,b=K(R*R),A=K(v*v),P=K(m*m),S=K(P*P),l=K(b*j),d=K(P*K(l+A)),M=K(S+K(B*K(b*A)));if(d!==M)throw new Error("bad point: equation left != right (1)");let f=K(R*v),C=K(m*h);if(f!==C)throw new Error("bad point: equation left != right (2)");return!0});class z{static BASE=new z(G.Gx,G.Gy,e,K(G.Gx*G.Gy));static ZERO=new z(F8,e,e,F8);static Fp=Q;static Fn=U;X;Y;Z;T;constructor(H,j,B,R){this.X=Z("x",H),this.Y=Z("y",j),this.Z=Z("z",B,!0),this.T=Z("t",R),Object.freeze(this)}static CURVE(){return G}static fromAffine(H){if(H instanceof z)throw new Error("extended point not allowed");let{x:j,y:B}=H||{};return Z("x",j),Z("y",B),new z(j,B,e,K(j*B))}static fromBytes(H,j=!1){let B=Q.BYTES,{a:R,d:v}=G;H=m8(u(H,B,"point")),f0(j,"zip215");let m=m8(H),h=H[B-1];m[B-1]=h&-129;let b=j8(m),A=j?N:Q.ORDER;d8("point.y",b,F8,A);let P=K(b*b),S=K(P-e),l=K(v*P-R),{isValid:d,value:M}=O(S,l);if(!d)throw new Error("bad point: invalid y coordinate");let f=(M&e)===e,C=(h&128)!==0;if(!j&&M===F8&&C)throw new Error("bad point: x=0 and x_0=1");if(C!==f)M=K(-M);return z.fromAffine({x:M,y:b})}static fromHex(H,j=!1){return z.fromBytes(e8(H),j)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(H=8,j=!0){if(F.createCache(this,H),!j)this.multiply(K$);return this}assertValidity(){I(this)}equals(H){W(H);let{X:j,Y:B,Z:R}=this,{X:v,Y:m,Z:h}=H,b=K(j*h),A=K(v*R),P=K(B*h),S=K(m*R);return b===A&&P===S}is0(){return this.equals(z.ZERO)}negate(){return new z(K(-this.X),this.Y,this.Z,K(-this.T))}double(){let{a:H}=G,{X:j,Y:B,Z:R}=this,v=K(j*j),m=K(B*B),h=K(K$*K(R*R)),b=K(H*v),A=j+B,P=K(K(A*A)-v-m),S=b+m,l=S-h,d=b-m,M=K(P*l),f=K(S*d),C=K(P*d),w=K(l*S);return new z(M,f,w,C)}add(H){W(H);let{a:j,d:B}=G,{X:R,Y:v,Z:m,T:h}=this,{X:b,Y:A,Z:P,T:S}=H,l=K(R*b),d=K(v*A),M=K(h*B*S),f=K(m*P),C=K((R+v)*(b+A)-l-d),w=f-M,T=f+M,V=K(d-j*l),y=K(C*w),k=K(T*V),_=K(C*V),g=K(w*T);return new z(y,k,g,_)}subtract(H){return this.add(H.negate())}multiply(H){if(!U.isValidNot0(H))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:j,f:B}=F.cached(this,H,(R)=>B0(z,R));return B0(z,[j,B])[0]}multiplyUnsafe(H,j=z.ZERO){if(!U.isValid(H))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(H===F8)return z.ZERO;if(this.is0()||H===e)return this;return F.unsafe(this,H,(B)=>B0(z,B),j)}isSmallOrder(){return this.multiplyUnsafe(X).is0()}isTorsionFree(){return F.unsafe(this,G.n).is0()}toAffine(H){return D(this,H)}clearCofactor(){if(X===e)return this;return this.multiplyUnsafe(X)}toBytes(){let{x:H,y:j}=this.toAffine(),B=Q.toBytes(j);return B[B.length-1]|=H&e?128:0,B}toHex(){return u8(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let F=new X$(z,U.BITS);return z.BASE.precompute(8),z}function yq($,q,J={}){if(typeof q!=="function")throw new Error('"hash" function param is required');b8(J,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:Q}=J,{BASE:U,Fp:G,Fn:X}=$,N=J.randomBytes||q0,K=J.adjustScalarBytes||((A)=>A),O=J.domain||((A,P,S)=>{if(f0(S,"phflag"),P.length||S)throw new Error("Contexts/pre-hash are not supported");return A});function Z(A){return X.create(j8(A))}function W(A){let P=R.secretKey;u(A,R.secretKey,"secretKey");let S=u(q(A),2*P,"hashedSecretKey"),l=K(S.slice(0,P)),d=S.slice(P,2*P),M=Z(l);return{head:l,prefix:d,scalar:M}}function D(A){let{head:P,prefix:S,scalar:l}=W(A),d=U.multiply(l),M=d.toBytes();return{head:P,prefix:S,scalar:l,point:d,pointBytes:M}}function I(A){return D(A).pointBytes}function z(A=Uint8Array.of(),...P){let S=$0(...P);return Z(q(O(S,u(A,void 0,"context"),!!Q)))}function F(A,P,S={}){if(A=u(A,void 0,"message"),Q)A=Q(A);let{prefix:l,scalar:d,pointBytes:M}=D(P),f=z(S.context,l,A),C=U.multiply(f).toBytes(),w=z(S.context,C,M,A),T=X.create(f+w*d);if(!X.isValid(T))throw new Error("sign failed: invalid s");let V=$0(C,X.toBytes(T));return u(V,R.signature,"result")}let H={zip215:!0};function j(A,P,S,l=H){let{context:d,zip215:M}=l,f=R.signature;if(A=u(A,f,"signature"),P=u(P,void 0,"message"),S=u(S,R.publicKey,"publicKey"),M!==void 0)f0(M,"zip215");if(Q)P=Q(P);let C=f/2,w=A.subarray(0,C),T=j8(A.subarray(C,f)),V,y,k;try{V=$.fromBytes(S,M),y=$.fromBytes(w,M),k=U.multiplyUnsafe(T)}catch(s8){return!1}if(!M&&V.isSmallOrder())return!1;let _=z(d,y.toBytes(),V.toBytes(),P);return y.add(V.multiplyUnsafe(_)).subtract(k).clearCofactor().is0()}let B=G.BYTES,R={secretKey:B,publicKey:B,signature:2*B,seed:B};function v(A=N(R.seed)){return u(A,R.seed,"seed")}function m(A){return W0(A)&&A.length===X.BYTES}function h(A,P){try{return!!$.fromBytes(A,P)}catch(S){return!1}}let b={getExtendedPublicKey:D,randomSecretKey:v,isValidSecretKey:m,isValidPublicKey:h,toMontgomery(A){let{y:P}=$.fromBytes(A),S=R.publicKey,l=S===32;if(!l&&S!==57)throw new Error("only defined for 25519 and 448");let d=l?G.div(e+P,e-P):G.div(P-e,P+e);return G.toBytes(d)},toMontgomerySecret(A){let P=R.secretKey;u(A,P);let S=q(A.subarray(0,P));return K(S).subarray(0,P)}};return Object.freeze({keygen:I0(v,I),getPublicKey:I,sign:F,verify:j,utils:b,Point:$,lengths:R})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var G0=BigInt(0),n8=BigInt(1),A0=BigInt(2);function Y1($){return b8($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function Fq($){let q=Y1($),{P:J,type:Q,adjustScalarBytes:U,powPminus2:G,randomBytes:X}=q,N=Q==="x25519";if(!N&&Q!=="x448")throw new Error("invalid type");let K=X||q0,O=N?255:448,Z=N?32:56,W=N?BigInt(9):BigInt(5),D=N?BigInt(121665):BigInt(39081),I=N?A0**BigInt(254):A0**BigInt(447),z=N?BigInt(8)*A0**BigInt(251)-n8:BigInt(4)*A0**BigInt(445)-n8,F=I+z+n8,H=(f)=>i(f,J),j=B(W);function B(f){return D0(H(f),Z)}function R(f){let C=m8(u(f,Z,"uCoordinate"));if(N)C[31]&=127;return H(j8(C))}function v(f){return j8(U(m8(u(f,Z,"scalar"))))}function m(f,C){let w=S(R(C),v(f));if(w===G0)throw new Error("invalid private or public key received");return B(w)}function h(f){return m(f,j)}let b=h,A=m;function P(f,C,w){let T=H(f*(C-w));return C=H(C-T),w=H(w+T),{x_2:C,x_3:w}}function S(f,C){d8("u",f,G0,J),d8("scalar",C,I,F);let w=C,T=f,V=n8,y=G0,k=f,_=n8,g=G0;for(let h0=BigInt(O-1);h0>=G0;h0--){let _$=w>>h0&n8;g^=_$,{x_2:V,x_3:k}=P(g,V,k),{x_2:y,x_3:_}=P(g,y,_),g=_$;let u0=V+y,d0=H(u0*u0),n0=V-y,S$=H(n0*n0),g$=d0-S$,_J=k+_,SJ=k-_,v$=H(SJ*u0),m$=H(_J*n0),b$=v$+m$,c$=v$-m$;k=H(b$*b$),_=H(T*H(c$*c$)),V=H(d0*S$),y=H(g$*(d0+H(D*g$)))}({x_2:V,x_3:k}=P(g,V,k)),{x_2:y,x_3:_}=P(g,y,_);let s8=G(y);return H(V*s8)}let l={secretKey:Z,publicKey:Z,seed:Z},d=(f=K(Z))=>{return u(f,l.seed,"seed"),f},M={randomSecretKey:d};return Object.freeze({keygen:I0(d,b),getSharedSecret:A,getPublicKey:b,scalarMult:m,scalarMultBase:h,utils:M,GuBytes:j.slice(),lengths:l})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Z1=BigInt(1),kq=BigInt(2),M1=BigInt(3),O1=BigInt(5),L1=BigInt(8),j0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),W1=(()=>({p:j0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:L1,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function Sq($){let q=BigInt(10),J=BigInt(20),Q=BigInt(40),U=BigInt(80),G=j0,N=$*$%G*$%G,K=L8(N,kq,G)*N%G,O=L8(K,Z1,G)*$%G,Z=L8(O,O1,G)*O%G,W=L8(Z,q,G)*Z%G,D=L8(W,J,G)*W%G,I=L8(D,Q,G)*D%G,z=L8(I,U,G)*I%G,F=L8(z,U,G)*I%G,H=L8(F,q,G)*Z%G;return{pow_p_5_8:L8(H,kq,G)*$%G,b2:N}}function gq($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var _q=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function C1($,q){let J=j0,Q=i(q*q*q,J),U=i(Q*Q*q,J),G=Sq($*U).pow_p_5_8,X=i($*Q*G,J),N=i(q*X*X,J),K=X,O=i(X*_q,J),Z=N===$,W=N===i(-$,J),D=N===i(-$*_q,J);if(Z)X=K;if(W||D)X=O;if(Dq(X,J))X=i(-X,J);return{isValid:Z||W,value:X}}var E1=Pq(W1,{uvRatio:C1});function w1($){return yq(E1,Gq,Object.assign({adjustScalarBytes:gq},$))}var k8=w1({});var X0=(()=>{let $=j0;return Fq({P:$,type:"x25519",powPminus2:(q)=>{let{pow_p_5_8:J,b2:Q}=Sq(q);return i(L8(J,M1,$)*Q,$)},adjustScalarBytes:gq})})();var GJ=l$(N$(),1);var Y$;try{Y$=new TextDecoder}catch($){}var x,l8,E=0;var lq=[],H1=105,f1=57342,D1=57343,mq=57337;var bq=6,i8={},K0=112810000,V8=16810000;var Z$=lq,M$=0,c={},r,P0,y0=0,Y0=0,a,W8,o=[],O$=[],Y8,K8,N0,cq={useRecords:!1,mapsAsObjects:!0},Z0=!1,hq=2;try{new Function("")}catch($){hq=1/0}class _8{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[q,J]of Object.entries($.keyMap))this.mapKey.set(J,q)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let q=new Map;for(let[J,Q]of Object.entries($))q.set(this._keyMap.hasOwnProperty(J)?this._keyMap[J]:J,Q);return q}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[J,Q]of Object.entries(this._keyMap))this._mapKey.set(Q,J)}let q={};return $.forEach((J,Q)=>q[C8(this._mapKey.has(Q)?this._mapKey.get(Q):Q)]=J),q}mapDecode($,q){let J=this.decode($);if(this._keyMap)switch(J.constructor.name){case"Array":return J.map((Q)=>this.decodeKeys(Q))}return J}decode($,q){if(x)return iq(()=>{return F0(),this?this.decode($,q):_8.prototype.decode.call(cq,$,q)});l8=q>-1?q:$.length,E=0,M$=0,Y0=0,P0=null,Z$=lq,a=null,x=$;try{K8=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(J){if(x=null,$ instanceof Uint8Array)throw J;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof _8){if(c=this,Y8=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return r=this.structures,V0();else if(!r||r.length>0)r=[]}else{if(c=cq,!r||r.length>0)r=[];Y8=null}return V0()}decodeMultiple($,q){let J,Q=0;try{let U=$.length;Z0=!0;let G=this?this.decode($,U):H$.decode($,U);if(q){if(q(G)===!1)return;while(E<U)if(Q=E,q(V0())===!1)return}else{J=[G];while(E<U)Q=E,J.push(V0());return J}}catch(U){throw U.lastPosition=Q,U.values=J,U}finally{Z0=!1,F0()}}}function V0(){try{let $=p();if(a){if(E>=a.postBundlePosition){let q=new Error("Unexpected bundle position");throw q.incomplete=!0,q}E=a.postBundlePosition,a=null}if(E==l8){if(r=null,x=null,W8)W8=null}else if(E>l8){let q=new Error("Unexpected end of CBOR data");throw q.incomplete=!0,q}else if(!Z0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(F0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function p(){let $=x[E++],q=$>>5;if($=$&31,$>23)switch($){case 24:$=x[E++];break;case 25:if(q==7)return B1();$=K8.getUint16(E),E+=2;break;case 26:if(q==7){let J=K8.getFloat32(E);if(c.useFloat32>2){let Q=k0[(x[E]&127)<<1|x[E+1]>>7];return E+=4,(Q*J+(J>0?0.5:-0.5)>>0)/Q}return E+=4,J}$=K8.getUint32(E),E+=4;break;case 27:if(q==7){let J=K8.getFloat64(E);return E+=8,J}if(q>1){if(K8.getUint32(E)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=K8.getUint32(E+4)}else if(c.int64AsNumber)$=K8.getUint32(E)*4294967296,$+=K8.getUint32(E+4);else $=K8.getBigUint64(E);E+=8;break;case 31:switch(q){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let J=[],Q,U=0;while((Q=p())!=i8){if(U>=K0)throw new Error(`Array length exceeds ${K0}`);J[U++]=Q}return q==4?J:q==3?J.join(""):Buffer.concat(J);case 5:let G;if(c.mapsAsObjects){let X={},N=0;if(c.keyMap)while((G=p())!=i8){if(N++>=V8)throw new Error(`Property count exceeds ${V8}`);X[C8(c.decodeKey(G))]=p()}else while((G=p())!=i8){if(N++>=V8)throw new Error(`Property count exceeds ${V8}`);X[C8(G)]=p()}return X}else{if(N0)c.mapsAsObjects=!0,N0=!1;let X=new Map;if(c.keyMap){let N=0;while((G=p())!=i8){if(N++>=V8)throw new Error(`Map size exceeds ${V8}`);X.set(c.decodeKey(G),p())}}else{let N=0;while((G=p())!=i8){if(N++>=V8)throw new Error(`Map size exceeds ${V8}`);X.set(G,p())}}return X}case 7:return i8;default:throw new Error("Invalid major type for indefinite length "+q)}default:throw new Error("Unknown token "+$)}switch(q){case 0:return $;case 1:return~$;case 2:return z1($);case 3:if(Y0>=E)return P0.slice(E-y0,(E+=$)-y0);if(Y0==0&&l8<140&&$<32){let U=$<16?uq($):R1($);if(U!=null)return U}return T1($);case 4:if($>=K0)throw new Error(`Array length exceeds ${K0}`);let J=new Array($);for(let U=0;U<$;U++)J[U]=p();return J;case 5:if($>=V8)throw new Error(`Map size exceeds ${K0}`);if(c.mapsAsObjects){let U={};if(c.keyMap)for(let G=0;G<$;G++)U[C8(c.decodeKey(p()))]=p();else for(let G=0;G<$;G++)U[C8(p())]=p();return U}else{if(N0)c.mapsAsObjects=!0,N0=!1;let U=new Map;if(c.keyMap)for(let G=0;G<$;G++)U.set(c.decodeKey(p()),p());else for(let G=0;G<$;G++)U.set(p(),p());return U}case 6:if($>=mq){let U=r[$&8191];if(U){if(!U.read)U.read=L$(U);return U.read()}if($<65536){if($==D1){let G=o8(),X=p(),N=p();C$(X,N);let K={};if(c.keyMap)for(let O=2;O<G;O++){let Z=c.decodeKey(N[O-2]);K[C8(Z)]=p()}else for(let O=2;O<G;O++){let Z=N[O-2];K[C8(Z)]=p()}return K}else if($==f1){let G=o8(),X=p();for(let N=2;N<G;N++)C$(X++,p());return p()}else if($==mq)return P1();if(c.getShared){if(w$(),U=r[$&8191],U){if(!U.read)U.read=L$(U);return U.read()}}}}let Q=o[$];if(Q)if(Q.handlesRead)return Q(p);else return Q(p());else{let U=p();for(let G=0;G<O$.length;G++){let X=O$[G]($,U);if(X!==void 0)return X}return new D8(U,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let U=(Y8||p8())[$];if(U!==void 0)return U;throw new Error("Unknown token "+$)}default:if(isNaN($)){let U=new Error("Unexpected end of CBOR data");throw U.incomplete=!0,U}throw new Error("Unknown CBOR token "+$)}}var pq=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function L$($){if(!$)throw new Error("Structure is required in record definition");function q(){let J=x[E++];if(J=J&31,J>23)switch(J){case 24:J=x[E++];break;case 25:J=K8.getUint16(E),E+=2;break;case 26:J=K8.getUint32(E),E+=4;break;default:throw new Error("Expected array header, but got "+x[E-1])}let Q=this.compiledReader;while(Q){if(Q.propertyCount===J)return Q(p);Q=Q.next}if(this.slowReads++>=hq){let G=this.length==J?this:this.slice(0,J);if(Q=c.keyMap?new Function("r","return {"+G.map((X)=>c.decodeKey(X)).map((X)=>pq.test(X)?C8(X)+":r()":"["+JSON.stringify(X)+"]:r()").join(",")+"}"):new Function("r","return {"+G.map((X)=>pq.test(X)?C8(X)+":r()":"["+JSON.stringify(X)+"]:r()").join(",")+"}"),this.compiledReader)Q.next=this.compiledReader;return Q.propertyCount=J,this.compiledReader=Q,Q(p)}let U={};if(c.keyMap)for(let G=0;G<J;G++)U[C8(c.decodeKey(this[G]))]=p();else for(let G=0;G<J;G++)U[C8(this[G])]=p();return U}return $.slowReads=0,q}function C8($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var T1=W$;function W$($){let q;if($<16){if(q=uq($))return q}if($>64&&Y$)return Y$.decode(x.subarray(E,E+=$));let J=E+$,Q=[];q="";while(E<J){let U=x[E++];if((U&128)===0)Q.push(U);else if((U&224)===192){let G=x[E++]&63;Q.push((U&31)<<6|G)}else if((U&240)===224){let G=x[E++]&63,X=x[E++]&63;Q.push((U&31)<<12|G<<6|X)}else if((U&248)===240){let G=x[E++]&63,X=x[E++]&63,N=x[E++]&63,K=(U&7)<<18|G<<12|X<<6|N;if(K>65535)K-=65536,Q.push(K>>>10&1023|55296),K=56320|K&1023;Q.push(K)}else Q.push(U);if(Q.length>=4096)q+=$8.apply(String,Q),Q.length=0}if(Q.length>0)q+=$8.apply(String,Q);return q}var $8=String.fromCharCode;function R1($){let q=E,J=new Array($);for(let Q=0;Q<$;Q++){let U=x[E++];if((U&128)>0){E=q;return}J[Q]=U}return $8.apply(String,J)}function uq($){if($<4)if($<2)if($===0)return"";else{let q=x[E++];if((q&128)>1){E-=1;return}return $8(q)}else{let q=x[E++],J=x[E++];if((q&128)>0||(J&128)>0){E-=2;return}if($<3)return $8(q,J);let Q=x[E++];if((Q&128)>0){E-=3;return}return $8(q,J,Q)}else{let q=x[E++],J=x[E++],Q=x[E++],U=x[E++];if((q&128)>0||(J&128)>0||(Q&128)>0||(U&128)>0){E-=4;return}if($<6)if($===4)return $8(q,J,Q,U);else{let G=x[E++];if((G&128)>0){E-=5;return}return $8(q,J,Q,U,G)}else if($<8){let G=x[E++],X=x[E++];if((G&128)>0||(X&128)>0){E-=6;return}if($<7)return $8(q,J,Q,U,G,X);let N=x[E++];if((N&128)>0){E-=7;return}return $8(q,J,Q,U,G,X,N)}else{let G=x[E++],X=x[E++],N=x[E++],K=x[E++];if((G&128)>0||(X&128)>0||(N&128)>0||(K&128)>0){E-=8;return}if($<10)if($===8)return $8(q,J,Q,U,G,X,N,K);else{let O=x[E++];if((O&128)>0){E-=9;return}return $8(q,J,Q,U,G,X,N,K,O)}else if($<12){let O=x[E++],Z=x[E++];if((O&128)>0||(Z&128)>0){E-=10;return}if($<11)return $8(q,J,Q,U,G,X,N,K,O,Z);let W=x[E++];if((W&128)>0){E-=11;return}return $8(q,J,Q,U,G,X,N,K,O,Z,W)}else{let O=x[E++],Z=x[E++],W=x[E++],D=x[E++];if((O&128)>0||(Z&128)>0||(W&128)>0||(D&128)>0){E-=12;return}if($<14)if($===12)return $8(q,J,Q,U,G,X,N,K,O,Z,W,D);else{let I=x[E++];if((I&128)>0){E-=13;return}return $8(q,J,Q,U,G,X,N,K,O,Z,W,D,I)}else{let I=x[E++],z=x[E++];if((I&128)>0||(z&128)>0){E-=14;return}if($<15)return $8(q,J,Q,U,G,X,N,K,O,Z,W,D,I,z);let F=x[E++];if((F&128)>0){E-=15;return}return $8(q,J,Q,U,G,X,N,K,O,Z,W,D,I,z,F)}}}}}function z1($){return c.copyBuffers?Uint8Array.prototype.slice.call(x,E,E+=$):x.subarray(E,E+=$)}var dq=new Float32Array(1),x0=new Uint8Array(dq.buffer,0,4);function B1(){let $=x[E++],q=x[E++],J=($&127)>>2;if(J===31){if(q||$&3)return NaN;return $&128?-1/0:1/0}if(J===0){let Q=(($&3)<<8|q)/16777216;return $&128?-Q:Q}return x0[3]=$&128|(J>>1)+56,x0[2]=($&7)<<5|q>>3,x0[1]=q<<5,x0[0]=0,dq[0]}var gQ=new Array(4096);class D8{constructor($,q){this.value=$,this.tag=q}}o[0]=($)=>{return new Date($)};o[1]=($)=>{return new Date(Math.round($*1000))};o[2]=($)=>{let q=BigInt(0);for(let J=0,Q=$.byteLength;J<Q;J++)q=BigInt($[J])+(q<<BigInt(8));return q};o[3]=($)=>{return BigInt(-1)-o[2]($)};o[4]=($)=>{return+($[1]+"e"+$[0])};o[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var C$=($,q)=>{$=$-57344;let J=r[$];if(J&&J.isShared)(r.restoreStructures||(r.restoreStructures=[]))[$]=J;r[$]=q,q.read=L$(q)};o[H1]=($)=>{let q=$.length,J=$[1];C$($[0],J);let Q={};for(let U=2;U<q;U++){let G=J[U-2];Q[C8(G)]=$[U]}return Q};o[14]=($)=>{if(a)return a[0].slice(a.position0,a.position0+=$);return new D8($,14)};o[15]=($)=>{if(a)return a[1].slice(a.position1,a.position1+=$);return new D8($,15)};var I1={Error,RegExp};o[27]=($)=>{return(I1[$[0]]||Error)($[1],$[2])};var nq=($)=>{if(x[E++]!=132){let J=new Error("Packed values structure must be followed by a 4 element array");if(x.length<E)J.incomplete=!0;throw J}let q=$();if(!q||!q.length){let J=new Error("Packed values structure must be followed by a 4 element array");throw J.incomplete=!0,J}return Y8=Y8?q.concat(Y8.slice(q.length)):q,Y8.prefixes=$(),Y8.suffixes=$(),$()};nq.handlesRead=!0;o[51]=nq;o[bq]=($)=>{if(!Y8)if(c.getShared)w$();else return new D8($,bq);if(typeof $=="number")return Y8[16+($>=0?2*$:-2*$-1)];let q=new Error("No support for non-integer packed references yet");if($===void 0)q.incomplete=!0;throw q};o[28]=($)=>{if(!W8)W8=new Map,W8.id=0;let q=W8.id++,J=E,Q=x[E],U;if(Q>>5==4)U=[];else U={};let G={target:U};W8.set(q,G);let X=$();if(G.used){if(Object.getPrototypeOf(U)!==Object.getPrototypeOf(X))E=J,U=X,W8.set(q,{target:U}),X=$();return Object.assign(U,X)}return G.target=X,X};o[28].handlesRead=!0;o[29]=($)=>{let q=W8.get($);return q.used=!0,q.target};o[258]=($)=>new Set($);(o[259]=($)=>{if(c.mapsAsObjects)c.mapsAsObjects=!1,N0=!0;return $()}).handlesRead=!0;function r8($,q){if(typeof $==="string")return $+q;if($ instanceof Array)return $.concat(q);return Object.assign({},$,q)}function p8(){if(!Y8)if(c.getShared)w$();else throw new Error("No packed values available");return Y8}var A1=1399353956;O$.push(($,q)=>{if($>=225&&$<=255)return r8(p8().prefixes[$-224],q);if($>=28704&&$<=32767)return r8(p8().prefixes[$-28672],q);if($>=1879052288&&$<=2147483647)return r8(p8().prefixes[$-1879048192],q);if($>=216&&$<=223)return r8(q,p8().suffixes[$-216]);if($>=27647&&$<=28671)return r8(q,p8().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return r8(q,p8().suffixes[$-1811939328]);if($==A1)return{packedValues:Y8,structures:r.slice(0),version:q};if($==55799)return q});var j1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,E$=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],V1=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<E$.length;$++)x1(E$[$],V1[$]);function x1($,q){let J="get"+$.name.slice(0,-5),Q;if(typeof $==="function")Q=$.BYTES_PER_ELEMENT;else $=null;for(let U=0;U<2;U++){if(!U&&Q==1)continue;let G=Q==2?1:Q==4?2:Q==8?3:0;o[U?q:q-4]=Q==1||U==j1?(X)=>{if(!$)throw new Error("Could not find typed array for code "+q);if(!c.copyBuffers){if(Q===1||Q===2&&!(X.byteOffset&1)||Q===4&&!(X.byteOffset&3)||Q===8&&!(X.byteOffset&7))return new $(X.buffer,X.byteOffset,X.byteLength>>G)}return new $(Uint8Array.prototype.slice.call(X,0).buffer)}:(X)=>{if(!$)throw new Error("Could not find typed array for code "+q);let N=new DataView(X.buffer,X.byteOffset,X.byteLength),K=X.length>>G,O=new $(K),Z=N[J];for(let W=0;W<K;W++)O[W]=Z.call(N,W<<G,U);return O}}}function P1(){let $=o8(),q=E+p();for(let Q=2;Q<$;Q++){let U=o8();E+=U}let J=E;return E=q,a=[W$(o8()),W$(o8())],a.position0=0,a.position1=0,a.postBundlePosition=E,E=J,p()}function o8(){let $=x[E++]&31;if($>23)switch($){case 24:$=x[E++];break;case 25:$=K8.getUint16(E),E+=2;break;case 26:$=K8.getUint32(E),E+=4;break}return $}function w$(){if(c.getShared){let $=iq(()=>{return x=null,c.getShared()})||{},q=$.structures||[];if(c.sharedVersion=$.version,Y8=c.sharedValues=$.packedValues,r===!0)c.structures=r=q;else r.splice.apply(r,[0,q.length].concat(q))}}function iq($){let q=l8,J=E,Q=M$,U=y0,G=Y0,X=P0,N=Z$,K=W8,O=a,Z=new Uint8Array(x.slice(0,l8)),W=r,D=c,I=Z0,z=$();return l8=q,E=J,M$=Q,y0=U,Y0=G,P0=X,Z$=N,W8=K,a=O,x=Z,Z0=I,r=W,c=D,K8=new DataView(x.buffer,x.byteOffset,x.byteLength),z}function F0(){x=null,W8=null,r=null}var k0=new Array(147);for(let $=0;$<256;$++)k0[$]=+("1e"+Math.floor(45.15-$*0.30103));var H$=new _8({useRecords:!1}),_0=H$.decode,y1=H$.decodeMultiple;var S0;try{S0=new TextEncoder}catch($){}var z$,$J,v0=typeof globalThis==="object"&&globalThis.Buffer,M0=typeof v0!=="undefined",f$=M0?v0.allocUnsafeSlow:Uint8Array,rq=M0?v0:Uint8Array,oq=256,aq=M0?4294967296:2144337920;var D$,L,n,Y=0,S8,s=null,F1=61440,k1=/[\u0080-\uFFFF]/,M8=Symbol("record-id");class m0 extends _8{constructor($){super($);this.offset=0;let q,J,Q,U,G,X;$=$||{};let N=rq.prototype.utf8Write?function(M,f,C){return L.utf8Write(M,f,C)}:S0&&S0.encodeInto?function(M,f){return S0.encodeInto(M,L.subarray(f)).written}:!1,K=this,O=$.structures||$.saveStructures,Z=$.maxSharedStructures;if(Z==null)Z=O?128:0;if(Z>8190)throw new Error("Maximum maxSharedStructure is 8190");let W=$.sequential;if(W)Z=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let D,I,z=$.sharedValues,F;if(z){F=Object.create(null);for(let M=0,f=z.length;M<f;M++)F[z[M]]=M}let H=[],j=0,B=0;this.mapEncode=function(M,f){if(this._keyMap&&!this._mapped)switch(M.constructor.name){case"Array":M=M.map((C)=>this.encodeKeys(C));break}return this.encode(M,f)},this.encode=function(M,f){if(!L)L=new f$(8192),n=new DataView(L.buffer,0,8192),Y=0;if(S8=L.length-10,S8-Y<2048)L=new f$(L.length),n=new DataView(L.buffer,0,L.length),S8=L.length-10,Y=0;else if(f===I$)Y=Y+7&2147483640;if(J=Y,K.useSelfDescribedHeader)n.setUint32(Y,3654940416),Y+=3;if(X=K.structuredClone?new Map:null,K.bundleStrings&&typeof M!=="string")s=[],s.size=1/0;else s=null;if(Q=K.structures,Q){if(Q.uninitialized){let w=K.getShared()||{};K.structures=Q=w.structures||[],K.sharedVersion=w.version;let T=K.sharedValues=w.packedValues;if(T){F={};for(let V=0,y=T.length;V<y;V++)F[T[V]]=V}}let C=Q.length;if(C>Z&&!W)C=Z;if(!Q.transitions){Q.transitions=Object.create(null);for(let w=0;w<C;w++){let T=Q[w];if(!T)continue;let V,y=Q.transitions;for(let k=0,_=T.length;k<_;k++){if(y[M8]===void 0)y[M8]=w;let g=T[k];if(V=y[g],!V)V=y[g]=Object.create(null);y=V}y[M8]=w|1048576}}if(!W)Q.nextId=C}if(U)U=!1;if(G=Q||[],I=F,$.pack){let C=new Map;if(C.values=[],C.encoder=K,C.maxValues=$.maxPrivatePackedValues||(F?16:1/0),C.objectMap=F||!1,C.samplingPackedValues=D,g0(M,C),C.values.length>0){L[Y++]=216,L[Y++]=51,R8(4);let w=C.values;R(w),R8(0),R8(0),I=Object.create(F||null);for(let T=0,V=w.length;T<V;T++)I[w[T]]=T}}D$=f&R$;try{if(D$)return;if(R(M),s)tq(J,R);if(K.offset=Y,X&&X.idsToInsert){if(Y+=X.idsToInsert.length*2,Y>S8)m(Y);K.offset=Y;let C=g1(L.subarray(J,Y),X.idsToInsert);return X=null,C}if(f&I$)return L.start=J,L.end=Y,L;return L.subarray(J,Y)}finally{if(Q){if(B<10)B++;if(Q.length>Z)Q.length=Z;if(j>1e4){if(Q.transitions=null,B=0,j=0,H.length>0)H=[]}else if(H.length>0&&!W){for(let C=0,w=H.length;C<w;C++)H[C][M8]=void 0;H=[]}}if(U&&K.saveShared){if(K.structures.length>Z)K.structures=K.structures.slice(0,Z);let C=L.subarray(J,Y);if(K.updateSharedData()===!1)return K.encode(M);return C}if(f&c1)Y=J}},this.findCommonStringsToPack=()=>{if(D=new Map,!F)F=Object.create(null);return(M)=>{let f=M&&M.threshold||4,C=this.pack?M.maxPrivatePackedValues||16:0;if(!z)z=this.sharedValues=[];for(let[w,T]of D)if(T.count>f)F[w]=C++,z.push(w),U=!0;while(this.saveShared&&this.updateSharedData()===!1);D=null}};let R=(M)=>{if(Y>S8)L=m(Y);var f=typeof M,C;if(f==="string"){if(I){let y=I[M];if(y>=0){if(y<16)L[Y++]=y+224;else if(L[Y++]=198,y&1)R(15-y>>1);else R(y-16>>1);return}else if(D&&!$.pack){let k=D.get(M);if(k)k.count++;else D.set(M,{count:1})}}let w=M.length;if(s&&w>=4&&w<1024){if((s.size+=w)>F1){let k,_=(s[0]?s[0].length*3+s[1].length:0)+10;if(Y+_>S8)L=m(Y+_);if(L[Y++]=217,L[Y++]=223,L[Y++]=249,L[Y++]=s.position?132:130,L[Y++]=26,k=Y-J,Y+=4,s.position)tq(J,R);s=["",""],s.size=0,s.position=k}let y=k1.test(M);s[y?0:1]+=M,L[Y++]=y?206:207,R(w);return}let T;if(w<32)T=1;else if(w<256)T=2;else if(w<65536)T=3;else T=5;let V=w*3;if(Y+V>S8)L=m(Y+V);if(w<64||!N){let y,k,_,g=Y+T;for(y=0;y<w;y++)if(k=M.charCodeAt(y),k<128)L[g++]=k;else if(k<2048)L[g++]=k>>6|192,L[g++]=k&63|128;else if((k&64512)===55296&&((_=M.charCodeAt(y+1))&64512)===56320)k=65536+((k&1023)<<10)+(_&1023),y++,L[g++]=k>>18|240,L[g++]=k>>12&63|128,L[g++]=k>>6&63|128,L[g++]=k&63|128;else L[g++]=k>>12|224,L[g++]=k>>6&63|128,L[g++]=k&63|128;C=g-Y-T}else C=N(M,Y+T,V);if(C<24)L[Y++]=96|C;else if(C<256){if(T<2)L.copyWithin(Y+2,Y+1,Y+1+C);L[Y++]=120,L[Y++]=C}else if(C<65536){if(T<3)L.copyWithin(Y+3,Y+2,Y+2+C);L[Y++]=121,L[Y++]=C>>8,L[Y++]=C&255}else{if(T<5)L.copyWithin(Y+5,Y+3,Y+3+C);L[Y++]=122,n.setUint32(Y,C),Y+=4}Y+=C}else if(f==="number")if(!this.alwaysUseFloat&&M>>>0===M)if(M<24)L[Y++]=M;else if(M<256)L[Y++]=24,L[Y++]=M;else if(M<65536)L[Y++]=25,L[Y++]=M>>8,L[Y++]=M&255;else L[Y++]=26,n.setUint32(Y,M),Y+=4;else if(!this.alwaysUseFloat&&M>>0===M)if(M>=-24)L[Y++]=31-M;else if(M>=-256)L[Y++]=56,L[Y++]=~M;else if(M>=-65536)L[Y++]=57,n.setUint16(Y,~M),Y+=2;else L[Y++]=58,n.setUint32(Y,~M),Y+=4;else{let w;if((w=this.useFloat32)>0&&M<4294967296&&M>=-2147483648){L[Y++]=250,n.setFloat32(Y,M);let T;if(w<4||(T=M*k0[(L[Y]&127)<<1|L[Y+1]>>7])>>0===T){Y+=4;return}else Y--}L[Y++]=251,n.setFloat64(Y,M),Y+=8}else if(f==="object")if(!M)L[Y++]=246;else{if(X){let T=X.get(M);if(T){if(L[Y++]=216,L[Y++]=29,L[Y++]=25,!T.references){let V=X.idsToInsert||(X.idsToInsert=[]);T.references=[],V.push(T)}T.references.push(Y-J),Y+=2;return}else X.set(M,{offset:Y-J})}let w=M.constructor;if(w===Object)v(M);else if(w===Array){if(C=M.length,C<24)L[Y++]=128|C;else R8(C);for(let T=0;T<C;T++)R(M[T])}else if(w===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)L[Y++]=217,L[Y++]=1,L[Y++]=3;if(C=M.size,C<24)L[Y++]=160|C;else if(C<256)L[Y++]=184,L[Y++]=C;else if(C<65536)L[Y++]=185,L[Y++]=C>>8,L[Y++]=C&255;else L[Y++]=186,n.setUint32(Y,C),Y+=4;if(K.keyMap)for(let[T,V]of M)R(K.encodeKey(T)),R(V);else for(let[T,V]of M)R(T),R(V)}else{for(let T=0,V=z$.length;T<V;T++){let y=$J[T];if(M instanceof y){let k=z$[T],_=k.tag;if(_==null)_=k.getTag&&k.getTag.call(this,M);if(_<24)L[Y++]=192|_;else if(_<256)L[Y++]=216,L[Y++]=_;else if(_<65536)L[Y++]=217,L[Y++]=_>>8,L[Y++]=_&255;else if(_>-1)L[Y++]=218,n.setUint32(Y,_),Y+=4;k.encode.call(this,M,R,m);return}}if(M[Symbol.iterator]){if(D$){let T=new Error("Iterable should be serialized as iterator");throw T.iteratorNotHandled=!0,T}L[Y++]=159;for(let T of M)R(T);L[Y++]=255;return}if(M[Symbol.asyncIterator]||T$(M)){let T=new Error("Iterable/blob should be serialized as iterator");throw T.iteratorNotHandled=!0,T}if(this.useToJSON&&M.toJSON){let T=M.toJSON();if(T!==M)return R(T)}v(M)}}else if(f==="boolean")L[Y++]=M?245:244;else if(f==="bigint"){if(M<BigInt(1)<<BigInt(64)&&M>=0)L[Y++]=27,n.setBigUint64(Y,M);else if(M>-(BigInt(1)<<BigInt(64))&&M<0)L[Y++]=59,n.setBigUint64(Y,-M-BigInt(1));else if(this.largeBigIntToFloat)L[Y++]=251,n.setFloat64(Y,Number(M));else{if(M>=BigInt(0))L[Y++]=194;else L[Y++]=195,M=BigInt(-1)-M;let w=[];while(M)w.push(Number(M&BigInt(255))),M>>=BigInt(8);B$(new Uint8Array(w.reverse()),m);return}Y+=8}else if(f==="undefined")L[Y++]=247;else throw new Error("Unknown type: "+f)},v=this.useRecords===!1?this.variableMapSize?(M)=>{let f=Object.keys(M),C=Object.values(M),w=f.length;if(w<24)L[Y++]=160|w;else if(w<256)L[Y++]=184,L[Y++]=w;else if(w<65536)L[Y++]=185,L[Y++]=w>>8,L[Y++]=w&255;else L[Y++]=186,n.setUint32(Y,w),Y+=4;let T;if(K.keyMap)for(let V=0;V<w;V++)R(K.encodeKey(f[V])),R(C[V]);else for(let V=0;V<w;V++)R(f[V]),R(C[V])}:(M)=>{L[Y++]=185;let f=Y-J;Y+=2;let C=0;if(K.keyMap){for(let w in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(w))R(K.encodeKey(w)),R(M[w]),C++}else for(let w in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(w))R(w),R(M[w]),C++;L[f+++J]=C>>8,L[f+J]=C&255}:(M,f)=>{let C,w=G.transitions||(G.transitions=Object.create(null)),T=0,V=0,y,k;if(this.keyMap){k=Object.keys(M).map((g)=>this.encodeKey(g)),V=k.length;for(let g=0;g<V;g++){let s8=k[g];if(C=w[s8],!C)C=w[s8]=Object.create(null),T++;w=C}}else for(let g in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(g)){if(C=w[g],!C){if(w[M8]&1048576)y=w[M8]&65535;C=w[g]=Object.create(null),T++}w=C,V++}let _=w[M8];if(_!==void 0)_&=65535,L[Y++]=217,L[Y++]=_>>8|224,L[Y++]=_&255;else{if(!k)k=w.__keys__||(w.__keys__=Object.keys(M));if(y===void 0){if(_=G.nextId++,!_)_=0,G.nextId=1;if(_>=oq)G.nextId=(_=Z)+1}else _=y;if(G[_]=k,_<Z){L[Y++]=217,L[Y++]=_>>8|224,L[Y++]=_&255,w=G.transitions;for(let g=0;g<V;g++){if(w[M8]===void 0||w[M8]&1048576)w[M8]=_;w=w[k[g]]}w[M8]=_|1048576,U=!0}else{if(w[M8]=_,n.setUint32(Y,3655335680),Y+=3,T)j+=B*T;if(H.length>=oq-Z)H.shift()[M8]=void 0;if(H.push(w),R8(V+2),R(57344+_),R(k),f)return;for(let g in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(g))R(M[g]);return}}if(V<24)L[Y++]=128|V;else R8(V);if(f)return;for(let g in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(g))R(M[g])},m=(M)=>{let f;if(M>16777216){if(M-J>aq)throw new Error("Encoded buffer would be larger than maximum buffer size");f=Math.min(aq,Math.round(Math.max((M-J)*(M>67108864?1.25:2),4194304)/4096)*4096)}else f=(Math.max(M-J<<2,L.length-1)>>12)+1<<12;let C=new f$(f);if(n=new DataView(C.buffer,0,f),L.copy)L.copy(C,0,J,M);else C.set(L.slice(J,M));return Y-=J,J=0,S8=C.length-10,L=C},h=100,b=1000;this.encodeAsIterable=function(M,f){return l(M,f,A)},this.encodeAsAsyncIterable=function(M,f){return l(M,f,d)};function*A(M,f,C){let w=M.constructor;if(w===Object){let T=K.useRecords!==!1;if(T)v(M,!0);else sq(Object.keys(M).length,160);for(let V in M){let y=M[V];if(!T)R(V);if(y&&typeof y==="object")if(f[V])yield*A(y,f[V]);else yield*P(y,f,V);else R(y)}}else if(w===Array){let T=M.length;R8(T);for(let V=0;V<T;V++){let y=M[V];if(y&&(typeof y==="object"||Y-J>h))if(f.element)yield*A(y,f.element);else yield*P(y,f,"element");else R(y)}}else if(M[Symbol.iterator]&&!M.buffer){L[Y++]=159;for(let T of M)if(T&&(typeof T==="object"||Y-J>h))if(f.element)yield*A(T,f.element);else yield*P(T,f,"element");else R(T);L[Y++]=255}else if(T$(M))sq(M.size,64),yield L.subarray(J,Y),yield M,S();else if(M[Symbol.asyncIterator])L[Y++]=159,yield L.subarray(J,Y),yield M,S(),L[Y++]=255;else R(M);if(C&&Y>J)yield L.subarray(J,Y);else if(Y-J>h)yield L.subarray(J,Y),S()}function*P(M,f,C){let w=Y-J;try{if(R(M),Y-J>h)yield L.subarray(J,Y),S()}catch(T){if(T.iteratorNotHandled)f[C]={},Y=J+w,yield*A.call(this,M,f[C]);else throw T}}function S(){h=b,K.encode(null,R$)}function l(M,f,C){if(f&&f.chunkThreshold)h=b=f.chunkThreshold;else h=100;if(M&&typeof M==="object")return K.encode(null,R$),C(M,K.iterateProperties||(K.iterateProperties={}),!0);return[K.encode(M)]}async function*d(M,f){for(let C of A(M,f,!0)){let w=C.constructor;if(w===rq||w===Uint8Array)yield C;else if(T$(C)){let T=C.stream().getReader(),V;while(!(V=await T.read()).done)yield V.value}else if(C[Symbol.asyncIterator])for await(let T of C)if(S(),T)yield*d(T,f.async||(f.async={}));else yield K.encode(T);else yield C}}}useBuffer($){L=$,n=new DataView(L.buffer,L.byteOffset,L.byteLength),Y=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let q=this.structures.slice(0),J=new A$(q,this.sharedValues,this.sharedVersion),Q=this.saveShared(J,(U)=>(U&&U.version||0)==$);if(Q===!1)J=this.getShared()||{},this.structures=J.structures||[],this.sharedValues=J.packedValues,this.sharedVersion=J.version,this.structures.nextId=this.structures.length;else q.forEach((U,G)=>this.structures[G]=U);return Q}}function sq($,q){if($<24)L[Y++]=q|$;else if($<256)L[Y++]=q|24,L[Y++]=$;else if($<65536)L[Y++]=q|25,L[Y++]=$>>8,L[Y++]=$&255;else L[Y++]=q|26,n.setUint32(Y,$),Y+=4}class A${constructor($,q,J){this.structures=$,this.packedValues=q,this.version=J}}function R8($){if($<24)L[Y++]=128|$;else if($<256)L[Y++]=152,L[Y++]=$;else if($<65536)L[Y++]=153,L[Y++]=$>>8,L[Y++]=$&255;else L[Y++]=154,n.setUint32(Y,$),Y+=4}var _1=typeof Blob==="undefined"?function(){}:Blob;function T$($){if($ instanceof _1)return!0;let q=$[Symbol.toStringTag];return q==="Blob"||q==="File"}function g0($,q){switch(typeof $){case"string":if($.length>3){if(q.objectMap[$]>-1||q.values.length>=q.maxValues)return;let Q=q.get($);if(Q){if(++Q.count==2)q.values.push($)}else if(q.set($,{count:1}),q.samplingPackedValues){let U=q.samplingPackedValues.get($);if(U)U.count++;else q.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let Q=0,U=$.length;Q<U;Q++)g0($[Q],q);else{let Q=!q.encoder.useRecords;for(var J in $)if($.hasOwnProperty(J)){if(Q)g0(J,q);g0($[J],q)}}break;case"function":console.log($)}}var S1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;$J=[Date,Set,Error,RegExp,D8,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,A$];z$=[{tag:1,encode($,q){let J=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&J>=0&&J<4294967296)L[Y++]=26,n.setUint32(Y,J),Y+=4;else L[Y++]=251,n.setFloat64(Y,J),Y+=8}},{tag:258,encode($,q){let J=Array.from($);q(J)}},{tag:27,encode($,q){q([$.name,$.message])}},{tag:27,encode($,q){q(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,q){q($.value)}},{encode($,q,J){B$($,J)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||M0&&this.tagUint8Array!==!1)return 64}},encode($,q,J){B$($,J)}},T8(68,1),T8(69,2),T8(70,4),T8(71,8),T8(72,1),T8(77,2),T8(78,4),T8(79,8),T8(85,4),T8(86,8),{encode($,q){let J=$.packedValues||[],Q=$.structures||[];if(J.values.length>0){L[Y++]=216,L[Y++]=51,R8(4);let U=J.values;q(U),R8(0),R8(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let G=0,X=U.length;G<X;G++)packedObjectMap[U[G]]=G}if(Q){n.setUint32(Y,3655335424),Y+=3;let U=Q.slice(0);U.unshift(57344),U.push(new D8($.version,1399353956)),q(U)}else q(new D8($.version,1399353956))}}];function T8($,q){if(!S1&&q>1)$-=4;return{tag:$,encode:function J(Q,U){let G=Q.byteLength,X=Q.byteOffset||0,N=Q.buffer||Q;U(M0?v0.from(N,X,G):new Uint8Array(N,X,G))}}}function B$($,q){let J=$.byteLength;if(J<24)L[Y++]=64+J;else if(J<256)L[Y++]=88,L[Y++]=J;else if(J<65536)L[Y++]=89,L[Y++]=J>>8,L[Y++]=J&255;else L[Y++]=90,n.setUint32(Y,J),Y+=4;if(Y+J>=L.length)q(Y+J);L.set($.buffer?$:new Uint8Array($),Y),Y+=J}function g1($,q){let J,Q=q.length*2,U=$.length-Q;q.sort((G,X)=>G.offset>X.offset?1:-1);for(let G=0;G<q.length;G++){let X=q[G];X.id=G;for(let N of X.references)$[N++]=G>>8,$[N]=G&255}while(J=q.pop()){let G=J.offset;$.copyWithin(G+Q,G,U),Q-=2;let X=G+Q;$[X++]=216,$[X++]=28,U=G}return $}function tq($,q){n.setUint32(s.position+$,Y-s.position-$+1);let J=s;s=null,q(J[0]),q(J[1])}var j$=new m0({useRecords:!1}),v1=j$.encode,m1=j$.encodeAsIterable,b1=j$.encodeAsAsyncIterable;var I$=512,c1=1024,R$=2048;var b0=($)=>{let q=new Uint8Array($),J="";for(let Q=0;Q<q.byteLength;Q++)J+=String.fromCharCode(q[Q]);return btoa(J).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},qJ=($)=>{let q=atob($.replace(/-/g,"+").replace(/_/g,"/")),J=new Uint8Array(q.length);for(let Q=0;Q<q.length;Q++)J[Q]=q.charCodeAt(Q);return J.buffer};async function JJ($){let q=crypto.getRandomValues(new Uint8Array(32)),J=crypto.getRandomValues(new Uint8Array(16)),Q=await navigator.credentials.create({publicKey:{challenge:q,rp:{name:"Sorane Web/A Form"},user:{id:J,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:60000,attestation:"none"}});if(!Q)throw new Error("Credential creation failed");return{id:Q.id,rawId:b0(Q.rawId),response:Q.response}}async function QJ($,q){let J=await navigator.credentials.get({publicKey:{challenge:q,allowCredentials:[{id:qJ($),type:"public-key"}],userVerification:"required"}});if(!J)throw new Error("Assertion failed");let Q=J.response;return{id:J.id,signature:b0(Q.signature),authenticatorData:b0(Q.authenticatorData),clientDataJSON:b0(Q.clientDataJSON)}}async function c0($,q){let J=crypto.getRandomValues(new Uint8Array(32)),Q=await navigator.credentials.get({publicKey:{challenge:J,allowCredentials:[{id:qJ($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:q}}}}});if(!Q)throw new Error("Assertion failed");let G=Q.getClientExtensionResults()?.prf?.results?.first;if(!G)throw new Error("PRF extension not available");return new Uint8Array(G)}function O0($){return Array.from($).map((q)=>q.toString(16).padStart(2,"0")).join("")}function UJ($){let q=new Uint8Array($.length/2);for(let J=0;J<q.length;J++)q[J]=parseInt($.substring(J*2,J*2+2),16);return q}class XJ{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),q=localStorage.getItem("weba_passkey_pub");if($&&q){this.credentialId=$,this.publicKey=UJ(q),this.publicKeyType="p256",this.usePasskey=!0;return}let J=localStorage.getItem("weba_private_key");if(J)this.edPrivateKey=UJ(J),this.publicKey=k8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey...");let $=await JJ("User"),q=new Uint8Array($.response.attestationObject),Q=_0(q).authData,U=new DataView(Q.buffer,Q.byteOffset,Q.byteLength),G=53,X=U.getUint16(G);G+=2,G+=X;let N=Q.slice(G),K=_0(N),O=K.get(-2),Z=K.get(-3);if(!O||!Z)throw new Error("Invalid COSE Key: x or y missing");let W=new Uint8Array(65);if(W[0]=4,W.set(O,1),W.set(Z,33),this.credentialId=$.rawId,this.publicKey=W,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",O0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=k8.utils.randomSecretKey(),this.publicKey=k8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",O0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${O0(this.publicKey)}`}getPublicKey(){return this.publicKey?O0(this.publicKey):""}async sign($,q="authentication"){if(!this.publicKey)await this.register();let J=GJ.default($),Q=new TextEncoder().encode(J);if(this.usePasskey&&this.credentialId){let U=await crypto.subtle.digest("SHA-256",Q),G=await QJ(this.credentialId,U);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:G.signature,"srn:authenticatorData":G.authenticatorData,"srn:clientDataJSON":G.clientDataJSON,"srn:credentialId":G.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let U=k8.sign(Q,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:O0(U)}}}}}var a8=new XJ;class V${oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,q){if(t8($),u(q,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let J=this.blockLen,Q=new Uint8Array(J);Q.set(q.length>J?$.create().update(q).digest():q);for(let U=0;U<Q.length;U++)Q[U]^=54;this.iHash.update(Q),this.oHash=$.create();for(let U=0;U<Q.length;U++)Q[U]^=106;this.oHash.update(Q),E8(Q)}update($){return h8(this),this.iHash.update($),this}digestInto($){h8(this),u($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:q,iHash:J,finished:Q,destroyed:U,blockLen:G,outputLen:X}=this;return $=$,$.finished=Q,$.destroyed=U,$.blockLen=G,$.outputLen=X,$.oHash=q._cloneInto($.oHash),$.iHash=J._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var p0=($,q,J)=>new V$($,q).update(J).digest();p0.create=($,q)=>new V$($,q);function p1($,q,J){if(t8($),J===void 0)J=new Uint8Array($.outputLen);return p0($,J,q)}var x$=Uint8Array.of(0),KJ=Uint8Array.of();function l1($,q,J,Q=32){t8($),H8(Q,"length");let U=$.outputLen;if(Q>255*U)throw new Error("Length must be <= 255*HashLen");let G=Math.ceil(Q/U);if(J===void 0)J=KJ;else u(J,void 0,"info");let X=new Uint8Array(G*U),N=p0.create($,q),K=N._cloneInto(),O=new Uint8Array(N.outputLen);for(let Z=0;Z<G;Z++)x$[0]=Z+1,K.update(Z===0?KJ:O).update(J).update(x$).digestInto(O),X.set(O,U*Z),N._cloneInto(K);return N.destroy(),K.destroy(),E8(O,x$),X.slice(0,Q)}var Z8=($,q,J,Q,U)=>l1($,p1($,q,J),Q,U);var ZJ=l$(N$(),1),NJ="weba_l2_ed25519_sk";function O8($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let q="";return $.forEach((Q)=>{q+=String.fromCharCode(Q)}),btoa(q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function t($){let q=$.length%4===0?"":"=".repeat(4-$.length%4),J=$.replace(/-/g,"+").replace(/_/g,"/")+q;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(J,"base64"));let Q=atob(J),U=new Uint8Array(Q.length);for(let G=0;G<Q.length;G+=1)U[G]=Q.charCodeAt(G);return U}function L0($){let q=ZJ.default($);if(q===void 0)throw new Error("Failed to canonicalize JSON");return q}function YJ($){let q=new Uint8Array($);return crypto.getRandomValues(q),q}function h1(){let $=localStorage.getItem(NJ);if($)return t($);let q=k8.utils.randomSecretKey();return localStorage.setItem(NJ,O8(q)),q}function u1($,q,J){let Q={layer1_ref:$,recipient:q,weba_version:J};return new TextEncoder().encode(L0(Q))}function MJ($,q){let J=new Uint8Array($.length+q.length);return J.set($,0),J.set(q,$.length),J}function OJ($){let q=$.keyPolicy??"campaign+layer1";if(q==="campaign+layer1"&&!$.layer1Ref)throw new Error("layer1_ref is required for campaign+layer1 policy");let J=L0({domain:"weba-l2/org-x25519",campaign_id:$.campaignId,key_policy:q,layer1_ref:q==="campaign+layer1"?$.layer1Ref:void 0}),Q=new TextEncoder().encode(J),U=Z8(N8,$.orgRootKey,void 0,Q,32);return{publicKey:X0.getPublicKey(U),privateKey:U,keyPolicy:q}}function LJ(){return globalThis.webaPqcKem||null}async function WJ($,q,J,Q){let U=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["encrypt"]),G=await crypto.subtle.encrypt({name:"AES-GCM",iv:J,additionalData:Q},U,$);return new Uint8Array(G)}async function CJ($){let q=Z8(N8,$.prfKey,void 0,void 0,32),J=Z8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=Z8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),U=$.aad??new Uint8Array;return WJ($.recipientSk,J,Q,U)}async function EJ($,q,J,Q){let U=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["decrypt"]),G=await crypto.subtle.decrypt({name:"AES-GCM",iv:J,additionalData:Q},U,$);return new Uint8Array(G)}async function wJ($){let q=$.config.weba_version??"0.1",J=$.config.recipient_kid,Q=$.config.layer1_ref,U=$.user_kid??"user#sig-1",G=h1(),X=L0($.layer2_plain),N=new TextEncoder().encode(X),K=k8.sign(N,G),O={alg:"Ed25519",kid:U,sig:O8(K),created_at:new Date().toISOString()},Z={layer2_plain:$.layer2_plain,layer2_sig:O},W=u1(Q,J,q),D=new TextEncoder().encode(L0(Z)),I=t($.config.recipient_x25519),z=YJ(32),F=X0.getPublicKey(z),H=X0.getSharedSecret(z,I),j=H,B,R="X25519";if($.config.recipient_pqc){let A=$.pqcProvider??LJ();if(!A)throw new Error("PQC requested but no provider is available");let P=t($.config.recipient_pqc),S=A.encapsulate(P);B=S.encapsulation,j=MJ(H,S.sharedSecret),R=`X25519+${A.kemId}`}let v=Z8(N8,j,W,void 0,32),m=Z8(N8,v,void 0,new TextEncoder().encode("weba-l2/key"),32),h=Z8(N8,v,void 0,new TextEncoder().encode("weba-l2/iv"),12),b=await WJ(D,m,h,W);return{weba_version:q,layer1_ref:Q,layer2:{enc:"HPKE-v1",suite:{kem:R,kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:J,encapsulated:{classical:O8(F),...B?{pqc:O8(B)}:{}},ciphertext:O8(b),aad:O8(W)},meta:{created_at:new Date().toISOString(),nonce:O8(YJ(16)),...$.config.campaign_id?{campaign_id:$.config.campaign_id}:{},...$.config.key_policy?{key_policy:$.config.key_policy}:{}}}}function HJ(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function l0($,q,J){let Q=t($.layer2.aad),U={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},G=new TextEncoder().encode(L0(U));if(O8(G)!==$.layer2.aad)throw new Error("AAD mismatch");let X=t($.layer2.encapsulated.classical),N=X0.getSharedSecret(q,X),K=N;if($.layer2.encapsulated.pqc){let z=J?.pqcProvider??LJ(),F=J?.pqcRecipientSk;if(!z||!F)throw new Error("Missing PQC KEM for envelope");let H=t($.layer2.encapsulated.pqc),j=z.decapsulate(F,H);K=MJ(N,j)}let O=Z8(N8,K,Q,void 0,32),Z=Z8(N8,O,void 0,new TextEncoder().encode("weba-l2/key"),32),W=Z8(N8,O,void 0,new TextEncoder().encode("weba-l2/iv"),12),D=t($.layer2.ciphertext),I=await EJ(D,Z,W,Q);return JSON.parse(new TextDecoder().decode(I))}async function fJ($){let q=Z8(N8,$.prfKey,void 0,void 0,32),J=Z8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=Z8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),U=$.keywrap.aad?t($.keywrap.aad):new Uint8Array,G=t($.keywrap.wrapped_key);return EJ(G,J,Q,U)}function d1($){$.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.checked=!1,J.removeAttribute("checked");else J.value="",J.removeAttribute("value")}),$.querySelectorAll("textarea").forEach((J)=>{J.value="",J.textContent=""}),$.querySelectorAll("select").forEach((J)=>{J.selectedIndex=-1,J.querySelectorAll("option").forEach((Q)=>Q.removeAttribute("selected"))}),$.getElementById("json-ld")?.remove(),$.getElementById("data-layer")?.remove();let q=$.getElementById("json-debug");if(q)q.textContent=""}function n1($,q){let J=JSON.stringify(q,null,2),Q=$.createElement("script");Q.type="application/ld+json",Q.id="weba-user-vc",Q.textContent=J,$.body.appendChild(Q);let U=$.createElement("div");U.className="weba-user-verification no-print",U.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",U.innerHTML=`
    <details>
      <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
        <span></span> 
      </summary>
      <div style="padding: 1rem 0;">
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
      </div>
    </details>
  `;let G=U.querySelector("pre");if(G)G.textContent=J;$.body.appendChild(U)}function i1($,q){let J=$.createElement("script");J.id="weba-l2-envelope",J.type="application/json",J.textContent=JSON.stringify(q,null,2),$.body.appendChild(J)}function r1($,q){let J=new Date,Q=J.getFullYear()+("0"+(J.getMonth()+1)).slice(-2)+("0"+J.getDate()).slice(-2)+"-"+("0"+J.getHours()).slice(-2)+("0"+J.getMinutes()).slice(-2),U=Math.random().toString(36).substring(2,8);return`${$}_${Q}_${q}_${U}.html`}function o1($,q){let Q=new DOMParser().parseFromString($,"text/html");if(q?.stripPlaintext)d1(Q);if(q?.embeddedVc)n1(Q,q.embeddedVc);if(q?.l2Envelope)i1(Q,q.l2Envelope);return Q.documentElement.outerHTML}function DJ($){let q=o1($.documentHtml,$.options),J=new Blob([q],{type:"text/html"}),Q=URL.createObjectURL(J),U=document.createElement("a");if(U.href=Q,U.download=r1($.title,$.filenameSuffix),U.click(),$.isFinal)setTimeout(()=>window.location.reload(),1000)}class P${formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let q=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((U)=>{let G=U.dataset.jsonPath;if(G)q[G]=U.value}),document.querySelectorAll('[type="radio"]:checked').forEach((U)=>{q[U.name]=U.value}),document.querySelectorAll("table.data-table.dynamic").forEach((U)=>{let G=U.dataset.tableKey;if(G){let X=[];U.querySelectorAll("tbody tr").forEach((N)=>{let K={},O=!1;if(N.querySelectorAll("[data-base-key]").forEach((Z)=>{if(Z.type==="checkbox"){if(K[Z.dataset.baseKey]=Z.checked,Z.checked)O=!0}else if(K[Z.dataset.baseKey]=Z.value,Z.value)O=!0}),O)X.push(K)}),q[G]=X}});let J=document.getElementById("json-ld");if(J)J.textContent=JSON.stringify(q,null,2);let Q=document.getElementById("json-debug");if(Q)Q.textContent=JSON.stringify(q,null,2);return q}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),q=window,J=q.generatedJsonStructure&&q.generatedJsonStructure.name||"Response",Q=window.location.href.split("#")[0],U=this.getL2Config(),G=document.getElementById("weba-l2-encrypt");if(!!(U?.enabled&&(G?G.checked:U.default_enabled))){if(!U?.recipient_kid||!U?.recipient_x25519||!U?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let K=await wJ({layer2_plain:$,config:U,user_kid:U.user_kid});this.downloadHtml("submit",!0,{l2Envelope:K,stripPlaintext:!0})}catch(K){console.error(K),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!a8.getPublicKey()){if(!await a8.register()){alert("Key registration failed.");return}}let N={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:a8.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:Q,answers:$}};try{let K=await a8.sign(N);this.downloadHtml("submitted",!0,{embeddedVc:K})}catch(K){console.error(K),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let q=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(q[Q]!==void 0)J.value=q[Q]}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey,U=q[Q];if(Array.isArray(U)){let G=J.querySelector("tbody");if(!G)return;let X=G.querySelectorAll(".template-row");U.forEach((N,K)=>{let O;if(K===0)O=G.querySelector(".template-row");else{let Z=G.querySelector(".template-row");if(Z){O=Z.cloneNode(!0),O.classList.remove("template-row");let W=O.querySelector(".remove-row-btn");if(W)W.style.visibility="visible";G.appendChild(O)}}if(O)O.querySelectorAll("input, select").forEach((Z)=>{let W=Z.dataset.baseKey;if(W&&N[W]!==void 0)if(Z.type==="checkbox")Z.checked=!!N[W];else Z.value=N[W]})})}})}catch(q){console.error(q)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,q,J){let Q=window,U=Q.generatedJsonStructure&&Q.generatedJsonStructure.name||"web-a-form";DJ({documentHtml:document.documentElement.outerHTML,title:U,filenameSuffix:$,isFinal:q,options:J})}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class y${calc;data;constructor($,q){this.calc=$,this.data=q}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},q=(navigator.language||"en").startsWith("ja")?"ja":"en",J=$[q]||$.en;document.querySelectorAll("[data-i18n]").forEach((Q)=>{let U=Q.dataset.i18n;if(J[U])Q.textContent=J[U]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((J)=>{return J.querySelectorAll("td").length>0}).forEach((J,Q)=>{let U=Q+1;J.querySelectorAll(".auto-num").forEach((G)=>{if(G.value!=U)G.value=U.toString(),G.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let q=$.closest("tr"),J=q.parentElement;if(q.classList.contains("template-row"))q.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox")Q.checked=!1;else Q.value=""});else{if(q.remove(),J)this.renumberRows(J);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,q){let J=document.getElementById("tbl_"+q);if(!J)return;let Q=J.querySelector("tbody");if(!Q)return;let U=Q.querySelector(".template-row");if(!U)return;let G=U.cloneNode(!0);G.classList.remove("template-row"),G.querySelectorAll("input").forEach((N)=>{if(N.type==="checkbox")N.checked=N.hasAttribute("checked");else N.value=N.getAttribute("value")||""});let X=G.querySelector(".remove-row-btn");if(X)X.style.visibility="visible";G.querySelectorAll("[data-copy-from]").forEach((N)=>{let K=N.dataset.copyFrom;if(K){let O=G.querySelector(`[data-base-key="${K}"]`);if(O&&O.value)N.value=O.value}}),Q.appendChild(G),this.renumberRows(Q),this.calc.recalculate()}switchTab($,q){document.querySelectorAll(".tab-btn").forEach((Q)=>Q.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((Q)=>Q.classList.remove("active")),$.classList.add("active");let J=document.getElementById(q);if(J)J.classList.add("active")}}function TJ($){let q=document.getElementById($);if(!q||!q.textContent)return null;try{return JSON.parse(q.textContent)}catch{return null}}function RJ(){let $=TJ("weba-l2-envelope");if(!$)return;let q=TJ("weba-l2-keywrap"),J=document.querySelector(".weba-form-container")||document.body,Q=document.createElement("div");Q.className="weba-l2-unlock",Q.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let U=document.createElement("div");U.textContent="Encrypted Submission",U.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",Q.appendChild(U);let G=document.createElement("div");G.textContent="Locked. Unlock with Passkey.",G.style.cssText="color:#64748b;margin-bottom:0.75rem;",Q.appendChild(G);let X=document.createElement("button");X.textContent="Unlock (Passkey)",X.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",Q.appendChild(X);let N=document.createElement("pre");N.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",Q.appendChild(N);let K=document.createElement("details");K.style.cssText="margin-top:0.75rem; display:none;",K.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',Q.appendChild(K);let O=document.createElement("button");O.textContent="Export JSON",O.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",O.disabled=!0,Q.appendChild(O),X.addEventListener("click",async()=>{if(!q){G.textContent="Key wrap package not found.";return}X.disabled=!0,G.textContent="Waiting for passkey...";try{let Z=t(q.prf_salt),W=await c0(q.credential_id,Z),D=await fJ({keywrap:q,prfKey:W}),I=await l0($,D);a1(I.layer2_plain),document.body.classList.add("weba-l2-readonly"),N.textContent=JSON.stringify(I.layer2_plain,null,2),N.style.display="block";let z=K.querySelector("pre");if(z)z.textContent=JSON.stringify(I.layer2_sig,null,2);K.style.display="block",O.style.display="inline-block",O.disabled=!1,G.textContent="Unlocked.",O.onclick=()=>{let F=new Blob([JSON.stringify(I,null,2)],{type:"application/json"}),H=URL.createObjectURL(F),j=document.createElement("a");j.href=H,j.download="weba-l2-decrypted.json",j.click()}}catch(Z){console.error(Z),G.textContent="Unlock failed.",X.disabled=!1}}),J.appendChild(Q)}function a1($){if(!$||typeof $!=="object")return;let q=$;document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(!Q||!(Q in q))return;let U=q[Q];if(J.type==="checkbox")J.checked=Boolean(U);else if(J.type==="radio")J.checked=J.value===String(U);else J.value=U===null||U===void 0?"":String(U)}),document.querySelectorAll('input[type="radio"]').forEach((J)=>{let Q=J.name;if(!Q||!(Q in q))return;let U=q[Q];J.checked=J.value===String(U)}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey;if(!Q)return;let U=q[Q];if(!Array.isArray(U))return;let G=J.querySelector("tbody");if(!G)return;let X=G.querySelector("tr.template-row");if(!X)return;Array.from(G.querySelectorAll("tr")).forEach((N)=>{if(!N.classList.contains("template-row"))N.remove()}),U.forEach((N,K)=>{let O=K===0?X:X.cloneNode(!0);if(K>0){O.classList.remove("template-row");let Z=O.querySelector(".remove-row-btn");if(Z)Z.style.visibility="visible";G.appendChild(O)}if(N&&typeof N==="object")O.querySelectorAll("input, select, textarea").forEach((Z)=>{let W=Z.dataset.baseKey;if(!W)return;let D=N[W];if(Z.type==="checkbox")Z.checked=Boolean(D);else Z.value=D===null||D===void 0?"":String(D)})})}),document.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.disabled=!0;else J.readOnly=!0}),document.querySelectorAll("textarea").forEach((J)=>{J.readOnly=!0}),document.querySelectorAll("select").forEach((J)=>{J.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((J)=>{J.disabled=!0})}function z8($){return document.getElementById($)}function zJ(){if(!z8("weba-l2-keywrap-tool"))return;let q=z8("kwp-recipient-sk"),J=z8("kwp-credential-id"),Q=z8("kwp-prf-salt"),U=z8("kwp-aad"),G=z8("kwp-kid"),X=z8("kwp-status"),N=z8("kwp-output"),K=z8("kwp-generate-salt"),O=z8("kwp-wrap");if(!q||!J||!Q||!X||!N||!O)return;K?.addEventListener("click",()=>{let Z=new Uint8Array(32);crypto.getRandomValues(Z),Q.value=O8(Z)}),O.addEventListener("click",async()=>{X.textContent="Waiting for passkey...",O.disabled=!0;try{if(!q.value||!J.value||!Q.value)throw new Error("Missing required fields.");let Z=t(q.value.trim()),W=t(Q.value.trim()),D=await c0(J.value.trim(),W),I=U?.value?t(U.value.trim()):void 0,z=await CJ({recipientSk:Z,prfKey:D,aad:I}),F={alg:"WebAuthn-PRF-AESGCM-v1",kid:G?.value||"issuer#passkey-1",credential_id:J.value.trim(),prf_salt:O8(W),wrapped_key:O8(z),...I?{aad:O8(I)}:{}};N.textContent=JSON.stringify(F,null,2),X.textContent="Key wrap ready."}catch(Z){console.error(Z),X.textContent="Key wrap failed."}finally{O.disabled=!1}})}function IJ($){let q={},J=(Q,U)=>{if(Q===null||Q===void 0){q[U]=null;return}if(Array.isArray(Q)){Q.forEach((G,X)=>{J(G,U?`${U}[${X}]`:`[${X}]`)});return}if(typeof Q==="object"){Object.entries(Q).forEach(([G,X])=>{let N=U?`${U}.${G}`:G;J(X,N)});return}q[U]=Q};if(J($,""),""in q)delete q[""];return q}function F$($){let q={_filename:$.filename},J=new Set(["_filename"]);if($.includeJson)J.add("_json"),q._json=JSON.stringify($.plain);let Q=IJ($.plain||{});for(let U of Object.keys(Q)){if($.omitKey&&$.omitKey(U))continue;J.add(U),q[U]=Q[U]}if($.sig)J.add("_l2_sig"),q._l2_sig=JSON.stringify($.sig);return{row:q,keys:J}}function BJ($){if($===null||$===void 0)return"";let q=String($);if(/[",\n]/.test(q))return`"${q.replace(/"/g,'""')}"`;return q}function AJ($,q){let J=[];return J.push(q.map(BJ).join(",")),$.forEach((Q)=>{let U=q.map((G)=>BJ(Q[G])).join(",");J.push(U)}),"\uFEFF"+J.join(`
`)}function jJ($){if(typeof DOMParser!=="undefined")return new DOMParser().parseFromString($,"text/html");if(typeof document!=="undefined"){let q=document.implementation.createHTMLDocument("");return q.documentElement.innerHTML=$,q}return null}function VJ($,q){let J=jJ($);if(J)return J.getElementById(q)?.textContent??null;let Q=new RegExp(`<script[^>]*id=["']${q}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),U=$.match(Q);return U?U[1]:null}function s1($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function t1($,q){let J=jJ($);if(J)return J.querySelector(`script[type="${q}"]`)?.textContent??null;let Q=new RegExp(`<script[^>]*type=["']${s1(q)}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),U=$.match(Q);return U?U[1]:null}function xJ($){let q=VJ($,"data-layer");if(q)try{return JSON.parse(q)}catch{return null}let J=t1($,"application/ld+json");if(J)try{return JSON.parse(J)}catch{return null}return null}function PJ($){let q=VJ($,"weba-l2-envelope");if(!q)return null;try{return JSON.parse(q)}catch{return null}}function e1($){if(!$.trim())return null;try{let q=JSON.parse($);if(!q.recipient_x25519_private&&!q.org_root_key)return null;return q}catch{return null}}function $Q(){let $=document.getElementById("weba-l2-keys");if(!$?.textContent)return null;return e1($.textContent)}async function qQ($,q){let J=PJ($);if(J&&q){if(q.recipient_kid&&J.layer2?.recipient&&q.recipient_kid!==J.layer2.recipient)throw new Error(`recipient_kid mismatch (${J.layer2.recipient})`);let U=null;if(q.org_root_key){let N=q.org_campaign_id||J.meta?.campaign_id;if(!N)throw new Error("org_campaign_id is required for org_root_key");U=OJ({orgRootKey:t(q.org_root_key),campaignId:N,layer1Ref:J.layer1_ref,keyPolicy:q.org_key_policy||J.meta?.key_policy}).privateKey}else if(q.recipient_x25519_private)U=t(q.recipient_x25519_private);else throw new Error("No recipient key provided");let G=q.recipient_pqc_private&&q.recipient_pqc_kem==="ML-KEM-768"?{pqcProvider:globalThis.webaPqcKem??null,pqcRecipientSk:t(q.recipient_pqc_private)}:void 0,X=await l0(J,U,G);return{plain:X.layer2_plain??X,sig:X.layer2_sig,source:"l2"}}let Q=xJ($);if(Q)return{plain:Q,source:"jsonld"};return{source:null}}function JQ($,q,J){if(q.length===0){$.innerHTML='<div class="agg-empty">No rows to display.</div>';return}let Q=J.map((G)=>`<th>${G}</th>`).join(""),U=q.slice(0,20).map((G)=>{return`<tr>${J.map((N)=>`<td>${G[N]??""}</td>`).join("")}</tr>`}).join("");$.innerHTML=`<table class="agg-table"><thead><tr>${Q}</tr></thead><tbody>${U}</tbody></table>`}function yJ(){let $=document.getElementById("aggregator-root");if(!$)return;$.innerHTML=`
    <div class="agg-panel">
      <div class="agg-row">
        <label class="agg-label">Input HTML</label>
        <input id="weba-agg-files" type="file" accept=".html" multiple />
      </div>
      <div class="agg-row">
        <label class="agg-label">L2 Key (embedded)</label>
        <div id="weba-agg-key-status" class="agg-chip">Not loaded</div>
        <div class="agg-note">Use <code>&lt;script id="weba-l2-keys"&gt;</code> to embed.</div>
      </div>
      <div class="agg-row">
        <label class="agg-label">Include JSON</label>
        <input id="weba-agg-include-json" type="checkbox" />
      </div>
      <div class="agg-row">
        <button id="weba-agg-run" class="agg-btn">Decrypt & Aggregate</button>
        <button id="weba-agg-download" class="agg-btn secondary" disabled>Download CSV</button>
      </div>
      <div id="weba-agg-status" class="agg-status">Ready.</div>
    </div>
    <div id="weba-agg-output" class="agg-output"></div>
  `;let q=$.querySelector("#weba-agg-files"),J=$.querySelector("#weba-agg-status"),Q=$.querySelector("#weba-agg-output"),U=$.querySelector("#weba-agg-include-json"),G=$.querySelector("#weba-agg-run"),X=$.querySelector("#weba-agg-download"),N=$.querySelector("#weba-agg-key-status"),K="",O=$Q();if(N)N.textContent=O?.recipient_kid?`Loaded (${O.recipient_kid})`:O?"Loaded":"Not loaded",N.classList.toggle("ready",!!O);let Z=async()=>{if(!q?.files||q.files.length===0){if(J)J.textContent="Select HTML files first.";return}if(J)J.textContent="Processing...";if(X)X.disabled=!0;let W=[],D=new Set(["_filename"]),I=0,z=0,F=O;for(let j of Array.from(q.files))try{let B=await j.text(),R=await qQ(B,F);if(R.source==="l2"&&R.plain){let v=F$({plain:R.plain,filename:j.name,includeJson:U?.checked,sig:R.sig});v.keys.forEach((m)=>D.add(m)),W.push(v.row),I+=1;continue}if(R.source==="jsonld"&&R.plain){let v=F$({plain:R.plain,filename:j.name,includeJson:U?.checked,omitKey:(m)=>m.startsWith("@")});v.keys.forEach((m)=>D.add(m)),W.push(v.row),I+=1;continue}z+=1}catch(B){console.error(B),z+=1}let H=Array.from(D).sort((j,B)=>{if(j==="_filename")return-1;if(B==="_filename")return 1;return j.localeCompare(B)});if(K=AJ(W,H),X)X.disabled=W.length===0;if(J)J.textContent=`Processed ${I} files. Errors: ${z}.`;if(Q)JQ(Q,W,H)};G?.addEventListener("click",()=>{Z().catch((W)=>{if(J)J.textContent="Failed to aggregate.";console.error(W)})}),X?.addEventListener("click",()=>{if(!K)return;let W=new Blob([K],{type:"text/csv"}),D=URL.createObjectURL(W),I=document.createElement("a");I.href=D,I.download="weba-aggregated.csv",I.click(),URL.revokeObjectURL(D)})}function FJ(){console.log("Web/A Runtime Booting...");let $=new i0,q=new P$,J=new y$($,q),Q=window,U=document.getElementById("weba-structure");if(U?.textContent)try{Q.generatedJsonStructure=JSON.parse(U.textContent)}catch(N){console.warn("Failed to parse weba structure JSON",N)}let G=HJ();if(G)Q.webaL2Config=G;Q.saveDraft=()=>q.saveDraft(),Q.submitDocument=()=>q.submitDocument(),Q.signAndDownload=()=>q.signAndDownload(),Q.clearData=()=>q.clearData(),Q.removeTableRow=(N)=>J.removeTableRow(N),Q.addTableRow=(N,K)=>J.addTableRow(N,K),Q.switchTab=(N,K)=>J.switchTab(N,K),Q.recalculate=()=>$.recalculate(),Q.escapeHtml=(N)=>{if(!N)return"";let K={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return N.toString().replace(/[&<>"']/g,(O)=>K[O]||O)},q.restoreFromLS(),J.applyI18n(),J.initTables(),$.recalculate(),RJ(),zJ(),yJ();let X;document.addEventListener("input",(N)=>{let K=N.target;if(N.isTrusted)K.dataset.dirty="true";let O=K.dataset.baseKey||K.dataset.jsonPath;if(O)(K.closest("tr")||document).querySelectorAll(`[data-copy-from="${O}"]`).forEach((D)=>{if(!D.dataset.dirty){if(D.value!==K.value)D.value=K.value,D.dispatchEvent(new Event("input"))}});$.recalculate(),q.updateJsonLd(),clearTimeout(X),X=setTimeout(()=>q.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class k${suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let q=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",q.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let q=$.toString().toLowerCase();return q=q.replace(/[---]/g,(J)=>{return String.fromCharCode(J.charCodeAt(0)-65248)}),q=q.replace(/[-]/g,(J)=>String.fromCharCode(J.charCodeAt(0)-65248)),q.trim()}clean($){if(!$)return"";let q=this.normalize($);return q=q.replace(/(|||||npo||)/g,""),q=q.replace(/(\(\)|\(\)|\(\))/g,""),q.trim()}toIndex($){let q=parseInt($||"",10);return Number.isFinite(q)?q-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let q=window,J=$.dataset.masterSrc,Q=$.dataset.suggestSource;if(!J&&!Q)return;let U=this.toIndex($.dataset.masterLabelIndex),G=this.toIndex($.dataset.masterValueIndex),X=$.value;if(!X){this.hideSuggestions();return}let N=[],K=this.normalize(X);if(Q==="column"){let O=$.dataset.baseKey,Z=$.closest("table");if(Z&&O){let W=new Set;Z.querySelectorAll(`[data-base-key="${O}"]`).forEach((D)=>{if(D===$)return;let I=D.value;if(I&&this.normalize(I).includes(K)){if(!W.has(I))W.add(I),N.push({val:I,row:[I],label:I,score:10})}})}}else if(J){let O=q.generatedJsonStructure.masterData;if(!O||!O[J])return;O[J].forEach((W,D)=>{if(D===0)return;if(W.some((z)=>this.normalize(z||"").includes(K))){let z=U>=0?W[U]||"":"",F=G>=0?W[G]||"":"",H=G>=0?F:U>=0?z:W[1]||W[0]||"";N.push({val:H,row:W,label:z,score:10,idx:D})}})}this.renderSuggestions($,N,U)}renderSuggestions($,q,J){if(q.length===0){this.hideSuggestions();return}let Q=window,U=q.slice(0,10),G="";U.forEach((Z)=>{let W=Q.escapeHtml(JSON.stringify(Z.row)),D=J>=0?Z.label||Z.row.join(" : "):Z.row.join(" : ");G+=`<div class="suggestion-item" data-val="${Q.escapeHtml(Z.val)}" data-row="${W}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${Q.escapeHtml(D)}</div>`});let X=this.getGlobalBox();X.innerHTML=G;let N=$.getBoundingClientRect(),K=window.scrollY||document.documentElement.scrollTop,O=window.scrollX||document.documentElement.scrollLeft;X.style.width=Math.max(N.width,200)+"px",X.style.left=N.left+O+"px",X.style.top=N.bottom+K+"px",X.querySelectorAll(".suggestion-item").forEach((Z)=>{Z.onmouseenter=()=>Z.style.background="#f0f8ff",Z.onmouseleave=()=>Z.style.background="white"}),X.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let q=window,J=this.activeSearchInput,Q=$.dataset.val||"",U=$.dataset.row||"[]";try{let G=JSON.parse(U),X=J.dataset.masterSrc,N=X?q.generatedJsonStructure.masterData[X][0]:[],K=!1;if(N.length>0&&G.length>0){let O=J.closest("tr");if(O){let Z=Array.from(O.querySelectorAll("input, select, textarea"));N.forEach((W,D)=>{if(!W)return;let I=G[D];this.fillField(Z,W,I,J,()=>{K=!0})})}}if(!K)J.value=Q,J.dispatchEvent(new Event("input",{bubbles:!0}))}catch(G){console.error(G)}this.hideSuggestions()}fillField($,q,J,Q,U){let G=this.normalize(q),X=$.find((N)=>{let K=N.dataset.baseKey||N.dataset.jsonPath,O=this.normalize(N.getAttribute("placeholder")||"");return K&&this.normalize(K)===G||O===G});if(X){if(X.value=J||"",X.dispatchEvent(new Event("input",{bubbles:!0})),X===Q)U()}}}var kJ=new k$;window.GlobalSearch=kJ;FJ();kJ.init();
