var FJ=Object.create;var{getPrototypeOf:kJ,defineProperty:c$,getOwnPropertyNames:yJ}=Object;var _J=Object.prototype.hasOwnProperty;var h$=($,q,J)=>{J=$!=null?FJ(kJ($)):{};let Q=q||!$||!$.__esModule?c$(J,"default",{value:$,enumerable:!0}):J;for(let U of yJ($))if(!_J.call(Q,U))c$(Q,U,{get:()=>$[U],enumerable:!0});return Q};var SJ=($,q)=>()=>(q||$((q={exports:{}}).exports,q),q.exports);var N$=SJ((PQ,gq)=>{gq.exports=function $(q){if(typeof q==="number"&&isNaN(q))throw new Error("NaN is not allowed");if(typeof q==="number"&&!isFinite(q))throw new Error("Infinity is not allowed");if(q===null||typeof q!=="object")return JSON.stringify(q);if(q.toJSON instanceof Function)return $(q.toJSON());if(Array.isArray(q))return`[${q.reduce((U,G,X)=>{return`${U}${X===0?"":","}${$(G===void 0||typeof G==="symbol"?null:G)}`},"")}]`;return`{${Object.keys(q).sort().reduce((Q,U)=>{if(q[U]===void 0||typeof q[U]==="symbol")return Q;let G=Q.length===0?"":",";return`${Q}${G}${$(U)}:${$(q[U])}`},"")}}`}});class i0{runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let q=$.dataset.copyFrom;if(q){let U=($.closest("tr")||document).querySelector(`[data-base-key="${q}"], [data-json-path="${q}"]`);if(U&&U.value!==$.value)$.value=U.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let q=$.dataset.formula;if(!q)return;let J=$.closest("tr"),Q=$.closest("table"),U=(X)=>{let N=0,K="none";if(J){let O=`[data-base-key="${X}"], [data-json-path="${X}"]`,Z=J.querySelector(O);if(Z){if(K="row-input",Z.value!=="")N=parseFloat(Z.value)}}if(K==="none"){let O=document.querySelector(`[data-json-path="${X}"]`);if(O){if(K="static-input",O.value!=="")N=parseFloat(O.value)}}return N},G=q.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(X,N)=>{let K=0,O=Q||document,Z=O.querySelectorAll(`[data-base-key="${N}"], [data-json-path="${N}"]`);if(Z.length===0&&O!==document)Z=document.querySelectorAll(`[data-base-key="${N}"], [data-json-path="${N}"]`);return Z.forEach((W)=>{let z=parseFloat(W.value);if(!isNaN(z))K+=z}),K});G=G.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(X)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(X))return X;return String(U(X))});try{let X=new Function("return "+G)();if(typeof X==="number"&&!isNaN(X))$.value=Number.isInteger(X)?X:X.toFixed(0);else $.value=""}catch(X){console.error("Calc Error:",X),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function W0($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function H8($,q=""){if(!Number.isSafeInteger($)||$<0){let J=q&&`"${q}" `;throw new Error(`${J}expected integer >= 0, got ${$}`)}}function u($,q,J=""){let Q=W0($),U=$?.length,G=q!==void 0;if(!Q||G&&U!==q){let X=J&&`"${J}" `,N=G?` of length ${q}`:"",K=Q?`length=${U}`:`type=${typeof $}`;throw new Error(X+"expected Uint8Array"+N+", got "+K)}return $}function t8($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");H8($.outputLen),H8($.blockLen)}function l8($,q=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(q&&$.finished)throw new Error("Hash#digest() has already been called")}function l$($,q){u($,void 0,"digestInto() output");let J=q.outputLen;if($.length<J)throw new Error('"digestInto() output" expected to be of length >='+J)}function E8(...$){for(let q=0;q<$.length;q++)$[q].fill(0)}function C0($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function w8($,q){return $<<32-q|$>>>q}var u$=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),gJ=Array.from({length:256},($,q)=>q.toString(16).padStart(2,"0"));function u8($){if(u($),u$)return $.toHex();let q="";for(let J=0;J<$.length;J++)q+=gJ[$[J]];return q}var f8={_0:48,_9:57,A:65,F:70,a:97,f:102};function p$($){if($>=f8._0&&$<=f8._9)return $-f8._0;if($>=f8.A&&$<=f8.F)return $-(f8.A-10);if($>=f8.a&&$<=f8.f)return $-(f8.a-10);return}function e8($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(u$)return Uint8Array.fromHex($);let q=$.length,J=q/2;if(q%2)throw new Error("hex string expected, got unpadded hex of length "+q);let Q=new Uint8Array(J);for(let U=0,G=0;U<J;U++,G+=2){let X=p$($.charCodeAt(G)),N=p$($.charCodeAt(G+1));if(X===void 0||N===void 0){let K=$[G]+$[G+1];throw new Error('hex string expected, got non-hex character "'+K+'" at index '+G)}Q[U]=X*16+N}return Q}function $0(...$){let q=0;for(let Q=0;Q<$.length;Q++){let U=$[Q];u(U),q+=U.length}let J=new Uint8Array(q);for(let Q=0,U=0;Q<$.length;Q++){let G=$[Q];J.set(G,U),U+=G.length}return J}function r0($,q={}){let J=(U,G)=>$(G).update(U).digest(),Q=$(void 0);return J.outputLen=Q.outputLen,J.blockLen=Q.blockLen,J.create=(U)=>$(U),Object.assign(J,q),Object.freeze(J)}function q0($=32){let q=typeof globalThis==="object"?globalThis.crypto:null;if(typeof q?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return q.getRandomValues(new Uint8Array($))}var o0=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function d$($,q,J){return $&q^~$&J}function n$($,q,J){return $&q^$&J^q&J}class E0{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,q,J,Q){this.blockLen=$,this.outputLen=q,this.padOffset=J,this.isLE=Q,this.buffer=new Uint8Array($),this.view=C0(this.buffer)}update($){l8(this),u($);let{view:q,buffer:J,blockLen:Q}=this,U=$.length;for(let G=0;G<U;){let X=Math.min(Q-this.pos,U-G);if(X===Q){let N=C0($);for(;Q<=U-G;G+=Q)this.process(N,G);continue}if(J.set($.subarray(G,G+X),this.pos),this.pos+=X,G+=X,this.pos===Q)this.process(q,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){l8(this),l$($,this),this.finished=!0;let{buffer:q,view:J,blockLen:Q,isLE:U}=this,{pos:G}=this;if(q[G++]=128,E8(this.buffer.subarray(G)),this.padOffset>Q-G)this.process(J,0),G=0;for(let Z=G;Z<Q;Z++)q[Z]=0;J.setBigUint64(Q-8,BigInt(this.length*8),U),this.process(J,0);let X=C0($),N=this.outputLen;if(N%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let K=N/4,O=this.get();if(K>O.length)throw new Error("_sha2: outputLen bigger than state");for(let Z=0;Z<K;Z++)X.setUint32(4*Z,O[Z],U)}digest(){let{buffer:$,outputLen:q}=this;this.digestInto($);let J=$.slice(0,q);return this.destroy(),J}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:q,buffer:J,length:Q,finished:U,destroyed:G,pos:X}=this;if($.destroyed=G,$.finished=U,$.length=Q,$.pos=X,Q%q)$.buffer.set(J);return $}clone(){return this._cloneInto()}}var I8=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),A8=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),q8=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J8=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var w0=BigInt(4294967295),i$=BigInt(32);function vJ($,q=!1){if(q)return{h:Number($&w0),l:Number($>>i$&w0)};return{h:Number($>>i$&w0)|0,l:Number($&w0)|0}}function r$($,q=!1){let J=$.length,Q=new Uint32Array(J),U=new Uint32Array(J);for(let G=0;G<J;G++){let{h:X,l:N}=vJ($[G],q);[Q[G],U[G]]=[X,N]}return[Q,U]}var a0=($,q,J)=>$>>>J,s0=($,q,J)=>$<<32-J|q>>>J,g8=($,q,J)=>$>>>J|q<<32-J,v8=($,q,J)=>$<<32-J|q>>>J,J0=($,q,J)=>$<<64-J|q>>>J-32,Q0=($,q,J)=>$>>>J-32|q<<64-J;function T8($,q,J,Q){let U=(q>>>0)+(Q>>>0);return{h:$+J+(U/4294967296|0)|0,l:U|0}}var o$=($,q,J)=>($>>>0)+(q>>>0)+(J>>>0),a$=($,q,J,Q)=>q+J+Q+($/4294967296|0)|0,s$=($,q,J,Q)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0),t$=($,q,J,Q,U)=>q+J+Q+U+($/4294967296|0)|0,e$=($,q,J,Q,U)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0)+(U>>>0),$q=($,q,J,Q,U,G)=>q+J+Q+U+G+($/4294967296|0)|0;var bJ=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),P8=new Uint32Array(64);class t0 extends E0{constructor($){super(64,$,8,!1)}get(){let{A:$,B:q,C:J,D:Q,E:U,F:G,G:X,H:N}=this;return[$,q,J,Q,U,G,X,N]}set($,q,J,Q,U,G,X,N){this.A=$|0,this.B=q|0,this.C=J|0,this.D=Q|0,this.E=U|0,this.F=G|0,this.G=X|0,this.H=N|0}process($,q){for(let Z=0;Z<16;Z++,q+=4)P8[Z]=$.getUint32(q,!1);for(let Z=16;Z<64;Z++){let W=P8[Z-15],z=P8[Z-2],A=w8(W,7)^w8(W,18)^W>>>3,B=w8(z,17)^w8(z,19)^z>>>10;P8[Z]=B+P8[Z-7]+A+P8[Z-16]|0}let{A:J,B:Q,C:U,D:G,E:X,F:N,G:K,H:O}=this;for(let Z=0;Z<64;Z++){let W=w8(X,6)^w8(X,11)^w8(X,25),z=O+W+d$(X,N,K)+bJ[Z]+P8[Z]|0,B=(w8(J,2)^w8(J,13)^w8(J,22))+n$(J,Q,U)|0;O=K,K=N,N=X,X=G+z|0,G=U,U=Q,Q=J,J=z+B|0}J=J+this.A|0,Q=Q+this.B|0,U=U+this.C|0,G=G+this.D|0,X=X+this.E|0,N=N+this.F|0,K=K+this.G|0,O=O+this.H|0,this.set(J,Q,U,G,X,N,K,O)}roundClean(){E8(P8)}destroy(){this.set(0,0,0,0,0,0,0,0),E8(this.buffer)}}class qq extends t0{A=I8[0]|0;B=I8[1]|0;C=I8[2]|0;D=I8[3]|0;E=I8[4]|0;F=I8[5]|0;G=I8[6]|0;H=I8[7]|0;constructor(){super(32)}}class cJ extends t0{A=A8[0]|0;B=A8[1]|0;C=A8[2]|0;D=A8[3]|0;E=A8[4]|0;F=A8[5]|0;G=A8[6]|0;H=A8[7]|0;constructor(){super(28)}}var Jq=(()=>r$(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),hJ=(()=>Jq[0])(),pJ=(()=>Jq[1])(),x8=new Uint32Array(80),F8=new Uint32Array(80);class U0 extends E0{constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:q,Bh:J,Bl:Q,Ch:U,Cl:G,Dh:X,Dl:N,Eh:K,El:O,Fh:Z,Fl:W,Gh:z,Gl:A,Hh:B,Hl:P}=this;return[$,q,J,Q,U,G,X,N,K,O,Z,W,z,A,B,P]}set($,q,J,Q,U,G,X,N,K,O,Z,W,z,A,B,P){this.Ah=$|0,this.Al=q|0,this.Bh=J|0,this.Bl=Q|0,this.Ch=U|0,this.Cl=G|0,this.Dh=X|0,this.Dl=N|0,this.Eh=K|0,this.El=O|0,this.Fh=Z|0,this.Fl=W|0,this.Gh=z|0,this.Gl=A|0,this.Hh=B|0,this.Hl=P|0}process($,q){for(let f=0;f<16;f++,q+=4)x8[f]=$.getUint32(q),F8[f]=$.getUint32(q+=4);for(let f=16;f<80;f++){let R=x8[f-15]|0,v=F8[f-15]|0,m=g8(R,v,1)^g8(R,v,8)^a0(R,v,7),l=v8(R,v,1)^v8(R,v,8)^s0(R,v,7),b=x8[f-2]|0,j=F8[f-2]|0,F=g8(b,j,19)^J0(b,j,61)^a0(b,j,6),S=v8(b,j,19)^Q0(b,j,61)^s0(b,j,6),p=s$(l,S,F8[f-7],F8[f-16]),d=t$(p,m,F,x8[f-7],x8[f-16]);x8[f]=d|0,F8[f]=p|0}let{Ah:J,Al:Q,Bh:U,Bl:G,Ch:X,Cl:N,Dh:K,Dl:O,Eh:Z,El:W,Fh:z,Fl:A,Gh:B,Gl:P,Hh:E,Hl:I}=this;for(let f=0;f<80;f++){let R=g8(Z,W,14)^g8(Z,W,18)^J0(Z,W,41),v=v8(Z,W,14)^v8(Z,W,18)^Q0(Z,W,41),m=Z&z^~Z&B,l=W&A^~W&P,b=e$(I,v,l,pJ[f],F8[f]),j=$q(b,E,R,m,hJ[f],x8[f]),F=b|0,S=g8(J,Q,28)^J0(J,Q,34)^J0(J,Q,39),p=v8(J,Q,28)^Q0(J,Q,34)^Q0(J,Q,39),d=J&U^J&X^U&X,M=Q&G^Q&N^G&N;E=B|0,I=P|0,B=z|0,P=A|0,z=Z|0,A=W|0,{h:Z,l:W}=T8(K|0,O|0,j|0,F|0),K=X|0,O=N|0,X=U|0,N=G|0,U=J|0,G=Q|0;let T=o$(F,p,M);J=a$(T,j,S,d),Q=T|0}({h:J,l:Q}=T8(this.Ah|0,this.Al|0,J|0,Q|0)),{h:U,l:G}=T8(this.Bh|0,this.Bl|0,U|0,G|0),{h:X,l:N}=T8(this.Ch|0,this.Cl|0,X|0,N|0),{h:K,l:O}=T8(this.Dh|0,this.Dl|0,K|0,O|0),{h:Z,l:W}=T8(this.Eh|0,this.El|0,Z|0,W|0),{h:z,l:A}=T8(this.Fh|0,this.Fl|0,z|0,A|0),{h:B,l:P}=T8(this.Gh|0,this.Gl|0,B|0,P|0),{h:E,l:I}=T8(this.Hh|0,this.Hl|0,E|0,I|0),this.set(J,Q,U,G,X,N,K,O,Z,W,z,A,B,P,E,I)}roundClean(){E8(x8,F8)}destroy(){E8(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Qq extends U0{Ah=J8[0]|0;Al=J8[1]|0;Bh=J8[2]|0;Bl=J8[3]|0;Ch=J8[4]|0;Cl=J8[5]|0;Dh=J8[6]|0;Dl=J8[7]|0;Eh=J8[8]|0;El=J8[9]|0;Fh=J8[10]|0;Fl=J8[11]|0;Gh=J8[12]|0;Gl=J8[13]|0;Hh=J8[14]|0;Hl=J8[15]|0;constructor(){super(64)}}class lJ extends U0{Ah=q8[0]|0;Al=q8[1]|0;Bh=q8[2]|0;Bl=q8[3]|0;Ch=q8[4]|0;Cl=q8[5]|0;Dh=q8[6]|0;Dl=q8[7]|0;Eh=q8[8]|0;El=q8[9]|0;Fh=q8[10]|0;Fl=q8[11]|0;Gh=q8[12]|0;Gl=q8[13]|0;Hh=q8[14]|0;Hl=q8[15]|0;constructor(){super(48)}}var Q8=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),U8=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class uJ extends U0{Ah=Q8[0]|0;Al=Q8[1]|0;Bh=Q8[2]|0;Bl=Q8[3]|0;Ch=Q8[4]|0;Cl=Q8[5]|0;Dh=Q8[6]|0;Dl=Q8[7]|0;Eh=Q8[8]|0;El=Q8[9]|0;Fh=Q8[10]|0;Fl=Q8[11]|0;Gh=Q8[12]|0;Gl=Q8[13]|0;Hh=Q8[14]|0;Hl=Q8[15]|0;constructor(){super(28)}}class dJ extends U0{Ah=U8[0]|0;Al=U8[1]|0;Bh=U8[2]|0;Bl=U8[3]|0;Ch=U8[4]|0;Cl=U8[5]|0;Dh=U8[6]|0;Dl=U8[7]|0;Eh=U8[8]|0;El=U8[9]|0;Fh=U8[10]|0;Fl=U8[11]|0;Gh=U8[12]|0;Gl=U8[13]|0;Hh=U8[14]|0;Hl=U8[15]|0;constructor(){super(32)}}var N8=r0(()=>new qq,o0(1));var Uq=r0(()=>new Qq,o0(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Xq=BigInt(0),Gq=BigInt(1);function T0($,q=""){if(typeof $!=="boolean"){let J=q&&`"${q}" `;throw new Error(J+"expected boolean, got type="+typeof $)}return $}function nJ($){if(typeof $==="bigint"){if(!H0($))throw new Error("positive bigint expected, got "+$)}else H8($);return $}function Kq($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?Xq:BigInt("0x"+$)}function Nq($){return Kq(u8($))}function j8($){return Kq(u8(m8(u($)).reverse()))}function e0($,q){H8(q),$=nJ($);let J=e8($.toString(16).padStart(q*2,"0"));if(J.length!==q)throw new Error("number too large");return J}function z0($,q){return e0($,q).reverse()}function m8($){return Uint8Array.from($)}var H0=($)=>typeof $==="bigint"&&Xq<=$;function iJ($,q,J){return H0($)&&H0(q)&&H0(J)&&q<=$&&$<J}function d8($,q,J,Q){if(!iJ(q,J,Q))throw new Error("expected valid "+$+": "+J+" <= n < "+Q+", got "+q)}var Yq=($)=>(Gq<<BigInt($))-Gq;function b8($,q={},J={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function Q(G,X,N){let K=$[G];if(N&&K===void 0)return;let O=typeof K;if(O!==X||K===null)throw new Error(`param "${G}" is invalid: expected ${X}, got ${O}`)}let U=(G,X)=>Object.entries(G).forEach(([N,K])=>Q(N,K,X));U(q,!1),U(J,!0)}function $$($){let q=new WeakMap;return(J,...Q)=>{let U=q.get(J);if(U!==void 0)return U;let G=$(J,...Q);return q.set(J,G),G}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var X8=BigInt(0),G8=BigInt(1),c8=BigInt(2),Oq=BigInt(3),Lq=BigInt(4),Wq=BigInt(5),rJ=BigInt(7),Cq=BigInt(8),oJ=BigInt(9),Eq=BigInt(16);function i($,q){let J=$%q;return J>=X8?J:q+J}function L8($,q,J){let Q=$;while(q-- >X8)Q*=Q,Q%=J;return Q}function Zq($,q){if($===X8)throw new Error("invert: expected non-zero number");if(q<=X8)throw new Error("invert: expected positive modulus, got "+q);let J=i($,q),Q=q,U=X8,G=G8,X=G8,N=X8;while(J!==X8){let O=Q/J,Z=Q%J,W=U-X*O,z=G-N*O;Q=J,J=Z,U=X,G=N,X=W,N=z}if(Q!==G8)throw new Error("invert: does not exist");return i(U,q)}function q$($,q,J){if(!$.eql($.sqr(q),J))throw new Error("Cannot find square root")}function wq($,q){let J=($.ORDER+G8)/Lq,Q=$.pow(q,J);return q$($,Q,q),Q}function aJ($,q){let J=($.ORDER-Wq)/Cq,Q=$.mul(q,c8),U=$.pow(Q,J),G=$.mul(q,U),X=$.mul($.mul(G,c8),U),N=$.mul(G,$.sub(X,$.ONE));return q$($,N,q),N}function sJ($){let q=R0($),J=Hq($),Q=J(q,q.neg(q.ONE)),U=J(q,Q),G=J(q,q.neg(Q)),X=($+rJ)/Eq;return(N,K)=>{let O=N.pow(K,X),Z=N.mul(O,Q),W=N.mul(O,U),z=N.mul(O,G),A=N.eql(N.sqr(Z),K),B=N.eql(N.sqr(W),K);O=N.cmov(O,Z,A),Z=N.cmov(z,W,B);let P=N.eql(N.sqr(Z),K),E=N.cmov(O,Z,P);return q$(N,E,K),E}}function Hq($){if($<Oq)throw new Error("sqrt is not defined for small field");let q=$-G8,J=0;while(q%c8===X8)q/=c8,J++;let Q=c8,U=R0($);while(Mq(U,Q)===1)if(Q++>1000)throw new Error("Cannot find square root: probably non-prime P");if(J===1)return wq;let G=U.pow(Q,q),X=(q+G8)/c8;return function N(K,O){if(K.is0(O))return O;if(Mq(K,O)!==1)throw new Error("Cannot find square root");let Z=J,W=K.mul(K.ONE,G),z=K.pow(O,q),A=K.pow(O,X);while(!K.eql(z,K.ONE)){if(K.is0(z))return K.ZERO;let B=1,P=K.sqr(z);while(!K.eql(P,K.ONE))if(B++,P=K.sqr(P),B===Z)throw new Error("Cannot find square root");let E=G8<<BigInt(Z-B-1),I=K.pow(W,E);Z=B,W=K.sqr(I),z=K.mul(z,W),A=K.mul(A,I)}return A}}function tJ($){if($%Lq===Oq)return wq;if($%Cq===Wq)return aJ;if($%Eq===oJ)return sJ($);return Hq($)}var Tq=($,q)=>(i($,q)&G8)===G8,eJ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function zq($){let q={ORDER:"bigint",BYTES:"number",BITS:"number"},J=eJ.reduce((Q,U)=>{return Q[U]="function",Q},q);return b8($,J),$}function $1($,q,J){if(J<X8)throw new Error("invalid exponent, negatives unsupported");if(J===X8)return $.ONE;if(J===G8)return q;let Q=$.ONE,U=q;while(J>X8){if(J&G8)Q=$.mul(Q,U);U=$.sqr(U),J>>=G8}return Q}function D0($,q,J=!1){let Q=new Array(q.length).fill(J?$.ZERO:void 0),U=q.reduce((X,N,K)=>{if($.is0(N))return X;return Q[K]=X,$.mul(X,N)},$.ONE),G=$.inv(U);return q.reduceRight((X,N,K)=>{if($.is0(N))return X;return Q[K]=$.mul(X,Q[K]),$.mul(X,N)},G),Q}function Mq($,q){let J=($.ORDER-G8)/c8,Q=$.pow(q,J),U=$.eql(Q,$.ONE),G=$.eql(Q,$.ZERO),X=$.eql(Q,$.neg($.ONE));if(!U&&!G&&!X)throw new Error("invalid Legendre symbol result");return U?1:G?0:-1}function q1($,q){if(q!==void 0)H8(q);let J=q!==void 0?q:$.toString(2).length,Q=Math.ceil(J/8);return{nBitLength:J,nByteLength:Q}}class Dq{ORDER;BITS;BYTES;isLE;ZERO=X8;ONE=G8;_lengths;_sqrt;_mod;constructor($,q={}){if($<=X8)throw new Error("invalid field: expected ORDER > 0, got "+$);let J=void 0;if(this.isLE=!1,q!=null&&typeof q==="object"){if(typeof q.BITS==="number")J=q.BITS;if(typeof q.sqrt==="function")this.sqrt=q.sqrt;if(typeof q.isLE==="boolean")this.isLE=q.isLE;if(q.allowedLengths)this._lengths=q.allowedLengths?.slice();if(typeof q.modFromBytes==="boolean")this._mod=q.modFromBytes}let{nBitLength:Q,nByteLength:U}=q1($,J);if(U>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=Q,this.BYTES=U,this._sqrt=void 0,Object.preventExtensions(this)}create($){return i($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return X8<=$&&$<this.ORDER}is0($){return $===X8}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&G8)===G8}neg($){return i(-$,this.ORDER)}eql($,q){return $===q}sqr($){return i($*$,this.ORDER)}add($,q){return i($+q,this.ORDER)}sub($,q){return i($-q,this.ORDER)}mul($,q){return i($*q,this.ORDER)}pow($,q){return $1(this,$,q)}div($,q){return i($*Zq(q,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,q){return $+q}subN($,q){return $-q}mulN($,q){return $*q}inv($){return Zq($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=tJ(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?z0($,this.BYTES):e0($,this.BYTES)}fromBytes($,q=!1){u($);let{_lengths:J,BYTES:Q,isLE:U,ORDER:G,_mod:X}=this;if(J){if(!J.includes($.length)||$.length>Q)throw new Error("Field.fromBytes: expected "+J+" bytes, got "+$.length);let K=new Uint8Array(Q);K.set($,U?0:K.length-$.length),$=K}if($.length!==Q)throw new Error("Field.fromBytes: expected "+Q+" bytes, got "+$.length);let N=U?j8($):Nq($);if(X)N=i(N,G);if(!q){if(!this.isValid(N))throw new Error("invalid field element: outside of range 0..ORDER")}return N}invertBatch($){return D0(this,$)}cmov($,q,J){return J?q:$}}function R0($,q={}){return new Dq($,q)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var B0=BigInt(0),G$=BigInt(1);function Rq($,q){let J=q.negate();return $?J:q}function f0($,q){let J=D0($.Fp,q.map((Q)=>Q.Z));return q.map((Q,U)=>$.fromAffine(Q.toAffine(J[U])))}function Aq($,q){if(!Number.isSafeInteger($)||$<=0||$>q)throw new Error("invalid window size, expected [1.."+q+"], got W="+$)}function J$($,q){Aq($,q);let J=Math.ceil(q/$)+1,Q=2**($-1),U=2**$,G=Yq($),X=BigInt($);return{windows:J,windowSize:Q,mask:G,maxNumber:U,shiftBy:X}}function Bq($,q,J){let{windowSize:Q,mask:U,maxNumber:G,shiftBy:X}=J,N=Number($&U),K=$>>X;if(N>Q)N-=G,K+=G$;let O=q*Q,Z=O+Math.abs(N)-1,W=N===0,z=N<0,A=q%2!==0;return{nextN:K,offset:Z,isZero:W,isNeg:z,isNegF:A,offsetF:O}}var Q$=new WeakMap,jq=new WeakMap;function U$($){return jq.get($)||1}function fq($){if($!==B0)throw new Error("invalid wNAF")}class X${BASE;ZERO;Fn;bits;constructor($,q){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=q}_unsafeLadder($,q,J=this.ZERO){let Q=$;while(q>B0){if(q&G$)J=J.add(Q);Q=Q.double(),q>>=G$}return J}precomputeWindow($,q){let{windows:J,windowSize:Q}=J$(q,this.bits),U=[],G=$,X=G;for(let N=0;N<J;N++){X=G,U.push(X);for(let K=1;K<Q;K++)X=X.add(G),U.push(X);G=X.double()}return U}wNAF($,q,J){if(!this.Fn.isValid(J))throw new Error("invalid scalar");let Q=this.ZERO,U=this.BASE,G=J$($,this.bits);for(let X=0;X<G.windows;X++){let{nextN:N,offset:K,isZero:O,isNeg:Z,isNegF:W,offsetF:z}=Bq(J,X,G);if(J=N,O)U=U.add(Rq(W,q[z]));else Q=Q.add(Rq(Z,q[K]))}return fq(J),{p:Q,f:U}}wNAFUnsafe($,q,J,Q=this.ZERO){let U=J$($,this.bits);for(let G=0;G<U.windows;G++){if(J===B0)break;let{nextN:X,offset:N,isZero:K,isNeg:O}=Bq(J,G,U);if(J=X,K)continue;else{let Z=q[N];Q=Q.add(O?Z.negate():Z)}}return fq(J),Q}getPrecomputes($,q,J){let Q=Q$.get(q);if(!Q){if(Q=this.precomputeWindow(q,$),$!==1){if(typeof J==="function")Q=J(Q);Q$.set(q,Q)}}return Q}cached($,q,J){let Q=U$($);return this.wNAF(Q,this.getPrecomputes(Q,$,J),q)}unsafe($,q,J,Q){let U=U$($);if(U===1)return this._unsafeLadder($,q,Q);return this.wNAFUnsafe(U,this.getPrecomputes(U,$,J),q,Q)}createCache($,q){Aq(q,this.bits),jq.set($,q),Q$.delete($)}hasCache($){return U$($)!==1}}function Iq($,q,J){if(q){if(q.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return zq(q),q}else return R0($,{isLE:J})}function Vq($,q,J={},Q){if(Q===void 0)Q=$==="edwards";if(!q||typeof q!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let K of["p","n","h"]){let O=q[K];if(!(typeof O==="bigint"&&O>B0))throw new Error(`CURVE.${K} must be positive bigint`)}let U=Iq(q.p,J.Fp,Q),G=Iq(q.n,J.Fn,Q),N=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let K of N)if(!U.isValid(q[K]))throw new Error(`CURVE.${K} must be valid field element of CURVE.Fp`);return q=Object.freeze(Object.assign({},q)),{CURVE:q,Fp:U,Fn:G}}function I0($,q){return function J(Q){let U=$(Q);return{secretKey:U,publicKey:q(U)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var k8=BigInt(0),e=BigInt(1),K$=BigInt(2),J1=BigInt(8);function Q1($,q,J,Q){let U=$.sqr(J),G=$.sqr(Q),X=$.add($.mul(q.a,U),G),N=$.add($.ONE,$.mul(q.d,$.mul(U,G)));return $.eql(X,N)}function Pq($,q={}){let J=Vq("edwards",$,q,q.FpFnLE),{Fp:Q,Fn:U}=J,G=J.CURVE,{h:X}=G;b8(q,{},{uvRatio:"function"});let N=K$<<BigInt(U.BYTES*8)-e,K=(E)=>Q.create(E),O=q.uvRatio||((E,I)=>{try{return{isValid:!0,value:Q.sqrt(Q.div(E,I))}}catch(f){return{isValid:!1,value:k8}}});if(!Q1(Q,G,G.Gx,G.Gy))throw new Error("bad curve params: generator point");function Z(E,I,f=!1){let R=f?e:k8;return d8("coordinate "+E,I,R,N),I}function W(E){if(!(E instanceof B))throw new Error("EdwardsPoint expected")}let z=$$((E,I)=>{let{X:f,Y:R,Z:v}=E,m=E.is0();if(I==null)I=m?J1:Q.inv(v);let l=K(f*I),b=K(R*I),j=Q.mul(v,I);if(m)return{x:k8,y:e};if(j!==e)throw new Error("invZ was invalid");return{x:l,y:b}}),A=$$((E)=>{let{a:I,d:f}=G;if(E.is0())throw new Error("bad point: ZERO");let{X:R,Y:v,Z:m,T:l}=E,b=K(R*R),j=K(v*v),F=K(m*m),S=K(F*F),p=K(b*I),d=K(F*K(p+j)),M=K(S+K(f*K(b*j)));if(d!==M)throw new Error("bad point: equation left != right (1)");let T=K(R*v),C=K(m*l);if(T!==C)throw new Error("bad point: equation left != right (2)");return!0});class B{static BASE=new B(G.Gx,G.Gy,e,K(G.Gx*G.Gy));static ZERO=new B(k8,e,e,k8);static Fp=Q;static Fn=U;X;Y;Z;T;constructor(E,I,f,R){this.X=Z("x",E),this.Y=Z("y",I),this.Z=Z("z",f,!0),this.T=Z("t",R),Object.freeze(this)}static CURVE(){return G}static fromAffine(E){if(E instanceof B)throw new Error("extended point not allowed");let{x:I,y:f}=E||{};return Z("x",I),Z("y",f),new B(I,f,e,K(I*f))}static fromBytes(E,I=!1){let f=Q.BYTES,{a:R,d:v}=G;E=m8(u(E,f,"point")),T0(I,"zip215");let m=m8(E),l=E[f-1];m[f-1]=l&-129;let b=j8(m),j=I?N:Q.ORDER;d8("point.y",b,k8,j);let F=K(b*b),S=K(F-e),p=K(v*F-R),{isValid:d,value:M}=O(S,p);if(!d)throw new Error("bad point: invalid y coordinate");let T=(M&e)===e,C=(l&128)!==0;if(!I&&M===k8&&C)throw new Error("bad point: x=0 and x_0=1");if(C!==T)M=K(-M);return B.fromAffine({x:M,y:b})}static fromHex(E,I=!1){return B.fromBytes(e8(E),I)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(E=8,I=!0){if(P.createCache(this,E),!I)this.multiply(K$);return this}assertValidity(){A(this)}equals(E){W(E);let{X:I,Y:f,Z:R}=this,{X:v,Y:m,Z:l}=E,b=K(I*l),j=K(v*R),F=K(f*l),S=K(m*R);return b===j&&F===S}is0(){return this.equals(B.ZERO)}negate(){return new B(K(-this.X),this.Y,this.Z,K(-this.T))}double(){let{a:E}=G,{X:I,Y:f,Z:R}=this,v=K(I*I),m=K(f*f),l=K(K$*K(R*R)),b=K(E*v),j=I+f,F=K(K(j*j)-v-m),S=b+m,p=S-l,d=b-m,M=K(F*p),T=K(S*d),C=K(F*d),H=K(p*S);return new B(M,T,H,C)}add(E){W(E);let{a:I,d:f}=G,{X:R,Y:v,Z:m,T:l}=this,{X:b,Y:j,Z:F,T:S}=E,p=K(R*b),d=K(v*j),M=K(l*f*S),T=K(m*F),C=K((R+v)*(b+j)-p-d),H=T-M,D=T+M,V=K(d-I*p),k=K(C*H),y=K(D*V),_=K(C*V),g=K(H*D);return new B(k,y,g,_)}subtract(E){return this.add(E.negate())}multiply(E){if(!U.isValidNot0(E))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:I,f}=P.cached(this,E,(R)=>f0(B,R));return f0(B,[I,f])[0]}multiplyUnsafe(E,I=B.ZERO){if(!U.isValid(E))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(E===k8)return B.ZERO;if(this.is0()||E===e)return this;return P.unsafe(this,E,(f)=>f0(B,f),I)}isSmallOrder(){return this.multiplyUnsafe(X).is0()}isTorsionFree(){return P.unsafe(this,G.n).is0()}toAffine(E){return z(this,E)}clearCofactor(){if(X===e)return this;return this.multiplyUnsafe(X)}toBytes(){let{x:E,y:I}=this.toAffine(),f=Q.toBytes(I);return f[f.length-1]|=E&e?128:0,f}toHex(){return u8(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let P=new X$(B,U.BITS);return B.BASE.precompute(8),B}function xq($,q,J={}){if(typeof q!=="function")throw new Error('"hash" function param is required');b8(J,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:Q}=J,{BASE:U,Fp:G,Fn:X}=$,N=J.randomBytes||q0,K=J.adjustScalarBytes||((j)=>j),O=J.domain||((j,F,S)=>{if(T0(S,"phflag"),F.length||S)throw new Error("Contexts/pre-hash are not supported");return j});function Z(j){return X.create(j8(j))}function W(j){let F=R.secretKey;u(j,R.secretKey,"secretKey");let S=u(q(j),2*F,"hashedSecretKey"),p=K(S.slice(0,F)),d=S.slice(F,2*F),M=Z(p);return{head:p,prefix:d,scalar:M}}function z(j){let{head:F,prefix:S,scalar:p}=W(j),d=U.multiply(p),M=d.toBytes();return{head:F,prefix:S,scalar:p,point:d,pointBytes:M}}function A(j){return z(j).pointBytes}function B(j=Uint8Array.of(),...F){let S=$0(...F);return Z(q(O(S,u(j,void 0,"context"),!!Q)))}function P(j,F,S={}){if(j=u(j,void 0,"message"),Q)j=Q(j);let{prefix:p,scalar:d,pointBytes:M}=z(F),T=B(S.context,p,j),C=U.multiply(T).toBytes(),H=B(S.context,C,M,j),D=X.create(T+H*d);if(!X.isValid(D))throw new Error("sign failed: invalid s");let V=$0(C,X.toBytes(D));return u(V,R.signature,"result")}let E={zip215:!0};function I(j,F,S,p=E){let{context:d,zip215:M}=p,T=R.signature;if(j=u(j,T,"signature"),F=u(F,void 0,"message"),S=u(S,R.publicKey,"publicKey"),M!==void 0)T0(M,"zip215");if(Q)F=Q(F);let C=T/2,H=j.subarray(0,C),D=j8(j.subarray(C,T)),V,k,y;try{V=$.fromBytes(S,M),k=$.fromBytes(H,M),y=U.multiplyUnsafe(D)}catch(s8){return!1}if(!M&&V.isSmallOrder())return!1;let _=B(d,k.toBytes(),V.toBytes(),F);return k.add(V.multiplyUnsafe(_)).subtract(y).clearCofactor().is0()}let f=G.BYTES,R={secretKey:f,publicKey:f,signature:2*f,seed:f};function v(j=N(R.seed)){return u(j,R.seed,"seed")}function m(j){return W0(j)&&j.length===X.BYTES}function l(j,F){try{return!!$.fromBytes(j,F)}catch(S){return!1}}let b={getExtendedPublicKey:z,randomSecretKey:v,isValidSecretKey:m,isValidPublicKey:l,toMontgomery(j){let{y:F}=$.fromBytes(j),S=R.publicKey,p=S===32;if(!p&&S!==57)throw new Error("only defined for 25519 and 448");let d=p?G.div(e+F,e-F):G.div(F-e,F+e);return G.toBytes(d)},toMontgomerySecret(j){let F=R.secretKey;u(j,F);let S=q(j.subarray(0,F));return K(S).subarray(0,F)}};return Object.freeze({keygen:I0(v,A),getPublicKey:A,sign:P,verify:I,utils:b,Point:$,lengths:R})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var G0=BigInt(0),n8=BigInt(1),A0=BigInt(2);function U1($){return b8($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function Fq($){let q=U1($),{P:J,type:Q,adjustScalarBytes:U,powPminus2:G,randomBytes:X}=q,N=Q==="x25519";if(!N&&Q!=="x448")throw new Error("invalid type");let K=X||q0,O=N?255:448,Z=N?32:56,W=N?BigInt(9):BigInt(5),z=N?BigInt(121665):BigInt(39081),A=N?A0**BigInt(254):A0**BigInt(447),B=N?BigInt(8)*A0**BigInt(251)-n8:BigInt(4)*A0**BigInt(445)-n8,P=A+B+n8,E=(T)=>i(T,J),I=f(W);function f(T){return z0(E(T),Z)}function R(T){let C=m8(u(T,Z,"uCoordinate"));if(N)C[31]&=127;return E(j8(C))}function v(T){return j8(U(m8(u(T,Z,"scalar"))))}function m(T,C){let H=S(R(C),v(T));if(H===G0)throw new Error("invalid private or public key received");return f(H)}function l(T){return m(T,I)}let b=l,j=m;function F(T,C,H){let D=E(T*(C-H));return C=E(C-D),H=E(H+D),{x_2:C,x_3:H}}function S(T,C){d8("u",T,G0,J),d8("scalar",C,A,P);let H=C,D=T,V=n8,k=G0,y=T,_=n8,g=G0;for(let l0=BigInt(O-1);l0>=G0;l0--){let y$=H>>l0&n8;g^=y$,{x_2:V,x_3:y}=F(g,V,y),{x_2:k,x_3:_}=F(g,k,_),g=y$;let u0=V+k,d0=E(u0*u0),n0=V-k,_$=E(n0*n0),S$=d0-_$,PJ=y+_,xJ=y-_,g$=E(xJ*u0),v$=E(PJ*n0),m$=g$+v$,b$=g$-v$;y=E(m$*m$),_=E(D*E(b$*b$)),V=E(d0*_$),k=E(S$*(d0+E(z*S$)))}({x_2:V,x_3:y}=F(g,V,y)),{x_2:k,x_3:_}=F(g,k,_);let s8=G(k);return E(V*s8)}let p={secretKey:Z,publicKey:Z,seed:Z},d=(T=K(Z))=>{return u(T,p.seed,"seed"),T},M={randomSecretKey:d};return Object.freeze({keygen:I0(d,b),getSharedSecret:j,getPublicKey:b,scalarMult:m,scalarMultBase:l,utils:M,GuBytes:I.slice(),lengths:p})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var G1=BigInt(1),kq=BigInt(2),X1=BigInt(3),K1=BigInt(5),N1=BigInt(8),j0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Y1=(()=>({p:j0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:N1,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function _q($){let q=BigInt(10),J=BigInt(20),Q=BigInt(40),U=BigInt(80),G=j0,N=$*$%G*$%G,K=L8(N,kq,G)*N%G,O=L8(K,G1,G)*$%G,Z=L8(O,K1,G)*O%G,W=L8(Z,q,G)*Z%G,z=L8(W,J,G)*W%G,A=L8(z,Q,G)*z%G,B=L8(A,U,G)*A%G,P=L8(B,U,G)*A%G,E=L8(P,q,G)*Z%G;return{pow_p_5_8:L8(E,kq,G)*$%G,b2:N}}function Sq($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var yq=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Z1($,q){let J=j0,Q=i(q*q*q,J),U=i(Q*Q*q,J),G=_q($*U).pow_p_5_8,X=i($*Q*G,J),N=i(q*X*X,J),K=X,O=i(X*yq,J),Z=N===$,W=N===i(-$,J),z=N===i(-$*yq,J);if(Z)X=K;if(W||z)X=O;if(Tq(X,J))X=i(-X,J);return{isValid:Z||W,value:X}}var M1=Pq(Y1,{uvRatio:Z1});function O1($){return xq(M1,Uq,Object.assign({adjustScalarBytes:Sq},$))}var y8=O1({});var X0=(()=>{let $=j0;return Fq({P:$,type:"x25519",powPminus2:(q)=>{let{pow_p_5_8:J,b2:Q}=_q(q);return i(L8(J,X1,$)*Q,$)},adjustScalarBytes:Sq})})();var UJ=h$(N$(),1);var Y$;try{Y$=new TextDecoder}catch($){}var x,p8,w=0;var hq=[],L1=105,W1=57342,C1=57343,vq=57337;var mq=6,i8={},K0=112810000,V8=16810000;var Z$=hq,M$=0,c={},r,x0,F0=0,Y0=0,a,W8,o=[],O$=[],Y8,K8,N0,bq={useRecords:!1,mapsAsObjects:!0},Z0=!1,pq=2;try{new Function("")}catch($){pq=1/0}class _8{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[q,J]of Object.entries($.keyMap))this.mapKey.set(J,q)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let q=new Map;for(let[J,Q]of Object.entries($))q.set(this._keyMap.hasOwnProperty(J)?this._keyMap[J]:J,Q);return q}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[J,Q]of Object.entries(this._keyMap))this._mapKey.set(Q,J)}let q={};return $.forEach((J,Q)=>q[C8(this._mapKey.has(Q)?this._mapKey.get(Q):Q)]=J),q}mapDecode($,q){let J=this.decode($);if(this._keyMap)switch(J.constructor.name){case"Array":return J.map((Q)=>this.decodeKeys(Q))}return J}decode($,q){if(x)return nq(()=>{return k0(),this?this.decode($,q):_8.prototype.decode.call(bq,$,q)});p8=q>-1?q:$.length,w=0,M$=0,Y0=0,x0=null,Z$=hq,a=null,x=$;try{K8=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(J){if(x=null,$ instanceof Uint8Array)throw J;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof _8){if(c=this,Y8=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return r=this.structures,V0();else if(!r||r.length>0)r=[]}else{if(c=bq,!r||r.length>0)r=[];Y8=null}return V0()}decodeMultiple($,q){let J,Q=0;try{let U=$.length;Z0=!0;let G=this?this.decode($,U):H$.decode($,U);if(q){if(q(G)===!1)return;while(w<U)if(Q=w,q(V0())===!1)return}else{J=[G];while(w<U)Q=w,J.push(V0());return J}}catch(U){throw U.lastPosition=Q,U.values=J,U}finally{Z0=!1,k0()}}}function V0(){try{let $=h();if(a){if(w>=a.postBundlePosition){let q=new Error("Unexpected bundle position");throw q.incomplete=!0,q}w=a.postBundlePosition,a=null}if(w==p8){if(r=null,x=null,W8)W8=null}else if(w>p8){let q=new Error("Unexpected end of CBOR data");throw q.incomplete=!0,q}else if(!Z0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(k0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function h(){let $=x[w++],q=$>>5;if($=$&31,$>23)switch($){case 24:$=x[w++];break;case 25:if(q==7)return T1();$=K8.getUint16(w),w+=2;break;case 26:if(q==7){let J=K8.getFloat32(w);if(c.useFloat32>2){let Q=y0[(x[w]&127)<<1|x[w+1]>>7];return w+=4,(Q*J+(J>0?0.5:-0.5)>>0)/Q}return w+=4,J}$=K8.getUint32(w),w+=4;break;case 27:if(q==7){let J=K8.getFloat64(w);return w+=8,J}if(q>1){if(K8.getUint32(w)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=K8.getUint32(w+4)}else if(c.int64AsNumber)$=K8.getUint32(w)*4294967296,$+=K8.getUint32(w+4);else $=K8.getBigUint64(w);w+=8;break;case 31:switch(q){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let J=[],Q,U=0;while((Q=h())!=i8){if(U>=K0)throw new Error(`Array length exceeds ${K0}`);J[U++]=Q}return q==4?J:q==3?J.join(""):Buffer.concat(J);case 5:let G;if(c.mapsAsObjects){let X={},N=0;if(c.keyMap)while((G=h())!=i8){if(N++>=V8)throw new Error(`Property count exceeds ${V8}`);X[C8(c.decodeKey(G))]=h()}else while((G=h())!=i8){if(N++>=V8)throw new Error(`Property count exceeds ${V8}`);X[C8(G)]=h()}return X}else{if(N0)c.mapsAsObjects=!0,N0=!1;let X=new Map;if(c.keyMap){let N=0;while((G=h())!=i8){if(N++>=V8)throw new Error(`Map size exceeds ${V8}`);X.set(c.decodeKey(G),h())}}else{let N=0;while((G=h())!=i8){if(N++>=V8)throw new Error(`Map size exceeds ${V8}`);X.set(G,h())}}return X}case 7:return i8;default:throw new Error("Invalid major type for indefinite length "+q)}default:throw new Error("Unknown token "+$)}switch(q){case 0:return $;case 1:return~$;case 2:return H1($);case 3:if(Y0>=w)return x0.slice(w-F0,(w+=$)-F0);if(Y0==0&&p8<140&&$<32){let U=$<16?lq($):w1($);if(U!=null)return U}return E1($);case 4:if($>=K0)throw new Error(`Array length exceeds ${K0}`);let J=new Array($);for(let U=0;U<$;U++)J[U]=h();return J;case 5:if($>=V8)throw new Error(`Map size exceeds ${K0}`);if(c.mapsAsObjects){let U={};if(c.keyMap)for(let G=0;G<$;G++)U[C8(c.decodeKey(h()))]=h();else for(let G=0;G<$;G++)U[C8(h())]=h();return U}else{if(N0)c.mapsAsObjects=!0,N0=!1;let U=new Map;if(c.keyMap)for(let G=0;G<$;G++)U.set(c.decodeKey(h()),h());else for(let G=0;G<$;G++)U.set(h(),h());return U}case 6:if($>=vq){let U=r[$&8191];if(U){if(!U.read)U.read=L$(U);return U.read()}if($<65536){if($==C1){let G=o8(),X=h(),N=h();C$(X,N);let K={};if(c.keyMap)for(let O=2;O<G;O++){let Z=c.decodeKey(N[O-2]);K[C8(Z)]=h()}else for(let O=2;O<G;O++){let Z=N[O-2];K[C8(Z)]=h()}return K}else if($==W1){let G=o8(),X=h();for(let N=2;N<G;N++)C$(X++,h());return h()}else if($==vq)return I1();if(c.getShared){if(w$(),U=r[$&8191],U){if(!U.read)U.read=L$(U);return U.read()}}}}let Q=o[$];if(Q)if(Q.handlesRead)return Q(h);else return Q(h());else{let U=h();for(let G=0;G<O$.length;G++){let X=O$[G]($,U);if(X!==void 0)return X}return new z8(U,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let U=(Y8||h8())[$];if(U!==void 0)return U;throw new Error("Unknown token "+$)}default:if(isNaN($)){let U=new Error("Unexpected end of CBOR data");throw U.incomplete=!0,U}throw new Error("Unknown CBOR token "+$)}}var cq=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function L$($){if(!$)throw new Error("Structure is required in record definition");function q(){let J=x[w++];if(J=J&31,J>23)switch(J){case 24:J=x[w++];break;case 25:J=K8.getUint16(w),w+=2;break;case 26:J=K8.getUint32(w),w+=4;break;default:throw new Error("Expected array header, but got "+x[w-1])}let Q=this.compiledReader;while(Q){if(Q.propertyCount===J)return Q(h);Q=Q.next}if(this.slowReads++>=pq){let G=this.length==J?this:this.slice(0,J);if(Q=c.keyMap?new Function("r","return {"+G.map((X)=>c.decodeKey(X)).map((X)=>cq.test(X)?C8(X)+":r()":"["+JSON.stringify(X)+"]:r()").join(",")+"}"):new Function("r","return {"+G.map((X)=>cq.test(X)?C8(X)+":r()":"["+JSON.stringify(X)+"]:r()").join(",")+"}"),this.compiledReader)Q.next=this.compiledReader;return Q.propertyCount=J,this.compiledReader=Q,Q(h)}let U={};if(c.keyMap)for(let G=0;G<J;G++)U[C8(c.decodeKey(this[G]))]=h();else for(let G=0;G<J;G++)U[C8(this[G])]=h();return U}return $.slowReads=0,q}function C8($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var E1=W$;function W$($){let q;if($<16){if(q=lq($))return q}if($>64&&Y$)return Y$.decode(x.subarray(w,w+=$));let J=w+$,Q=[];q="";while(w<J){let U=x[w++];if((U&128)===0)Q.push(U);else if((U&224)===192){let G=x[w++]&63;Q.push((U&31)<<6|G)}else if((U&240)===224){let G=x[w++]&63,X=x[w++]&63;Q.push((U&31)<<12|G<<6|X)}else if((U&248)===240){let G=x[w++]&63,X=x[w++]&63,N=x[w++]&63,K=(U&7)<<18|G<<12|X<<6|N;if(K>65535)K-=65536,Q.push(K>>>10&1023|55296),K=56320|K&1023;Q.push(K)}else Q.push(U);if(Q.length>=4096)q+=$8.apply(String,Q),Q.length=0}if(Q.length>0)q+=$8.apply(String,Q);return q}var $8=String.fromCharCode;function w1($){let q=w,J=new Array($);for(let Q=0;Q<$;Q++){let U=x[w++];if((U&128)>0){w=q;return}J[Q]=U}return $8.apply(String,J)}function lq($){if($<4)if($<2)if($===0)return"";else{let q=x[w++];if((q&128)>1){w-=1;return}return $8(q)}else{let q=x[w++],J=x[w++];if((q&128)>0||(J&128)>0){w-=2;return}if($<3)return $8(q,J);let Q=x[w++];if((Q&128)>0){w-=3;return}return $8(q,J,Q)}else{let q=x[w++],J=x[w++],Q=x[w++],U=x[w++];if((q&128)>0||(J&128)>0||(Q&128)>0||(U&128)>0){w-=4;return}if($<6)if($===4)return $8(q,J,Q,U);else{let G=x[w++];if((G&128)>0){w-=5;return}return $8(q,J,Q,U,G)}else if($<8){let G=x[w++],X=x[w++];if((G&128)>0||(X&128)>0){w-=6;return}if($<7)return $8(q,J,Q,U,G,X);let N=x[w++];if((N&128)>0){w-=7;return}return $8(q,J,Q,U,G,X,N)}else{let G=x[w++],X=x[w++],N=x[w++],K=x[w++];if((G&128)>0||(X&128)>0||(N&128)>0||(K&128)>0){w-=8;return}if($<10)if($===8)return $8(q,J,Q,U,G,X,N,K);else{let O=x[w++];if((O&128)>0){w-=9;return}return $8(q,J,Q,U,G,X,N,K,O)}else if($<12){let O=x[w++],Z=x[w++];if((O&128)>0||(Z&128)>0){w-=10;return}if($<11)return $8(q,J,Q,U,G,X,N,K,O,Z);let W=x[w++];if((W&128)>0){w-=11;return}return $8(q,J,Q,U,G,X,N,K,O,Z,W)}else{let O=x[w++],Z=x[w++],W=x[w++],z=x[w++];if((O&128)>0||(Z&128)>0||(W&128)>0||(z&128)>0){w-=12;return}if($<14)if($===12)return $8(q,J,Q,U,G,X,N,K,O,Z,W,z);else{let A=x[w++];if((A&128)>0){w-=13;return}return $8(q,J,Q,U,G,X,N,K,O,Z,W,z,A)}else{let A=x[w++],B=x[w++];if((A&128)>0||(B&128)>0){w-=14;return}if($<15)return $8(q,J,Q,U,G,X,N,K,O,Z,W,z,A,B);let P=x[w++];if((P&128)>0){w-=15;return}return $8(q,J,Q,U,G,X,N,K,O,Z,W,z,A,B,P)}}}}}function H1($){return c.copyBuffers?Uint8Array.prototype.slice.call(x,w,w+=$):x.subarray(w,w+=$)}var uq=new Float32Array(1),P0=new Uint8Array(uq.buffer,0,4);function T1(){let $=x[w++],q=x[w++],J=($&127)>>2;if(J===31){if(q||$&3)return NaN;return $&128?-1/0:1/0}if(J===0){let Q=(($&3)<<8|q)/16777216;return $&128?-Q:Q}return P0[3]=$&128|(J>>1)+56,P0[2]=($&7)<<5|q>>3,P0[1]=q<<5,P0[0]=0,uq[0]}var xQ=new Array(4096);class z8{constructor($,q){this.value=$,this.tag=q}}o[0]=($)=>{return new Date($)};o[1]=($)=>{return new Date(Math.round($*1000))};o[2]=($)=>{let q=BigInt(0);for(let J=0,Q=$.byteLength;J<Q;J++)q=BigInt($[J])+(q<<BigInt(8));return q};o[3]=($)=>{return BigInt(-1)-o[2]($)};o[4]=($)=>{return+($[1]+"e"+$[0])};o[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var C$=($,q)=>{$=$-57344;let J=r[$];if(J&&J.isShared)(r.restoreStructures||(r.restoreStructures=[]))[$]=J;r[$]=q,q.read=L$(q)};o[L1]=($)=>{let q=$.length,J=$[1];C$($[0],J);let Q={};for(let U=2;U<q;U++){let G=J[U-2];Q[C8(G)]=$[U]}return Q};o[14]=($)=>{if(a)return a[0].slice(a.position0,a.position0+=$);return new z8($,14)};o[15]=($)=>{if(a)return a[1].slice(a.position1,a.position1+=$);return new z8($,15)};var z1={Error,RegExp};o[27]=($)=>{return(z1[$[0]]||Error)($[1],$[2])};var dq=($)=>{if(x[w++]!=132){let J=new Error("Packed values structure must be followed by a 4 element array");if(x.length<w)J.incomplete=!0;throw J}let q=$();if(!q||!q.length){let J=new Error("Packed values structure must be followed by a 4 element array");throw J.incomplete=!0,J}return Y8=Y8?q.concat(Y8.slice(q.length)):q,Y8.prefixes=$(),Y8.suffixes=$(),$()};dq.handlesRead=!0;o[51]=dq;o[mq]=($)=>{if(!Y8)if(c.getShared)w$();else return new z8($,mq);if(typeof $=="number")return Y8[16+($>=0?2*$:-2*$-1)];let q=new Error("No support for non-integer packed references yet");if($===void 0)q.incomplete=!0;throw q};o[28]=($)=>{if(!W8)W8=new Map,W8.id=0;let q=W8.id++,J=w,Q=x[w],U;if(Q>>5==4)U=[];else U={};let G={target:U};W8.set(q,G);let X=$();if(G.used){if(Object.getPrototypeOf(U)!==Object.getPrototypeOf(X))w=J,U=X,W8.set(q,{target:U}),X=$();return Object.assign(U,X)}return G.target=X,X};o[28].handlesRead=!0;o[29]=($)=>{let q=W8.get($);return q.used=!0,q.target};o[258]=($)=>new Set($);(o[259]=($)=>{if(c.mapsAsObjects)c.mapsAsObjects=!1,N0=!0;return $()}).handlesRead=!0;function r8($,q){if(typeof $==="string")return $+q;if($ instanceof Array)return $.concat(q);return Object.assign({},$,q)}function h8(){if(!Y8)if(c.getShared)w$();else throw new Error("No packed values available");return Y8}var D1=1399353956;O$.push(($,q)=>{if($>=225&&$<=255)return r8(h8().prefixes[$-224],q);if($>=28704&&$<=32767)return r8(h8().prefixes[$-28672],q);if($>=1879052288&&$<=2147483647)return r8(h8().prefixes[$-1879048192],q);if($>=216&&$<=223)return r8(q,h8().suffixes[$-216]);if($>=27647&&$<=28671)return r8(q,h8().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return r8(q,h8().suffixes[$-1811939328]);if($==D1)return{packedValues:Y8,structures:r.slice(0),version:q};if($==55799)return q});var R1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,E$=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],B1=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<E$.length;$++)f1(E$[$],B1[$]);function f1($,q){let J="get"+$.name.slice(0,-5),Q;if(typeof $==="function")Q=$.BYTES_PER_ELEMENT;else $=null;for(let U=0;U<2;U++){if(!U&&Q==1)continue;let G=Q==2?1:Q==4?2:Q==8?3:0;o[U?q:q-4]=Q==1||U==R1?(X)=>{if(!$)throw new Error("Could not find typed array for code "+q);if(!c.copyBuffers){if(Q===1||Q===2&&!(X.byteOffset&1)||Q===4&&!(X.byteOffset&3)||Q===8&&!(X.byteOffset&7))return new $(X.buffer,X.byteOffset,X.byteLength>>G)}return new $(Uint8Array.prototype.slice.call(X,0).buffer)}:(X)=>{if(!$)throw new Error("Could not find typed array for code "+q);let N=new DataView(X.buffer,X.byteOffset,X.byteLength),K=X.length>>G,O=new $(K),Z=N[J];for(let W=0;W<K;W++)O[W]=Z.call(N,W<<G,U);return O}}}function I1(){let $=o8(),q=w+h();for(let Q=2;Q<$;Q++){let U=o8();w+=U}let J=w;return w=q,a=[W$(o8()),W$(o8())],a.position0=0,a.position1=0,a.postBundlePosition=w,w=J,h()}function o8(){let $=x[w++]&31;if($>23)switch($){case 24:$=x[w++];break;case 25:$=K8.getUint16(w),w+=2;break;case 26:$=K8.getUint32(w),w+=4;break}return $}function w$(){if(c.getShared){let $=nq(()=>{return x=null,c.getShared()})||{},q=$.structures||[];if(c.sharedVersion=$.version,Y8=c.sharedValues=$.packedValues,r===!0)c.structures=r=q;else r.splice.apply(r,[0,q.length].concat(q))}}function nq($){let q=p8,J=w,Q=M$,U=F0,G=Y0,X=x0,N=Z$,K=W8,O=a,Z=new Uint8Array(x.slice(0,p8)),W=r,z=c,A=Z0,B=$();return p8=q,w=J,M$=Q,F0=U,Y0=G,x0=X,Z$=N,W8=K,a=O,x=Z,Z0=A,r=W,c=z,K8=new DataView(x.buffer,x.byteOffset,x.byteLength),B}function k0(){x=null,W8=null,r=null}var y0=new Array(147);for(let $=0;$<256;$++)y0[$]=+("1e"+Math.floor(45.15-$*0.30103));var H$=new _8({useRecords:!1}),_0=H$.decode,A1=H$.decodeMultiple;var S0;try{S0=new TextEncoder}catch($){}var B$,eq,v0=typeof globalThis==="object"&&globalThis.Buffer,M0=typeof v0!=="undefined",T$=M0?v0.allocUnsafeSlow:Uint8Array,iq=M0?v0:Uint8Array,rq=256,oq=M0?4294967296:2144337920;var z$,L,n,Y=0,S8,s=null,j1=61440,V1=/[\u0080-\uFFFF]/,M8=Symbol("record-id");class m0 extends _8{constructor($){super($);this.offset=0;let q,J,Q,U,G,X;$=$||{};let N=iq.prototype.utf8Write?function(M,T,C){return L.utf8Write(M,T,C)}:S0&&S0.encodeInto?function(M,T){return S0.encodeInto(M,L.subarray(T)).written}:!1,K=this,O=$.structures||$.saveStructures,Z=$.maxSharedStructures;if(Z==null)Z=O?128:0;if(Z>8190)throw new Error("Maximum maxSharedStructure is 8190");let W=$.sequential;if(W)Z=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let z,A,B=$.sharedValues,P;if(B){P=Object.create(null);for(let M=0,T=B.length;M<T;M++)P[B[M]]=M}let E=[],I=0,f=0;this.mapEncode=function(M,T){if(this._keyMap&&!this._mapped)switch(M.constructor.name){case"Array":M=M.map((C)=>this.encodeKeys(C));break}return this.encode(M,T)},this.encode=function(M,T){if(!L)L=new T$(8192),n=new DataView(L.buffer,0,8192),Y=0;if(S8=L.length-10,S8-Y<2048)L=new T$(L.length),n=new DataView(L.buffer,0,L.length),S8=L.length-10,Y=0;else if(T===I$)Y=Y+7&2147483640;if(J=Y,K.useSelfDescribedHeader)n.setUint32(Y,3654940416),Y+=3;if(X=K.structuredClone?new Map:null,K.bundleStrings&&typeof M!=="string")s=[],s.size=1/0;else s=null;if(Q=K.structures,Q){if(Q.uninitialized){let H=K.getShared()||{};K.structures=Q=H.structures||[],K.sharedVersion=H.version;let D=K.sharedValues=H.packedValues;if(D){P={};for(let V=0,k=D.length;V<k;V++)P[D[V]]=V}}let C=Q.length;if(C>Z&&!W)C=Z;if(!Q.transitions){Q.transitions=Object.create(null);for(let H=0;H<C;H++){let D=Q[H];if(!D)continue;let V,k=Q.transitions;for(let y=0,_=D.length;y<_;y++){if(k[M8]===void 0)k[M8]=H;let g=D[y];if(V=k[g],!V)V=k[g]=Object.create(null);k=V}k[M8]=H|1048576}}if(!W)Q.nextId=C}if(U)U=!1;if(G=Q||[],A=P,$.pack){let C=new Map;if(C.values=[],C.encoder=K,C.maxValues=$.maxPrivatePackedValues||(P?16:1/0),C.objectMap=P||!1,C.samplingPackedValues=z,g0(M,C),C.values.length>0){L[Y++]=216,L[Y++]=51,R8(4);let H=C.values;R(H),R8(0),R8(0),A=Object.create(P||null);for(let D=0,V=H.length;D<V;D++)A[H[D]]=D}}z$=T&R$;try{if(z$)return;if(R(M),s)sq(J,R);if(K.offset=Y,X&&X.idsToInsert){if(Y+=X.idsToInsert.length*2,Y>S8)m(Y);K.offset=Y;let C=F1(L.subarray(J,Y),X.idsToInsert);return X=null,C}if(T&I$)return L.start=J,L.end=Y,L;return L.subarray(J,Y)}finally{if(Q){if(f<10)f++;if(Q.length>Z)Q.length=Z;if(I>1e4){if(Q.transitions=null,f=0,I=0,E.length>0)E=[]}else if(E.length>0&&!W){for(let C=0,H=E.length;C<H;C++)E[C][M8]=void 0;E=[]}}if(U&&K.saveShared){if(K.structures.length>Z)K.structures=K.structures.slice(0,Z);let C=L.subarray(J,Y);if(K.updateSharedData()===!1)return K.encode(M);return C}if(T&S1)Y=J}},this.findCommonStringsToPack=()=>{if(z=new Map,!P)P=Object.create(null);return(M)=>{let T=M&&M.threshold||4,C=this.pack?M.maxPrivatePackedValues||16:0;if(!B)B=this.sharedValues=[];for(let[H,D]of z)if(D.count>T)P[H]=C++,B.push(H),U=!0;while(this.saveShared&&this.updateSharedData()===!1);z=null}};let R=(M)=>{if(Y>S8)L=m(Y);var T=typeof M,C;if(T==="string"){if(A){let k=A[M];if(k>=0){if(k<16)L[Y++]=k+224;else if(L[Y++]=198,k&1)R(15-k>>1);else R(k-16>>1);return}else if(z&&!$.pack){let y=z.get(M);if(y)y.count++;else z.set(M,{count:1})}}let H=M.length;if(s&&H>=4&&H<1024){if((s.size+=H)>j1){let y,_=(s[0]?s[0].length*3+s[1].length:0)+10;if(Y+_>S8)L=m(Y+_);if(L[Y++]=217,L[Y++]=223,L[Y++]=249,L[Y++]=s.position?132:130,L[Y++]=26,y=Y-J,Y+=4,s.position)sq(J,R);s=["",""],s.size=0,s.position=y}let k=V1.test(M);s[k?0:1]+=M,L[Y++]=k?206:207,R(H);return}let D;if(H<32)D=1;else if(H<256)D=2;else if(H<65536)D=3;else D=5;let V=H*3;if(Y+V>S8)L=m(Y+V);if(H<64||!N){let k,y,_,g=Y+D;for(k=0;k<H;k++)if(y=M.charCodeAt(k),y<128)L[g++]=y;else if(y<2048)L[g++]=y>>6|192,L[g++]=y&63|128;else if((y&64512)===55296&&((_=M.charCodeAt(k+1))&64512)===56320)y=65536+((y&1023)<<10)+(_&1023),k++,L[g++]=y>>18|240,L[g++]=y>>12&63|128,L[g++]=y>>6&63|128,L[g++]=y&63|128;else L[g++]=y>>12|224,L[g++]=y>>6&63|128,L[g++]=y&63|128;C=g-Y-D}else C=N(M,Y+D,V);if(C<24)L[Y++]=96|C;else if(C<256){if(D<2)L.copyWithin(Y+2,Y+1,Y+1+C);L[Y++]=120,L[Y++]=C}else if(C<65536){if(D<3)L.copyWithin(Y+3,Y+2,Y+2+C);L[Y++]=121,L[Y++]=C>>8,L[Y++]=C&255}else{if(D<5)L.copyWithin(Y+5,Y+3,Y+3+C);L[Y++]=122,n.setUint32(Y,C),Y+=4}Y+=C}else if(T==="number")if(!this.alwaysUseFloat&&M>>>0===M)if(M<24)L[Y++]=M;else if(M<256)L[Y++]=24,L[Y++]=M;else if(M<65536)L[Y++]=25,L[Y++]=M>>8,L[Y++]=M&255;else L[Y++]=26,n.setUint32(Y,M),Y+=4;else if(!this.alwaysUseFloat&&M>>0===M)if(M>=-24)L[Y++]=31-M;else if(M>=-256)L[Y++]=56,L[Y++]=~M;else if(M>=-65536)L[Y++]=57,n.setUint16(Y,~M),Y+=2;else L[Y++]=58,n.setUint32(Y,~M),Y+=4;else{let H;if((H=this.useFloat32)>0&&M<4294967296&&M>=-2147483648){L[Y++]=250,n.setFloat32(Y,M);let D;if(H<4||(D=M*y0[(L[Y]&127)<<1|L[Y+1]>>7])>>0===D){Y+=4;return}else Y--}L[Y++]=251,n.setFloat64(Y,M),Y+=8}else if(T==="object")if(!M)L[Y++]=246;else{if(X){let D=X.get(M);if(D){if(L[Y++]=216,L[Y++]=29,L[Y++]=25,!D.references){let V=X.idsToInsert||(X.idsToInsert=[]);D.references=[],V.push(D)}D.references.push(Y-J),Y+=2;return}else X.set(M,{offset:Y-J})}let H=M.constructor;if(H===Object)v(M);else if(H===Array){if(C=M.length,C<24)L[Y++]=128|C;else R8(C);for(let D=0;D<C;D++)R(M[D])}else if(H===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)L[Y++]=217,L[Y++]=1,L[Y++]=3;if(C=M.size,C<24)L[Y++]=160|C;else if(C<256)L[Y++]=184,L[Y++]=C;else if(C<65536)L[Y++]=185,L[Y++]=C>>8,L[Y++]=C&255;else L[Y++]=186,n.setUint32(Y,C),Y+=4;if(K.keyMap)for(let[D,V]of M)R(K.encodeKey(D)),R(V);else for(let[D,V]of M)R(D),R(V)}else{for(let D=0,V=B$.length;D<V;D++){let k=eq[D];if(M instanceof k){let y=B$[D],_=y.tag;if(_==null)_=y.getTag&&y.getTag.call(this,M);if(_<24)L[Y++]=192|_;else if(_<256)L[Y++]=216,L[Y++]=_;else if(_<65536)L[Y++]=217,L[Y++]=_>>8,L[Y++]=_&255;else if(_>-1)L[Y++]=218,n.setUint32(Y,_),Y+=4;y.encode.call(this,M,R,m);return}}if(M[Symbol.iterator]){if(z$){let D=new Error("Iterable should be serialized as iterator");throw D.iteratorNotHandled=!0,D}L[Y++]=159;for(let D of M)R(D);L[Y++]=255;return}if(M[Symbol.asyncIterator]||D$(M)){let D=new Error("Iterable/blob should be serialized as iterator");throw D.iteratorNotHandled=!0,D}if(this.useToJSON&&M.toJSON){let D=M.toJSON();if(D!==M)return R(D)}v(M)}}else if(T==="boolean")L[Y++]=M?245:244;else if(T==="bigint"){if(M<BigInt(1)<<BigInt(64)&&M>=0)L[Y++]=27,n.setBigUint64(Y,M);else if(M>-(BigInt(1)<<BigInt(64))&&M<0)L[Y++]=59,n.setBigUint64(Y,-M-BigInt(1));else if(this.largeBigIntToFloat)L[Y++]=251,n.setFloat64(Y,Number(M));else{if(M>=BigInt(0))L[Y++]=194;else L[Y++]=195,M=BigInt(-1)-M;let H=[];while(M)H.push(Number(M&BigInt(255))),M>>=BigInt(8);f$(new Uint8Array(H.reverse()),m);return}Y+=8}else if(T==="undefined")L[Y++]=247;else throw new Error("Unknown type: "+T)},v=this.useRecords===!1?this.variableMapSize?(M)=>{let T=Object.keys(M),C=Object.values(M),H=T.length;if(H<24)L[Y++]=160|H;else if(H<256)L[Y++]=184,L[Y++]=H;else if(H<65536)L[Y++]=185,L[Y++]=H>>8,L[Y++]=H&255;else L[Y++]=186,n.setUint32(Y,H),Y+=4;let D;if(K.keyMap)for(let V=0;V<H;V++)R(K.encodeKey(T[V])),R(C[V]);else for(let V=0;V<H;V++)R(T[V]),R(C[V])}:(M)=>{L[Y++]=185;let T=Y-J;Y+=2;let C=0;if(K.keyMap){for(let H in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(H))R(K.encodeKey(H)),R(M[H]),C++}else for(let H in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(H))R(H),R(M[H]),C++;L[T+++J]=C>>8,L[T+J]=C&255}:(M,T)=>{let C,H=G.transitions||(G.transitions=Object.create(null)),D=0,V=0,k,y;if(this.keyMap){y=Object.keys(M).map((g)=>this.encodeKey(g)),V=y.length;for(let g=0;g<V;g++){let s8=y[g];if(C=H[s8],!C)C=H[s8]=Object.create(null),D++;H=C}}else for(let g in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(g)){if(C=H[g],!C){if(H[M8]&1048576)k=H[M8]&65535;C=H[g]=Object.create(null),D++}H=C,V++}let _=H[M8];if(_!==void 0)_&=65535,L[Y++]=217,L[Y++]=_>>8|224,L[Y++]=_&255;else{if(!y)y=H.__keys__||(H.__keys__=Object.keys(M));if(k===void 0){if(_=G.nextId++,!_)_=0,G.nextId=1;if(_>=rq)G.nextId=(_=Z)+1}else _=k;if(G[_]=y,_<Z){L[Y++]=217,L[Y++]=_>>8|224,L[Y++]=_&255,H=G.transitions;for(let g=0;g<V;g++){if(H[M8]===void 0||H[M8]&1048576)H[M8]=_;H=H[y[g]]}H[M8]=_|1048576,U=!0}else{if(H[M8]=_,n.setUint32(Y,3655335680),Y+=3,D)I+=f*D;if(E.length>=rq-Z)E.shift()[M8]=void 0;if(E.push(H),R8(V+2),R(57344+_),R(y),T)return;for(let g in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(g))R(M[g]);return}}if(V<24)L[Y++]=128|V;else R8(V);if(T)return;for(let g in M)if(typeof M.hasOwnProperty!=="function"||M.hasOwnProperty(g))R(M[g])},m=(M)=>{let T;if(M>16777216){if(M-J>oq)throw new Error("Encoded buffer would be larger than maximum buffer size");T=Math.min(oq,Math.round(Math.max((M-J)*(M>67108864?1.25:2),4194304)/4096)*4096)}else T=(Math.max(M-J<<2,L.length-1)>>12)+1<<12;let C=new T$(T);if(n=new DataView(C.buffer,0,T),L.copy)L.copy(C,0,J,M);else C.set(L.slice(J,M));return Y-=J,J=0,S8=C.length-10,L=C},l=100,b=1000;this.encodeAsIterable=function(M,T){return p(M,T,j)},this.encodeAsAsyncIterable=function(M,T){return p(M,T,d)};function*j(M,T,C){let H=M.constructor;if(H===Object){let D=K.useRecords!==!1;if(D)v(M,!0);else aq(Object.keys(M).length,160);for(let V in M){let k=M[V];if(!D)R(V);if(k&&typeof k==="object")if(T[V])yield*j(k,T[V]);else yield*F(k,T,V);else R(k)}}else if(H===Array){let D=M.length;R8(D);for(let V=0;V<D;V++){let k=M[V];if(k&&(typeof k==="object"||Y-J>l))if(T.element)yield*j(k,T.element);else yield*F(k,T,"element");else R(k)}}else if(M[Symbol.iterator]&&!M.buffer){L[Y++]=159;for(let D of M)if(D&&(typeof D==="object"||Y-J>l))if(T.element)yield*j(D,T.element);else yield*F(D,T,"element");else R(D);L[Y++]=255}else if(D$(M))aq(M.size,64),yield L.subarray(J,Y),yield M,S();else if(M[Symbol.asyncIterator])L[Y++]=159,yield L.subarray(J,Y),yield M,S(),L[Y++]=255;else R(M);if(C&&Y>J)yield L.subarray(J,Y);else if(Y-J>l)yield L.subarray(J,Y),S()}function*F(M,T,C){let H=Y-J;try{if(R(M),Y-J>l)yield L.subarray(J,Y),S()}catch(D){if(D.iteratorNotHandled)T[C]={},Y=J+H,yield*j.call(this,M,T[C]);else throw D}}function S(){l=b,K.encode(null,R$)}function p(M,T,C){if(T&&T.chunkThreshold)l=b=T.chunkThreshold;else l=100;if(M&&typeof M==="object")return K.encode(null,R$),C(M,K.iterateProperties||(K.iterateProperties={}),!0);return[K.encode(M)]}async function*d(M,T){for(let C of j(M,T,!0)){let H=C.constructor;if(H===iq||H===Uint8Array)yield C;else if(D$(C)){let D=C.stream().getReader(),V;while(!(V=await D.read()).done)yield V.value}else if(C[Symbol.asyncIterator])for await(let D of C)if(S(),D)yield*d(D,T.async||(T.async={}));else yield K.encode(D);else yield C}}}useBuffer($){L=$,n=new DataView(L.buffer,L.byteOffset,L.byteLength),Y=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let q=this.structures.slice(0),J=new A$(q,this.sharedValues,this.sharedVersion),Q=this.saveShared(J,(U)=>(U&&U.version||0)==$);if(Q===!1)J=this.getShared()||{},this.structures=J.structures||[],this.sharedValues=J.packedValues,this.sharedVersion=J.version,this.structures.nextId=this.structures.length;else q.forEach((U,G)=>this.structures[G]=U);return Q}}function aq($,q){if($<24)L[Y++]=q|$;else if($<256)L[Y++]=q|24,L[Y++]=$;else if($<65536)L[Y++]=q|25,L[Y++]=$>>8,L[Y++]=$&255;else L[Y++]=q|26,n.setUint32(Y,$),Y+=4}class A${constructor($,q,J){this.structures=$,this.packedValues=q,this.version=J}}function R8($){if($<24)L[Y++]=128|$;else if($<256)L[Y++]=152,L[Y++]=$;else if($<65536)L[Y++]=153,L[Y++]=$>>8,L[Y++]=$&255;else L[Y++]=154,n.setUint32(Y,$),Y+=4}var P1=typeof Blob==="undefined"?function(){}:Blob;function D$($){if($ instanceof P1)return!0;let q=$[Symbol.toStringTag];return q==="Blob"||q==="File"}function g0($,q){switch(typeof $){case"string":if($.length>3){if(q.objectMap[$]>-1||q.values.length>=q.maxValues)return;let Q=q.get($);if(Q){if(++Q.count==2)q.values.push($)}else if(q.set($,{count:1}),q.samplingPackedValues){let U=q.samplingPackedValues.get($);if(U)U.count++;else q.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let Q=0,U=$.length;Q<U;Q++)g0($[Q],q);else{let Q=!q.encoder.useRecords;for(var J in $)if($.hasOwnProperty(J)){if(Q)g0(J,q);g0($[J],q)}}break;case"function":console.log($)}}var x1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;eq=[Date,Set,Error,RegExp,z8,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,A$];B$=[{tag:1,encode($,q){let J=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&J>=0&&J<4294967296)L[Y++]=26,n.setUint32(Y,J),Y+=4;else L[Y++]=251,n.setFloat64(Y,J),Y+=8}},{tag:258,encode($,q){let J=Array.from($);q(J)}},{tag:27,encode($,q){q([$.name,$.message])}},{tag:27,encode($,q){q(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,q){q($.value)}},{encode($,q,J){f$($,J)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||M0&&this.tagUint8Array!==!1)return 64}},encode($,q,J){f$($,J)}},D8(68,1),D8(69,2),D8(70,4),D8(71,8),D8(72,1),D8(77,2),D8(78,4),D8(79,8),D8(85,4),D8(86,8),{encode($,q){let J=$.packedValues||[],Q=$.structures||[];if(J.values.length>0){L[Y++]=216,L[Y++]=51,R8(4);let U=J.values;q(U),R8(0),R8(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let G=0,X=U.length;G<X;G++)packedObjectMap[U[G]]=G}if(Q){n.setUint32(Y,3655335424),Y+=3;let U=Q.slice(0);U.unshift(57344),U.push(new z8($.version,1399353956)),q(U)}else q(new z8($.version,1399353956))}}];function D8($,q){if(!x1&&q>1)$-=4;return{tag:$,encode:function J(Q,U){let G=Q.byteLength,X=Q.byteOffset||0,N=Q.buffer||Q;U(M0?v0.from(N,X,G):new Uint8Array(N,X,G))}}}function f$($,q){let J=$.byteLength;if(J<24)L[Y++]=64+J;else if(J<256)L[Y++]=88,L[Y++]=J;else if(J<65536)L[Y++]=89,L[Y++]=J>>8,L[Y++]=J&255;else L[Y++]=90,n.setUint32(Y,J),Y+=4;if(Y+J>=L.length)q(Y+J);L.set($.buffer?$:new Uint8Array($),Y),Y+=J}function F1($,q){let J,Q=q.length*2,U=$.length-Q;q.sort((G,X)=>G.offset>X.offset?1:-1);for(let G=0;G<q.length;G++){let X=q[G];X.id=G;for(let N of X.references)$[N++]=G>>8,$[N]=G&255}while(J=q.pop()){let G=J.offset;$.copyWithin(G+Q,G,U),Q-=2;let X=G+Q;$[X++]=216,$[X++]=28,U=G}return $}function sq($,q){n.setUint32(s.position+$,Y-s.position-$+1);let J=s;s=null,q(J[0]),q(J[1])}var j$=new m0({useRecords:!1}),k1=j$.encode,y1=j$.encodeAsIterable,_1=j$.encodeAsAsyncIterable;var I$=512,S1=1024,R$=2048;var b0=($)=>{let q=new Uint8Array($),J="";for(let Q=0;Q<q.byteLength;Q++)J+=String.fromCharCode(q[Q]);return btoa(J).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},$J=($)=>{let q=atob($.replace(/-/g,"+").replace(/_/g,"/")),J=new Uint8Array(q.length);for(let Q=0;Q<q.length;Q++)J[Q]=q.charCodeAt(Q);return J.buffer};async function qJ($){let q=crypto.getRandomValues(new Uint8Array(32)),J=crypto.getRandomValues(new Uint8Array(16)),Q=await navigator.credentials.create({publicKey:{challenge:q,rp:{name:"Sorane Web/A Form"},user:{id:J,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:60000,attestation:"none"}});if(!Q)throw new Error("Credential creation failed");return{id:Q.id,rawId:b0(Q.rawId),response:Q.response}}async function JJ($,q){let J=await navigator.credentials.get({publicKey:{challenge:q,allowCredentials:[{id:$J($),type:"public-key"}],userVerification:"required"}});if(!J)throw new Error("Assertion failed");let Q=J.response;return{id:J.id,signature:b0(Q.signature),authenticatorData:b0(Q.authenticatorData),clientDataJSON:b0(Q.clientDataJSON)}}async function c0($,q){let J=crypto.getRandomValues(new Uint8Array(32)),Q=await navigator.credentials.get({publicKey:{challenge:J,allowCredentials:[{id:$J($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:q}}}}});if(!Q)throw new Error("Assertion failed");let G=Q.getClientExtensionResults()?.prf?.results?.first;if(!G)throw new Error("PRF extension not available");return new Uint8Array(G)}function O0($){return Array.from($).map((q)=>q.toString(16).padStart(2,"0")).join("")}function QJ($){let q=new Uint8Array($.length/2);for(let J=0;J<q.length;J++)q[J]=parseInt($.substring(J*2,J*2+2),16);return q}class GJ{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),q=localStorage.getItem("weba_passkey_pub");if($&&q){this.credentialId=$,this.publicKey=QJ(q),this.publicKeyType="p256",this.usePasskey=!0;return}let J=localStorage.getItem("weba_private_key");if(J)this.edPrivateKey=QJ(J),this.publicKey=y8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey...");let $=await qJ("User"),q=new Uint8Array($.response.attestationObject),Q=_0(q).authData,U=new DataView(Q.buffer,Q.byteOffset,Q.byteLength),G=53,X=U.getUint16(G);G+=2,G+=X;let N=Q.slice(G),K=_0(N),O=K.get(-2),Z=K.get(-3);if(!O||!Z)throw new Error("Invalid COSE Key: x or y missing");let W=new Uint8Array(65);if(W[0]=4,W.set(O,1),W.set(Z,33),this.credentialId=$.rawId,this.publicKey=W,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",O0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=y8.utils.randomSecretKey(),this.publicKey=y8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",O0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${O0(this.publicKey)}`}getPublicKey(){return this.publicKey?O0(this.publicKey):""}async sign($,q="authentication"){if(!this.publicKey)await this.register();let J=UJ.default($),Q=new TextEncoder().encode(J);if(this.usePasskey&&this.credentialId){let U=await crypto.subtle.digest("SHA-256",Q),G=await JJ(this.credentialId,U);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:G.signature,"srn:authenticatorData":G.authenticatorData,"srn:clientDataJSON":G.clientDataJSON,"srn:credentialId":G.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let U=y8.sign(Q,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:O0(U)}}}}}var a8=new GJ;class V${oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,q){if(t8($),u(q,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let J=this.blockLen,Q=new Uint8Array(J);Q.set(q.length>J?$.create().update(q).digest():q);for(let U=0;U<Q.length;U++)Q[U]^=54;this.iHash.update(Q),this.oHash=$.create();for(let U=0;U<Q.length;U++)Q[U]^=106;this.oHash.update(Q),E8(Q)}update($){return l8(this),this.iHash.update($),this}digestInto($){l8(this),u($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:q,iHash:J,finished:Q,destroyed:U,blockLen:G,outputLen:X}=this;return $=$,$.finished=Q,$.destroyed=U,$.blockLen=G,$.outputLen=X,$.oHash=q._cloneInto($.oHash),$.iHash=J._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var h0=($,q,J)=>new V$($,q).update(J).digest();h0.create=($,q)=>new V$($,q);function g1($,q,J){if(t8($),J===void 0)J=new Uint8Array($.outputLen);return h0($,J,q)}var P$=Uint8Array.of(0),XJ=Uint8Array.of();function v1($,q,J,Q=32){t8($),H8(Q,"length");let U=$.outputLen;if(Q>255*U)throw new Error("Length must be <= 255*HashLen");let G=Math.ceil(Q/U);if(J===void 0)J=XJ;else u(J,void 0,"info");let X=new Uint8Array(G*U),N=h0.create($,q),K=N._cloneInto(),O=new Uint8Array(N.outputLen);for(let Z=0;Z<G;Z++)P$[0]=Z+1,K.update(Z===0?XJ:O).update(J).update(P$).digestInto(O),X.set(O,U*Z),N._cloneInto(K);return N.destroy(),K.destroy(),E8(O,P$),X.slice(0,Q)}var Z8=($,q,J,Q,U)=>v1($,g1($,q,J),Q,U);var YJ=h$(N$(),1),KJ="weba_l2_ed25519_sk";function O8($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let q="";return $.forEach((Q)=>{q+=String.fromCharCode(Q)}),btoa(q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function t($){let q=$.length%4===0?"":"=".repeat(4-$.length%4),J=$.replace(/-/g,"+").replace(/_/g,"/")+q;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(J,"base64"));let Q=atob(J),U=new Uint8Array(Q.length);for(let G=0;G<Q.length;G+=1)U[G]=Q.charCodeAt(G);return U}function L0($){let q=YJ.default($);if(q===void 0)throw new Error("Failed to canonicalize JSON");return q}function NJ($){let q=new Uint8Array($);return crypto.getRandomValues(q),q}function m1(){let $=localStorage.getItem(KJ);if($)return t($);let q=y8.utils.randomSecretKey();return localStorage.setItem(KJ,O8(q)),q}function b1($,q,J){let Q={layer1_ref:$,recipient:q,weba_version:J};return new TextEncoder().encode(L0(Q))}function ZJ($,q){let J=new Uint8Array($.length+q.length);return J.set($,0),J.set(q,$.length),J}function MJ($){let q=$.keyPolicy??"campaign+layer1";if(q==="campaign+layer1"&&!$.layer1Ref)throw new Error("layer1_ref is required for campaign+layer1 policy");let J=L0({domain:"weba-l2/org-x25519",campaign_id:$.campaignId,key_policy:q,layer1_ref:q==="campaign+layer1"?$.layer1Ref:void 0}),Q=new TextEncoder().encode(J),U=Z8(N8,$.orgRootKey,void 0,Q,32);return{publicKey:X0.getPublicKey(U),privateKey:U,keyPolicy:q}}function OJ(){return globalThis.webaPqcKem||null}async function LJ($,q,J,Q){let U=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["encrypt"]),G=await crypto.subtle.encrypt({name:"AES-GCM",iv:J,additionalData:Q},U,$);return new Uint8Array(G)}async function WJ($){let q=Z8(N8,$.prfKey,void 0,void 0,32),J=Z8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=Z8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),U=$.aad??new Uint8Array;return LJ($.recipientSk,J,Q,U)}async function CJ($,q,J,Q){let U=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["decrypt"]),G=await crypto.subtle.decrypt({name:"AES-GCM",iv:J,additionalData:Q},U,$);return new Uint8Array(G)}async function EJ($){let q=$.config.weba_version??"0.1",J=$.config.recipient_kid,Q=$.config.layer1_ref,U=$.user_kid??"user#sig-1",G=m1(),X=L0($.layer2_plain),N=new TextEncoder().encode(X),K=y8.sign(N,G),O={alg:"Ed25519",kid:U,sig:O8(K),created_at:new Date().toISOString()},Z={layer2_plain:$.layer2_plain,layer2_sig:O},W=b1(Q,J,q),z=new TextEncoder().encode(L0(Z)),A=t($.config.recipient_x25519),B=NJ(32),P=X0.getPublicKey(B),E=X0.getSharedSecret(B,A),I=E,f,R="X25519";if($.config.recipient_pqc){let j=$.pqcProvider??OJ();if(!j)throw new Error("PQC requested but no provider is available");let F=t($.config.recipient_pqc),S=j.encapsulate(F);f=S.encapsulation,I=ZJ(E,S.sharedSecret),R=`X25519+${j.kemId}`}let v=Z8(N8,I,W,void 0,32),m=Z8(N8,v,void 0,new TextEncoder().encode("weba-l2/key"),32),l=Z8(N8,v,void 0,new TextEncoder().encode("weba-l2/iv"),12),b=await LJ(z,m,l,W);return{weba_version:q,layer1_ref:Q,layer2:{enc:"HPKE-v1",suite:{kem:R,kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:J,encapsulated:{classical:O8(P),...f?{pqc:O8(f)}:{}},ciphertext:O8(b),aad:O8(W)},meta:{created_at:new Date().toISOString(),nonce:O8(NJ(16)),...$.config.campaign_id?{campaign_id:$.config.campaign_id}:{},...$.config.key_policy?{key_policy:$.config.key_policy}:{}}}}function wJ(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function p0($,q,J){let Q=t($.layer2.aad),U={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},G=new TextEncoder().encode(L0(U));if(O8(G)!==$.layer2.aad)throw new Error("AAD mismatch");let X=t($.layer2.encapsulated.classical),N=X0.getSharedSecret(q,X),K=N;if($.layer2.encapsulated.pqc){let B=J?.pqcProvider??OJ(),P=J?.pqcRecipientSk;if(!B||!P)throw new Error("Missing PQC KEM for envelope");let E=t($.layer2.encapsulated.pqc),I=B.decapsulate(P,E);K=ZJ(N,I)}let O=Z8(N8,K,Q,void 0,32),Z=Z8(N8,O,void 0,new TextEncoder().encode("weba-l2/key"),32),W=Z8(N8,O,void 0,new TextEncoder().encode("weba-l2/iv"),12),z=t($.layer2.ciphertext),A=await CJ(z,Z,W,Q);return JSON.parse(new TextDecoder().decode(A))}async function HJ($){let q=Z8(N8,$.prfKey,void 0,void 0,32),J=Z8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=Z8(N8,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),U=$.keywrap.aad?t($.keywrap.aad):new Uint8Array,G=t($.keywrap.wrapped_key);return CJ(G,J,Q,U)}class x${formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let q=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((U)=>{let G=U.dataset.jsonPath;if(G)q[G]=U.value}),document.querySelectorAll('[type="radio"]:checked').forEach((U)=>{q[U.name]=U.value}),document.querySelectorAll("table.data-table.dynamic").forEach((U)=>{let G=U.dataset.tableKey;if(G){let X=[];U.querySelectorAll("tbody tr").forEach((N)=>{let K={},O=!1;if(N.querySelectorAll("[data-base-key]").forEach((Z)=>{if(Z.type==="checkbox"){if(K[Z.dataset.baseKey]=Z.checked,Z.checked)O=!0}else if(K[Z.dataset.baseKey]=Z.value,Z.value)O=!0}),O)X.push(K)}),q[G]=X}});let J=document.getElementById("json-ld");if(J)J.textContent=JSON.stringify(q,null,2);let Q=document.getElementById("json-debug");if(Q)Q.textContent=JSON.stringify(q,null,2);return q}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),q=window,J=q.generatedJsonStructure&&q.generatedJsonStructure.name||"Response",Q=window.location.href.split("#")[0],U=this.getL2Config(),G=document.getElementById("weba-l2-encrypt");if(!!(U?.enabled&&(G?G.checked:U.default_enabled))){if(!U?.recipient_kid||!U?.recipient_x25519||!U?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let K=await EJ({layer2_plain:$,config:U,user_kid:U.user_kid});this.downloadHtml("submit",!0,{l2Envelope:K,stripPlaintext:!0})}catch(K){console.error(K),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!a8.getPublicKey()){if(!await a8.register()){alert("Key registration failed.");return}}let N={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:a8.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:Q,answers:$}};try{let K=await a8.sign(N);this.downloadHtml("submitted",!0,{embeddedVc:K})}catch(K){console.error(K),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let q=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(q[Q]!==void 0)J.value=q[Q]}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey,U=q[Q];if(Array.isArray(U)){let G=J.querySelector("tbody");if(!G)return;let X=G.querySelectorAll(".template-row");U.forEach((N,K)=>{let O;if(K===0)O=G.querySelector(".template-row");else{let Z=G.querySelector(".template-row");if(Z){O=Z.cloneNode(!0),O.classList.remove("template-row");let W=O.querySelector(".remove-row-btn");if(W)W.style.visibility="visible";G.appendChild(O)}}if(O)O.querySelectorAll("input, select").forEach((Z)=>{let W=Z.dataset.baseKey;if(W&&N[W]!==void 0)if(Z.type==="checkbox")Z.checked=!!N[W];else Z.value=N[W]})})}})}catch(q){console.error(q)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,q,J){let Q=window,G=new DOMParser().parseFromString(document.documentElement.outerHTML,"text/html");if(J?.stripPlaintext){G.querySelectorAll("input").forEach((E)=>{if(E.type==="checkbox"||E.type==="radio")E.checked=!1,E.removeAttribute("checked");else E.value="",E.removeAttribute("value")}),G.querySelectorAll("textarea").forEach((E)=>{E.value="",E.textContent=""}),G.querySelectorAll("select").forEach((E)=>{E.selectedIndex=-1,E.querySelectorAll("option").forEach((I)=>I.removeAttribute("selected"))}),G.getElementById("json-ld")?.remove(),G.getElementById("data-layer")?.remove();let P=G.getElementById("json-debug");if(P)P.textContent=""}if(J?.embeddedVc){let P=JSON.stringify(J.embeddedVc,null,2),E=G.createElement("script");E.type="application/ld+json",E.id="weba-user-vc",E.textContent=P,G.body.appendChild(E);let I=G.createElement("div");I.className="weba-user-verification no-print",I.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",I.innerHTML=`
                <details>
                    <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
                        <span></span> 
                    </summary>
                    <div style="padding: 1rem 0;">
                        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
                    </div>
                </details>
            `;let f=I.querySelector("pre");if(f)f.textContent=P;G.body.appendChild(I)}if(J?.l2Envelope){let P=G.createElement("script");P.id="weba-l2-envelope",P.type="application/json",P.textContent=JSON.stringify(J.l2Envelope,null,2),G.body.appendChild(P)}let X=G.documentElement.outerHTML,N=new Blob([X],{type:"text/html"}),K=URL.createObjectURL(N),O=document.createElement("a");O.href=K;let Z=Q.generatedJsonStructure&&Q.generatedJsonStructure.name||"web-a-form",W=new Date,z=W.getFullYear()+("0"+(W.getMonth()+1)).slice(-2)+("0"+W.getDate()).slice(-2)+"-"+("0"+W.getHours()).slice(-2)+("0"+W.getMinutes()).slice(-2),A=Math.random().toString(36).substring(2,8),B=`${Z}_${z}_${$}_${A}.html`;if(O.download=B,O.click(),q)setTimeout(()=>window.location.reload(),1000)}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class F${calc;data;constructor($,q){this.calc=$,this.data=q}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},q=(navigator.language||"en").startsWith("ja")?"ja":"en",J=$[q]||$.en;document.querySelectorAll("[data-i18n]").forEach((Q)=>{let U=Q.dataset.i18n;if(J[U])Q.textContent=J[U]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((J)=>{return J.querySelectorAll("td").length>0}).forEach((J,Q)=>{let U=Q+1;J.querySelectorAll(".auto-num").forEach((G)=>{if(G.value!=U)G.value=U.toString(),G.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let q=$.closest("tr"),J=q.parentElement;if(q.classList.contains("template-row"))q.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox")Q.checked=!1;else Q.value=""});else{if(q.remove(),J)this.renumberRows(J);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,q){let J=document.getElementById("tbl_"+q);if(!J)return;let Q=J.querySelector("tbody");if(!Q)return;let U=Q.querySelector(".template-row");if(!U)return;let G=U.cloneNode(!0);G.classList.remove("template-row"),G.querySelectorAll("input").forEach((N)=>{if(N.type==="checkbox")N.checked=N.hasAttribute("checked");else N.value=N.getAttribute("value")||""});let X=G.querySelector(".remove-row-btn");if(X)X.style.visibility="visible";G.querySelectorAll("[data-copy-from]").forEach((N)=>{let K=N.dataset.copyFrom;if(K){let O=G.querySelector(`[data-base-key="${K}"]`);if(O&&O.value)N.value=O.value}}),Q.appendChild(G),this.renumberRows(Q),this.calc.recalculate()}switchTab($,q){document.querySelectorAll(".tab-btn").forEach((Q)=>Q.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((Q)=>Q.classList.remove("active")),$.classList.add("active");let J=document.getElementById(q);if(J)J.classList.add("active")}}function TJ($){let q=document.getElementById($);if(!q||!q.textContent)return null;try{return JSON.parse(q.textContent)}catch{return null}}function zJ(){let $=TJ("weba-l2-envelope");if(!$)return;let q=TJ("weba-l2-keywrap"),J=document.querySelector(".weba-form-container")||document.body,Q=document.createElement("div");Q.className="weba-l2-unlock",Q.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let U=document.createElement("div");U.textContent="Encrypted Submission",U.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",Q.appendChild(U);let G=document.createElement("div");G.textContent="Locked. Unlock with Passkey.",G.style.cssText="color:#64748b;margin-bottom:0.75rem;",Q.appendChild(G);let X=document.createElement("button");X.textContent="Unlock (Passkey)",X.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",Q.appendChild(X);let N=document.createElement("pre");N.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",Q.appendChild(N);let K=document.createElement("details");K.style.cssText="margin-top:0.75rem; display:none;",K.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',Q.appendChild(K);let O=document.createElement("button");O.textContent="Export JSON",O.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",O.disabled=!0,Q.appendChild(O),X.addEventListener("click",async()=>{if(!q){G.textContent="Key wrap package not found.";return}X.disabled=!0,G.textContent="Waiting for passkey...";try{let Z=t(q.prf_salt),W=await c0(q.credential_id,Z),z=await HJ({keywrap:q,prfKey:W}),A=await p0($,z);c1(A.layer2_plain),document.body.classList.add("weba-l2-readonly"),N.textContent=JSON.stringify(A.layer2_plain,null,2),N.style.display="block";let B=K.querySelector("pre");if(B)B.textContent=JSON.stringify(A.layer2_sig,null,2);K.style.display="block",O.style.display="inline-block",O.disabled=!1,G.textContent="Unlocked.",O.onclick=()=>{let P=new Blob([JSON.stringify(A,null,2)],{type:"application/json"}),E=URL.createObjectURL(P),I=document.createElement("a");I.href=E,I.download="weba-l2-decrypted.json",I.click()}}catch(Z){console.error(Z),G.textContent="Unlock failed.",X.disabled=!1}}),J.appendChild(Q)}function c1($){if(!$||typeof $!=="object")return;let q=$;document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(!Q||!(Q in q))return;let U=q[Q];if(J.type==="checkbox")J.checked=Boolean(U);else if(J.type==="radio")J.checked=J.value===String(U);else J.value=U===null||U===void 0?"":String(U)}),document.querySelectorAll('input[type="radio"]').forEach((J)=>{let Q=J.name;if(!Q||!(Q in q))return;let U=q[Q];J.checked=J.value===String(U)}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey;if(!Q)return;let U=q[Q];if(!Array.isArray(U))return;let G=J.querySelector("tbody");if(!G)return;let X=G.querySelector("tr.template-row");if(!X)return;Array.from(G.querySelectorAll("tr")).forEach((N)=>{if(!N.classList.contains("template-row"))N.remove()}),U.forEach((N,K)=>{let O=K===0?X:X.cloneNode(!0);if(K>0){O.classList.remove("template-row");let Z=O.querySelector(".remove-row-btn");if(Z)Z.style.visibility="visible";G.appendChild(O)}if(N&&typeof N==="object")O.querySelectorAll("input, select, textarea").forEach((Z)=>{let W=Z.dataset.baseKey;if(!W)return;let z=N[W];if(Z.type==="checkbox")Z.checked=Boolean(z);else Z.value=z===null||z===void 0?"":String(z)})})}),document.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.disabled=!0;else J.readOnly=!0}),document.querySelectorAll("textarea").forEach((J)=>{J.readOnly=!0}),document.querySelectorAll("select").forEach((J)=>{J.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((J)=>{J.disabled=!0})}function B8($){return document.getElementById($)}function DJ(){if(!B8("weba-l2-keywrap-tool"))return;let q=B8("kwp-recipient-sk"),J=B8("kwp-credential-id"),Q=B8("kwp-prf-salt"),U=B8("kwp-aad"),G=B8("kwp-kid"),X=B8("kwp-status"),N=B8("kwp-output"),K=B8("kwp-generate-salt"),O=B8("kwp-wrap");if(!q||!J||!Q||!X||!N||!O)return;K?.addEventListener("click",()=>{let Z=new Uint8Array(32);crypto.getRandomValues(Z),Q.value=O8(Z)}),O.addEventListener("click",async()=>{X.textContent="Waiting for passkey...",O.disabled=!0;try{if(!q.value||!J.value||!Q.value)throw new Error("Missing required fields.");let Z=t(q.value.trim()),W=t(Q.value.trim()),z=await c0(J.value.trim(),W),A=U?.value?t(U.value.trim()):void 0,B=await WJ({recipientSk:Z,prfKey:z,aad:A}),P={alg:"WebAuthn-PRF-AESGCM-v1",kid:G?.value||"issuer#passkey-1",credential_id:J.value.trim(),prf_salt:O8(W),wrapped_key:O8(B),...A?{aad:O8(A)}:{}};N.textContent=JSON.stringify(P,null,2),X.textContent="Key wrap ready."}catch(Z){console.error(Z),X.textContent="Key wrap failed."}finally{O.disabled=!1}})}function fJ($){if(typeof DOMParser!=="undefined")return new DOMParser().parseFromString($,"text/html");if(typeof document!=="undefined"){let q=document.implementation.createHTMLDocument("");return q.documentElement.innerHTML=$,q}return null}function IJ($,q){let J=fJ($);if(J)return J.getElementById(q)?.textContent??null;let Q=new RegExp(`<script[^>]*id=["']${q}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),U=$.match(Q);return U?U[1]:null}function h1($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function p1($,q){let J=fJ($);if(J)return J.querySelector(`script[type="${q}"]`)?.textContent??null;let Q=new RegExp(`<script[^>]*type=["']${h1(q)}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),U=$.match(Q);return U?U[1]:null}function l1($){let q=IJ($,"data-layer");if(q)try{return JSON.parse(q)}catch{return null}let J=p1($,"application/ld+json");if(J)try{return JSON.parse(J)}catch{return null}return null}function u1($){let q=IJ($,"weba-l2-envelope");if(!q)return null;try{return JSON.parse(q)}catch{return null}}function d1($){if(!$.trim())return null;try{let q=JSON.parse($);if(!q.recipient_x25519_private&&!q.org_root_key)return null;return q}catch{return null}}function n1(){let $=document.getElementById("weba-l2-keys");if(!$?.textContent)return null;return d1($.textContent)}function i1($){let q={},J=(Q,U)=>{if(Q===null||Q===void 0){q[U]=null;return}if(Array.isArray(Q)){Q.forEach((G,X)=>{J(G,U?`${U}[${X}]`:`[${X}]`)});return}if(typeof Q==="object"){Object.entries(Q).forEach(([G,X])=>{let N=U?`${U}.${G}`:G;J(X,N)});return}q[U]=Q};if(J($,""),""in q)delete q[""];return q}function RJ($){let q={_filename:$.filename},J=new Set(["_filename"]);if($.includeJson)J.add("_json"),q._json=JSON.stringify($.plain);let Q=i1($.plain||{});for(let U of Object.keys(Q)){if($.omitKey&&$.omitKey(U))continue;J.add(U),q[U]=Q[U]}if($.sig)J.add("_l2_sig"),q._l2_sig=JSON.stringify($.sig);return{row:q,keys:J}}async function r1($,q){let J=u1($);if(J&&q){if(q.recipient_kid&&J.layer2?.recipient&&q.recipient_kid!==J.layer2.recipient)throw new Error(`recipient_kid mismatch (${J.layer2.recipient})`);let U=null;if(q.org_root_key){let N=q.org_campaign_id||J.meta?.campaign_id;if(!N)throw new Error("org_campaign_id is required for org_root_key");U=MJ({orgRootKey:t(q.org_root_key),campaignId:N,layer1Ref:J.layer1_ref,keyPolicy:q.org_key_policy||J.meta?.key_policy}).privateKey}else if(q.recipient_x25519_private)U=t(q.recipient_x25519_private);else throw new Error("No recipient key provided");let G=q.recipient_pqc_private&&q.recipient_pqc_kem==="ML-KEM-768"?{pqcProvider:globalThis.webaPqcKem??null,pqcRecipientSk:t(q.recipient_pqc_private)}:void 0,X=await p0(J,U,G);return{plain:X.layer2_plain??X,sig:X.layer2_sig,source:"l2"}}let Q=l1($);if(Q)return{plain:Q,source:"jsonld"};return{source:null}}function BJ($){if($===null||$===void 0)return"";let q=String($);if(/[",\n]/.test(q))return`"${q.replace(/"/g,'""')}"`;return q}function o1($,q){let J=[];return J.push(q.map(BJ).join(",")),$.forEach((Q)=>{let U=q.map((G)=>BJ(Q[G])).join(",");J.push(U)}),"\uFEFF"+J.join(`
`)}function a1($,q,J){if(q.length===0){$.innerHTML='<div class="agg-empty">No rows to display.</div>';return}let Q=J.map((G)=>`<th>${G}</th>`).join(""),U=q.slice(0,20).map((G)=>{return`<tr>${J.map((N)=>`<td>${G[N]??""}</td>`).join("")}</tr>`}).join("");$.innerHTML=`<table class="agg-table"><thead><tr>${Q}</tr></thead><tbody>${U}</tbody></table>`}function AJ(){let $=document.getElementById("aggregator-root");if(!$)return;$.innerHTML=`
    <div class="agg-panel">
      <div class="agg-row">
        <label class="agg-label">Input HTML</label>
        <input id="weba-agg-files" type="file" accept=".html" multiple />
      </div>
      <div class="agg-row">
        <label class="agg-label">L2 Key (embedded)</label>
        <div id="weba-agg-key-status" class="agg-chip">Not loaded</div>
        <div class="agg-note">Use <code>&lt;script id="weba-l2-keys"&gt;</code> to embed.</div>
      </div>
      <div class="agg-row">
        <label class="agg-label">Include JSON</label>
        <input id="weba-agg-include-json" type="checkbox" />
      </div>
      <div class="agg-row">
        <button id="weba-agg-run" class="agg-btn">Decrypt & Aggregate</button>
        <button id="weba-agg-download" class="agg-btn secondary" disabled>Download CSV</button>
      </div>
      <div id="weba-agg-status" class="agg-status">Ready.</div>
    </div>
    <div id="weba-agg-output" class="agg-output"></div>
  `;let q=$.querySelector("#weba-agg-files"),J=$.querySelector("#weba-agg-status"),Q=$.querySelector("#weba-agg-output"),U=$.querySelector("#weba-agg-include-json"),G=$.querySelector("#weba-agg-run"),X=$.querySelector("#weba-agg-download"),N=$.querySelector("#weba-agg-key-status"),K="",O=n1();if(N)N.textContent=O?.recipient_kid?`Loaded (${O.recipient_kid})`:O?"Loaded":"Not loaded",N.classList.toggle("ready",!!O);let Z=async()=>{if(!q?.files||q.files.length===0){if(J)J.textContent="Select HTML files first.";return}if(J)J.textContent="Processing...";if(X)X.disabled=!0;let W=[],z=new Set(["_filename"]),A=0,B=0,P=O;for(let I of Array.from(q.files))try{let f=await I.text(),R=await r1(f,P);if(R.source==="l2"&&R.plain){let v=RJ({plain:R.plain,filename:I.name,includeJson:U?.checked,sig:R.sig});v.keys.forEach((m)=>z.add(m)),W.push(v.row),A+=1;continue}if(R.source==="jsonld"&&R.plain){let v=RJ({plain:R.plain,filename:I.name,includeJson:U?.checked,omitKey:(m)=>m.startsWith("@")});v.keys.forEach((m)=>z.add(m)),W.push(v.row),A+=1;continue}B+=1}catch(f){console.error(f),B+=1}let E=Array.from(z).sort((I,f)=>{if(I==="_filename")return-1;if(f==="_filename")return 1;return I.localeCompare(f)});if(K=o1(W,E),X)X.disabled=W.length===0;if(J)J.textContent=`Processed ${A} files. Errors: ${B}.`;if(Q)a1(Q,W,E)};G?.addEventListener("click",()=>{Z().catch((W)=>{if(J)J.textContent="Failed to aggregate.";console.error(W)})}),X?.addEventListener("click",()=>{if(!K)return;let W=new Blob([K],{type:"text/csv"}),z=URL.createObjectURL(W),A=document.createElement("a");A.href=z,A.download="weba-aggregated.csv",A.click(),URL.revokeObjectURL(z)})}function jJ(){console.log("Web/A Runtime Booting...");let $=new i0,q=new x$,J=new F$($,q),Q=window,U=document.getElementById("weba-structure");if(U?.textContent)try{Q.generatedJsonStructure=JSON.parse(U.textContent)}catch(N){console.warn("Failed to parse weba structure JSON",N)}let G=wJ();if(G)Q.webaL2Config=G;Q.saveDraft=()=>q.saveDraft(),Q.submitDocument=()=>q.submitDocument(),Q.signAndDownload=()=>q.signAndDownload(),Q.clearData=()=>q.clearData(),Q.removeTableRow=(N)=>J.removeTableRow(N),Q.addTableRow=(N,K)=>J.addTableRow(N,K),Q.switchTab=(N,K)=>J.switchTab(N,K),Q.recalculate=()=>$.recalculate(),Q.escapeHtml=(N)=>{if(!N)return"";let K={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return N.toString().replace(/[&<>"']/g,(O)=>K[O]||O)},q.restoreFromLS(),J.applyI18n(),J.initTables(),$.recalculate(),zJ(),DJ(),AJ();let X;document.addEventListener("input",(N)=>{let K=N.target;if(N.isTrusted)K.dataset.dirty="true";let O=K.dataset.baseKey||K.dataset.jsonPath;if(O)(K.closest("tr")||document).querySelectorAll(`[data-copy-from="${O}"]`).forEach((z)=>{if(!z.dataset.dirty){if(z.value!==K.value)z.value=K.value,z.dispatchEvent(new Event("input"))}});$.recalculate(),q.updateJsonLd(),clearTimeout(X),X=setTimeout(()=>q.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class k${suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let q=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",q.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let q=$.toString().toLowerCase();return q=q.replace(/[---]/g,(J)=>{return String.fromCharCode(J.charCodeAt(0)-65248)}),q=q.replace(/[-]/g,(J)=>String.fromCharCode(J.charCodeAt(0)-65248)),q.trim()}clean($){if(!$)return"";let q=this.normalize($);return q=q.replace(/(|||||npo||)/g,""),q=q.replace(/(\(\)|\(\)|\(\))/g,""),q.trim()}toIndex($){let q=parseInt($||"",10);return Number.isFinite(q)?q-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let q=window,J=$.dataset.masterSrc,Q=$.dataset.suggestSource;if(!J&&!Q)return;let U=this.toIndex($.dataset.masterLabelIndex),G=this.toIndex($.dataset.masterValueIndex),X=$.value;if(!X){this.hideSuggestions();return}let N=[],K=this.normalize(X);if(Q==="column"){let O=$.dataset.baseKey,Z=$.closest("table");if(Z&&O){let W=new Set;Z.querySelectorAll(`[data-base-key="${O}"]`).forEach((z)=>{if(z===$)return;let A=z.value;if(A&&this.normalize(A).includes(K)){if(!W.has(A))W.add(A),N.push({val:A,row:[A],label:A,score:10})}})}}else if(J){let O=q.generatedJsonStructure.masterData;if(!O||!O[J])return;O[J].forEach((W,z)=>{if(z===0)return;if(W.some((B)=>this.normalize(B||"").includes(K))){let B=U>=0?W[U]||"":"",P=G>=0?W[G]||"":"",E=G>=0?P:U>=0?B:W[1]||W[0]||"";N.push({val:E,row:W,label:B,score:10,idx:z})}})}this.renderSuggestions($,N,U)}renderSuggestions($,q,J){if(q.length===0){this.hideSuggestions();return}let Q=window,U=q.slice(0,10),G="";U.forEach((Z)=>{let W=Q.escapeHtml(JSON.stringify(Z.row)),z=J>=0?Z.label||Z.row.join(" : "):Z.row.join(" : ");G+=`<div class="suggestion-item" data-val="${Q.escapeHtml(Z.val)}" data-row="${W}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${Q.escapeHtml(z)}</div>`});let X=this.getGlobalBox();X.innerHTML=G;let N=$.getBoundingClientRect(),K=window.scrollY||document.documentElement.scrollTop,O=window.scrollX||document.documentElement.scrollLeft;X.style.width=Math.max(N.width,200)+"px",X.style.left=N.left+O+"px",X.style.top=N.bottom+K+"px",X.querySelectorAll(".suggestion-item").forEach((Z)=>{Z.onmouseenter=()=>Z.style.background="#f0f8ff",Z.onmouseleave=()=>Z.style.background="white"}),X.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let q=window,J=this.activeSearchInput,Q=$.dataset.val||"",U=$.dataset.row||"[]";try{let G=JSON.parse(U),X=J.dataset.masterSrc,N=X?q.generatedJsonStructure.masterData[X][0]:[],K=!1;if(N.length>0&&G.length>0){let O=J.closest("tr");if(O){let Z=Array.from(O.querySelectorAll("input, select, textarea"));N.forEach((W,z)=>{if(!W)return;let A=G[z];this.fillField(Z,W,A,J,()=>{K=!0})})}}if(!K)J.value=Q,J.dispatchEvent(new Event("input",{bubbles:!0}))}catch(G){console.error(G)}this.hideSuggestions()}fillField($,q,J,Q,U){let G=this.normalize(q),X=$.find((N)=>{let K=N.dataset.baseKey||N.dataset.jsonPath,O=this.normalize(N.getAttribute("placeholder")||"");return K&&this.normalize(K)===G||O===G});if(X){if(X.value=J||"",X.dispatchEvent(new Event("input",{bubbles:!0})),X===Q)U()}}}var VJ=new k$;window.GlobalSearch=VJ;jJ();VJ.init();
