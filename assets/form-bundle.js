var PQ=Object.create;var{getPrototypeOf:xQ,defineProperty:N8,getOwnPropertyNames:_Q}=Object;var kQ=Object.prototype.hasOwnProperty;var fQ=($,Q,J)=>{J=$!=null?PQ(xQ($)):{};let X=Q||!$||!$.__esModule?N8(J,"default",{value:$,enumerable:!0}):J;for(let G of _Q($))if(!kQ.call(X,G))N8(X,G,{get:()=>$[G],enumerable:!0});return X};var SQ=($,Q)=>()=>(Q||$((Q={exports:{}}).exports,Q),Q.exports);var qQ=SQ((KX,XQ)=>{XQ.exports=function $(Q){if(typeof Q==="number"&&isNaN(Q))throw new Error("NaN is not allowed");if(typeof Q==="number"&&!isFinite(Q))throw new Error("Infinity is not allowed");if(Q===null||typeof Q!=="object")return JSON.stringify(Q);if(Q.toJSON instanceof Function)return $(Q.toJSON());if(Array.isArray(Q))return`[${Q.reduce((G,q,Y)=>{return`${G}${Y===0?"":","}${$(q===void 0||typeof q==="symbol"?null:q)}`},"")}]`;return`{${Object.keys(Q).sort().reduce((X,G)=>{if(Q[G]===void 0||typeof Q[G]==="symbol")return X;let q=X.length===0?"":",";return`${X}${q}${$(G)}:${$(Q[G])}`},"")}}`}});class j0{runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let Q=$.dataset.copyFrom;if(Q){let G=($.closest("tr")||document).querySelector(`[data-base-key="${Q}"], [data-json-path="${Q}"]`);if(G&&G.value!==$.value)$.value=G.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let Q=$.dataset.formula;if(!Q)return;let J=$.closest("tr"),X=$.closest("table"),G=(Y)=>{let U=0,Z="none";if(J){let O=`[data-base-key="${Y}"], [data-json-path="${Y}"]`,W=J.querySelector(O);if(W){if(Z="row-input",W.value!=="")U=parseFloat(W.value)}}if(Z==="none"){let O=document.querySelector(`[data-json-path="${Y}"]`);if(O){if(Z="static-input",O.value!=="")U=parseFloat(O.value)}}return U},q=Q.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(Y,U)=>{let Z=0,O=X||document,W=O.querySelectorAll(`[data-base-key="${U}"], [data-json-path="${U}"]`);if(W.length===0&&O!==document)W=document.querySelectorAll(`[data-base-key="${U}"], [data-json-path="${U}"]`);return W.forEach((L)=>{let I=parseFloat(L.value);if(!isNaN(I))Z+=I}),Z});q=q.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(Y)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(Y))return Y;return String(G(Y))});try{let Y=new Function("return "+q)();if(typeof Y==="number"&&!isNaN(Y))$.value=Number.isInteger(Y)?Y:Y.toFixed(0);else $.value=""}catch(Y){console.error("Calc Error:",Y),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function e$($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function f$($,Q=""){if(!Number.isSafeInteger($)||$<0){let J=Q&&`"${Q}" `;throw new Error(`${J}expected integer >= 0, got ${$}`)}}function i($,Q,J=""){let X=e$($),G=$?.length,q=Q!==void 0;if(!X||q&&G!==Q){let Y=J&&`"${J}" `,U=q?` of length ${Q}`:"",Z=X?`length=${G}`:`type=${typeof $}`;throw new Error(Y+"expected Uint8Array"+U+", got "+Z)}return $}function V0($,Q=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(Q&&$.finished)throw new Error("Hash#digest() has already been called")}function K8($,Q){i($,void 0,"digestInto() output");let J=Q.outputLen;if($.length<J)throw new Error('"digestInto() output" expected to be of length >='+J)}function F$(...$){for(let Q=0;Q<$.length;Q++)$[Q].fill(0)}function $0($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function W$($,Q){return $<<32-Q|$>>>Q}var W8=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),vQ=Array.from({length:256},($,Q)=>Q.toString(16).padStart(2,"0"));function S$($){if(i($),W8)return $.toHex();let Q="";for(let J=0;J<$.length;J++)Q+=vQ[$[J]];return Q}var D$={_0:48,_9:57,A:65,F:70,a:97,f:102};function U8($){if($>=D$._0&&$<=D$._9)return $-D$._0;if($>=D$.A&&$<=D$.F)return $-(D$.A-10);if($>=D$.a&&$<=D$.f)return $-(D$.a-10);return}function h$($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(W8)return Uint8Array.fromHex($);let Q=$.length,J=Q/2;if(Q%2)throw new Error("hex string expected, got unpadded hex of length "+Q);let X=new Uint8Array(J);for(let G=0,q=0;G<J;G++,q+=2){let Y=U8($.charCodeAt(q)),U=U8($.charCodeAt(q+1));if(Y===void 0||U===void 0){let Z=$[q]+$[q+1];throw new Error('hex string expected, got non-hex character "'+Z+'" at index '+q)}X[G]=Y*16+U}return X}function p$(...$){let Q=0;for(let X=0;X<$.length;X++){let G=$[X];i(G),Q+=G.length}let J=new Uint8Array(Q);for(let X=0,G=0;X<$.length;X++){let q=$[X];J.set(q,G),G+=q.length}return J}function M8($,Q={}){let J=(G,q)=>$(q).update(G).digest(),X=$(void 0);return J.outputLen=X.outputLen,J.blockLen=X.blockLen,J.create=(G)=>$(G),Object.assign(J,Q),Object.freeze(J)}function E0($=32){let Q=typeof globalThis==="object"?globalThis.crypto:null;if(typeof Q?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return Q.getRandomValues(new Uint8Array($))}var O8=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function z8($,Q,J){return $&Q^~$&J}function C8($,Q,J){return $&Q^$&J^Q&J}class Q0{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,Q,J,X){this.blockLen=$,this.outputLen=Q,this.padOffset=J,this.isLE=X,this.buffer=new Uint8Array($),this.view=$0(this.buffer)}update($){V0(this),i($);let{view:Q,buffer:J,blockLen:X}=this,G=$.length;for(let q=0;q<G;){let Y=Math.min(X-this.pos,G-q);if(Y===X){let U=$0($);for(;X<=G-q;q+=X)this.process(U,q);continue}if(J.set($.subarray(q,q+Y),this.pos),this.pos+=Y,q+=Y,this.pos===X)this.process(Q,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){V0(this),K8($,this),this.finished=!0;let{buffer:Q,view:J,blockLen:X,isLE:G}=this,{pos:q}=this;if(Q[q++]=128,F$(this.buffer.subarray(q)),this.padOffset>X-q)this.process(J,0),q=0;for(let W=q;W<X;W++)Q[W]=0;J.setBigUint64(X-8,BigInt(this.length*8),G),this.process(J,0);let Y=$0($),U=this.outputLen;if(U%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let Z=U/4,O=this.get();if(Z>O.length)throw new Error("_sha2: outputLen bigger than state");for(let W=0;W<Z;W++)Y.setUint32(4*W,O[W],G)}digest(){let{buffer:$,outputLen:Q}=this;this.digestInto($);let J=$.slice(0,Q);return this.destroy(),J}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:Q,buffer:J,length:X,finished:G,destroyed:q,pos:Y}=this;if($.destroyed=q,$.finished=G,$.length=X,$.pos=Y,X%Q)$.buffer.set(J);return $}clone(){return this._cloneInto()}}var H$=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),R$=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),$$=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Q$=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var J0=BigInt(4294967295),L8=BigInt(32);function mQ($,Q=!1){if(Q)return{h:Number($&J0),l:Number($>>L8&J0)};return{h:Number($>>L8&J0)|0,l:Number($&J0)|0}}function D8($,Q=!1){let J=$.length,X=new Uint32Array(J),G=new Uint32Array(J);for(let q=0;q<J;q++){let{h:Y,l:U}=mQ($[q],Q);[X[q],G[q]]=[Y,U]}return[X,G]}var A0=($,Q,J)=>$>>>J,F0=($,Q,J)=>$<<32-J|Q>>>J,w$=($,Q,J)=>$>>>J|Q<<32-J,P$=($,Q,J)=>$<<32-J|Q>>>J,u$=($,Q,J)=>$<<64-J|Q>>>J-32,c$=($,Q,J)=>$>>>J-32|Q<<64-J;function O$($,Q,J,X){let G=(Q>>>0)+(X>>>0);return{h:$+J+(G/4294967296|0)|0,l:G|0}}var H8=($,Q,J)=>($>>>0)+(Q>>>0)+(J>>>0),R8=($,Q,J,X)=>Q+J+X+($/4294967296|0)|0,B8=($,Q,J,X)=>($>>>0)+(Q>>>0)+(J>>>0)+(X>>>0),T8=($,Q,J,X,G)=>Q+J+X+G+($/4294967296|0)|0,I8=($,Q,J,X,G)=>($>>>0)+(Q>>>0)+(J>>>0)+(X>>>0)+(G>>>0),j8=($,Q,J,X,G,q)=>Q+J+X+G+q+($/4294967296|0)|0;var yQ=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),T$=new Uint32Array(64);class w0 extends Q0{constructor($){super(64,$,8,!1)}get(){let{A:$,B:Q,C:J,D:X,E:G,F:q,G:Y,H:U}=this;return[$,Q,J,X,G,q,Y,U]}set($,Q,J,X,G,q,Y,U){this.A=$|0,this.B=Q|0,this.C=J|0,this.D=X|0,this.E=G|0,this.F=q|0,this.G=Y|0,this.H=U|0}process($,Q){for(let W=0;W<16;W++,Q+=4)T$[W]=$.getUint32(Q,!1);for(let W=16;W<64;W++){let L=T$[W-15],I=T$[W-2],w=W$(L,7)^W$(L,18)^L>>>3,V=W$(I,17)^W$(I,19)^I>>>10;T$[W]=V+T$[W-7]+w+T$[W-16]|0}let{A:J,B:X,C:G,D:q,E:Y,F:U,G:Z,H:O}=this;for(let W=0;W<64;W++){let L=W$(Y,6)^W$(Y,11)^W$(Y,25),I=O+L+z8(Y,U,Z)+yQ[W]+T$[W]|0,V=(W$(J,2)^W$(J,13)^W$(J,22))+C8(J,X,G)|0;O=Z,Z=U,U=Y,Y=q+I|0,q=G,G=X,X=J,J=I+V|0}J=J+this.A|0,X=X+this.B|0,G=G+this.C|0,q=q+this.D|0,Y=Y+this.E|0,U=U+this.F|0,Z=Z+this.G|0,O=O+this.H|0,this.set(J,X,G,q,Y,U,Z,O)}roundClean(){F$(T$)}destroy(){this.set(0,0,0,0,0,0,0,0),F$(this.buffer)}}class bQ extends w0{A=H$[0]|0;B=H$[1]|0;C=H$[2]|0;D=H$[3]|0;E=H$[4]|0;F=H$[5]|0;G=H$[6]|0;H=H$[7]|0;constructor(){super(32)}}class hQ extends w0{A=R$[0]|0;B=R$[1]|0;C=R$[2]|0;D=R$[3]|0;E=R$[4]|0;F=R$[5]|0;G=R$[6]|0;H=R$[7]|0;constructor(){super(28)}}var V8=(()=>D8(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),pQ=(()=>V8[0])(),uQ=(()=>V8[1])(),I$=new Uint32Array(80),j$=new Uint32Array(80);class l$ extends Q0{constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:Q,Bh:J,Bl:X,Ch:G,Cl:q,Dh:Y,Dl:U,Eh:Z,El:O,Fh:W,Fl:L,Gh:I,Gl:w,Hh:V,Hl:S}=this;return[$,Q,J,X,G,q,Y,U,Z,O,W,L,I,w,V,S]}set($,Q,J,X,G,q,Y,U,Z,O,W,L,I,w,V,S){this.Ah=$|0,this.Al=Q|0,this.Bh=J|0,this.Bl=X|0,this.Ch=G|0,this.Cl=q|0,this.Dh=Y|0,this.Dl=U|0,this.Eh=Z|0,this.El=O|0,this.Fh=W|0,this.Fl=L|0,this.Gh=I|0,this.Gl=w|0,this.Hh=V|0,this.Hl=S|0}process($,Q){for(let E=0;E<16;E++,Q+=4)I$[E]=$.getUint32(Q),j$[E]=$.getUint32(Q+=4);for(let E=16;E<80;E++){let T=I$[E-15]|0,b=j$[E-15]|0,p=w$(T,b,1)^w$(T,b,8)^A0(T,b,7),c=P$(T,b,1)^P$(T,b,8)^F0(T,b,7),h=I$[E-2]|0,j=j$[E-2]|0,x=w$(h,j,19)^u$(h,j,61)^A0(h,j,6),f=P$(h,j,19)^c$(h,j,61)^F0(h,j,6),u=B8(c,f,j$[E-7],j$[E-16]),l=T8(u,p,x,I$[E-7],I$[E-16]);I$[E]=l|0,j$[E]=u|0}let{Ah:J,Al:X,Bh:G,Bl:q,Ch:Y,Cl:U,Dh:Z,Dl:O,Eh:W,El:L,Fh:I,Fl:w,Gh:V,Gl:S,Hh:B,Hl:P}=this;for(let E=0;E<80;E++){let T=w$(W,L,14)^w$(W,L,18)^u$(W,L,41),b=P$(W,L,14)^P$(W,L,18)^c$(W,L,41),p=W&I^~W&V,c=L&w^~L&S,h=I8(P,b,c,uQ[E],j$[E]),j=j8(h,B,T,p,pQ[E],I$[E]),x=h|0,f=w$(J,X,28)^u$(J,X,34)^u$(J,X,39),u=P$(J,X,28)^c$(J,X,34)^c$(J,X,39),l=J&G^J&Y^G&Y,K=X&q^X&U^q&U;B=V|0,P=S|0,V=I|0,S=w|0,I=W|0,w=L|0,{h:W,l:L}=O$(Z|0,O|0,j|0,x|0),Z=Y|0,O=U|0,Y=G|0,U=q|0,G=J|0,q=X|0;let R=H8(x,u,K);J=R8(R,j,f,l),X=R|0}({h:J,l:X}=O$(this.Ah|0,this.Al|0,J|0,X|0)),{h:G,l:q}=O$(this.Bh|0,this.Bl|0,G|0,q|0),{h:Y,l:U}=O$(this.Ch|0,this.Cl|0,Y|0,U|0),{h:Z,l:O}=O$(this.Dh|0,this.Dl|0,Z|0,O|0),{h:W,l:L}=O$(this.Eh|0,this.El|0,W|0,L|0),{h:I,l:w}=O$(this.Fh|0,this.Fl|0,I|0,w|0),{h:V,l:S}=O$(this.Gh|0,this.Gl|0,V|0,S|0),{h:B,l:P}=O$(this.Hh|0,this.Hl|0,B|0,P|0),this.set(J,X,G,q,Y,U,Z,O,W,L,I,w,V,S,B,P)}roundClean(){F$(I$,j$)}destroy(){F$(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class E8 extends l${Ah=Q$[0]|0;Al=Q$[1]|0;Bh=Q$[2]|0;Bl=Q$[3]|0;Ch=Q$[4]|0;Cl=Q$[5]|0;Dh=Q$[6]|0;Dl=Q$[7]|0;Eh=Q$[8]|0;El=Q$[9]|0;Fh=Q$[10]|0;Fl=Q$[11]|0;Gh=Q$[12]|0;Gl=Q$[13]|0;Hh=Q$[14]|0;Hl=Q$[15]|0;constructor(){super(64)}}class cQ extends l${Ah=$$[0]|0;Al=$$[1]|0;Bh=$$[2]|0;Bl=$$[3]|0;Ch=$$[4]|0;Cl=$$[5]|0;Dh=$$[6]|0;Dl=$$[7]|0;Eh=$$[8]|0;El=$$[9]|0;Fh=$$[10]|0;Fl=$$[11]|0;Gh=$$[12]|0;Gl=$$[13]|0;Hh=$$[14]|0;Hl=$$[15]|0;constructor(){super(48)}}var J$=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),X$=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class lQ extends l${Ah=J$[0]|0;Al=J$[1]|0;Bh=J$[2]|0;Bl=J$[3]|0;Ch=J$[4]|0;Cl=J$[5]|0;Dh=J$[6]|0;Dl=J$[7]|0;Eh=J$[8]|0;El=J$[9]|0;Fh=J$[10]|0;Fl=J$[11]|0;Gh=J$[12]|0;Gl=J$[13]|0;Hh=J$[14]|0;Hl=J$[15]|0;constructor(){super(28)}}class dQ extends l${Ah=X$[0]|0;Al=X$[1]|0;Bh=X$[2]|0;Bl=X$[3]|0;Ch=X$[4]|0;Cl=X$[5]|0;Dh=X$[6]|0;Dl=X$[7]|0;Eh=X$[8]|0;El=X$[9]|0;Fh=X$[10]|0;Fl=X$[11]|0;Gh=X$[12]|0;Gl=X$[13]|0;Hh=X$[14]|0;Hl=X$[15]|0;constructor(){super(32)}}var A8=M8(()=>new E8,O8(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var w8=BigInt(0),F8=BigInt(1);function q0($,Q=""){if(typeof $!=="boolean"){let J=Q&&`"${Q}" `;throw new Error(J+"expected boolean, got type="+typeof $)}return $}function iQ($){if(typeof $==="bigint"){if(!X0($))throw new Error("positive bigint expected, got "+$)}else f$($);return $}function P8($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?w8:BigInt("0x"+$)}function x8($){return P8(S$($))}function v$($){return P8(S$(G0(i($)).reverse()))}function P0($,Q){f$(Q),$=iQ($);let J=h$($.toString(16).padStart(Q*2,"0"));if(J.length!==Q)throw new Error("number too large");return J}function _8($,Q){return P0($,Q).reverse()}function G0($){return Uint8Array.from($)}var X0=($)=>typeof $==="bigint"&&w8<=$;function oQ($,Q,J){return X0($)&&X0(Q)&&X0(J)&&Q<=$&&$<J}function x0($,Q,J,X){if(!oQ(Q,J,X))throw new Error("expected valid "+$+": "+J+" <= n < "+X+", got "+Q)}var k8=($)=>(F8<<BigInt($))-F8;function d$($,Q={},J={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function X(q,Y,U){let Z=$[q];if(U&&Z===void 0)return;let O=typeof Z;if(O!==Y||Z===null)throw new Error(`param "${q}" is invalid: expected ${Y}, got ${O}`)}let G=(q,Y)=>Object.entries(q).forEach(([U,Z])=>X(U,Z,Y));G(Q,!1),G(J,!0)}function _0($){let Q=new WeakMap;return(J,...X)=>{let G=Q.get(J);if(G!==void 0)return G;let q=$(J,...X);return Q.set(J,q),q}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var G$=BigInt(0),q$=BigInt(1),x$=BigInt(2),v8=BigInt(3),m8=BigInt(4),g8=BigInt(5),sQ=BigInt(7),y8=BigInt(8),aQ=BigInt(9),b8=BigInt(16);function s($,Q){let J=$%Q;return J>=G$?J:Q+J}function M$($,Q,J){let X=$;while(Q-- >G$)X*=X,X%=J;return X}function f8($,Q){if($===G$)throw new Error("invert: expected non-zero number");if(Q<=G$)throw new Error("invert: expected positive modulus, got "+Q);let J=s($,Q),X=Q,G=G$,q=q$,Y=q$,U=G$;while(J!==G$){let O=X/J,W=X%J,L=G-Y*O,I=q-U*O;X=J,J=W,G=Y,q=U,Y=L,U=I}if(X!==q$)throw new Error("invert: does not exist");return s(G,Q)}function k0($,Q,J){if(!$.eql($.sqr(Q),J))throw new Error("Cannot find square root")}function h8($,Q){let J=($.ORDER+q$)/m8,X=$.pow(Q,J);return k0($,X,Q),X}function nQ($,Q){let J=($.ORDER-g8)/y8,X=$.mul(Q,x$),G=$.pow(X,J),q=$.mul(Q,G),Y=$.mul($.mul(q,x$),G),U=$.mul(q,$.sub(Y,$.ONE));return k0($,U,Q),U}function rQ($){let Q=Z0($),J=p8($),X=J(Q,Q.neg(Q.ONE)),G=J(Q,X),q=J(Q,Q.neg(X)),Y=($+sQ)/b8;return(U,Z)=>{let O=U.pow(Z,Y),W=U.mul(O,X),L=U.mul(O,G),I=U.mul(O,q),w=U.eql(U.sqr(W),Z),V=U.eql(U.sqr(L),Z);O=U.cmov(O,W,w),W=U.cmov(I,L,V);let S=U.eql(U.sqr(W),Z),B=U.cmov(O,W,S);return k0(U,B,Z),B}}function p8($){if($<v8)throw new Error("sqrt is not defined for small field");let Q=$-q$,J=0;while(Q%x$===G$)Q/=x$,J++;let X=x$,G=Z0($);while(S8(G,X)===1)if(X++>1000)throw new Error("Cannot find square root: probably non-prime P");if(J===1)return h8;let q=G.pow(X,Q),Y=(Q+q$)/x$;return function U(Z,O){if(Z.is0(O))return O;if(S8(Z,O)!==1)throw new Error("Cannot find square root");let W=J,L=Z.mul(Z.ONE,q),I=Z.pow(O,Q),w=Z.pow(O,Y);while(!Z.eql(I,Z.ONE)){if(Z.is0(I))return Z.ZERO;let V=1,S=Z.sqr(I);while(!Z.eql(S,Z.ONE))if(V++,S=Z.sqr(S),V===W)throw new Error("Cannot find square root");let B=q$<<BigInt(W-V-1),P=Z.pow(L,B);W=V,L=Z.sqr(P),I=Z.mul(I,L),w=Z.mul(w,P)}return w}}function tQ($){if($%m8===v8)return h8;if($%y8===g8)return nQ;if($%b8===aQ)return rQ($);return p8($)}var u8=($,Q)=>(s($,Q)&q$)===q$,eQ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function c8($){let Q={ORDER:"bigint",BYTES:"number",BITS:"number"},J=eQ.reduce((X,G)=>{return X[G]="function",X},Q);return d$($,J),$}function $J($,Q,J){if(J<G$)throw new Error("invalid exponent, negatives unsupported");if(J===G$)return $.ONE;if(J===q$)return Q;let X=$.ONE,G=Q;while(J>G$){if(J&q$)X=$.mul(X,G);G=$.sqr(G),J>>=q$}return X}function Y0($,Q,J=!1){let X=new Array(Q.length).fill(J?$.ZERO:void 0),G=Q.reduce((Y,U,Z)=>{if($.is0(U))return Y;return X[Z]=Y,$.mul(Y,U)},$.ONE),q=$.inv(G);return Q.reduceRight((Y,U,Z)=>{if($.is0(U))return Y;return X[Z]=$.mul(Y,X[Z]),$.mul(Y,U)},q),X}function S8($,Q){let J=($.ORDER-q$)/x$,X=$.pow(Q,J),G=$.eql(X,$.ONE),q=$.eql(X,$.ZERO),Y=$.eql(X,$.neg($.ONE));if(!G&&!q&&!Y)throw new Error("invalid Legendre symbol result");return G?1:q?0:-1}function QJ($,Q){if(Q!==void 0)f$(Q);let J=Q!==void 0?Q:$.toString(2).length,X=Math.ceil(J/8);return{nBitLength:J,nByteLength:X}}class l8{ORDER;BITS;BYTES;isLE;ZERO=G$;ONE=q$;_lengths;_sqrt;_mod;constructor($,Q={}){if($<=G$)throw new Error("invalid field: expected ORDER > 0, got "+$);let J=void 0;if(this.isLE=!1,Q!=null&&typeof Q==="object"){if(typeof Q.BITS==="number")J=Q.BITS;if(typeof Q.sqrt==="function")this.sqrt=Q.sqrt;if(typeof Q.isLE==="boolean")this.isLE=Q.isLE;if(Q.allowedLengths)this._lengths=Q.allowedLengths?.slice();if(typeof Q.modFromBytes==="boolean")this._mod=Q.modFromBytes}let{nBitLength:X,nByteLength:G}=QJ($,J);if(G>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=X,this.BYTES=G,this._sqrt=void 0,Object.preventExtensions(this)}create($){return s($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return G$<=$&&$<this.ORDER}is0($){return $===G$}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&q$)===q$}neg($){return s(-$,this.ORDER)}eql($,Q){return $===Q}sqr($){return s($*$,this.ORDER)}add($,Q){return s($+Q,this.ORDER)}sub($,Q){return s($-Q,this.ORDER)}mul($,Q){return s($*Q,this.ORDER)}pow($,Q){return $J(this,$,Q)}div($,Q){return s($*f8(Q,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,Q){return $+Q}subN($,Q){return $-Q}mulN($,Q){return $*Q}inv($){return f8($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=tQ(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?_8($,this.BYTES):P0($,this.BYTES)}fromBytes($,Q=!1){i($);let{_lengths:J,BYTES:X,isLE:G,ORDER:q,_mod:Y}=this;if(J){if(!J.includes($.length)||$.length>X)throw new Error("Field.fromBytes: expected "+J+" bytes, got "+$.length);let Z=new Uint8Array(X);Z.set($,G?0:Z.length-$.length),$=Z}if($.length!==X)throw new Error("Field.fromBytes: expected "+X+" bytes, got "+$.length);let U=G?v$($):x8($);if(Y)U=s(U,q);if(!Q){if(!this.isValid(U))throw new Error("invalid field element: outside of range 0..ORDER")}return U}invertBatch($){return Y0(this,$)}cmov($,Q,J){return J?Q:$}}function Z0($,Q={}){return new l8($,Q)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var N0=BigInt(0),m0=BigInt(1);function d8($,Q){let J=Q.negate();return $?J:Q}function U0($,Q){let J=Y0($.Fp,Q.map((X)=>X.Z));return Q.map((X,G)=>$.fromAffine(X.toAffine(J[G])))}function a8($,Q){if(!Number.isSafeInteger($)||$<=0||$>Q)throw new Error("invalid window size, expected [1.."+Q+"], got W="+$)}function f0($,Q){a8($,Q);let J=Math.ceil(Q/$)+1,X=2**($-1),G=2**$,q=k8($),Y=BigInt($);return{windows:J,windowSize:X,mask:q,maxNumber:G,shiftBy:Y}}function i8($,Q,J){let{windowSize:X,mask:G,maxNumber:q,shiftBy:Y}=J,U=Number($&G),Z=$>>Y;if(U>X)U-=q,Z+=m0;let O=Q*X,W=O+Math.abs(U)-1,L=U===0,I=U<0,w=Q%2!==0;return{nextN:Z,offset:W,isZero:L,isNeg:I,isNegF:w,offsetF:O}}var S0=new WeakMap,n8=new WeakMap;function v0($){return n8.get($)||1}function o8($){if($!==N0)throw new Error("invalid wNAF")}class g0{BASE;ZERO;Fn;bits;constructor($,Q){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=Q}_unsafeLadder($,Q,J=this.ZERO){let X=$;while(Q>N0){if(Q&m0)J=J.add(X);X=X.double(),Q>>=m0}return J}precomputeWindow($,Q){let{windows:J,windowSize:X}=f0(Q,this.bits),G=[],q=$,Y=q;for(let U=0;U<J;U++){Y=q,G.push(Y);for(let Z=1;Z<X;Z++)Y=Y.add(q),G.push(Y);q=Y.double()}return G}wNAF($,Q,J){if(!this.Fn.isValid(J))throw new Error("invalid scalar");let X=this.ZERO,G=this.BASE,q=f0($,this.bits);for(let Y=0;Y<q.windows;Y++){let{nextN:U,offset:Z,isZero:O,isNeg:W,isNegF:L,offsetF:I}=i8(J,Y,q);if(J=U,O)G=G.add(d8(L,Q[I]));else X=X.add(d8(W,Q[Z]))}return o8(J),{p:X,f:G}}wNAFUnsafe($,Q,J,X=this.ZERO){let G=f0($,this.bits);for(let q=0;q<G.windows;q++){if(J===N0)break;let{nextN:Y,offset:U,isZero:Z,isNeg:O}=i8(J,q,G);if(J=Y,Z)continue;else{let W=Q[U];X=X.add(O?W.negate():W)}}return o8(J),X}getPrecomputes($,Q,J){let X=S0.get(Q);if(!X){if(X=this.precomputeWindow(Q,$),$!==1){if(typeof J==="function")X=J(X);S0.set(Q,X)}}return X}cached($,Q,J){let X=v0($);return this.wNAF(X,this.getPrecomputes(X,$,J),Q)}unsafe($,Q,J,X){let G=v0($);if(G===1)return this._unsafeLadder($,Q,X);return this.wNAFUnsafe(G,this.getPrecomputes(G,$,J),Q,X)}createCache($,Q){a8(Q,this.bits),n8.set($,Q),S0.delete($)}hasCache($){return v0($)!==1}}function s8($,Q,J){if(Q){if(Q.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return c8(Q),Q}else return Z0($,{isLE:J})}function r8($,Q,J={},X){if(X===void 0)X=$==="edwards";if(!Q||typeof Q!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let Z of["p","n","h"]){let O=Q[Z];if(!(typeof O==="bigint"&&O>N0))throw new Error(`CURVE.${Z} must be positive bigint`)}let G=s8(Q.p,J.Fp,X),q=s8(Q.n,J.Fn,X),U=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let Z of U)if(!G.isValid(Q[Z]))throw new Error(`CURVE.${Z} must be valid field element of CURVE.Fp`);return Q=Object.freeze(Object.assign({},Q)),{CURVE:Q,Fp:G,Fn:q}}function t8($,Q){return function J(X){let G=$(X);return{secretKey:G,publicKey:Q(G)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var V$=BigInt(0),t=BigInt(1),y0=BigInt(2),JJ=BigInt(8);function XJ($,Q,J,X){let G=$.sqr(J),q=$.sqr(X),Y=$.add($.mul(Q.a,G),q),U=$.add($.ONE,$.mul(Q.d,$.mul(G,q)));return $.eql(Y,U)}function e8($,Q={}){let J=r8("edwards",$,Q,Q.FpFnLE),{Fp:X,Fn:G}=J,q=J.CURVE,{h:Y}=q;d$(Q,{},{uvRatio:"function"});let U=y0<<BigInt(G.BYTES*8)-t,Z=(B)=>X.create(B),O=Q.uvRatio||((B,P)=>{try{return{isValid:!0,value:X.sqrt(X.div(B,P))}}catch(E){return{isValid:!1,value:V$}}});if(!XJ(X,q,q.Gx,q.Gy))throw new Error("bad curve params: generator point");function W(B,P,E=!1){let T=E?t:V$;return x0("coordinate "+B,P,T,U),P}function L(B){if(!(B instanceof V))throw new Error("EdwardsPoint expected")}let I=_0((B,P)=>{let{X:E,Y:T,Z:b}=B,p=B.is0();if(P==null)P=p?JJ:X.inv(b);let c=Z(E*P),h=Z(T*P),j=X.mul(b,P);if(p)return{x:V$,y:t};if(j!==t)throw new Error("invZ was invalid");return{x:c,y:h}}),w=_0((B)=>{let{a:P,d:E}=q;if(B.is0())throw new Error("bad point: ZERO");let{X:T,Y:b,Z:p,T:c}=B,h=Z(T*T),j=Z(b*b),x=Z(p*p),f=Z(x*x),u=Z(h*P),l=Z(x*Z(u+j)),K=Z(f+Z(E*Z(h*j)));if(l!==K)throw new Error("bad point: equation left != right (1)");let R=Z(T*b),C=Z(p*c);if(R!==C)throw new Error("bad point: equation left != right (2)");return!0});class V{static BASE=new V(q.Gx,q.Gy,t,Z(q.Gx*q.Gy));static ZERO=new V(V$,t,t,V$);static Fp=X;static Fn=G;X;Y;Z;T;constructor(B,P,E,T){this.X=W("x",B),this.Y=W("y",P),this.Z=W("z",E,!0),this.T=W("t",T),Object.freeze(this)}static CURVE(){return q}static fromAffine(B){if(B instanceof V)throw new Error("extended point not allowed");let{x:P,y:E}=B||{};return W("x",P),W("y",E),new V(P,E,t,Z(P*E))}static fromBytes(B,P=!1){let E=X.BYTES,{a:T,d:b}=q;B=G0(i(B,E,"point")),q0(P,"zip215");let p=G0(B),c=B[E-1];p[E-1]=c&-129;let h=v$(p),j=P?U:X.ORDER;x0("point.y",h,V$,j);let x=Z(h*h),f=Z(x-t),u=Z(b*x-T),{isValid:l,value:K}=O(f,u);if(!l)throw new Error("bad point: invalid y coordinate");let R=(K&t)===t,C=(c&128)!==0;if(!P&&K===V$&&C)throw new Error("bad point: x=0 and x_0=1");if(C!==R)K=Z(-K);return V.fromAffine({x:K,y:h})}static fromHex(B,P=!1){return V.fromBytes(h$(B),P)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(B=8,P=!0){if(S.createCache(this,B),!P)this.multiply(y0);return this}assertValidity(){w(this)}equals(B){L(B);let{X:P,Y:E,Z:T}=this,{X:b,Y:p,Z:c}=B,h=Z(P*c),j=Z(b*T),x=Z(E*c),f=Z(p*T);return h===j&&x===f}is0(){return this.equals(V.ZERO)}negate(){return new V(Z(-this.X),this.Y,this.Z,Z(-this.T))}double(){let{a:B}=q,{X:P,Y:E,Z:T}=this,b=Z(P*P),p=Z(E*E),c=Z(y0*Z(T*T)),h=Z(B*b),j=P+E,x=Z(Z(j*j)-b-p),f=h+p,u=f-c,l=h-p,K=Z(x*u),R=Z(f*l),C=Z(x*l),D=Z(u*f);return new V(K,R,D,C)}add(B){L(B);let{a:P,d:E}=q,{X:T,Y:b,Z:p,T:c}=this,{X:h,Y:j,Z:x,T:f}=B,u=Z(T*h),l=Z(b*j),K=Z(c*E*f),R=Z(p*x),C=Z((T+b)*(h+j)-u-l),D=R-K,H=R+K,A=Z(l-P*u),_=Z(C*D),k=Z(H*A),v=Z(C*A),m=Z(D*H);return new V(_,k,m,v)}subtract(B){return this.add(B.negate())}multiply(B){if(!G.isValidNot0(B))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:P,f:E}=S.cached(this,B,(T)=>U0(V,T));return U0(V,[P,E])[0]}multiplyUnsafe(B,P=V.ZERO){if(!G.isValid(B))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(B===V$)return V.ZERO;if(this.is0()||B===t)return this;return S.unsafe(this,B,(E)=>U0(V,E),P)}isSmallOrder(){return this.multiplyUnsafe(Y).is0()}isTorsionFree(){return S.unsafe(this,q.n).is0()}toAffine(B){return I(this,B)}clearCofactor(){if(Y===t)return this;return this.multiplyUnsafe(Y)}toBytes(){let{x:B,y:P}=this.toAffine(),E=X.toBytes(P);return E[E.length-1]|=B&t?128:0,E}toHex(){return S$(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let S=new g0(V,G.BITS);return V.BASE.precompute(8),V}function $Q($,Q,J={}){if(typeof Q!=="function")throw new Error('"hash" function param is required');d$(J,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:X}=J,{BASE:G,Fp:q,Fn:Y}=$,U=J.randomBytes||E0,Z=J.adjustScalarBytes||((j)=>j),O=J.domain||((j,x,f)=>{if(q0(f,"phflag"),x.length||f)throw new Error("Contexts/pre-hash are not supported");return j});function W(j){return Y.create(v$(j))}function L(j){let x=T.secretKey;i(j,T.secretKey,"secretKey");let f=i(Q(j),2*x,"hashedSecretKey"),u=Z(f.slice(0,x)),l=f.slice(x,2*x),K=W(u);return{head:u,prefix:l,scalar:K}}function I(j){let{head:x,prefix:f,scalar:u}=L(j),l=G.multiply(u),K=l.toBytes();return{head:x,prefix:f,scalar:u,point:l,pointBytes:K}}function w(j){return I(j).pointBytes}function V(j=Uint8Array.of(),...x){let f=p$(...x);return W(Q(O(f,i(j,void 0,"context"),!!X)))}function S(j,x,f={}){if(j=i(j,void 0,"message"),X)j=X(j);let{prefix:u,scalar:l,pointBytes:K}=I(x),R=V(f.context,u,j),C=G.multiply(R).toBytes(),D=V(f.context,C,K,j),H=Y.create(R+D*l);if(!Y.isValid(H))throw new Error("sign failed: invalid s");let A=p$(C,Y.toBytes(H));return i(A,T.signature,"result")}let B={zip215:!0};function P(j,x,f,u=B){let{context:l,zip215:K}=u,R=T.signature;if(j=i(j,R,"signature"),x=i(x,void 0,"message"),f=i(f,T.publicKey,"publicKey"),K!==void 0)q0(K,"zip215");if(X)x=X(x);let C=R/2,D=j.subarray(0,C),H=v$(j.subarray(C,R)),A,_,k;try{A=$.fromBytes(f,K),_=$.fromBytes(D,K),k=G.multiplyUnsafe(H)}catch(I0){return!1}if(!K&&A.isSmallOrder())return!1;let v=V(l,_.toBytes(),A.toBytes(),x);return _.add(A.multiplyUnsafe(v)).subtract(k).clearCofactor().is0()}let E=q.BYTES,T={secretKey:E,publicKey:E,signature:2*E,seed:E};function b(j=U(T.seed)){return i(j,T.seed,"seed")}function p(j){return e$(j)&&j.length===Y.BYTES}function c(j,x){try{return!!$.fromBytes(j,x)}catch(f){return!1}}let h={getExtendedPublicKey:I,randomSecretKey:b,isValidSecretKey:p,isValidPublicKey:c,toMontgomery(j){let{y:x}=$.fromBytes(j),f=T.publicKey,u=f===32;if(!u&&f!==57)throw new Error("only defined for 25519 and 448");let l=u?q.div(t+x,t-x):q.div(x-t,x+t);return q.toBytes(l)},toMontgomerySecret(j){let x=T.secretKey;i(j,x);let f=Q(j.subarray(0,x));return Z(f).subarray(0,x)}};return Object.freeze({keygen:t8(b,w),getPublicKey:w,sign:S,verify:P,utils:h,Point:$,lengths:T})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var qJ=BigInt(1),QQ=BigInt(2);var GJ=BigInt(5),YJ=BigInt(8),b0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),ZJ=(()=>({p:b0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:YJ,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function NJ($){let Q=BigInt(10),J=BigInt(20),X=BigInt(40),G=BigInt(80),q=b0,U=$*$%q*$%q,Z=M$(U,QQ,q)*U%q,O=M$(Z,qJ,q)*$%q,W=M$(O,GJ,q)*O%q,L=M$(W,Q,q)*W%q,I=M$(L,J,q)*L%q,w=M$(I,X,q)*I%q,V=M$(w,G,q)*w%q,S=M$(V,G,q)*w%q,B=M$(S,Q,q)*W%q;return{pow_p_5_8:M$(B,QQ,q)*$%q,b2:U}}function UJ($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var JQ=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function KJ($,Q){let J=b0,X=s(Q*Q*Q,J),G=s(X*X*Q,J),q=NJ($*G).pow_p_5_8,Y=s($*X*q,J),U=s(Q*Y*Y,J),Z=Y,O=s(Y*JQ,J),W=U===$,L=U===s(-$,J),I=U===s(-$*JQ,J);if(W)Y=Z;if(L||I)Y=O;if(u8(Y,J))Y=s(-Y,J);return{isValid:W||L,value:Y}}var WJ=e8(ZJ,{uvRatio:KJ});function MJ($){return $Q(WJ,A8,Object.assign({adjustScalarBytes:UJ},$))}var i$=MJ({});var EQ=fQ(qQ(),1);var h0;try{h0=new TextDecoder}catch($){}var F,k$,z=0;var UQ=[],OJ=105,zJ=57342,CJ=57343,GQ=57337;var YQ=6,m$={},o$=112810000,B$=16810000;var p0=UQ,u0=0,g={},o,M0,O0=0,a$=0,n,U$,a=[],c0=[],Z$,Y$,s$,ZQ={useRecords:!1,mapsAsObjects:!0},n$=!1,KQ=2;try{new Function("")}catch($){KQ=1/0}class E${constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[Q,J]of Object.entries($.keyMap))this.mapKey.set(J,Q)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let Q=new Map;for(let[J,X]of Object.entries($))Q.set(this._keyMap.hasOwnProperty(J)?this._keyMap[J]:J,X);return Q}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[J,X]of Object.entries(this._keyMap))this._mapKey.set(X,J)}let Q={};return $.forEach((J,X)=>Q[K$(this._mapKey.has(X)?this._mapKey.get(X):X)]=J),Q}mapDecode($,Q){let J=this.decode($);if(this._keyMap)switch(J.constructor.name){case"Array":return J.map((X)=>this.decodeKeys(X))}return J}decode($,Q){if(F)return zQ(()=>{return z0(),this?this.decode($,Q):E$.prototype.decode.call(ZQ,$,Q)});k$=Q>-1?Q:$.length,z=0,u0=0,a$=0,M0=null,p0=UQ,n=null,F=$;try{Y$=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(J){if(F=null,$ instanceof Uint8Array)throw J;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof E$){if(g=this,Z$=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return o=this.structures,K0();else if(!o||o.length>0)o=[]}else{if(g=ZQ,!o||o.length>0)o=[];Z$=null}return K0()}decodeMultiple($,Q){let J,X=0;try{let G=$.length;n$=!0;let q=this?this.decode($,G):a0.decode($,G);if(Q){if(Q(q)===!1)return;while(z<G)if(X=z,Q(K0())===!1)return}else{J=[q];while(z<G)X=z,J.push(K0());return J}}catch(G){throw G.lastPosition=X,G.values=J,G}finally{n$=!1,z0()}}}function K0(){try{let $=y();if(n){if(z>=n.postBundlePosition){let Q=new Error("Unexpected bundle position");throw Q.incomplete=!0,Q}z=n.postBundlePosition,n=null}if(z==k$){if(o=null,F=null,U$)U$=null}else if(z>k$){let Q=new Error("Unexpected end of CBOR data");throw Q.incomplete=!0,Q}else if(!n$)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(z0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function y(){let $=F[z++],Q=$>>5;if($=$&31,$>23)switch($){case 24:$=F[z++];break;case 25:if(Q==7)return RJ();$=Y$.getUint16(z),z+=2;break;case 26:if(Q==7){let J=Y$.getFloat32(z);if(g.useFloat32>2){let X=C0[(F[z]&127)<<1|F[z+1]>>7];return z+=4,(X*J+(J>0?0.5:-0.5)>>0)/X}return z+=4,J}$=Y$.getUint32(z),z+=4;break;case 27:if(Q==7){let J=Y$.getFloat64(z);return z+=8,J}if(Q>1){if(Y$.getUint32(z)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=Y$.getUint32(z+4)}else if(g.int64AsNumber)$=Y$.getUint32(z)*4294967296,$+=Y$.getUint32(z+4);else $=Y$.getBigUint64(z);z+=8;break;case 31:switch(Q){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let J=[],X,G=0;while((X=y())!=m$){if(G>=o$)throw new Error(`Array length exceeds ${o$}`);J[G++]=X}return Q==4?J:Q==3?J.join(""):Buffer.concat(J);case 5:let q;if(g.mapsAsObjects){let Y={},U=0;if(g.keyMap)while((q=y())!=m$){if(U++>=B$)throw new Error(`Property count exceeds ${B$}`);Y[K$(g.decodeKey(q))]=y()}else while((q=y())!=m$){if(U++>=B$)throw new Error(`Property count exceeds ${B$}`);Y[K$(q)]=y()}return Y}else{if(s$)g.mapsAsObjects=!0,s$=!1;let Y=new Map;if(g.keyMap){let U=0;while((q=y())!=m$){if(U++>=B$)throw new Error(`Map size exceeds ${B$}`);Y.set(g.decodeKey(q),y())}}else{let U=0;while((q=y())!=m$){if(U++>=B$)throw new Error(`Map size exceeds ${B$}`);Y.set(q,y())}}return Y}case 7:return m$;default:throw new Error("Invalid major type for indefinite length "+Q)}default:throw new Error("Unknown token "+$)}switch(Q){case 0:return $;case 1:return~$;case 2:return HJ($);case 3:if(a$>=z)return M0.slice(z-O0,(z+=$)-O0);if(a$==0&&k$<140&&$<32){let G=$<16?WQ($):DJ($);if(G!=null)return G}return LJ($);case 4:if($>=o$)throw new Error(`Array length exceeds ${o$}`);let J=new Array($);for(let G=0;G<$;G++)J[G]=y();return J;case 5:if($>=B$)throw new Error(`Map size exceeds ${o$}`);if(g.mapsAsObjects){let G={};if(g.keyMap)for(let q=0;q<$;q++)G[K$(g.decodeKey(y()))]=y();else for(let q=0;q<$;q++)G[K$(y())]=y();return G}else{if(s$)g.mapsAsObjects=!0,s$=!1;let G=new Map;if(g.keyMap)for(let q=0;q<$;q++)G.set(g.decodeKey(y()),y());else for(let q=0;q<$;q++)G.set(y(),y());return G}case 6:if($>=GQ){let G=o[$&8191];if(G){if(!G.read)G.read=l0(G);return G.read()}if($<65536){if($==CJ){let q=y$(),Y=y(),U=y();i0(Y,U);let Z={};if(g.keyMap)for(let O=2;O<q;O++){let W=g.decodeKey(U[O-2]);Z[K$(W)]=y()}else for(let O=2;O<q;O++){let W=U[O-2];Z[K$(W)]=y()}return Z}else if($==zJ){let q=y$(),Y=y();for(let U=2;U<q;U++)i0(Y++,y());return y()}else if($==GQ)return EJ();if(g.getShared){if(s0(),G=o[$&8191],G){if(!G.read)G.read=l0(G);return G.read()}}}}let X=a[$];if(X)if(X.handlesRead)return X(y);else return X(y());else{let G=y();for(let q=0;q<c0.length;q++){let Y=c0[q]($,G);if(Y!==void 0)return Y}return new z$(G,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let G=(Z$||_$())[$];if(G!==void 0)return G;throw new Error("Unknown token "+$)}default:if(isNaN($)){let G=new Error("Unexpected end of CBOR data");throw G.incomplete=!0,G}throw new Error("Unknown CBOR token "+$)}}var NQ=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function l0($){if(!$)throw new Error("Structure is required in record definition");function Q(){let J=F[z++];if(J=J&31,J>23)switch(J){case 24:J=F[z++];break;case 25:J=Y$.getUint16(z),z+=2;break;case 26:J=Y$.getUint32(z),z+=4;break;default:throw new Error("Expected array header, but got "+F[z-1])}let X=this.compiledReader;while(X){if(X.propertyCount===J)return X(y);X=X.next}if(this.slowReads++>=KQ){let q=this.length==J?this:this.slice(0,J);if(X=g.keyMap?new Function("r","return {"+q.map((Y)=>g.decodeKey(Y)).map((Y)=>NQ.test(Y)?K$(Y)+":r()":"["+JSON.stringify(Y)+"]:r()").join(",")+"}"):new Function("r","return {"+q.map((Y)=>NQ.test(Y)?K$(Y)+":r()":"["+JSON.stringify(Y)+"]:r()").join(",")+"}"),this.compiledReader)X.next=this.compiledReader;return X.propertyCount=J,this.compiledReader=X,X(y)}let G={};if(g.keyMap)for(let q=0;q<J;q++)G[K$(g.decodeKey(this[q]))]=y();else for(let q=0;q<J;q++)G[K$(this[q])]=y();return G}return $.slowReads=0,Q}function K$($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var LJ=d0;function d0($){let Q;if($<16){if(Q=WQ($))return Q}if($>64&&h0)return h0.decode(F.subarray(z,z+=$));let J=z+$,X=[];Q="";while(z<J){let G=F[z++];if((G&128)===0)X.push(G);else if((G&224)===192){let q=F[z++]&63;X.push((G&31)<<6|q)}else if((G&240)===224){let q=F[z++]&63,Y=F[z++]&63;X.push((G&31)<<12|q<<6|Y)}else if((G&248)===240){let q=F[z++]&63,Y=F[z++]&63,U=F[z++]&63,Z=(G&7)<<18|q<<12|Y<<6|U;if(Z>65535)Z-=65536,X.push(Z>>>10&1023|55296),Z=56320|Z&1023;X.push(Z)}else X.push(G);if(X.length>=4096)Q+=e.apply(String,X),X.length=0}if(X.length>0)Q+=e.apply(String,X);return Q}var e=String.fromCharCode;function DJ($){let Q=z,J=new Array($);for(let X=0;X<$;X++){let G=F[z++];if((G&128)>0){z=Q;return}J[X]=G}return e.apply(String,J)}function WQ($){if($<4)if($<2)if($===0)return"";else{let Q=F[z++];if((Q&128)>1){z-=1;return}return e(Q)}else{let Q=F[z++],J=F[z++];if((Q&128)>0||(J&128)>0){z-=2;return}if($<3)return e(Q,J);let X=F[z++];if((X&128)>0){z-=3;return}return e(Q,J,X)}else{let Q=F[z++],J=F[z++],X=F[z++],G=F[z++];if((Q&128)>0||(J&128)>0||(X&128)>0||(G&128)>0){z-=4;return}if($<6)if($===4)return e(Q,J,X,G);else{let q=F[z++];if((q&128)>0){z-=5;return}return e(Q,J,X,G,q)}else if($<8){let q=F[z++],Y=F[z++];if((q&128)>0||(Y&128)>0){z-=6;return}if($<7)return e(Q,J,X,G,q,Y);let U=F[z++];if((U&128)>0){z-=7;return}return e(Q,J,X,G,q,Y,U)}else{let q=F[z++],Y=F[z++],U=F[z++],Z=F[z++];if((q&128)>0||(Y&128)>0||(U&128)>0||(Z&128)>0){z-=8;return}if($<10)if($===8)return e(Q,J,X,G,q,Y,U,Z);else{let O=F[z++];if((O&128)>0){z-=9;return}return e(Q,J,X,G,q,Y,U,Z,O)}else if($<12){let O=F[z++],W=F[z++];if((O&128)>0||(W&128)>0){z-=10;return}if($<11)return e(Q,J,X,G,q,Y,U,Z,O,W);let L=F[z++];if((L&128)>0){z-=11;return}return e(Q,J,X,G,q,Y,U,Z,O,W,L)}else{let O=F[z++],W=F[z++],L=F[z++],I=F[z++];if((O&128)>0||(W&128)>0||(L&128)>0||(I&128)>0){z-=12;return}if($<14)if($===12)return e(Q,J,X,G,q,Y,U,Z,O,W,L,I);else{let w=F[z++];if((w&128)>0){z-=13;return}return e(Q,J,X,G,q,Y,U,Z,O,W,L,I,w)}else{let w=F[z++],V=F[z++];if((w&128)>0||(V&128)>0){z-=14;return}if($<15)return e(Q,J,X,G,q,Y,U,Z,O,W,L,I,w,V);let S=F[z++];if((S&128)>0){z-=15;return}return e(Q,J,X,G,q,Y,U,Z,O,W,L,I,w,V,S)}}}}}function HJ($){return g.copyBuffers?Uint8Array.prototype.slice.call(F,z,z+=$):F.subarray(z,z+=$)}var MQ=new Float32Array(1),W0=new Uint8Array(MQ.buffer,0,4);function RJ(){let $=F[z++],Q=F[z++],J=($&127)>>2;if(J===31){if(Q||$&3)return NaN;return $&128?-1/0:1/0}if(J===0){let X=(($&3)<<8|Q)/16777216;return $&128?-X:X}return W0[3]=$&128|(J>>1)+56,W0[2]=($&7)<<5|Q>>3,W0[1]=Q<<5,W0[0]=0,MQ[0]}var WX=new Array(4096);class z${constructor($,Q){this.value=$,this.tag=Q}}a[0]=($)=>{return new Date($)};a[1]=($)=>{return new Date(Math.round($*1000))};a[2]=($)=>{let Q=BigInt(0);for(let J=0,X=$.byteLength;J<X;J++)Q=BigInt($[J])+(Q<<BigInt(8));return Q};a[3]=($)=>{return BigInt(-1)-a[2]($)};a[4]=($)=>{return+($[1]+"e"+$[0])};a[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var i0=($,Q)=>{$=$-57344;let J=o[$];if(J&&J.isShared)(o.restoreStructures||(o.restoreStructures=[]))[$]=J;o[$]=Q,Q.read=l0(Q)};a[OJ]=($)=>{let Q=$.length,J=$[1];i0($[0],J);let X={};for(let G=2;G<Q;G++){let q=J[G-2];X[K$(q)]=$[G]}return X};a[14]=($)=>{if(n)return n[0].slice(n.position0,n.position0+=$);return new z$($,14)};a[15]=($)=>{if(n)return n[1].slice(n.position1,n.position1+=$);return new z$($,15)};var BJ={Error,RegExp};a[27]=($)=>{return(BJ[$[0]]||Error)($[1],$[2])};var OQ=($)=>{if(F[z++]!=132){let J=new Error("Packed values structure must be followed by a 4 element array");if(F.length<z)J.incomplete=!0;throw J}let Q=$();if(!Q||!Q.length){let J=new Error("Packed values structure must be followed by a 4 element array");throw J.incomplete=!0,J}return Z$=Z$?Q.concat(Z$.slice(Q.length)):Q,Z$.prefixes=$(),Z$.suffixes=$(),$()};OQ.handlesRead=!0;a[51]=OQ;a[YQ]=($)=>{if(!Z$)if(g.getShared)s0();else return new z$($,YQ);if(typeof $=="number")return Z$[16+($>=0?2*$:-2*$-1)];let Q=new Error("No support for non-integer packed references yet");if($===void 0)Q.incomplete=!0;throw Q};a[28]=($)=>{if(!U$)U$=new Map,U$.id=0;let Q=U$.id++,J=z,X=F[z],G;if(X>>5==4)G=[];else G={};let q={target:G};U$.set(Q,q);let Y=$();if(q.used){if(Object.getPrototypeOf(G)!==Object.getPrototypeOf(Y))z=J,G=Y,U$.set(Q,{target:G}),Y=$();return Object.assign(G,Y)}return q.target=Y,Y};a[28].handlesRead=!0;a[29]=($)=>{let Q=U$.get($);return Q.used=!0,Q.target};a[258]=($)=>new Set($);(a[259]=($)=>{if(g.mapsAsObjects)g.mapsAsObjects=!1,s$=!0;return $()}).handlesRead=!0;function g$($,Q){if(typeof $==="string")return $+Q;if($ instanceof Array)return $.concat(Q);return Object.assign({},$,Q)}function _$(){if(!Z$)if(g.getShared)s0();else throw new Error("No packed values available");return Z$}var TJ=1399353956;c0.push(($,Q)=>{if($>=225&&$<=255)return g$(_$().prefixes[$-224],Q);if($>=28704&&$<=32767)return g$(_$().prefixes[$-28672],Q);if($>=1879052288&&$<=2147483647)return g$(_$().prefixes[$-1879048192],Q);if($>=216&&$<=223)return g$(Q,_$().suffixes[$-216]);if($>=27647&&$<=28671)return g$(Q,_$().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return g$(Q,_$().suffixes[$-1811939328]);if($==TJ)return{packedValues:Z$,structures:o.slice(0),version:Q};if($==55799)return Q});var IJ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,o0=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],jJ=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<o0.length;$++)VJ(o0[$],jJ[$]);function VJ($,Q){let J="get"+$.name.slice(0,-5),X;if(typeof $==="function")X=$.BYTES_PER_ELEMENT;else $=null;for(let G=0;G<2;G++){if(!G&&X==1)continue;let q=X==2?1:X==4?2:X==8?3:0;a[G?Q:Q-4]=X==1||G==IJ?(Y)=>{if(!$)throw new Error("Could not find typed array for code "+Q);if(!g.copyBuffers){if(X===1||X===2&&!(Y.byteOffset&1)||X===4&&!(Y.byteOffset&3)||X===8&&!(Y.byteOffset&7))return new $(Y.buffer,Y.byteOffset,Y.byteLength>>q)}return new $(Uint8Array.prototype.slice.call(Y,0).buffer)}:(Y)=>{if(!$)throw new Error("Could not find typed array for code "+Q);let U=new DataView(Y.buffer,Y.byteOffset,Y.byteLength),Z=Y.length>>q,O=new $(Z),W=U[J];for(let L=0;L<Z;L++)O[L]=W.call(U,L<<q,G);return O}}}function EJ(){let $=y$(),Q=z+y();for(let X=2;X<$;X++){let G=y$();z+=G}let J=z;return z=Q,n=[d0(y$()),d0(y$())],n.position0=0,n.position1=0,n.postBundlePosition=z,z=J,y()}function y$(){let $=F[z++]&31;if($>23)switch($){case 24:$=F[z++];break;case 25:$=Y$.getUint16(z),z+=2;break;case 26:$=Y$.getUint32(z),z+=4;break}return $}function s0(){if(g.getShared){let $=zQ(()=>{return F=null,g.getShared()})||{},Q=$.structures||[];if(g.sharedVersion=$.version,Z$=g.sharedValues=$.packedValues,o===!0)g.structures=o=Q;else o.splice.apply(o,[0,Q.length].concat(Q))}}function zQ($){let Q=k$,J=z,X=u0,G=O0,q=a$,Y=M0,U=p0,Z=U$,O=n,W=new Uint8Array(F.slice(0,k$)),L=o,I=g,w=n$,V=$();return k$=Q,z=J,u0=X,O0=G,a$=q,M0=Y,p0=U,U$=Z,n=O,F=W,n$=w,o=L,g=I,Y$=new DataView(F.buffer,F.byteOffset,F.byteLength),V}function z0(){F=null,U$=null,o=null}var C0=new Array(147);for(let $=0;$<256;$++)C0[$]=+("1e"+Math.floor(45.15-$*0.30103));var a0=new E$({useRecords:!1}),L0=a0.decode,AJ=a0.decodeMultiple;var D0;try{D0=new TextEncoder}catch($){}var $8,TQ,R0=typeof globalThis==="object"&&globalThis.Buffer,r$=typeof R0!=="undefined",n0=r$?R0.allocUnsafeSlow:Uint8Array,CQ=r$?R0:Uint8Array,LQ=256,DQ=r$?4294967296:2144337920;var r0,M,d,N=0,A$,r=null,FJ=61440,wJ=/[\u0080-\uFFFF]/,N$=Symbol("record-id");class B0 extends E${constructor($){super($);this.offset=0;let Q,J,X,G,q,Y;$=$||{};let U=CQ.prototype.utf8Write?function(K,R,C){return M.utf8Write(K,R,C)}:D0&&D0.encodeInto?function(K,R){return D0.encodeInto(K,M.subarray(R)).written}:!1,Z=this,O=$.structures||$.saveStructures,W=$.maxSharedStructures;if(W==null)W=O?128:0;if(W>8190)throw new Error("Maximum maxSharedStructure is 8190");let L=$.sequential;if(L)W=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let I,w,V=$.sharedValues,S;if(V){S=Object.create(null);for(let K=0,R=V.length;K<R;K++)S[V[K]]=K}let B=[],P=0,E=0;this.mapEncode=function(K,R){if(this._keyMap&&!this._mapped)switch(K.constructor.name){case"Array":K=K.map((C)=>this.encodeKeys(C));break}return this.encode(K,R)},this.encode=function(K,R){if(!M)M=new n0(8192),d=new DataView(M.buffer,0,8192),N=0;if(A$=M.length-10,A$-N<2048)M=new n0(M.length),d=new DataView(M.buffer,0,M.length),A$=M.length-10,N=0;else if(R===J8)N=N+7&2147483640;if(J=N,Z.useSelfDescribedHeader)d.setUint32(N,3654940416),N+=3;if(Y=Z.structuredClone?new Map:null,Z.bundleStrings&&typeof K!=="string")r=[],r.size=1/0;else r=null;if(X=Z.structures,X){if(X.uninitialized){let D=Z.getShared()||{};Z.structures=X=D.structures||[],Z.sharedVersion=D.version;let H=Z.sharedValues=D.packedValues;if(H){S={};for(let A=0,_=H.length;A<_;A++)S[H[A]]=A}}let C=X.length;if(C>W&&!L)C=W;if(!X.transitions){X.transitions=Object.create(null);for(let D=0;D<C;D++){let H=X[D];if(!H)continue;let A,_=X.transitions;for(let k=0,v=H.length;k<v;k++){if(_[N$]===void 0)_[N$]=D;let m=H[k];if(A=_[m],!A)A=_[m]=Object.create(null);_=A}_[N$]=D|1048576}}if(!L)X.nextId=C}if(G)G=!1;if(q=X||[],w=S,$.pack){let C=new Map;if(C.values=[],C.encoder=Z,C.maxValues=$.maxPrivatePackedValues||(S?16:1/0),C.objectMap=S||!1,C.samplingPackedValues=I,H0(K,C),C.values.length>0){M[N++]=216,M[N++]=51,L$(4);let D=C.values;T(D),L$(0),L$(0),w=Object.create(S||null);for(let H=0,A=D.length;H<A;H++)w[D[H]]=H}}r0=R&e0;try{if(r0)return;if(T(K),r)RQ(J,T);if(Z.offset=N,Y&&Y.idsToInsert){if(N+=Y.idsToInsert.length*2,N>A$)p(N);Z.offset=N;let C=_J(M.subarray(J,N),Y.idsToInsert);return Y=null,C}if(R&J8)return M.start=J,M.end=N,M;return M.subarray(J,N)}finally{if(X){if(E<10)E++;if(X.length>W)X.length=W;if(P>1e4){if(X.transitions=null,E=0,P=0,B.length>0)B=[]}else if(B.length>0&&!L){for(let C=0,D=B.length;C<D;C++)B[C][N$]=void 0;B=[]}}if(G&&Z.saveShared){if(Z.structures.length>W)Z.structures=Z.structures.slice(0,W);let C=M.subarray(J,N);if(Z.updateSharedData()===!1)return Z.encode(K);return C}if(R&vJ)N=J}},this.findCommonStringsToPack=()=>{if(I=new Map,!S)S=Object.create(null);return(K)=>{let R=K&&K.threshold||4,C=this.pack?K.maxPrivatePackedValues||16:0;if(!V)V=this.sharedValues=[];for(let[D,H]of I)if(H.count>R)S[D]=C++,V.push(D),G=!0;while(this.saveShared&&this.updateSharedData()===!1);I=null}};let T=(K)=>{if(N>A$)M=p(N);var R=typeof K,C;if(R==="string"){if(w){let _=w[K];if(_>=0){if(_<16)M[N++]=_+224;else if(M[N++]=198,_&1)T(15-_>>1);else T(_-16>>1);return}else if(I&&!$.pack){let k=I.get(K);if(k)k.count++;else I.set(K,{count:1})}}let D=K.length;if(r&&D>=4&&D<1024){if((r.size+=D)>FJ){let k,v=(r[0]?r[0].length*3+r[1].length:0)+10;if(N+v>A$)M=p(N+v);if(M[N++]=217,M[N++]=223,M[N++]=249,M[N++]=r.position?132:130,M[N++]=26,k=N-J,N+=4,r.position)RQ(J,T);r=["",""],r.size=0,r.position=k}let _=wJ.test(K);r[_?0:1]+=K,M[N++]=_?206:207,T(D);return}let H;if(D<32)H=1;else if(D<256)H=2;else if(D<65536)H=3;else H=5;let A=D*3;if(N+A>A$)M=p(N+A);if(D<64||!U){let _,k,v,m=N+H;for(_=0;_<D;_++)if(k=K.charCodeAt(_),k<128)M[m++]=k;else if(k<2048)M[m++]=k>>6|192,M[m++]=k&63|128;else if((k&64512)===55296&&((v=K.charCodeAt(_+1))&64512)===56320)k=65536+((k&1023)<<10)+(v&1023),_++,M[m++]=k>>18|240,M[m++]=k>>12&63|128,M[m++]=k>>6&63|128,M[m++]=k&63|128;else M[m++]=k>>12|224,M[m++]=k>>6&63|128,M[m++]=k&63|128;C=m-N-H}else C=U(K,N+H,A);if(C<24)M[N++]=96|C;else if(C<256){if(H<2)M.copyWithin(N+2,N+1,N+1+C);M[N++]=120,M[N++]=C}else if(C<65536){if(H<3)M.copyWithin(N+3,N+2,N+2+C);M[N++]=121,M[N++]=C>>8,M[N++]=C&255}else{if(H<5)M.copyWithin(N+5,N+3,N+3+C);M[N++]=122,d.setUint32(N,C),N+=4}N+=C}else if(R==="number")if(!this.alwaysUseFloat&&K>>>0===K)if(K<24)M[N++]=K;else if(K<256)M[N++]=24,M[N++]=K;else if(K<65536)M[N++]=25,M[N++]=K>>8,M[N++]=K&255;else M[N++]=26,d.setUint32(N,K),N+=4;else if(!this.alwaysUseFloat&&K>>0===K)if(K>=-24)M[N++]=31-K;else if(K>=-256)M[N++]=56,M[N++]=~K;else if(K>=-65536)M[N++]=57,d.setUint16(N,~K),N+=2;else M[N++]=58,d.setUint32(N,~K),N+=4;else{let D;if((D=this.useFloat32)>0&&K<4294967296&&K>=-2147483648){M[N++]=250,d.setFloat32(N,K);let H;if(D<4||(H=K*C0[(M[N]&127)<<1|M[N+1]>>7])>>0===H){N+=4;return}else N--}M[N++]=251,d.setFloat64(N,K),N+=8}else if(R==="object")if(!K)M[N++]=246;else{if(Y){let H=Y.get(K);if(H){if(M[N++]=216,M[N++]=29,M[N++]=25,!H.references){let A=Y.idsToInsert||(Y.idsToInsert=[]);H.references=[],A.push(H)}H.references.push(N-J),N+=2;return}else Y.set(K,{offset:N-J})}let D=K.constructor;if(D===Object)b(K);else if(D===Array){if(C=K.length,C<24)M[N++]=128|C;else L$(C);for(let H=0;H<C;H++)T(K[H])}else if(D===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)M[N++]=217,M[N++]=1,M[N++]=3;if(C=K.size,C<24)M[N++]=160|C;else if(C<256)M[N++]=184,M[N++]=C;else if(C<65536)M[N++]=185,M[N++]=C>>8,M[N++]=C&255;else M[N++]=186,d.setUint32(N,C),N+=4;if(Z.keyMap)for(let[H,A]of K)T(Z.encodeKey(H)),T(A);else for(let[H,A]of K)T(H),T(A)}else{for(let H=0,A=$8.length;H<A;H++){let _=TQ[H];if(K instanceof _){let k=$8[H],v=k.tag;if(v==null)v=k.getTag&&k.getTag.call(this,K);if(v<24)M[N++]=192|v;else if(v<256)M[N++]=216,M[N++]=v;else if(v<65536)M[N++]=217,M[N++]=v>>8,M[N++]=v&255;else if(v>-1)M[N++]=218,d.setUint32(N,v),N+=4;k.encode.call(this,K,T,p);return}}if(K[Symbol.iterator]){if(r0){let H=new Error("Iterable should be serialized as iterator");throw H.iteratorNotHandled=!0,H}M[N++]=159;for(let H of K)T(H);M[N++]=255;return}if(K[Symbol.asyncIterator]||t0(K)){let H=new Error("Iterable/blob should be serialized as iterator");throw H.iteratorNotHandled=!0,H}if(this.useToJSON&&K.toJSON){let H=K.toJSON();if(H!==K)return T(H)}b(K)}}else if(R==="boolean")M[N++]=K?245:244;else if(R==="bigint"){if(K<BigInt(1)<<BigInt(64)&&K>=0)M[N++]=27,d.setBigUint64(N,K);else if(K>-(BigInt(1)<<BigInt(64))&&K<0)M[N++]=59,d.setBigUint64(N,-K-BigInt(1));else if(this.largeBigIntToFloat)M[N++]=251,d.setFloat64(N,Number(K));else{if(K>=BigInt(0))M[N++]=194;else M[N++]=195,K=BigInt(-1)-K;let D=[];while(K)D.push(Number(K&BigInt(255))),K>>=BigInt(8);Q8(new Uint8Array(D.reverse()),p);return}N+=8}else if(R==="undefined")M[N++]=247;else throw new Error("Unknown type: "+R)},b=this.useRecords===!1?this.variableMapSize?(K)=>{let R=Object.keys(K),C=Object.values(K),D=R.length;if(D<24)M[N++]=160|D;else if(D<256)M[N++]=184,M[N++]=D;else if(D<65536)M[N++]=185,M[N++]=D>>8,M[N++]=D&255;else M[N++]=186,d.setUint32(N,D),N+=4;let H;if(Z.keyMap)for(let A=0;A<D;A++)T(Z.encodeKey(R[A])),T(C[A]);else for(let A=0;A<D;A++)T(R[A]),T(C[A])}:(K)=>{M[N++]=185;let R=N-J;N+=2;let C=0;if(Z.keyMap){for(let D in K)if(typeof K.hasOwnProperty!=="function"||K.hasOwnProperty(D))T(Z.encodeKey(D)),T(K[D]),C++}else for(let D in K)if(typeof K.hasOwnProperty!=="function"||K.hasOwnProperty(D))T(D),T(K[D]),C++;M[R+++J]=C>>8,M[R+J]=C&255}:(K,R)=>{let C,D=q.transitions||(q.transitions=Object.create(null)),H=0,A=0,_,k;if(this.keyMap){k=Object.keys(K).map((m)=>this.encodeKey(m)),A=k.length;for(let m=0;m<A;m++){let I0=k[m];if(C=D[I0],!C)C=D[I0]=Object.create(null),H++;D=C}}else for(let m in K)if(typeof K.hasOwnProperty!=="function"||K.hasOwnProperty(m)){if(C=D[m],!C){if(D[N$]&1048576)_=D[N$]&65535;C=D[m]=Object.create(null),H++}D=C,A++}let v=D[N$];if(v!==void 0)v&=65535,M[N++]=217,M[N++]=v>>8|224,M[N++]=v&255;else{if(!k)k=D.__keys__||(D.__keys__=Object.keys(K));if(_===void 0){if(v=q.nextId++,!v)v=0,q.nextId=1;if(v>=LQ)q.nextId=(v=W)+1}else v=_;if(q[v]=k,v<W){M[N++]=217,M[N++]=v>>8|224,M[N++]=v&255,D=q.transitions;for(let m=0;m<A;m++){if(D[N$]===void 0||D[N$]&1048576)D[N$]=v;D=D[k[m]]}D[N$]=v|1048576,G=!0}else{if(D[N$]=v,d.setUint32(N,3655335680),N+=3,H)P+=E*H;if(B.length>=LQ-W)B.shift()[N$]=void 0;if(B.push(D),L$(A+2),T(57344+v),T(k),R)return;for(let m in K)if(typeof K.hasOwnProperty!=="function"||K.hasOwnProperty(m))T(K[m]);return}}if(A<24)M[N++]=128|A;else L$(A);if(R)return;for(let m in K)if(typeof K.hasOwnProperty!=="function"||K.hasOwnProperty(m))T(K[m])},p=(K)=>{let R;if(K>16777216){if(K-J>DQ)throw new Error("Encoded buffer would be larger than maximum buffer size");R=Math.min(DQ,Math.round(Math.max((K-J)*(K>67108864?1.25:2),4194304)/4096)*4096)}else R=(Math.max(K-J<<2,M.length-1)>>12)+1<<12;let C=new n0(R);if(d=new DataView(C.buffer,0,R),M.copy)M.copy(C,0,J,K);else C.set(M.slice(J,K));return N-=J,J=0,A$=C.length-10,M=C},c=100,h=1000;this.encodeAsIterable=function(K,R){return u(K,R,j)},this.encodeAsAsyncIterable=function(K,R){return u(K,R,l)};function*j(K,R,C){let D=K.constructor;if(D===Object){let H=Z.useRecords!==!1;if(H)b(K,!0);else HQ(Object.keys(K).length,160);for(let A in K){let _=K[A];if(!H)T(A);if(_&&typeof _==="object")if(R[A])yield*j(_,R[A]);else yield*x(_,R,A);else T(_)}}else if(D===Array){let H=K.length;L$(H);for(let A=0;A<H;A++){let _=K[A];if(_&&(typeof _==="object"||N-J>c))if(R.element)yield*j(_,R.element);else yield*x(_,R,"element");else T(_)}}else if(K[Symbol.iterator]&&!K.buffer){M[N++]=159;for(let H of K)if(H&&(typeof H==="object"||N-J>c))if(R.element)yield*j(H,R.element);else yield*x(H,R,"element");else T(H);M[N++]=255}else if(t0(K))HQ(K.size,64),yield M.subarray(J,N),yield K,f();else if(K[Symbol.asyncIterator])M[N++]=159,yield M.subarray(J,N),yield K,f(),M[N++]=255;else T(K);if(C&&N>J)yield M.subarray(J,N);else if(N-J>c)yield M.subarray(J,N),f()}function*x(K,R,C){let D=N-J;try{if(T(K),N-J>c)yield M.subarray(J,N),f()}catch(H){if(H.iteratorNotHandled)R[C]={},N=J+D,yield*j.call(this,K,R[C]);else throw H}}function f(){c=h,Z.encode(null,e0)}function u(K,R,C){if(R&&R.chunkThreshold)c=h=R.chunkThreshold;else c=100;if(K&&typeof K==="object")return Z.encode(null,e0),C(K,Z.iterateProperties||(Z.iterateProperties={}),!0);return[Z.encode(K)]}async function*l(K,R){for(let C of j(K,R,!0)){let D=C.constructor;if(D===CQ||D===Uint8Array)yield C;else if(t0(C)){let H=C.stream().getReader(),A;while(!(A=await H.read()).done)yield A.value}else if(C[Symbol.asyncIterator])for await(let H of C)if(f(),H)yield*l(H,R.async||(R.async={}));else yield Z.encode(H);else yield C}}}useBuffer($){M=$,d=new DataView(M.buffer,M.byteOffset,M.byteLength),N=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let Q=this.structures.slice(0),J=new X8(Q,this.sharedValues,this.sharedVersion),X=this.saveShared(J,(G)=>(G&&G.version||0)==$);if(X===!1)J=this.getShared()||{},this.structures=J.structures||[],this.sharedValues=J.packedValues,this.sharedVersion=J.version,this.structures.nextId=this.structures.length;else Q.forEach((G,q)=>this.structures[q]=G);return X}}function HQ($,Q){if($<24)M[N++]=Q|$;else if($<256)M[N++]=Q|24,M[N++]=$;else if($<65536)M[N++]=Q|25,M[N++]=$>>8,M[N++]=$&255;else M[N++]=Q|26,d.setUint32(N,$),N+=4}class X8{constructor($,Q,J){this.structures=$,this.packedValues=Q,this.version=J}}function L$($){if($<24)M[N++]=128|$;else if($<256)M[N++]=152,M[N++]=$;else if($<65536)M[N++]=153,M[N++]=$>>8,M[N++]=$&255;else M[N++]=154,d.setUint32(N,$),N+=4}var PJ=typeof Blob==="undefined"?function(){}:Blob;function t0($){if($ instanceof PJ)return!0;let Q=$[Symbol.toStringTag];return Q==="Blob"||Q==="File"}function H0($,Q){switch(typeof $){case"string":if($.length>3){if(Q.objectMap[$]>-1||Q.values.length>=Q.maxValues)return;let X=Q.get($);if(X){if(++X.count==2)Q.values.push($)}else if(Q.set($,{count:1}),Q.samplingPackedValues){let G=Q.samplingPackedValues.get($);if(G)G.count++;else Q.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let X=0,G=$.length;X<G;X++)H0($[X],Q);else{let X=!Q.encoder.useRecords;for(var J in $)if($.hasOwnProperty(J)){if(X)H0(J,Q);H0($[J],Q)}}break;case"function":console.log($)}}var xJ=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;TQ=[Date,Set,Error,RegExp,z$,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,X8];$8=[{tag:1,encode($,Q){let J=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&J>=0&&J<4294967296)M[N++]=26,d.setUint32(N,J),N+=4;else M[N++]=251,d.setFloat64(N,J),N+=8}},{tag:258,encode($,Q){let J=Array.from($);Q(J)}},{tag:27,encode($,Q){Q([$.name,$.message])}},{tag:27,encode($,Q){Q(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,Q){Q($.value)}},{encode($,Q,J){Q8($,J)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||r$&&this.tagUint8Array!==!1)return 64}},encode($,Q,J){Q8($,J)}},C$(68,1),C$(69,2),C$(70,4),C$(71,8),C$(72,1),C$(77,2),C$(78,4),C$(79,8),C$(85,4),C$(86,8),{encode($,Q){let J=$.packedValues||[],X=$.structures||[];if(J.values.length>0){M[N++]=216,M[N++]=51,L$(4);let G=J.values;Q(G),L$(0),L$(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let q=0,Y=G.length;q<Y;q++)packedObjectMap[G[q]]=q}if(X){d.setUint32(N,3655335424),N+=3;let G=X.slice(0);G.unshift(57344),G.push(new z$($.version,1399353956)),Q(G)}else Q(new z$($.version,1399353956))}}];function C$($,Q){if(!xJ&&Q>1)$-=4;return{tag:$,encode:function J(X,G){let q=X.byteLength,Y=X.byteOffset||0,U=X.buffer||X;G(r$?R0.from(U,Y,q):new Uint8Array(U,Y,q))}}}function Q8($,Q){let J=$.byteLength;if(J<24)M[N++]=64+J;else if(J<256)M[N++]=88,M[N++]=J;else if(J<65536)M[N++]=89,M[N++]=J>>8,M[N++]=J&255;else M[N++]=90,d.setUint32(N,J),N+=4;if(N+J>=M.length)Q(N+J);M.set($.buffer?$:new Uint8Array($),N),N+=J}function _J($,Q){let J,X=Q.length*2,G=$.length-X;Q.sort((q,Y)=>q.offset>Y.offset?1:-1);for(let q=0;q<Q.length;q++){let Y=Q[q];Y.id=q;for(let U of Y.references)$[U++]=q>>8,$[U]=q&255}while(J=Q.pop()){let q=J.offset;$.copyWithin(q+X,q,G),X-=2;let Y=q+X;$[Y++]=216,$[Y++]=28,G=q}return $}function RQ($,Q){d.setUint32(r.position+$,N-r.position-$+1);let J=r;r=null,Q(J[0]),Q(J[1])}var q8=new B0({useRecords:!1}),kJ=q8.encode,fJ=q8.encodeAsIterable,SJ=q8.encodeAsAsyncIterable;var J8=512,vJ=1024,e0=2048;var T0=($)=>{let Q=new Uint8Array($),J="";for(let X=0;X<Q.byteLength;X++)J+=String.fromCharCode(Q[X]);return btoa(J).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},mJ=($)=>{let Q=atob($.replace(/-/g,"+").replace(/_/g,"/")),J=new Uint8Array(Q.length);for(let X=0;X<Q.length;X++)J[X]=Q.charCodeAt(X);return J.buffer};async function IQ($){let Q=crypto.getRandomValues(new Uint8Array(32)),J=crypto.getRandomValues(new Uint8Array(16)),X=await navigator.credentials.create({publicKey:{challenge:Q,rp:{name:"Sorane Web/A Form"},user:{id:J,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:60000,attestation:"none"}});if(!X)throw new Error("Credential creation failed");return{id:X.id,rawId:T0(X.rawId),response:X.response}}async function jQ($,Q){let J=await navigator.credentials.get({publicKey:{challenge:Q,allowCredentials:[{id:mJ($),type:"public-key"}],userVerification:"required"}});if(!J)throw new Error("Assertion failed");let X=J.response;return{id:J.id,signature:T0(X.signature),authenticatorData:T0(X.authenticatorData),clientDataJSON:T0(X.clientDataJSON)}}function t$($){return Array.from($).map((Q)=>Q.toString(16).padStart(2,"0")).join("")}function VQ($){let Q=new Uint8Array($.length/2);for(let J=0;J<Q.length;J++)Q[J]=parseInt($.substring(J*2,J*2+2),16);return Q}class AQ{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),Q=localStorage.getItem("weba_passkey_pub");if($&&Q){this.credentialId=$,this.publicKey=VQ(Q),this.publicKeyType="p256",this.usePasskey=!0;return}let J=localStorage.getItem("weba_private_key");if(J)this.edPrivateKey=VQ(J),this.publicKey=i$.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey...");let $=await IQ("User"),Q=new Uint8Array($.response.attestationObject),X=L0(Q).authData,G=new DataView(X.buffer,X.byteOffset,X.byteLength),q=53,Y=G.getUint16(q);q+=2,q+=Y;let U=X.slice(q),Z=L0(U),O=Z.get(-2),W=Z.get(-3);if(!O||!W)throw new Error("Invalid COSE Key: x or y missing");let L=new Uint8Array(65);if(L[0]=4,L.set(O,1),L.set(W,33),this.credentialId=$.rawId,this.publicKey=L,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",t$(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=i$.utils.randomSecretKey(),this.publicKey=i$.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",t$(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${t$(this.publicKey)}`}getPublicKey(){return this.publicKey?t$(this.publicKey):""}async sign($,Q="authentication"){if(!this.publicKey)await this.register();let J=EQ.default($),X=new TextEncoder().encode(J);if(this.usePasskey&&this.credentialId){let G=await crypto.subtle.digest("SHA-256",X),q=await jQ(this.credentialId,G);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:Q,proofValue:q.signature,"srn:authenticatorData":q.authenticatorData,"srn:clientDataJSON":q.clientDataJSON,"srn:credentialId":q.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let G=i$.sign(X,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:Q,proofValue:t$(G)}}}}}var b$=new AQ;class G8{formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let Q=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((G)=>{let q=G.dataset.jsonPath;if(q)Q[q]=G.value}),document.querySelectorAll('[type="radio"]:checked').forEach((G)=>{Q[G.name]=G.value}),document.querySelectorAll("table.data-table.dynamic").forEach((G)=>{let q=G.dataset.tableKey;if(q){let Y=[];G.querySelectorAll("tbody tr").forEach((U)=>{let Z={},O=!1;if(U.querySelectorAll("[data-base-key]").forEach((W)=>{if(W.type==="checkbox"){if(Z[W.dataset.baseKey]=W.checked,W.checked)O=!0}else if(Z[W.dataset.baseKey]=W.value,W.value)O=!0}),O)Y.push(Z)}),Q[q]=Y}});let J=document.getElementById("json-ld");if(J)J.textContent=JSON.stringify(Q,null,2);let X=document.getElementById("json-debug");if(X)X.textContent=JSON.stringify(Q,null,2);return Q}async signAndDownload(){let $=this.updateJsonLd(),Q=window,J=Q.generatedJsonStructure&&Q.generatedJsonStructure.name||"Response",X=window.location.href.split("#")[0];if(!b$.getPublicKey()){if(!await b$.register()){alert("Key registration failed.");return}}let G={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:b$.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:X,answers:$}};try{let q=await b$.sign(G);this.downloadHtml("submitted",!0,q)}catch(q){console.error(q),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let Q=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((J)=>{let X=J.dataset.jsonPath;if(Q[X]!==void 0)J.value=Q[X]}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let X=J.dataset.tableKey,G=Q[X];if(Array.isArray(G)){let q=J.querySelector("tbody");if(!q)return;let Y=q.querySelectorAll(".template-row");G.forEach((U,Z)=>{let O;if(Z===0)O=q.querySelector(".template-row");else{let W=q.querySelector(".template-row");if(W){O=W.cloneNode(!0),O.classList.remove("template-row");let L=O.querySelector(".remove-row-btn");if(L)L.style.visibility="visible";q.appendChild(O)}}if(O)O.querySelectorAll("input, select").forEach((W)=>{let L=W.dataset.baseKey;if(L&&U[L]!==void 0)if(W.type==="checkbox")W.checked=!!U[L];else W.value=U[L]})})}})}catch(Q){console.error(Q)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,Q,J){let X=window,G=document.documentElement.outerHTML;if(J){let w=`
<script type="application/ld+json" id="weba-user-vc">
${JSON.stringify(J,null,2)}
</script>
`;if(G.includes("</body>"))G=G.replace("</body>",w+"</body>");else G+=w}let q=new Blob([G],{type:"text/html"}),Y=URL.createObjectURL(q),U=document.createElement("a");U.href=Y;let Z=X.generatedJsonStructure&&X.generatedJsonStructure.name||"web-a-form",O=new Date,W=O.getFullYear()+("0"+(O.getMonth()+1)).slice(-2)+("0"+O.getDate()).slice(-2)+"-"+("0"+O.getHours()).slice(-2)+("0"+O.getMinutes()).slice(-2),L=Math.random().toString(36).substring(2,8),I=`${Z}_${W}_${$}_${L}.html`;if(U.download=I,U.click(),Q)setTimeout(()=>window.location.reload(),1000)}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class Y8{calc;data;constructor($,Q){this.calc=$,this.data=Q}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save HTML",clear_btn:"Clear Data",sign_btn:"Submit (VC)"},ja:{add_row:"+ ",work_save_btn:"HTML",clear_btn:"",sign_btn:" (Submit)"}},Q=(navigator.language||"en").startsWith("ja")?"ja":"en",J=$[Q]||$.en;document.querySelectorAll("[data-i18n]").forEach((X)=>{let G=X.dataset.i18n;if(J[G])X.textContent=J[G]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((J)=>{return J.querySelectorAll("td").length>0}).forEach((J,X)=>{let G=X+1;J.querySelectorAll(".auto-num").forEach((q)=>{if(q.value!=G)q.value=G.toString(),q.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let Q=$.closest("tr"),J=Q.parentElement;if(Q.classList.contains("template-row"))Q.querySelectorAll("input").forEach((X)=>{if(X.type==="checkbox")X.checked=!1;else X.value=""});else{if(Q.remove(),J)this.renumberRows(J);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,Q){let J=document.getElementById("tbl_"+Q);if(!J)return;let X=J.querySelector("tbody");if(!X)return;let G=X.querySelector(".template-row");if(!G)return;let q=G.cloneNode(!0);q.classList.remove("template-row"),q.querySelectorAll("input").forEach((U)=>{if(U.type==="checkbox")U.checked=U.hasAttribute("checked");else U.value=U.getAttribute("value")||""});let Y=q.querySelector(".remove-row-btn");if(Y)Y.style.visibility="visible";q.querySelectorAll("[data-copy-from]").forEach((U)=>{let Z=U.dataset.copyFrom;if(Z){let O=q.querySelector(`[data-base-key="${Z}"]`);if(O&&O.value)U.value=O.value}}),X.appendChild(q),this.renumberRows(X),this.calc.recalculate()}switchTab($,Q){document.querySelectorAll(".tab-btn").forEach((X)=>X.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((X)=>X.classList.remove("active")),$.classList.add("active");let J=document.getElementById(Q);if(J)J.classList.add("active")}}function FQ(){console.log("Web/A Runtime Booting...");let $=new j0,Q=new G8,J=new Y8($,Q),X=window;X.saveDraft=()=>Q.saveDraft(),X.submitDocument=()=>Q.submitDocument(),X.signAndDownload=()=>Q.signAndDownload(),X.clearData=()=>Q.clearData(),X.removeTableRow=(q)=>J.removeTableRow(q),X.addTableRow=(q,Y)=>J.addTableRow(q,Y),X.switchTab=(q,Y)=>J.switchTab(q,Y),X.recalculate=()=>$.recalculate(),X.escapeHtml=(q)=>{if(!q)return"";let Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return q.toString().replace(/[&<>"']/g,(U)=>Y[U]||U)},Q.restoreFromLS(),J.applyI18n(),J.initTables(),$.recalculate();let G;document.addEventListener("input",(q)=>{let Y=q.target;if(q.isTrusted)Y.dataset.dirty="true";let U=Y.dataset.baseKey||Y.dataset.jsonPath;if(U)(Y.closest("tr")||document).querySelectorAll(`[data-copy-from="${U}"]`).forEach((W)=>{if(!W.dataset.dirty){if(W.value!==Y.value)W.value=Y.value,W.dispatchEvent(new Event("input"))}});$.recalculate(),Q.updateJsonLd(),clearTimeout(G),G=setTimeout(()=>Q.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class Z8{suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let Q=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",Q.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let Q=$.toString().toLowerCase();return Q=Q.replace(/[---]/g,(J)=>{return String.fromCharCode(J.charCodeAt(0)-65248)}),Q=Q.replace(/[-]/g,(J)=>String.fromCharCode(J.charCodeAt(0)-65248)),Q.trim()}clean($){if(!$)return"";let Q=this.normalize($);return Q=Q.replace(/(|||||npo||)/g,""),Q=Q.replace(/(\(\)|\(\)|\(\))/g,""),Q.trim()}toIndex($){let Q=parseInt($||"",10);return Number.isFinite(Q)?Q-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let Q=window,J=$.dataset.masterSrc,X=$.dataset.suggestSource;if(!J&&!X)return;let G=this.toIndex($.dataset.masterLabelIndex),q=this.toIndex($.dataset.masterValueIndex),Y=$.value;if(!Y){this.hideSuggestions();return}let U=[],Z=this.normalize(Y);if(X==="column"){let O=$.dataset.baseKey,W=$.closest("table");if(W&&O){let L=new Set;W.querySelectorAll(`[data-base-key="${O}"]`).forEach((I)=>{if(I===$)return;let w=I.value;if(w&&this.normalize(w).includes(Z)){if(!L.has(w))L.add(w),U.push({val:w,row:[w],label:w,score:10})}})}}else if(J){let O=Q.generatedJsonStructure.masterData;if(!O||!O[J])return;O[J].forEach((L,I)=>{if(I===0)return;if(L.some((V)=>this.normalize(V||"").includes(Z))){let V=G>=0?L[G]||"":"",S=q>=0?L[q]||"":"",B=q>=0?S:G>=0?V:L[1]||L[0]||"";U.push({val:B,row:L,label:V,score:10,idx:I})}})}this.renderSuggestions($,U,G)}renderSuggestions($,Q,J){if(Q.length===0){this.hideSuggestions();return}let X=window,G=Q.slice(0,10),q="";G.forEach((W)=>{let L=X.escapeHtml(JSON.stringify(W.row)),I=J>=0?W.label||W.row.join(" : "):W.row.join(" : ");q+=`<div class="suggestion-item" data-val="${X.escapeHtml(W.val)}" data-row="${L}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${X.escapeHtml(I)}</div>`});let Y=this.getGlobalBox();Y.innerHTML=q;let U=$.getBoundingClientRect(),Z=window.scrollY||document.documentElement.scrollTop,O=window.scrollX||document.documentElement.scrollLeft;Y.style.width=Math.max(U.width,200)+"px",Y.style.left=U.left+O+"px",Y.style.top=U.bottom+Z+"px",Y.querySelectorAll(".suggestion-item").forEach((W)=>{W.onmouseenter=()=>W.style.background="#f0f8ff",W.onmouseleave=()=>W.style.background="white"}),Y.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let Q=window,J=this.activeSearchInput,X=$.dataset.val||"",G=$.dataset.row||"[]";try{let q=JSON.parse(G),Y=J.dataset.masterSrc,U=Y?Q.generatedJsonStructure.masterData[Y][0]:[],Z=!1;if(U.length>0&&q.length>0){let O=J.closest("tr");if(O){let W=Array.from(O.querySelectorAll("input, select, textarea"));U.forEach((L,I)=>{if(!L)return;let w=q[I];this.fillField(W,L,w,J,()=>{Z=!0})})}}if(!Z)J.value=X,J.dispatchEvent(new Event("input",{bubbles:!0}))}catch(q){console.error(q)}this.hideSuggestions()}fillField($,Q,J,X,G){let q=this.normalize(Q),Y=$.find((U)=>{let Z=U.dataset.baseKey||U.dataset.jsonPath,O=this.normalize(U.getAttribute("placeholder")||"");return Z&&this.normalize(Z)===q||O===q});if(Y){if(Y.value=J||"",Y.dispatchEvent(new Event("input",{bubbles:!0})),Y===X)G()}}}var wQ=new Z8;window.GlobalSearch=wQ;FQ();wQ.init();
