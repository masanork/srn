var lJ=Object.create;var{getPrototypeOf:pJ,defineProperty:u$,getOwnPropertyNames:uJ}=Object;var hJ=Object.prototype.hasOwnProperty;var h$=($,q,J)=>{J=$!=null?lJ(pJ($)):{};let Q=q||!$||!$.__esModule?u$(J,"default",{value:$,enumerable:!0}):J;for(let U of uJ($))if(!hJ.call(Q,U))u$(Q,U,{get:()=>$[U],enumerable:!0});return Q};var dJ=($,q)=>()=>(q||$((q={exports:{}}).exports,q),q.exports);var Y$=dJ((uQ,bq)=>{bq.exports=function $(q){if(typeof q==="number"&&isNaN(q))throw new Error("NaN is not allowed");if(typeof q==="number"&&!isFinite(q))throw new Error("Infinity is not allowed");if(q===null||typeof q!=="object")return JSON.stringify(q);if(q.toJSON instanceof Function)return $(q.toJSON());if(Array.isArray(q))return`[${q.reduce((U,G,N)=>{return`${U}${N===0?"":","}${$(G===void 0||typeof G==="symbol"?null:G)}`},"")}]`;return`{${Object.keys(q).sort().reduce((Q,U)=>{if(q[U]===void 0||typeof q[U]==="symbol")return Q;let G=Q.length===0?"":",";return`${Q}${G}${$(U)}:${$(q[U])}`},"")}}`}});class r8{runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let q=$.dataset.copyFrom;if(q){let U=($.closest("tr")||document).querySelector(`[data-base-key="${q}"], [data-json-path="${q}"]`);if(U&&U.value!==$.value)$.value=U.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let q=$.dataset.formula;if(!q)return;let J=$.closest("tr"),Q=$.closest("table"),U=(N)=>{let K=0,X="none";if(J){let M=`[data-base-key="${N}"], [data-json-path="${N}"]`,Z=J.querySelector(M);if(Z){if(X="row-input",Z.value!=="")K=parseFloat(Z.value)}}if(X==="none"){let M=document.querySelector(`[data-json-path="${N}"]`);if(M){if(X="static-input",M.value!=="")K=parseFloat(M.value)}}return K},G=q.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(N,K)=>{let X=0,M=Q||document,Z=M.querySelectorAll(`[data-base-key="${K}"], [data-json-path="${K}"]`);if(Z.length===0&&M!==document)Z=document.querySelectorAll(`[data-base-key="${K}"], [data-json-path="${K}"]`);return Z.forEach((w)=>{let T=parseFloat(w.value);if(!isNaN(T))X+=T}),X});G=G.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(N)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(N))return N;return String(U(N))});try{let N=new Function("return "+G)();if(typeof N==="number"&&!isNaN(N))$.value=Number.isInteger(N)?N:N.toFixed(0);else $.value=""}catch(N){console.error("Calc Error:",N),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function O8($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function E0($,q=""){if(!Number.isSafeInteger($)||$<0){let J=q&&`"${q}" `;throw new Error(`${J}expected integer >= 0, got ${$}`)}}function d($,q,J=""){let Q=O8($),U=$?.length,G=q!==void 0;if(!Q||G&&U!==q){let N=J&&`"${J}" `,K=G?` of length ${q}`:"",X=Q?`length=${U}`:`type=${typeof $}`;throw new Error(N+"expected Uint8Array"+K+", got "+X)}return $}function t0($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");E0($.outputLen),E0($.blockLen)}function u0($,q=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(q&&$.finished)throw new Error("Hash#digest() has already been called")}function n$($,q){d($,void 0,"digestInto() output");let J=q.outputLen;if($.length<J)throw new Error('"digestInto() output" expected to be of length >='+J)}function W0(...$){for(let q=0;q<$.length;q++)$[q].fill(0)}function w8($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function C0($,q){return $<<32-q|$>>>q}var i$=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),nJ=Array.from({length:256},($,q)=>q.toString(16).padStart(2,"0"));function h0($){if(d($),i$)return $.toHex();let q="";for(let J=0;J<$.length;J++)q+=nJ[$[J]];return q}var A0={_0:48,_9:57,A:65,F:70,a:97,f:102};function d$($){if($>=A0._0&&$<=A0._9)return $-A0._0;if($>=A0.A&&$<=A0.F)return $-(A0.A-10);if($>=A0.a&&$<=A0.f)return $-(A0.a-10);return}function e0($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(i$)return Uint8Array.fromHex($);let q=$.length,J=q/2;if(q%2)throw new Error("hex string expected, got unpadded hex of length "+q);let Q=new Uint8Array(J);for(let U=0,G=0;U<J;U++,G+=2){let N=d$($.charCodeAt(G)),K=d$($.charCodeAt(G+1));if(N===void 0||K===void 0){let X=$[G]+$[G+1];throw new Error('hex string expected, got non-hex character "'+X+'" at index '+G)}Q[U]=N*16+K}return Q}function $8(...$){let q=0;for(let Q=0;Q<$.length;Q++){let U=$[Q];d(U),q+=U.length}let J=new Uint8Array(q);for(let Q=0,U=0;Q<$.length;Q++){let G=$[Q];J.set(G,U),U+=G.length}return J}function o8($,q={}){let J=(U,G)=>$(G).update(U).digest(),Q=$(void 0);return J.outputLen=Q.outputLen,J.blockLen=Q.blockLen,J.create=(U)=>$(U),Object.assign(J,q),Object.freeze(J)}function q8($=32){let q=typeof globalThis==="object"?globalThis.crypto:null;if(typeof q?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return q.getRandomValues(new Uint8Array($))}var a8=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function r$($,q,J){return $&q^~$&J}function o$($,q,J){return $&q^$&J^q&J}class W8{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,q,J,Q){this.blockLen=$,this.outputLen=q,this.padOffset=J,this.isLE=Q,this.buffer=new Uint8Array($),this.view=w8(this.buffer)}update($){u0(this),d($);let{view:q,buffer:J,blockLen:Q}=this,U=$.length;for(let G=0;G<U;){let N=Math.min(Q-this.pos,U-G);if(N===Q){let K=w8($);for(;Q<=U-G;G+=Q)this.process(K,G);continue}if(J.set($.subarray(G,G+N),this.pos),this.pos+=N,G+=N,this.pos===Q)this.process(q,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){u0(this),n$($,this),this.finished=!0;let{buffer:q,view:J,blockLen:Q,isLE:U}=this,{pos:G}=this;if(q[G++]=128,W0(this.buffer.subarray(G)),this.padOffset>Q-G)this.process(J,0),G=0;for(let Z=G;Z<Q;Z++)q[Z]=0;J.setBigUint64(Q-8,BigInt(this.length*8),U),this.process(J,0);let N=w8($),K=this.outputLen;if(K%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let X=K/4,M=this.get();if(X>M.length)throw new Error("_sha2: outputLen bigger than state");for(let Z=0;Z<X;Z++)N.setUint32(4*Z,M[Z],U)}digest(){let{buffer:$,outputLen:q}=this;this.digestInto($);let J=$.slice(0,q);return this.destroy(),J}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:q,buffer:J,length:Q,finished:U,destroyed:G,pos:N}=this;if($.destroyed=G,$.finished=U,$.length=Q,$.pos=N,Q%q)$.buffer.set(J);return $}clone(){return this._cloneInto()}}var B0=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),I0=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),q0=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J0=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var C8=BigInt(4294967295),a$=BigInt(32);function iJ($,q=!1){if(q)return{h:Number($&C8),l:Number($>>a$&C8)};return{h:Number($>>a$&C8)|0,l:Number($&C8)|0}}function s$($,q=!1){let J=$.length,Q=new Uint32Array(J),U=new Uint32Array(J);for(let G=0;G<J;G++){let{h:N,l:K}=iJ($[G],q);[Q[G],U[G]]=[N,K]}return[Q,U]}var s8=($,q,J)=>$>>>J,t8=($,q,J)=>$<<32-J|q>>>J,_0=($,q,J)=>$>>>J|q<<32-J,v0=($,q,J)=>$<<32-J|q>>>J,J8=($,q,J)=>$<<64-J|q>>>J-32,Q8=($,q,J)=>$>>>J-32|q<<64-J;function H0($,q,J,Q){let U=(q>>>0)+(Q>>>0);return{h:$+J+(U/4294967296|0)|0,l:U|0}}var t$=($,q,J)=>($>>>0)+(q>>>0)+(J>>>0),e$=($,q,J,Q)=>q+J+Q+($/4294967296|0)|0,$q=($,q,J,Q)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0),qq=($,q,J,Q,U)=>q+J+Q+U+($/4294967296|0)|0,Jq=($,q,J,Q,U)=>($>>>0)+(q>>>0)+(J>>>0)+(Q>>>0)+(U>>>0),Qq=($,q,J,Q,U,G)=>q+J+Q+U+G+($/4294967296|0)|0;var oJ=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),g0=new Uint32Array(64);class e8 extends W8{constructor($){super(64,$,8,!1)}get(){let{A:$,B:q,C:J,D:Q,E:U,F:G,G:N,H:K}=this;return[$,q,J,Q,U,G,N,K]}set($,q,J,Q,U,G,N,K){this.A=$|0,this.B=q|0,this.C=J|0,this.D=Q|0,this.E=U|0,this.F=G|0,this.G=N|0,this.H=K|0}process($,q){for(let Z=0;Z<16;Z++,q+=4)g0[Z]=$.getUint32(q,!1);for(let Z=16;Z<64;Z++){let w=g0[Z-15],T=g0[Z-2],D=C0(w,7)^C0(w,18)^w>>>3,B=C0(T,17)^C0(T,19)^T>>>10;g0[Z]=B+g0[Z-7]+D+g0[Z-16]|0}let{A:J,B:Q,C:U,D:G,E:N,F:K,G:X,H:M}=this;for(let Z=0;Z<64;Z++){let w=C0(N,6)^C0(N,11)^C0(N,25),T=M+w+r$(N,K,X)+oJ[Z]+g0[Z]|0,B=(C0(J,2)^C0(J,13)^C0(J,22))+o$(J,Q,U)|0;M=X,X=K,K=N,N=G+T|0,G=U,U=Q,Q=J,J=T+B|0}J=J+this.A|0,Q=Q+this.B|0,U=U+this.C|0,G=G+this.D|0,N=N+this.E|0,K=K+this.F|0,X=X+this.G|0,M=M+this.H|0,this.set(J,Q,U,G,N,K,X,M)}roundClean(){W0(g0)}destroy(){this.set(0,0,0,0,0,0,0,0),W0(this.buffer)}}class Uq extends e8{A=B0[0]|0;B=B0[1]|0;C=B0[2]|0;D=B0[3]|0;E=B0[4]|0;F=B0[5]|0;G=B0[6]|0;H=B0[7]|0;constructor(){super(32)}}class aJ extends e8{A=I0[0]|0;B=I0[1]|0;C=I0[2]|0;D=I0[3]|0;E=I0[4]|0;F=I0[5]|0;G=I0[6]|0;H=I0[7]|0;constructor(){super(28)}}var Gq=(()=>s$(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),sJ=(()=>Gq[0])(),tJ=(()=>Gq[1])(),x0=new Uint32Array(80),V0=new Uint32Array(80);class U8 extends W8{constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:q,Bh:J,Bl:Q,Ch:U,Cl:G,Dh:N,Dl:K,Eh:X,El:M,Fh:Z,Fl:w,Gh:T,Gl:D,Hh:B,Hl:x}=this;return[$,q,J,Q,U,G,N,K,X,M,Z,w,T,D,B,x]}set($,q,J,Q,U,G,N,K,X,M,Z,w,T,D,B,x){this.Ah=$|0,this.Al=q|0,this.Bh=J|0,this.Bl=Q|0,this.Ch=U|0,this.Cl=G|0,this.Dh=N|0,this.Dl=K|0,this.Eh=X|0,this.El=M|0,this.Fh=Z|0,this.Fl=w|0,this.Gh=T|0,this.Gl=D|0,this.Hh=B|0,this.Hl=x|0}process($,q){for(let z=0;z<16;z++,q+=4)x0[z]=$.getUint32(q),V0[z]=$.getUint32(q+=4);for(let z=16;z<80;z++){let A=x0[z-15]|0,g=V0[z-15]|0,_=_0(A,g,1)^_0(A,g,8)^s8(A,g,7),S=v0(A,g,1)^v0(A,g,8)^t8(A,g,7),c=x0[z-2]|0,I=V0[z-2]|0,P=_0(c,I,19)^J8(c,I,61)^s8(c,I,6),m=v0(c,I,19)^Q8(c,I,61)^t8(c,I,6),b=$q(S,m,V0[z-7],V0[z-16]),p=qq(b,_,P,x0[z-7],x0[z-16]);x0[z]=p|0,V0[z]=b|0}let{Ah:J,Al:Q,Bh:U,Bl:G,Ch:N,Cl:K,Dh:X,Dl:M,Eh:Z,El:w,Fh:T,Fl:D,Gh:B,Gl:x,Hh:W,Hl:j}=this;for(let z=0;z<80;z++){let A=_0(Z,w,14)^_0(Z,w,18)^J8(Z,w,41),g=v0(Z,w,14)^v0(Z,w,18)^Q8(Z,w,41),_=Z&T^~Z&B,S=w&D^~w&x,c=Jq(j,g,S,tJ[z],V0[z]),I=Qq(c,W,A,_,sJ[z],x0[z]),P=c|0,m=_0(J,Q,28)^J8(J,Q,34)^J8(J,Q,39),b=v0(J,Q,28)^Q8(J,Q,34)^Q8(J,Q,39),p=J&U^J&N^U&N,f=Q&G^Q&K^G&K;W=B|0,j=x|0,B=T|0,x=D|0,T=Z|0,D=w|0,{h:Z,l:w}=H0(X|0,M|0,I|0,P|0),X=N|0,M=K|0,N=U|0,K=G|0,U=J|0,G=Q|0;let E=t$(P,b,f);J=e$(E,I,m,p),Q=E|0}({h:J,l:Q}=H0(this.Ah|0,this.Al|0,J|0,Q|0)),{h:U,l:G}=H0(this.Bh|0,this.Bl|0,U|0,G|0),{h:N,l:K}=H0(this.Ch|0,this.Cl|0,N|0,K|0),{h:X,l:M}=H0(this.Dh|0,this.Dl|0,X|0,M|0),{h:Z,l:w}=H0(this.Eh|0,this.El|0,Z|0,w|0),{h:T,l:D}=H0(this.Fh|0,this.Fl|0,T|0,D|0),{h:B,l:x}=H0(this.Gh|0,this.Gl|0,B|0,x|0),{h:W,l:j}=H0(this.Hh|0,this.Hl|0,W|0,j|0),this.set(J,Q,U,G,N,K,X,M,Z,w,T,D,B,x,W,j)}roundClean(){W0(x0,V0)}destroy(){W0(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Nq extends U8{Ah=J0[0]|0;Al=J0[1]|0;Bh=J0[2]|0;Bl=J0[3]|0;Ch=J0[4]|0;Cl=J0[5]|0;Dh=J0[6]|0;Dl=J0[7]|0;Eh=J0[8]|0;El=J0[9]|0;Fh=J0[10]|0;Fl=J0[11]|0;Gh=J0[12]|0;Gl=J0[13]|0;Hh=J0[14]|0;Hl=J0[15]|0;constructor(){super(64)}}class eJ extends U8{Ah=q0[0]|0;Al=q0[1]|0;Bh=q0[2]|0;Bl=q0[3]|0;Ch=q0[4]|0;Cl=q0[5]|0;Dh=q0[6]|0;Dl=q0[7]|0;Eh=q0[8]|0;El=q0[9]|0;Fh=q0[10]|0;Fl=q0[11]|0;Gh=q0[12]|0;Gl=q0[13]|0;Hh=q0[14]|0;Hl=q0[15]|0;constructor(){super(48)}}var Q0=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),U0=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class $1 extends U8{Ah=Q0[0]|0;Al=Q0[1]|0;Bh=Q0[2]|0;Bl=Q0[3]|0;Ch=Q0[4]|0;Cl=Q0[5]|0;Dh=Q0[6]|0;Dl=Q0[7]|0;Eh=Q0[8]|0;El=Q0[9]|0;Fh=Q0[10]|0;Fl=Q0[11]|0;Gh=Q0[12]|0;Gl=Q0[13]|0;Hh=Q0[14]|0;Hl=Q0[15]|0;constructor(){super(28)}}class q1 extends U8{Ah=U0[0]|0;Al=U0[1]|0;Bh=U0[2]|0;Bl=U0[3]|0;Ch=U0[4]|0;Cl=U0[5]|0;Dh=U0[6]|0;Dl=U0[7]|0;Eh=U0[8]|0;El=U0[9]|0;Fh=U0[10]|0;Fl=U0[11]|0;Gh=U0[12]|0;Gl=U0[13]|0;Hh=U0[14]|0;Hl=U0[15]|0;constructor(){super(32)}}var K0=o8(()=>new Uq,a8(1));var Xq=o8(()=>new Nq,a8(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Yq=BigInt(0),Kq=BigInt(1);function H8($,q=""){if(typeof $!=="boolean"){let J=q&&`"${q}" `;throw new Error(J+"expected boolean, got type="+typeof $)}return $}function J1($){if(typeof $==="bigint"){if(!E8($))throw new Error("positive bigint expected, got "+$)}else E0($);return $}function Zq($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?Yq:BigInt("0x"+$)}function fq($){return Zq(h0($))}function j0($){return Zq(h0(S0(d($)).reverse()))}function $$($,q){E0(q),$=J1($);let J=e0($.toString(16).padStart(q*2,"0"));if(J.length!==q)throw new Error("number too large");return J}function T8($,q){return $$($,q).reverse()}function S0($){return Uint8Array.from($)}var E8=($)=>typeof $==="bigint"&&Yq<=$;function Q1($,q,J){return E8($)&&E8(q)&&E8(J)&&q<=$&&$<J}function d0($,q,J,Q){if(!Q1(q,J,Q))throw new Error("expected valid "+$+": "+J+" <= n < "+Q+", got "+q)}var Mq=($)=>(Kq<<BigInt($))-Kq;function b0($,q={},J={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function Q(G,N,K){let X=$[G];if(K&&X===void 0)return;let M=typeof X;if(M!==N||X===null)throw new Error(`param "${G}" is invalid: expected ${N}, got ${M}`)}let U=(G,N)=>Object.entries(G).forEach(([K,X])=>Q(K,X,N));U(q,!1),U(J,!0)}function q$($){let q=new WeakMap;return(J,...Q)=>{let U=q.get(J);if(U!==void 0)return U;let G=$(J,...Q);return q.set(J,G),G}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var N0=BigInt(0),G0=BigInt(1),c0=BigInt(2),wq=BigInt(3),Wq=BigInt(4),Cq=BigInt(5),U1=BigInt(7),Eq=BigInt(8),G1=BigInt(9),Hq=BigInt(16);function i($,q){let J=$%q;return J>=N0?J:q+J}function L0($,q,J){let Q=$;while(q-- >N0)Q*=Q,Q%=J;return Q}function Lq($,q){if($===N0)throw new Error("invert: expected non-zero number");if(q<=N0)throw new Error("invert: expected positive modulus, got "+q);let J=i($,q),Q=q,U=N0,G=G0,N=G0,K=N0;while(J!==N0){let M=Q/J,Z=Q%J,w=U-N*M,T=G-K*M;Q=J,J=Z,U=N,G=K,N=w,K=T}if(Q!==G0)throw new Error("invert: does not exist");return i(U,q)}function J$($,q,J){if(!$.eql($.sqr(q),J))throw new Error("Cannot find square root")}function Tq($,q){let J=($.ORDER+G0)/Wq,Q=$.pow(q,J);return J$($,Q,q),Q}function N1($,q){let J=($.ORDER-Cq)/Eq,Q=$.mul(q,c0),U=$.pow(Q,J),G=$.mul(q,U),N=$.mul($.mul(G,c0),U),K=$.mul(G,$.sub(N,$.ONE));return J$($,K,q),K}function X1($){let q=D8($),J=Rq($),Q=J(q,q.neg(q.ONE)),U=J(q,Q),G=J(q,q.neg(Q)),N=($+U1)/Hq;return(K,X)=>{let M=K.pow(X,N),Z=K.mul(M,Q),w=K.mul(M,U),T=K.mul(M,G),D=K.eql(K.sqr(Z),X),B=K.eql(K.sqr(w),X);M=K.cmov(M,Z,D),Z=K.cmov(T,w,B);let x=K.eql(K.sqr(Z),X),W=K.cmov(M,Z,x);return J$(K,W,X),W}}function Rq($){if($<wq)throw new Error("sqrt is not defined for small field");let q=$-G0,J=0;while(q%c0===N0)q/=c0,J++;let Q=c0,U=D8($);while(Oq(U,Q)===1)if(Q++>1000)throw new Error("Cannot find square root: probably non-prime P");if(J===1)return Tq;let G=U.pow(Q,q),N=(q+G0)/c0;return function K(X,M){if(X.is0(M))return M;if(Oq(X,M)!==1)throw new Error("Cannot find square root");let Z=J,w=X.mul(X.ONE,G),T=X.pow(M,q),D=X.pow(M,N);while(!X.eql(T,X.ONE)){if(X.is0(T))return X.ZERO;let B=1,x=X.sqr(T);while(!X.eql(x,X.ONE))if(B++,x=X.sqr(x),B===Z)throw new Error("Cannot find square root");let W=G0<<BigInt(Z-B-1),j=X.pow(w,W);Z=B,w=X.sqr(j),T=X.mul(T,w),D=X.mul(D,j)}return D}}function K1($){if($%Wq===wq)return Tq;if($%Eq===Cq)return N1;if($%Hq===G1)return X1($);return Rq($)}var Dq=($,q)=>(i($,q)&G0)===G0,Y1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function zq($){let q={ORDER:"bigint",BYTES:"number",BITS:"number"},J=Y1.reduce((Q,U)=>{return Q[U]="function",Q},q);return b0($,J),$}function Z1($,q,J){if(J<N0)throw new Error("invalid exponent, negatives unsupported");if(J===N0)return $.ONE;if(J===G0)return q;let Q=$.ONE,U=q;while(J>N0){if(J&G0)Q=$.mul(Q,U);U=$.sqr(U),J>>=G0}return Q}function R8($,q,J=!1){let Q=new Array(q.length).fill(J?$.ZERO:void 0),U=q.reduce((N,K,X)=>{if($.is0(K))return N;return Q[X]=N,$.mul(N,K)},$.ONE),G=$.inv(U);return q.reduceRight((N,K,X)=>{if($.is0(K))return N;return Q[X]=$.mul(N,Q[X]),$.mul(N,K)},G),Q}function Oq($,q){let J=($.ORDER-G0)/c0,Q=$.pow(q,J),U=$.eql(Q,$.ONE),G=$.eql(Q,$.ZERO),N=$.eql(Q,$.neg($.ONE));if(!U&&!G&&!N)throw new Error("invalid Legendre symbol result");return U?1:G?0:-1}function f1($,q){if(q!==void 0)E0(q);let J=q!==void 0?q:$.toString(2).length,Q=Math.ceil(J/8);return{nBitLength:J,nByteLength:Q}}class Aq{ORDER;BITS;BYTES;isLE;ZERO=N0;ONE=G0;_lengths;_sqrt;_mod;constructor($,q={}){if($<=N0)throw new Error("invalid field: expected ORDER > 0, got "+$);let J=void 0;if(this.isLE=!1,q!=null&&typeof q==="object"){if(typeof q.BITS==="number")J=q.BITS;if(typeof q.sqrt==="function")this.sqrt=q.sqrt;if(typeof q.isLE==="boolean")this.isLE=q.isLE;if(q.allowedLengths)this._lengths=q.allowedLengths?.slice();if(typeof q.modFromBytes==="boolean")this._mod=q.modFromBytes}let{nBitLength:Q,nByteLength:U}=f1($,J);if(U>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=Q,this.BYTES=U,this._sqrt=void 0,Object.preventExtensions(this)}create($){return i($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return N0<=$&&$<this.ORDER}is0($){return $===N0}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&G0)===G0}neg($){return i(-$,this.ORDER)}eql($,q){return $===q}sqr($){return i($*$,this.ORDER)}add($,q){return i($+q,this.ORDER)}sub($,q){return i($-q,this.ORDER)}mul($,q){return i($*q,this.ORDER)}pow($,q){return Z1(this,$,q)}div($,q){return i($*Lq(q,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,q){return $+q}subN($,q){return $-q}mulN($,q){return $*q}inv($){return Lq($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=K1(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?T8($,this.BYTES):$$($,this.BYTES)}fromBytes($,q=!1){d($);let{_lengths:J,BYTES:Q,isLE:U,ORDER:G,_mod:N}=this;if(J){if(!J.includes($.length)||$.length>Q)throw new Error("Field.fromBytes: expected "+J+" bytes, got "+$.length);let X=new Uint8Array(Q);X.set($,U?0:X.length-$.length),$=X}if($.length!==Q)throw new Error("Field.fromBytes: expected "+Q+" bytes, got "+$.length);let K=U?j0($):fq($);if(N)K=i(K,G);if(!q){if(!this.isValid(K))throw new Error("invalid field element: outside of range 0..ORDER")}return K}invertBatch($){return R8(this,$)}cmov($,q,J){return J?q:$}}function D8($,q={}){return new Aq($,q)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var z8=BigInt(0),N$=BigInt(1);function Bq($,q){let J=q.negate();return $?J:q}function A8($,q){let J=R8($.Fp,q.map((Q)=>Q.Z));return q.map((Q,U)=>$.fromAffine(Q.toAffine(J[U])))}function gq($,q){if(!Number.isSafeInteger($)||$<=0||$>q)throw new Error("invalid window size, expected [1.."+q+"], got W="+$)}function Q$($,q){gq($,q);let J=Math.ceil(q/$)+1,Q=2**($-1),U=2**$,G=Mq($),N=BigInt($);return{windows:J,windowSize:Q,mask:G,maxNumber:U,shiftBy:N}}function Iq($,q,J){let{windowSize:Q,mask:U,maxNumber:G,shiftBy:N}=J,K=Number($&U),X=$>>N;if(K>Q)K-=G,X+=N$;let M=q*Q,Z=M+Math.abs(K)-1,w=K===0,T=K<0,D=q%2!==0;return{nextN:X,offset:Z,isZero:w,isNeg:T,isNegF:D,offsetF:M}}var U$=new WeakMap,xq=new WeakMap;function G$($){return xq.get($)||1}function jq($){if($!==z8)throw new Error("invalid wNAF")}class X${BASE;ZERO;Fn;bits;constructor($,q){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=q}_unsafeLadder($,q,J=this.ZERO){let Q=$;while(q>z8){if(q&N$)J=J.add(Q);Q=Q.double(),q>>=N$}return J}precomputeWindow($,q){let{windows:J,windowSize:Q}=Q$(q,this.bits),U=[],G=$,N=G;for(let K=0;K<J;K++){N=G,U.push(N);for(let X=1;X<Q;X++)N=N.add(G),U.push(N);G=N.double()}return U}wNAF($,q,J){if(!this.Fn.isValid(J))throw new Error("invalid scalar");let Q=this.ZERO,U=this.BASE,G=Q$($,this.bits);for(let N=0;N<G.windows;N++){let{nextN:K,offset:X,isZero:M,isNeg:Z,isNegF:w,offsetF:T}=Iq(J,N,G);if(J=K,M)U=U.add(Bq(w,q[T]));else Q=Q.add(Bq(Z,q[X]))}return jq(J),{p:Q,f:U}}wNAFUnsafe($,q,J,Q=this.ZERO){let U=Q$($,this.bits);for(let G=0;G<U.windows;G++){if(J===z8)break;let{nextN:N,offset:K,isZero:X,isNeg:M}=Iq(J,G,U);if(J=N,X)continue;else{let Z=q[K];Q=Q.add(M?Z.negate():Z)}}return jq(J),Q}getPrecomputes($,q,J){let Q=U$.get(q);if(!Q){if(Q=this.precomputeWindow(q,$),$!==1){if(typeof J==="function")Q=J(Q);U$.set(q,Q)}}return Q}cached($,q,J){let Q=G$($);return this.wNAF(Q,this.getPrecomputes(Q,$,J),q)}unsafe($,q,J,Q){let U=G$($);if(U===1)return this._unsafeLadder($,q,Q);return this.wNAFUnsafe(U,this.getPrecomputes(U,$,J),q,Q)}createCache($,q){gq(q,this.bits),xq.set($,q),U$.delete($)}hasCache($){return G$($)!==1}}function yq($,q,J){if(q){if(q.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return zq(q),q}else return D8($,{isLE:J})}function Vq($,q,J={},Q){if(Q===void 0)Q=$==="edwards";if(!q||typeof q!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let X of["p","n","h"]){let M=q[X];if(!(typeof M==="bigint"&&M>z8))throw new Error(`CURVE.${X} must be positive bigint`)}let U=yq(q.p,J.Fp,Q),G=yq(q.n,J.Fn,Q),K=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let X of K)if(!U.isValid(q[X]))throw new Error(`CURVE.${X} must be valid field element of CURVE.Fp`);return q=Object.freeze(Object.assign({},q)),{CURVE:q,Fp:U,Fn:G}}function B8($,q){return function J(Q){let U=$(Q);return{secretKey:U,publicKey:q(U)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var P0=BigInt(0),e=BigInt(1),K$=BigInt(2),M1=BigInt(8);function L1($,q,J,Q){let U=$.sqr(J),G=$.sqr(Q),N=$.add($.mul(q.a,U),G),K=$.add($.ONE,$.mul(q.d,$.mul(U,G)));return $.eql(N,K)}function Pq($,q={}){let J=Vq("edwards",$,q,q.FpFnLE),{Fp:Q,Fn:U}=J,G=J.CURVE,{h:N}=G;b0(q,{},{uvRatio:"function"});let K=K$<<BigInt(U.BYTES*8)-e,X=(W)=>Q.create(W),M=q.uvRatio||((W,j)=>{try{return{isValid:!0,value:Q.sqrt(Q.div(W,j))}}catch(z){return{isValid:!1,value:P0}}});if(!L1(Q,G,G.Gx,G.Gy))throw new Error("bad curve params: generator point");function Z(W,j,z=!1){let A=z?e:P0;return d0("coordinate "+W,j,A,K),j}function w(W){if(!(W instanceof B))throw new Error("EdwardsPoint expected")}let T=q$((W,j)=>{let{X:z,Y:A,Z:g}=W,_=W.is0();if(j==null)j=_?M1:Q.inv(g);let S=X(z*j),c=X(A*j),I=Q.mul(g,j);if(_)return{x:P0,y:e};if(I!==e)throw new Error("invZ was invalid");return{x:S,y:c}}),D=q$((W)=>{let{a:j,d:z}=G;if(W.is0())throw new Error("bad point: ZERO");let{X:A,Y:g,Z:_,T:S}=W,c=X(A*A),I=X(g*g),P=X(_*_),m=X(P*P),b=X(c*j),p=X(P*X(b+I)),f=X(m+X(z*X(c*I)));if(p!==f)throw new Error("bad point: equation left != right (1)");let E=X(A*g),O=X(_*S);if(E!==O)throw new Error("bad point: equation left != right (2)");return!0});class B{static BASE=new B(G.Gx,G.Gy,e,X(G.Gx*G.Gy));static ZERO=new B(P0,e,e,P0);static Fp=Q;static Fn=U;X;Y;Z;T;constructor(W,j,z,A){this.X=Z("x",W),this.Y=Z("y",j),this.Z=Z("z",z,!0),this.T=Z("t",A),Object.freeze(this)}static CURVE(){return G}static fromAffine(W){if(W instanceof B)throw new Error("extended point not allowed");let{x:j,y:z}=W||{};return Z("x",j),Z("y",z),new B(j,z,e,X(j*z))}static fromBytes(W,j=!1){let z=Q.BYTES,{a:A,d:g}=G;W=S0(d(W,z,"point")),H8(j,"zip215");let _=S0(W),S=W[z-1];_[z-1]=S&-129;let c=j0(_),I=j?K:Q.ORDER;d0("point.y",c,P0,I);let P=X(c*c),m=X(P-e),b=X(g*P-A),{isValid:p,value:f}=M(m,b);if(!p)throw new Error("bad point: invalid y coordinate");let E=(f&e)===e,O=(S&128)!==0;if(!j&&f===P0&&O)throw new Error("bad point: x=0 and x_0=1");if(O!==E)f=X(-f);return B.fromAffine({x:f,y:c})}static fromHex(W,j=!1){return B.fromBytes(e0(W),j)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(W=8,j=!0){if(x.createCache(this,W),!j)this.multiply(K$);return this}assertValidity(){D(this)}equals(W){w(W);let{X:j,Y:z,Z:A}=this,{X:g,Y:_,Z:S}=W,c=X(j*S),I=X(g*A),P=X(z*S),m=X(_*A);return c===I&&P===m}is0(){return this.equals(B.ZERO)}negate(){return new B(X(-this.X),this.Y,this.Z,X(-this.T))}double(){let{a:W}=G,{X:j,Y:z,Z:A}=this,g=X(j*j),_=X(z*z),S=X(K$*X(A*A)),c=X(W*g),I=j+z,P=X(X(I*I)-g-_),m=c+_,b=m-S,p=c-_,f=X(P*b),E=X(m*p),O=X(P*p),H=X(b*m);return new B(f,E,H,O)}add(W){w(W);let{a:j,d:z}=G,{X:A,Y:g,Z:_,T:S}=this,{X:c,Y:I,Z:P,T:m}=W,b=X(A*c),p=X(g*I),f=X(S*z*m),E=X(_*P),O=X((A+g)*(c+I)-b-p),H=E-f,R=E+f,y=X(p-j*b),F=X(O*H),k=X(R*y),v=X(O*y),l=X(H*R);return new B(F,k,l,v)}subtract(W){return this.add(W.negate())}multiply(W){if(!U.isValidNot0(W))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:j,f:z}=x.cached(this,W,(A)=>A8(B,A));return A8(B,[j,z])[0]}multiplyUnsafe(W,j=B.ZERO){if(!U.isValid(W))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(W===P0)return B.ZERO;if(this.is0()||W===e)return this;return x.unsafe(this,W,(z)=>A8(B,z),j)}isSmallOrder(){return this.multiplyUnsafe(N).is0()}isTorsionFree(){return x.unsafe(this,G.n).is0()}toAffine(W){return T(this,W)}clearCofactor(){if(N===e)return this;return this.multiplyUnsafe(N)}toBytes(){let{x:W,y:j}=this.toAffine(),z=Q.toBytes(j);return z[z.length-1]|=W&e?128:0,z}toHex(){return h0(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let x=new X$(B,U.BITS);return B.BASE.precompute(8),B}function Fq($,q,J={}){if(typeof q!=="function")throw new Error('"hash" function param is required');b0(J,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:Q}=J,{BASE:U,Fp:G,Fn:N}=$,K=J.randomBytes||q8,X=J.adjustScalarBytes||((I)=>I),M=J.domain||((I,P,m)=>{if(H8(m,"phflag"),P.length||m)throw new Error("Contexts/pre-hash are not supported");return I});function Z(I){return N.create(j0(I))}function w(I){let P=A.secretKey;d(I,A.secretKey,"secretKey");let m=d(q(I),2*P,"hashedSecretKey"),b=X(m.slice(0,P)),p=m.slice(P,2*P),f=Z(b);return{head:b,prefix:p,scalar:f}}function T(I){let{head:P,prefix:m,scalar:b}=w(I),p=U.multiply(b),f=p.toBytes();return{head:P,prefix:m,scalar:b,point:p,pointBytes:f}}function D(I){return T(I).pointBytes}function B(I=Uint8Array.of(),...P){let m=$8(...P);return Z(q(M(m,d(I,void 0,"context"),!!Q)))}function x(I,P,m={}){if(I=d(I,void 0,"message"),Q)I=Q(I);let{prefix:b,scalar:p,pointBytes:f}=T(P),E=B(m.context,b,I),O=U.multiply(E).toBytes(),H=B(m.context,O,f,I),R=N.create(E+H*p);if(!N.isValid(R))throw new Error("sign failed: invalid s");let y=$8(O,N.toBytes(R));return d(y,A.signature,"result")}let W={zip215:!0};function j(I,P,m,b=W){let{context:p,zip215:f}=b,E=A.signature;if(I=d(I,E,"signature"),P=d(P,void 0,"message"),m=d(m,A.publicKey,"publicKey"),f!==void 0)H8(f,"zip215");if(Q)P=Q(P);let O=E/2,H=I.subarray(0,O),R=j0(I.subarray(O,E)),y,F,k;try{y=$.fromBytes(m,f),F=$.fromBytes(H,f),k=U.multiplyUnsafe(R)}catch(s0){return!1}if(!f&&y.isSmallOrder())return!1;let v=B(p,F.toBytes(),y.toBytes(),P);return F.add(y.multiplyUnsafe(v)).subtract(k).clearCofactor().is0()}let z=G.BYTES,A={secretKey:z,publicKey:z,signature:2*z,seed:z};function g(I=K(A.seed)){return d(I,A.seed,"seed")}function _(I){return O8(I)&&I.length===N.BYTES}function S(I,P){try{return!!$.fromBytes(I,P)}catch(m){return!1}}let c={getExtendedPublicKey:T,randomSecretKey:g,isValidSecretKey:_,isValidPublicKey:S,toMontgomery(I){let{y:P}=$.fromBytes(I),m=A.publicKey,b=m===32;if(!b&&m!==57)throw new Error("only defined for 25519 and 448");let p=b?G.div(e+P,e-P):G.div(P-e,P+e);return G.toBytes(p)},toMontgomerySecret(I){let P=A.secretKey;d(I,P);let m=q(I.subarray(0,P));return X(m).subarray(0,P)}};return Object.freeze({keygen:B8(g,D),getPublicKey:D,sign:x,verify:j,utils:c,Point:$,lengths:A})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var G8=BigInt(0),n0=BigInt(1),I8=BigInt(2);function O1($){return b0($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function kq($){let q=O1($),{P:J,type:Q,adjustScalarBytes:U,powPminus2:G,randomBytes:N}=q,K=Q==="x25519";if(!K&&Q!=="x448")throw new Error("invalid type");let X=N||q8,M=K?255:448,Z=K?32:56,w=K?BigInt(9):BigInt(5),T=K?BigInt(121665):BigInt(39081),D=K?I8**BigInt(254):I8**BigInt(447),B=K?BigInt(8)*I8**BigInt(251)-n0:BigInt(4)*I8**BigInt(445)-n0,x=D+B+n0,W=(E)=>i(E,J),j=z(w);function z(E){return T8(W(E),Z)}function A(E){let O=S0(d(E,Z,"uCoordinate"));if(K)O[31]&=127;return W(j0(O))}function g(E){return j0(U(S0(d(E,Z,"scalar"))))}function _(E,O){let H=m(A(O),g(E));if(H===G8)throw new Error("invalid private or public key received");return z(H)}function S(E){return _(E,j)}let c=S,I=_;function P(E,O,H){let R=W(E*(O-H));return O=W(O-R),H=W(H+R),{x_2:O,x_3:H}}function m(E,O){d0("u",E,G8,J),d0("scalar",O,D,x);let H=O,R=E,y=n0,F=G8,k=E,v=n0,l=G8;for(let h8=BigInt(M-1);h8>=G8;h8--){let _$=H>>h8&n0;l^=_$,{x_2:y,x_3:k}=P(l,y,k),{x_2:F,x_3:v}=P(l,F,v),l=_$;let d8=y+F,n8=W(d8*d8),i8=y-F,v$=W(i8*i8),S$=n8-v$,bJ=k+v,cJ=k-v,b$=W(cJ*d8),c$=W(bJ*i8),l$=b$+c$,p$=b$-c$;k=W(l$*l$),v=W(R*W(p$*p$)),y=W(n8*v$),F=W(S$*(n8+W(T*S$)))}({x_2:y,x_3:k}=P(l,y,k)),{x_2:F,x_3:v}=P(l,F,v);let s0=G(F);return W(y*s0)}let b={secretKey:Z,publicKey:Z,seed:Z},p=(E=X(Z))=>{return d(E,b.seed,"seed"),E},f={randomSecretKey:p};return Object.freeze({keygen:B8(p,c),getSharedSecret:I,getPublicKey:c,scalarMult:_,scalarMultBase:S,utils:f,GuBytes:j.slice(),lengths:b})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var w1=BigInt(1),mq=BigInt(2),W1=BigInt(3),C1=BigInt(5),E1=BigInt(8),j8=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),H1=(()=>({p:j8,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:E1,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function vq($){let q=BigInt(10),J=BigInt(20),Q=BigInt(40),U=BigInt(80),G=j8,K=$*$%G*$%G,X=L0(K,mq,G)*K%G,M=L0(X,w1,G)*$%G,Z=L0(M,C1,G)*M%G,w=L0(Z,q,G)*Z%G,T=L0(w,J,G)*w%G,D=L0(T,Q,G)*T%G,B=L0(D,U,G)*D%G,x=L0(B,U,G)*D%G,W=L0(x,q,G)*Z%G;return{pow_p_5_8:L0(W,mq,G)*$%G,b2:K}}function Sq($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var _q=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function T1($,q){let J=j8,Q=i(q*q*q,J),U=i(Q*Q*q,J),G=vq($*U).pow_p_5_8,N=i($*Q*G,J),K=i(q*N*N,J),X=N,M=i(N*_q,J),Z=K===$,w=K===i(-$,J),T=K===i(-$*_q,J);if(Z)N=X;if(w||T)N=M;if(Dq(N,J))N=i(-N,J);return{isValid:Z||w,value:N}}var R1=Pq(H1,{uvRatio:T1});function D1($){return Fq(R1,Xq,Object.assign({adjustScalarBytes:Sq},$))}var F0=D1({});var N8=(()=>{let $=j8;return kq({P:$,type:"x25519",powPminus2:(q)=>{let{pow_p_5_8:J,b2:Q}=vq(q);return i(L0(J,W1,$)*Q,$)},adjustScalarBytes:Sq})})();var XJ=h$(Y$(),1);var Z$;try{Z$=new TextDecoder}catch($){}var V,p0,C=0;var hq=[],z1=105,A1=57342,B1=57343,cq=57337;var lq=6,i0={},X8=112810000,y0=16810000;var f$=hq,M$=0,u={},r,x8,V8=0,Y8=0,a,O0,o=[],L$=[],Y0,X0,K8,pq={useRecords:!1,mapsAsObjects:!0},Z8=!1,dq=2;try{new Function("")}catch($){dq=1/0}class k0{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[q,J]of Object.entries($.keyMap))this.mapKey.set(J,q)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let q=new Map;for(let[J,Q]of Object.entries($))q.set(this._keyMap.hasOwnProperty(J)?this._keyMap[J]:J,Q);return q}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[J,Q]of Object.entries(this._keyMap))this._mapKey.set(Q,J)}let q={};return $.forEach((J,Q)=>q[w0(this._mapKey.has(Q)?this._mapKey.get(Q):Q)]=J),q}mapDecode($,q){let J=this.decode($);if(this._keyMap)switch(J.constructor.name){case"Array":return J.map((Q)=>this.decodeKeys(Q))}return J}decode($,q){if(V)return oq(()=>{return P8(),this?this.decode($,q):k0.prototype.decode.call(pq,$,q)});p0=q>-1?q:$.length,C=0,M$=0,Y8=0,x8=null,f$=hq,a=null,V=$;try{X0=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(J){if(V=null,$ instanceof Uint8Array)throw J;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof k0){if(u=this,Y0=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return r=this.structures,y8();else if(!r||r.length>0)r=[]}else{if(u=pq,!r||r.length>0)r=[];Y0=null}return y8()}decodeMultiple($,q){let J,Q=0;try{let U=$.length;Z8=!0;let G=this?this.decode($,U):H$.decode($,U);if(q){if(q(G)===!1)return;while(C<U)if(Q=C,q(y8())===!1)return}else{J=[G];while(C<U)Q=C,J.push(y8());return J}}catch(U){throw U.lastPosition=Q,U.values=J,U}finally{Z8=!1,P8()}}}function y8(){try{let $=h();if(a){if(C>=a.postBundlePosition){let q=new Error("Unexpected bundle position");throw q.incomplete=!0,q}C=a.postBundlePosition,a=null}if(C==p0){if(r=null,V=null,O0)O0=null}else if(C>p0){let q=new Error("Unexpected end of CBOR data");throw q.incomplete=!0,q}else if(!Z8)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(P8(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function h(){let $=V[C++],q=$>>5;if($=$&31,$>23)switch($){case 24:$=V[C++];break;case 25:if(q==7)return g1();$=X0.getUint16(C),C+=2;break;case 26:if(q==7){let J=X0.getFloat32(C);if(u.useFloat32>2){let Q=F8[(V[C]&127)<<1|V[C+1]>>7];return C+=4,(Q*J+(J>0?0.5:-0.5)>>0)/Q}return C+=4,J}$=X0.getUint32(C),C+=4;break;case 27:if(q==7){let J=X0.getFloat64(C);return C+=8,J}if(q>1){if(X0.getUint32(C)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=X0.getUint32(C+4)}else if(u.int64AsNumber)$=X0.getUint32(C)*4294967296,$+=X0.getUint32(C+4);else $=X0.getBigUint64(C);C+=8;break;case 31:switch(q){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let J=[],Q,U=0;while((Q=h())!=i0){if(U>=X8)throw new Error(`Array length exceeds ${X8}`);J[U++]=Q}return q==4?J:q==3?J.join(""):Buffer.concat(J);case 5:let G;if(u.mapsAsObjects){let N={},K=0;if(u.keyMap)while((G=h())!=i0){if(K++>=y0)throw new Error(`Property count exceeds ${y0}`);N[w0(u.decodeKey(G))]=h()}else while((G=h())!=i0){if(K++>=y0)throw new Error(`Property count exceeds ${y0}`);N[w0(G)]=h()}return N}else{if(K8)u.mapsAsObjects=!0,K8=!1;let N=new Map;if(u.keyMap){let K=0;while((G=h())!=i0){if(K++>=y0)throw new Error(`Map size exceeds ${y0}`);N.set(u.decodeKey(G),h())}}else{let K=0;while((G=h())!=i0){if(K++>=y0)throw new Error(`Map size exceeds ${y0}`);N.set(G,h())}}return N}case 7:return i0;default:throw new Error("Invalid major type for indefinite length "+q)}default:throw new Error("Unknown token "+$)}switch(q){case 0:return $;case 1:return~$;case 2:return y1($);case 3:if(Y8>=C)return x8.slice(C-V8,(C+=$)-V8);if(Y8==0&&p0<140&&$<32){let U=$<16?nq($):j1($);if(U!=null)return U}return I1($);case 4:if($>=X8)throw new Error(`Array length exceeds ${X8}`);let J=new Array($);for(let U=0;U<$;U++)J[U]=h();return J;case 5:if($>=y0)throw new Error(`Map size exceeds ${X8}`);if(u.mapsAsObjects){let U={};if(u.keyMap)for(let G=0;G<$;G++)U[w0(u.decodeKey(h()))]=h();else for(let G=0;G<$;G++)U[w0(h())]=h();return U}else{if(K8)u.mapsAsObjects=!0,K8=!1;let U=new Map;if(u.keyMap)for(let G=0;G<$;G++)U.set(u.decodeKey(h()),h());else for(let G=0;G<$;G++)U.set(h(),h());return U}case 6:if($>=cq){let U=r[$&8191];if(U){if(!U.read)U.read=O$(U);return U.read()}if($<65536){if($==B1){let G=o0(),N=h(),K=h();W$(N,K);let X={};if(u.keyMap)for(let M=2;M<G;M++){let Z=u.decodeKey(K[M-2]);X[w0(Z)]=h()}else for(let M=2;M<G;M++){let Z=K[M-2];X[w0(Z)]=h()}return X}else if($==A1){let G=o0(),N=h();for(let K=2;K<G;K++)W$(N++,h());return h()}else if($==cq)return m1();if(u.getShared){if(E$(),U=r[$&8191],U){if(!U.read)U.read=O$(U);return U.read()}}}}let Q=o[$];if(Q)if(Q.handlesRead)return Q(h);else return Q(h());else{let U=h();for(let G=0;G<L$.length;G++){let N=L$[G]($,U);if(N!==void 0)return N}return new T0(U,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let U=(Y0||l0())[$];if(U!==void 0)return U;throw new Error("Unknown token "+$)}default:if(isNaN($)){let U=new Error("Unexpected end of CBOR data");throw U.incomplete=!0,U}throw new Error("Unknown CBOR token "+$)}}var uq=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function O$($){if(!$)throw new Error("Structure is required in record definition");function q(){let J=V[C++];if(J=J&31,J>23)switch(J){case 24:J=V[C++];break;case 25:J=X0.getUint16(C),C+=2;break;case 26:J=X0.getUint32(C),C+=4;break;default:throw new Error("Expected array header, but got "+V[C-1])}let Q=this.compiledReader;while(Q){if(Q.propertyCount===J)return Q(h);Q=Q.next}if(this.slowReads++>=dq){let G=this.length==J?this:this.slice(0,J);if(Q=u.keyMap?new Function("r","return {"+G.map((N)=>u.decodeKey(N)).map((N)=>uq.test(N)?w0(N)+":r()":"["+JSON.stringify(N)+"]:r()").join(",")+"}"):new Function("r","return {"+G.map((N)=>uq.test(N)?w0(N)+":r()":"["+JSON.stringify(N)+"]:r()").join(",")+"}"),this.compiledReader)Q.next=this.compiledReader;return Q.propertyCount=J,this.compiledReader=Q,Q(h)}let U={};if(u.keyMap)for(let G=0;G<J;G++)U[w0(u.decodeKey(this[G]))]=h();else for(let G=0;G<J;G++)U[w0(this[G])]=h();return U}return $.slowReads=0,q}function w0($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var I1=w$;function w$($){let q;if($<16){if(q=nq($))return q}if($>64&&Z$)return Z$.decode(V.subarray(C,C+=$));let J=C+$,Q=[];q="";while(C<J){let U=V[C++];if((U&128)===0)Q.push(U);else if((U&224)===192){let G=V[C++]&63;Q.push((U&31)<<6|G)}else if((U&240)===224){let G=V[C++]&63,N=V[C++]&63;Q.push((U&31)<<12|G<<6|N)}else if((U&248)===240){let G=V[C++]&63,N=V[C++]&63,K=V[C++]&63,X=(U&7)<<18|G<<12|N<<6|K;if(X>65535)X-=65536,Q.push(X>>>10&1023|55296),X=56320|X&1023;Q.push(X)}else Q.push(U);if(Q.length>=4096)q+=$0.apply(String,Q),Q.length=0}if(Q.length>0)q+=$0.apply(String,Q);return q}var $0=String.fromCharCode;function j1($){let q=C,J=new Array($);for(let Q=0;Q<$;Q++){let U=V[C++];if((U&128)>0){C=q;return}J[Q]=U}return $0.apply(String,J)}function nq($){if($<4)if($<2)if($===0)return"";else{let q=V[C++];if((q&128)>1){C-=1;return}return $0(q)}else{let q=V[C++],J=V[C++];if((q&128)>0||(J&128)>0){C-=2;return}if($<3)return $0(q,J);let Q=V[C++];if((Q&128)>0){C-=3;return}return $0(q,J,Q)}else{let q=V[C++],J=V[C++],Q=V[C++],U=V[C++];if((q&128)>0||(J&128)>0||(Q&128)>0||(U&128)>0){C-=4;return}if($<6)if($===4)return $0(q,J,Q,U);else{let G=V[C++];if((G&128)>0){C-=5;return}return $0(q,J,Q,U,G)}else if($<8){let G=V[C++],N=V[C++];if((G&128)>0||(N&128)>0){C-=6;return}if($<7)return $0(q,J,Q,U,G,N);let K=V[C++];if((K&128)>0){C-=7;return}return $0(q,J,Q,U,G,N,K)}else{let G=V[C++],N=V[C++],K=V[C++],X=V[C++];if((G&128)>0||(N&128)>0||(K&128)>0||(X&128)>0){C-=8;return}if($<10)if($===8)return $0(q,J,Q,U,G,N,K,X);else{let M=V[C++];if((M&128)>0){C-=9;return}return $0(q,J,Q,U,G,N,K,X,M)}else if($<12){let M=V[C++],Z=V[C++];if((M&128)>0||(Z&128)>0){C-=10;return}if($<11)return $0(q,J,Q,U,G,N,K,X,M,Z);let w=V[C++];if((w&128)>0){C-=11;return}return $0(q,J,Q,U,G,N,K,X,M,Z,w)}else{let M=V[C++],Z=V[C++],w=V[C++],T=V[C++];if((M&128)>0||(Z&128)>0||(w&128)>0||(T&128)>0){C-=12;return}if($<14)if($===12)return $0(q,J,Q,U,G,N,K,X,M,Z,w,T);else{let D=V[C++];if((D&128)>0){C-=13;return}return $0(q,J,Q,U,G,N,K,X,M,Z,w,T,D)}else{let D=V[C++],B=V[C++];if((D&128)>0||(B&128)>0){C-=14;return}if($<15)return $0(q,J,Q,U,G,N,K,X,M,Z,w,T,D,B);let x=V[C++];if((x&128)>0){C-=15;return}return $0(q,J,Q,U,G,N,K,X,M,Z,w,T,D,B,x)}}}}}function y1($){return u.copyBuffers?Uint8Array.prototype.slice.call(V,C,C+=$):V.subarray(C,C+=$)}var iq=new Float32Array(1),g8=new Uint8Array(iq.buffer,0,4);function g1(){let $=V[C++],q=V[C++],J=($&127)>>2;if(J===31){if(q||$&3)return NaN;return $&128?-1/0:1/0}if(J===0){let Q=(($&3)<<8|q)/16777216;return $&128?-Q:Q}return g8[3]=$&128|(J>>1)+56,g8[2]=($&7)<<5|q>>3,g8[1]=q<<5,g8[0]=0,iq[0]}var hQ=new Array(4096);class T0{constructor($,q){this.value=$,this.tag=q}}o[0]=($)=>{return new Date($)};o[1]=($)=>{return new Date(Math.round($*1000))};o[2]=($)=>{let q=BigInt(0);for(let J=0,Q=$.byteLength;J<Q;J++)q=BigInt($[J])+(q<<BigInt(8));return q};o[3]=($)=>{return BigInt(-1)-o[2]($)};o[4]=($)=>{return+($[1]+"e"+$[0])};o[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var W$=($,q)=>{$=$-57344;let J=r[$];if(J&&J.isShared)(r.restoreStructures||(r.restoreStructures=[]))[$]=J;r[$]=q,q.read=O$(q)};o[z1]=($)=>{let q=$.length,J=$[1];W$($[0],J);let Q={};for(let U=2;U<q;U++){let G=J[U-2];Q[w0(G)]=$[U]}return Q};o[14]=($)=>{if(a)return a[0].slice(a.position0,a.position0+=$);return new T0($,14)};o[15]=($)=>{if(a)return a[1].slice(a.position1,a.position1+=$);return new T0($,15)};var x1={Error,RegExp};o[27]=($)=>{return(x1[$[0]]||Error)($[1],$[2])};var rq=($)=>{if(V[C++]!=132){let J=new Error("Packed values structure must be followed by a 4 element array");if(V.length<C)J.incomplete=!0;throw J}let q=$();if(!q||!q.length){let J=new Error("Packed values structure must be followed by a 4 element array");throw J.incomplete=!0,J}return Y0=Y0?q.concat(Y0.slice(q.length)):q,Y0.prefixes=$(),Y0.suffixes=$(),$()};rq.handlesRead=!0;o[51]=rq;o[lq]=($)=>{if(!Y0)if(u.getShared)E$();else return new T0($,lq);if(typeof $=="number")return Y0[16+($>=0?2*$:-2*$-1)];let q=new Error("No support for non-integer packed references yet");if($===void 0)q.incomplete=!0;throw q};o[28]=($)=>{if(!O0)O0=new Map,O0.id=0;let q=O0.id++,J=C,Q=V[C],U;if(Q>>5==4)U=[];else U={};let G={target:U};O0.set(q,G);let N=$();if(G.used){if(Object.getPrototypeOf(U)!==Object.getPrototypeOf(N))C=J,U=N,O0.set(q,{target:U}),N=$();return Object.assign(U,N)}return G.target=N,N};o[28].handlesRead=!0;o[29]=($)=>{let q=O0.get($);return q.used=!0,q.target};o[258]=($)=>new Set($);(o[259]=($)=>{if(u.mapsAsObjects)u.mapsAsObjects=!1,K8=!0;return $()}).handlesRead=!0;function r0($,q){if(typeof $==="string")return $+q;if($ instanceof Array)return $.concat(q);return Object.assign({},$,q)}function l0(){if(!Y0)if(u.getShared)E$();else throw new Error("No packed values available");return Y0}var V1=1399353956;L$.push(($,q)=>{if($>=225&&$<=255)return r0(l0().prefixes[$-224],q);if($>=28704&&$<=32767)return r0(l0().prefixes[$-28672],q);if($>=1879052288&&$<=2147483647)return r0(l0().prefixes[$-1879048192],q);if($>=216&&$<=223)return r0(q,l0().suffixes[$-216]);if($>=27647&&$<=28671)return r0(q,l0().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return r0(q,l0().suffixes[$-1811939328]);if($==V1)return{packedValues:Y0,structures:r.slice(0),version:q};if($==55799)return q});var P1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,C$=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],F1=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<C$.length;$++)k1(C$[$],F1[$]);function k1($,q){let J="get"+$.name.slice(0,-5),Q;if(typeof $==="function")Q=$.BYTES_PER_ELEMENT;else $=null;for(let U=0;U<2;U++){if(!U&&Q==1)continue;let G=Q==2?1:Q==4?2:Q==8?3:0;o[U?q:q-4]=Q==1||U==P1?(N)=>{if(!$)throw new Error("Could not find typed array for code "+q);if(!u.copyBuffers){if(Q===1||Q===2&&!(N.byteOffset&1)||Q===4&&!(N.byteOffset&3)||Q===8&&!(N.byteOffset&7))return new $(N.buffer,N.byteOffset,N.byteLength>>G)}return new $(Uint8Array.prototype.slice.call(N,0).buffer)}:(N)=>{if(!$)throw new Error("Could not find typed array for code "+q);let K=new DataView(N.buffer,N.byteOffset,N.byteLength),X=N.length>>G,M=new $(X),Z=K[J];for(let w=0;w<X;w++)M[w]=Z.call(K,w<<G,U);return M}}}function m1(){let $=o0(),q=C+h();for(let Q=2;Q<$;Q++){let U=o0();C+=U}let J=C;return C=q,a=[w$(o0()),w$(o0())],a.position0=0,a.position1=0,a.postBundlePosition=C,C=J,h()}function o0(){let $=V[C++]&31;if($>23)switch($){case 24:$=V[C++];break;case 25:$=X0.getUint16(C),C+=2;break;case 26:$=X0.getUint32(C),C+=4;break}return $}function E$(){if(u.getShared){let $=oq(()=>{return V=null,u.getShared()})||{},q=$.structures||[];if(u.sharedVersion=$.version,Y0=u.sharedValues=$.packedValues,r===!0)u.structures=r=q;else r.splice.apply(r,[0,q.length].concat(q))}}function oq($){let q=p0,J=C,Q=M$,U=V8,G=Y8,N=x8,K=f$,X=O0,M=a,Z=new Uint8Array(V.slice(0,p0)),w=r,T=u,D=Z8,B=$();return p0=q,C=J,M$=Q,V8=U,Y8=G,x8=N,f$=K,O0=X,a=M,V=Z,Z8=D,r=w,u=T,X0=new DataView(V.buffer,V.byteOffset,V.byteLength),B}function P8(){V=null,O0=null,r=null}var F8=new Array(147);for(let $=0;$<256;$++)F8[$]=+("1e"+Math.floor(45.15-$*0.30103));var H$=new k0({useRecords:!1}),k8=H$.decode,_1=H$.decodeMultiple;var m8;try{m8=new TextEncoder}catch($){}var A$,JJ,v8=typeof globalThis==="object"&&globalThis.Buffer,f8=typeof v8!=="undefined",T$=f8?v8.allocUnsafeSlow:Uint8Array,aq=f8?v8:Uint8Array,sq=256,tq=f8?4294967296:2144337920;var R$,L,n,Y=0,m0,s=null,v1=61440,S1=/[\u0080-\uFFFF]/,f0=Symbol("record-id");class S8 extends k0{constructor($){super($);this.offset=0;let q,J,Q,U,G,N;$=$||{};let K=aq.prototype.utf8Write?function(f,E,O){return L.utf8Write(f,E,O)}:m8&&m8.encodeInto?function(f,E){return m8.encodeInto(f,L.subarray(E)).written}:!1,X=this,M=$.structures||$.saveStructures,Z=$.maxSharedStructures;if(Z==null)Z=M?128:0;if(Z>8190)throw new Error("Maximum maxSharedStructure is 8190");let w=$.sequential;if(w)Z=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let T,D,B=$.sharedValues,x;if(B){x=Object.create(null);for(let f=0,E=B.length;f<E;f++)x[B[f]]=f}let W=[],j=0,z=0;this.mapEncode=function(f,E){if(this._keyMap&&!this._mapped)switch(f.constructor.name){case"Array":f=f.map((O)=>this.encodeKeys(O));break}return this.encode(f,E)},this.encode=function(f,E){if(!L)L=new T$(8192),n=new DataView(L.buffer,0,8192),Y=0;if(m0=L.length-10,m0-Y<2048)L=new T$(L.length),n=new DataView(L.buffer,0,L.length),m0=L.length-10,Y=0;else if(E===I$)Y=Y+7&2147483640;if(J=Y,X.useSelfDescribedHeader)n.setUint32(Y,3654940416),Y+=3;if(N=X.structuredClone?new Map:null,X.bundleStrings&&typeof f!=="string")s=[],s.size=1/0;else s=null;if(Q=X.structures,Q){if(Q.uninitialized){let H=X.getShared()||{};X.structures=Q=H.structures||[],X.sharedVersion=H.version;let R=X.sharedValues=H.packedValues;if(R){x={};for(let y=0,F=R.length;y<F;y++)x[R[y]]=y}}let O=Q.length;if(O>Z&&!w)O=Z;if(!Q.transitions){Q.transitions=Object.create(null);for(let H=0;H<O;H++){let R=Q[H];if(!R)continue;let y,F=Q.transitions;for(let k=0,v=R.length;k<v;k++){if(F[f0]===void 0)F[f0]=H;let l=R[k];if(y=F[l],!y)y=F[l]=Object.create(null);F=y}F[f0]=H|1048576}}if(!w)Q.nextId=O}if(U)U=!1;if(G=Q||[],D=x,$.pack){let O=new Map;if(O.values=[],O.encoder=X,O.maxValues=$.maxPrivatePackedValues||(x?16:1/0),O.objectMap=x||!1,O.samplingPackedValues=T,_8(f,O),O.values.length>0){L[Y++]=216,L[Y++]=51,D0(4);let H=O.values;A(H),D0(0),D0(0),D=Object.create(x||null);for(let R=0,y=H.length;R<y;R++)D[H[R]]=R}}R$=E&z$;try{if(R$)return;if(A(f),s)$J(J,A);if(X.offset=Y,N&&N.idsToInsert){if(Y+=N.idsToInsert.length*2,Y>m0)_(Y);X.offset=Y;let O=l1(L.subarray(J,Y),N.idsToInsert);return N=null,O}if(E&I$)return L.start=J,L.end=Y,L;return L.subarray(J,Y)}finally{if(Q){if(z<10)z++;if(Q.length>Z)Q.length=Z;if(j>1e4){if(Q.transitions=null,z=0,j=0,W.length>0)W=[]}else if(W.length>0&&!w){for(let O=0,H=W.length;O<H;O++)W[O][f0]=void 0;W=[]}}if(U&&X.saveShared){if(X.structures.length>Z)X.structures=X.structures.slice(0,Z);let O=L.subarray(J,Y);if(X.updateSharedData()===!1)return X.encode(f);return O}if(E&d1)Y=J}},this.findCommonStringsToPack=()=>{if(T=new Map,!x)x=Object.create(null);return(f)=>{let E=f&&f.threshold||4,O=this.pack?f.maxPrivatePackedValues||16:0;if(!B)B=this.sharedValues=[];for(let[H,R]of T)if(R.count>E)x[H]=O++,B.push(H),U=!0;while(this.saveShared&&this.updateSharedData()===!1);T=null}};let A=(f)=>{if(Y>m0)L=_(Y);var E=typeof f,O;if(E==="string"){if(D){let F=D[f];if(F>=0){if(F<16)L[Y++]=F+224;else if(L[Y++]=198,F&1)A(15-F>>1);else A(F-16>>1);return}else if(T&&!$.pack){let k=T.get(f);if(k)k.count++;else T.set(f,{count:1})}}let H=f.length;if(s&&H>=4&&H<1024){if((s.size+=H)>v1){let k,v=(s[0]?s[0].length*3+s[1].length:0)+10;if(Y+v>m0)L=_(Y+v);if(L[Y++]=217,L[Y++]=223,L[Y++]=249,L[Y++]=s.position?132:130,L[Y++]=26,k=Y-J,Y+=4,s.position)$J(J,A);s=["",""],s.size=0,s.position=k}let F=S1.test(f);s[F?0:1]+=f,L[Y++]=F?206:207,A(H);return}let R;if(H<32)R=1;else if(H<256)R=2;else if(H<65536)R=3;else R=5;let y=H*3;if(Y+y>m0)L=_(Y+y);if(H<64||!K){let F,k,v,l=Y+R;for(F=0;F<H;F++)if(k=f.charCodeAt(F),k<128)L[l++]=k;else if(k<2048)L[l++]=k>>6|192,L[l++]=k&63|128;else if((k&64512)===55296&&((v=f.charCodeAt(F+1))&64512)===56320)k=65536+((k&1023)<<10)+(v&1023),F++,L[l++]=k>>18|240,L[l++]=k>>12&63|128,L[l++]=k>>6&63|128,L[l++]=k&63|128;else L[l++]=k>>12|224,L[l++]=k>>6&63|128,L[l++]=k&63|128;O=l-Y-R}else O=K(f,Y+R,y);if(O<24)L[Y++]=96|O;else if(O<256){if(R<2)L.copyWithin(Y+2,Y+1,Y+1+O);L[Y++]=120,L[Y++]=O}else if(O<65536){if(R<3)L.copyWithin(Y+3,Y+2,Y+2+O);L[Y++]=121,L[Y++]=O>>8,L[Y++]=O&255}else{if(R<5)L.copyWithin(Y+5,Y+3,Y+3+O);L[Y++]=122,n.setUint32(Y,O),Y+=4}Y+=O}else if(E==="number")if(!this.alwaysUseFloat&&f>>>0===f)if(f<24)L[Y++]=f;else if(f<256)L[Y++]=24,L[Y++]=f;else if(f<65536)L[Y++]=25,L[Y++]=f>>8,L[Y++]=f&255;else L[Y++]=26,n.setUint32(Y,f),Y+=4;else if(!this.alwaysUseFloat&&f>>0===f)if(f>=-24)L[Y++]=31-f;else if(f>=-256)L[Y++]=56,L[Y++]=~f;else if(f>=-65536)L[Y++]=57,n.setUint16(Y,~f),Y+=2;else L[Y++]=58,n.setUint32(Y,~f),Y+=4;else{let H;if((H=this.useFloat32)>0&&f<4294967296&&f>=-2147483648){L[Y++]=250,n.setFloat32(Y,f);let R;if(H<4||(R=f*F8[(L[Y]&127)<<1|L[Y+1]>>7])>>0===R){Y+=4;return}else Y--}L[Y++]=251,n.setFloat64(Y,f),Y+=8}else if(E==="object")if(!f)L[Y++]=246;else{if(N){let R=N.get(f);if(R){if(L[Y++]=216,L[Y++]=29,L[Y++]=25,!R.references){let y=N.idsToInsert||(N.idsToInsert=[]);R.references=[],y.push(R)}R.references.push(Y-J),Y+=2;return}else N.set(f,{offset:Y-J})}let H=f.constructor;if(H===Object)g(f);else if(H===Array){if(O=f.length,O<24)L[Y++]=128|O;else D0(O);for(let R=0;R<O;R++)A(f[R])}else if(H===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)L[Y++]=217,L[Y++]=1,L[Y++]=3;if(O=f.size,O<24)L[Y++]=160|O;else if(O<256)L[Y++]=184,L[Y++]=O;else if(O<65536)L[Y++]=185,L[Y++]=O>>8,L[Y++]=O&255;else L[Y++]=186,n.setUint32(Y,O),Y+=4;if(X.keyMap)for(let[R,y]of f)A(X.encodeKey(R)),A(y);else for(let[R,y]of f)A(R),A(y)}else{for(let R=0,y=A$.length;R<y;R++){let F=JJ[R];if(f instanceof F){let k=A$[R],v=k.tag;if(v==null)v=k.getTag&&k.getTag.call(this,f);if(v<24)L[Y++]=192|v;else if(v<256)L[Y++]=216,L[Y++]=v;else if(v<65536)L[Y++]=217,L[Y++]=v>>8,L[Y++]=v&255;else if(v>-1)L[Y++]=218,n.setUint32(Y,v),Y+=4;k.encode.call(this,f,A,_);return}}if(f[Symbol.iterator]){if(R$){let R=new Error("Iterable should be serialized as iterator");throw R.iteratorNotHandled=!0,R}L[Y++]=159;for(let R of f)A(R);L[Y++]=255;return}if(f[Symbol.asyncIterator]||D$(f)){let R=new Error("Iterable/blob should be serialized as iterator");throw R.iteratorNotHandled=!0,R}if(this.useToJSON&&f.toJSON){let R=f.toJSON();if(R!==f)return A(R)}g(f)}}else if(E==="boolean")L[Y++]=f?245:244;else if(E==="bigint"){if(f<BigInt(1)<<BigInt(64)&&f>=0)L[Y++]=27,n.setBigUint64(Y,f);else if(f>-(BigInt(1)<<BigInt(64))&&f<0)L[Y++]=59,n.setBigUint64(Y,-f-BigInt(1));else if(this.largeBigIntToFloat)L[Y++]=251,n.setFloat64(Y,Number(f));else{if(f>=BigInt(0))L[Y++]=194;else L[Y++]=195,f=BigInt(-1)-f;let H=[];while(f)H.push(Number(f&BigInt(255))),f>>=BigInt(8);B$(new Uint8Array(H.reverse()),_);return}Y+=8}else if(E==="undefined")L[Y++]=247;else throw new Error("Unknown type: "+E)},g=this.useRecords===!1?this.variableMapSize?(f)=>{let E=Object.keys(f),O=Object.values(f),H=E.length;if(H<24)L[Y++]=160|H;else if(H<256)L[Y++]=184,L[Y++]=H;else if(H<65536)L[Y++]=185,L[Y++]=H>>8,L[Y++]=H&255;else L[Y++]=186,n.setUint32(Y,H),Y+=4;let R;if(X.keyMap)for(let y=0;y<H;y++)A(X.encodeKey(E[y])),A(O[y]);else for(let y=0;y<H;y++)A(E[y]),A(O[y])}:(f)=>{L[Y++]=185;let E=Y-J;Y+=2;let O=0;if(X.keyMap){for(let H in f)if(typeof f.hasOwnProperty!=="function"||f.hasOwnProperty(H))A(X.encodeKey(H)),A(f[H]),O++}else for(let H in f)if(typeof f.hasOwnProperty!=="function"||f.hasOwnProperty(H))A(H),A(f[H]),O++;L[E+++J]=O>>8,L[E+J]=O&255}:(f,E)=>{let O,H=G.transitions||(G.transitions=Object.create(null)),R=0,y=0,F,k;if(this.keyMap){k=Object.keys(f).map((l)=>this.encodeKey(l)),y=k.length;for(let l=0;l<y;l++){let s0=k[l];if(O=H[s0],!O)O=H[s0]=Object.create(null),R++;H=O}}else for(let l in f)if(typeof f.hasOwnProperty!=="function"||f.hasOwnProperty(l)){if(O=H[l],!O){if(H[f0]&1048576)F=H[f0]&65535;O=H[l]=Object.create(null),R++}H=O,y++}let v=H[f0];if(v!==void 0)v&=65535,L[Y++]=217,L[Y++]=v>>8|224,L[Y++]=v&255;else{if(!k)k=H.__keys__||(H.__keys__=Object.keys(f));if(F===void 0){if(v=G.nextId++,!v)v=0,G.nextId=1;if(v>=sq)G.nextId=(v=Z)+1}else v=F;if(G[v]=k,v<Z){L[Y++]=217,L[Y++]=v>>8|224,L[Y++]=v&255,H=G.transitions;for(let l=0;l<y;l++){if(H[f0]===void 0||H[f0]&1048576)H[f0]=v;H=H[k[l]]}H[f0]=v|1048576,U=!0}else{if(H[f0]=v,n.setUint32(Y,3655335680),Y+=3,R)j+=z*R;if(W.length>=sq-Z)W.shift()[f0]=void 0;if(W.push(H),D0(y+2),A(57344+v),A(k),E)return;for(let l in f)if(typeof f.hasOwnProperty!=="function"||f.hasOwnProperty(l))A(f[l]);return}}if(y<24)L[Y++]=128|y;else D0(y);if(E)return;for(let l in f)if(typeof f.hasOwnProperty!=="function"||f.hasOwnProperty(l))A(f[l])},_=(f)=>{let E;if(f>16777216){if(f-J>tq)throw new Error("Encoded buffer would be larger than maximum buffer size");E=Math.min(tq,Math.round(Math.max((f-J)*(f>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(f-J<<2,L.length-1)>>12)+1<<12;let O=new T$(E);if(n=new DataView(O.buffer,0,E),L.copy)L.copy(O,0,J,f);else O.set(L.slice(J,f));return Y-=J,J=0,m0=O.length-10,L=O},S=100,c=1000;this.encodeAsIterable=function(f,E){return b(f,E,I)},this.encodeAsAsyncIterable=function(f,E){return b(f,E,p)};function*I(f,E,O){let H=f.constructor;if(H===Object){let R=X.useRecords!==!1;if(R)g(f,!0);else eq(Object.keys(f).length,160);for(let y in f){let F=f[y];if(!R)A(y);if(F&&typeof F==="object")if(E[y])yield*I(F,E[y]);else yield*P(F,E,y);else A(F)}}else if(H===Array){let R=f.length;D0(R);for(let y=0;y<R;y++){let F=f[y];if(F&&(typeof F==="object"||Y-J>S))if(E.element)yield*I(F,E.element);else yield*P(F,E,"element");else A(F)}}else if(f[Symbol.iterator]&&!f.buffer){L[Y++]=159;for(let R of f)if(R&&(typeof R==="object"||Y-J>S))if(E.element)yield*I(R,E.element);else yield*P(R,E,"element");else A(R);L[Y++]=255}else if(D$(f))eq(f.size,64),yield L.subarray(J,Y),yield f,m();else if(f[Symbol.asyncIterator])L[Y++]=159,yield L.subarray(J,Y),yield f,m(),L[Y++]=255;else A(f);if(O&&Y>J)yield L.subarray(J,Y);else if(Y-J>S)yield L.subarray(J,Y),m()}function*P(f,E,O){let H=Y-J;try{if(A(f),Y-J>S)yield L.subarray(J,Y),m()}catch(R){if(R.iteratorNotHandled)E[O]={},Y=J+H,yield*I.call(this,f,E[O]);else throw R}}function m(){S=c,X.encode(null,z$)}function b(f,E,O){if(E&&E.chunkThreshold)S=c=E.chunkThreshold;else S=100;if(f&&typeof f==="object")return X.encode(null,z$),O(f,X.iterateProperties||(X.iterateProperties={}),!0);return[X.encode(f)]}async function*p(f,E){for(let O of I(f,E,!0)){let H=O.constructor;if(H===aq||H===Uint8Array)yield O;else if(D$(O)){let R=O.stream().getReader(),y;while(!(y=await R.read()).done)yield y.value}else if(O[Symbol.asyncIterator])for await(let R of O)if(m(),R)yield*p(R,E.async||(E.async={}));else yield X.encode(R);else yield O}}}useBuffer($){L=$,n=new DataView(L.buffer,L.byteOffset,L.byteLength),Y=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let q=this.structures.slice(0),J=new j$(q,this.sharedValues,this.sharedVersion),Q=this.saveShared(J,(U)=>(U&&U.version||0)==$);if(Q===!1)J=this.getShared()||{},this.structures=J.structures||[],this.sharedValues=J.packedValues,this.sharedVersion=J.version,this.structures.nextId=this.structures.length;else q.forEach((U,G)=>this.structures[G]=U);return Q}}function eq($,q){if($<24)L[Y++]=q|$;else if($<256)L[Y++]=q|24,L[Y++]=$;else if($<65536)L[Y++]=q|25,L[Y++]=$>>8,L[Y++]=$&255;else L[Y++]=q|26,n.setUint32(Y,$),Y+=4}class j${constructor($,q,J){this.structures=$,this.packedValues=q,this.version=J}}function D0($){if($<24)L[Y++]=128|$;else if($<256)L[Y++]=152,L[Y++]=$;else if($<65536)L[Y++]=153,L[Y++]=$>>8,L[Y++]=$&255;else L[Y++]=154,n.setUint32(Y,$),Y+=4}var b1=typeof Blob==="undefined"?function(){}:Blob;function D$($){if($ instanceof b1)return!0;let q=$[Symbol.toStringTag];return q==="Blob"||q==="File"}function _8($,q){switch(typeof $){case"string":if($.length>3){if(q.objectMap[$]>-1||q.values.length>=q.maxValues)return;let Q=q.get($);if(Q){if(++Q.count==2)q.values.push($)}else if(q.set($,{count:1}),q.samplingPackedValues){let U=q.samplingPackedValues.get($);if(U)U.count++;else q.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let Q=0,U=$.length;Q<U;Q++)_8($[Q],q);else{let Q=!q.encoder.useRecords;for(var J in $)if($.hasOwnProperty(J)){if(Q)_8(J,q);_8($[J],q)}}break;case"function":console.log($)}}var c1=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;JJ=[Date,Set,Error,RegExp,T0,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,j$];A$=[{tag:1,encode($,q){let J=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&J>=0&&J<4294967296)L[Y++]=26,n.setUint32(Y,J),Y+=4;else L[Y++]=251,n.setFloat64(Y,J),Y+=8}},{tag:258,encode($,q){let J=Array.from($);q(J)}},{tag:27,encode($,q){q([$.name,$.message])}},{tag:27,encode($,q){q(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,q){q($.value)}},{encode($,q,J){B$($,J)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||f8&&this.tagUint8Array!==!1)return 64}},encode($,q,J){B$($,J)}},R0(68,1),R0(69,2),R0(70,4),R0(71,8),R0(72,1),R0(77,2),R0(78,4),R0(79,8),R0(85,4),R0(86,8),{encode($,q){let J=$.packedValues||[],Q=$.structures||[];if(J.values.length>0){L[Y++]=216,L[Y++]=51,D0(4);let U=J.values;q(U),D0(0),D0(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let G=0,N=U.length;G<N;G++)packedObjectMap[U[G]]=G}if(Q){n.setUint32(Y,3655335424),Y+=3;let U=Q.slice(0);U.unshift(57344),U.push(new T0($.version,1399353956)),q(U)}else q(new T0($.version,1399353956))}}];function R0($,q){if(!c1&&q>1)$-=4;return{tag:$,encode:function J(Q,U){let G=Q.byteLength,N=Q.byteOffset||0,K=Q.buffer||Q;U(f8?v8.from(K,N,G):new Uint8Array(K,N,G))}}}function B$($,q){let J=$.byteLength;if(J<24)L[Y++]=64+J;else if(J<256)L[Y++]=88,L[Y++]=J;else if(J<65536)L[Y++]=89,L[Y++]=J>>8,L[Y++]=J&255;else L[Y++]=90,n.setUint32(Y,J),Y+=4;if(Y+J>=L.length)q(Y+J);L.set($.buffer?$:new Uint8Array($),Y),Y+=J}function l1($,q){let J,Q=q.length*2,U=$.length-Q;q.sort((G,N)=>G.offset>N.offset?1:-1);for(let G=0;G<q.length;G++){let N=q[G];N.id=G;for(let K of N.references)$[K++]=G>>8,$[K]=G&255}while(J=q.pop()){let G=J.offset;$.copyWithin(G+Q,G,U),Q-=2;let N=G+Q;$[N++]=216,$[N++]=28,U=G}return $}function $J($,q){n.setUint32(s.position+$,Y-s.position-$+1);let J=s;s=null,q(J[0]),q(J[1])}var y$=new S8({useRecords:!1}),p1=y$.encode,u1=y$.encodeAsIterable,h1=y$.encodeAsAsyncIterable;var I$=512,d1=1024,z$=2048;var b8=($)=>{let q=new Uint8Array($),J="";for(let Q=0;Q<q.byteLength;Q++)J+=String.fromCharCode(q[Q]);return btoa(J).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},QJ=($)=>{let q=atob($.replace(/-/g,"+").replace(/_/g,"/")),J=new Uint8Array(q.length);for(let Q=0;Q<q.length;Q++)J[Q]=q.charCodeAt(Q);return J.buffer};async function UJ($){let q=crypto.getRandomValues(new Uint8Array(32)),J=crypto.getRandomValues(new Uint8Array(16)),Q=await navigator.credentials.create({publicKey:{challenge:q,rp:{name:"Sorane Web/A Form"},user:{id:J,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:60000,attestation:"none"}});if(!Q)throw new Error("Credential creation failed");return{id:Q.id,rawId:b8(Q.rawId),response:Q.response}}async function GJ($,q){let J=await navigator.credentials.get({publicKey:{challenge:q,allowCredentials:[{id:QJ($),type:"public-key"}],userVerification:"required"}});if(!J)throw new Error("Assertion failed");let Q=J.response;return{id:J.id,signature:b8(Q.signature),authenticatorData:b8(Q.authenticatorData),clientDataJSON:b8(Q.clientDataJSON)}}async function c8($,q){let J=crypto.getRandomValues(new Uint8Array(32)),Q=await navigator.credentials.get({publicKey:{challenge:J,allowCredentials:[{id:QJ($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:q}}}}});if(!Q)throw new Error("Assertion failed");let G=Q.getClientExtensionResults()?.prf?.results?.first;if(!G)throw new Error("PRF extension not available");return new Uint8Array(G)}function M8($){return Array.from($).map((q)=>q.toString(16).padStart(2,"0")).join("")}function NJ($){let q=new Uint8Array($.length/2);for(let J=0;J<q.length;J++)q[J]=parseInt($.substring(J*2,J*2+2),16);return q}class KJ{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),q=localStorage.getItem("weba_passkey_pub");if($&&q){this.credentialId=$,this.publicKey=NJ(q),this.publicKeyType="p256",this.usePasskey=!0;return}let J=localStorage.getItem("weba_private_key");if(J)this.edPrivateKey=NJ(J),this.publicKey=F0.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey...");let $=await UJ("User"),q=new Uint8Array($.response.attestationObject),Q=k8(q).authData,U=new DataView(Q.buffer,Q.byteOffset,Q.byteLength),G=53,N=U.getUint16(G);G+=2,G+=N;let K=Q.slice(G),X=k8(K),M=X.get(-2),Z=X.get(-3);if(!M||!Z)throw new Error("Invalid COSE Key: x or y missing");let w=new Uint8Array(65);if(w[0]=4,w.set(M,1),w.set(Z,33),this.credentialId=$.rawId,this.publicKey=w,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",M8(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=F0.utils.randomSecretKey(),this.publicKey=F0.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",M8(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${M8(this.publicKey)}`}getPublicKey(){return this.publicKey?M8(this.publicKey):""}async sign($,q="authentication"){if(!this.publicKey)await this.register();let J=XJ.default($),Q=new TextEncoder().encode(J);if(this.usePasskey&&this.credentialId){let U=await crypto.subtle.digest("SHA-256",Q),G=await GJ(this.credentialId,U);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:G.signature,"srn:authenticatorData":G.authenticatorData,"srn:clientDataJSON":G.clientDataJSON,"srn:credentialId":G.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let U=F0.sign(Q,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:q,proofValue:M8(U)}}}}}var a0=new KJ;class g${oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,q){if(t0($),d(q,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let J=this.blockLen,Q=new Uint8Array(J);Q.set(q.length>J?$.create().update(q).digest():q);for(let U=0;U<Q.length;U++)Q[U]^=54;this.iHash.update(Q),this.oHash=$.create();for(let U=0;U<Q.length;U++)Q[U]^=106;this.oHash.update(Q),W0(Q)}update($){return u0(this),this.iHash.update($),this}digestInto($){u0(this),d($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:q,iHash:J,finished:Q,destroyed:U,blockLen:G,outputLen:N}=this;return $=$,$.finished=Q,$.destroyed=U,$.blockLen=G,$.outputLen=N,$.oHash=q._cloneInto($.oHash),$.iHash=J._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var l8=($,q,J)=>new g$($,q).update(J).digest();l8.create=($,q)=>new g$($,q);function n1($,q,J){if(t0($),J===void 0)J=new Uint8Array($.outputLen);return l8($,J,q)}var x$=Uint8Array.of(0),YJ=Uint8Array.of();function i1($,q,J,Q=32){t0($),E0(Q,"length");let U=$.outputLen;if(Q>255*U)throw new Error("Length must be <= 255*HashLen");let G=Math.ceil(Q/U);if(J===void 0)J=YJ;else d(J,void 0,"info");let N=new Uint8Array(G*U),K=l8.create($,q),X=K._cloneInto(),M=new Uint8Array(K.outputLen);for(let Z=0;Z<G;Z++)x$[0]=Z+1,X.update(Z===0?YJ:M).update(J).update(x$).digestInto(M),N.set(M,U*Z),K._cloneInto(X);return K.destroy(),X.destroy(),W0(M,x$),N.slice(0,Q)}var Z0=($,q,J,Q,U)=>i1($,n1($,q,J),Q,U);var MJ=h$(Y$(),1),ZJ="weba_l2_ed25519_sk";function M0($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let q="";return $.forEach((Q)=>{q+=String.fromCharCode(Q)}),btoa(q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function t($){let q=$.length%4===0?"":"=".repeat(4-$.length%4),J=$.replace(/-/g,"+").replace(/_/g,"/")+q;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(J,"base64"));let Q=atob(J),U=new Uint8Array(Q.length);for(let G=0;G<Q.length;G+=1)U[G]=Q.charCodeAt(G);return U}function L8($){let q=MJ.default($);if(q===void 0)throw new Error("Failed to canonicalize JSON");return q}function fJ($){let q=new Uint8Array($);return crypto.getRandomValues(q),q}function r1(){let $=localStorage.getItem(ZJ);if($)return t($);let q=F0.utils.randomSecretKey();return localStorage.setItem(ZJ,M0(q)),q}function o1($,q,J){let Q={layer1_ref:$,recipient:q,weba_version:J};return new TextEncoder().encode(L8(Q))}function LJ($,q){let J=new Uint8Array($.length+q.length);return J.set($,0),J.set(q,$.length),J}function OJ($){let q=$.keyPolicy??"campaign+layer1";if(q==="campaign+layer1"&&!$.layer1Ref)throw new Error("layer1_ref is required for campaign+layer1 policy");let J=L8({domain:"weba-l2/org-x25519",campaign_id:$.campaignId,key_policy:q,layer1_ref:q==="campaign+layer1"?$.layer1Ref:void 0}),Q=new TextEncoder().encode(J),U=Z0(K0,$.orgRootKey,void 0,Q,32);return{publicKey:N8.getPublicKey(U),privateKey:U,keyPolicy:q}}function wJ(){return globalThis.webaPqcKem||null}async function WJ($,q,J,Q){let U=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["encrypt"]),G=await crypto.subtle.encrypt({name:"AES-GCM",iv:J,additionalData:Q},U,$);return new Uint8Array(G)}async function CJ($){let q=Z0(K0,$.prfKey,void 0,void 0,32),J=Z0(K0,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=Z0(K0,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),U=$.aad??new Uint8Array;return WJ($.recipientSk,J,Q,U)}async function EJ($,q,J,Q){let U=await crypto.subtle.importKey("raw",q,"AES-GCM",!1,["decrypt"]),G=await crypto.subtle.decrypt({name:"AES-GCM",iv:J,additionalData:Q},U,$);return new Uint8Array(G)}async function HJ($){let q=$.config.weba_version??"0.1",J=$.config.recipient_kid,Q=$.config.layer1_ref,U=$.user_kid??"user#sig-1",G=r1(),N=L8($.layer2_plain),K=new TextEncoder().encode(N),X=F0.sign(K,G),M={alg:"Ed25519",kid:U,sig:M0(X),created_at:new Date().toISOString()},Z={layer2_plain:$.layer2_plain,layer2_sig:M},w=o1(Q,J,q),T=new TextEncoder().encode(L8(Z)),D=t($.config.recipient_x25519),B=fJ(32),x=N8.getPublicKey(B),W=N8.getSharedSecret(B,D),j=W,z,A="X25519";if($.config.recipient_pqc){let I=$.pqcProvider??wJ();if(!I)throw new Error("PQC requested but no provider is available");let P=t($.config.recipient_pqc),m=I.encapsulate(P);z=m.encapsulation,j=LJ(W,m.sharedSecret),A=`X25519+${I.kemId}`}let g=Z0(K0,j,w,void 0,32),_=Z0(K0,g,void 0,new TextEncoder().encode("weba-l2/key"),32),S=Z0(K0,g,void 0,new TextEncoder().encode("weba-l2/iv"),12),c=await WJ(T,_,S,w);return{weba_version:q,layer1_ref:Q,layer2:{enc:"HPKE-v1",suite:{kem:A,kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:J,encapsulated:{classical:M0(x),...z?{pqc:M0(z)}:{}},ciphertext:M0(c),aad:M0(w)},meta:{created_at:new Date().toISOString(),nonce:M0(fJ(16)),...$.config.campaign_id?{campaign_id:$.config.campaign_id}:{},...$.config.key_policy?{key_policy:$.config.key_policy}:{}}}}function TJ(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function p8($,q,J){let Q=t($.layer2.aad),U={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},G=new TextEncoder().encode(L8(U));if(M0(G)!==$.layer2.aad)throw new Error("AAD mismatch");let N=t($.layer2.encapsulated.classical),K=N8.getSharedSecret(q,N),X=K;if($.layer2.encapsulated.pqc){let B=J?.pqcProvider??wJ(),x=J?.pqcRecipientSk;if(!B||!x)throw new Error("Missing PQC KEM for envelope");let W=t($.layer2.encapsulated.pqc),j=B.decapsulate(x,W);X=LJ(K,j)}let M=Z0(K0,X,Q,void 0,32),Z=Z0(K0,M,void 0,new TextEncoder().encode("weba-l2/key"),32),w=Z0(K0,M,void 0,new TextEncoder().encode("weba-l2/iv"),12),T=t($.layer2.ciphertext),D=await EJ(T,Z,w,Q);return JSON.parse(new TextDecoder().decode(D))}async function RJ($){let q=Z0(K0,$.prfKey,void 0,void 0,32),J=Z0(K0,q,void 0,new TextEncoder().encode("weba-l2/kw"),32),Q=Z0(K0,q,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),U=$.keywrap.aad?t($.keywrap.aad):new Uint8Array,G=t($.keywrap.wrapped_key);return EJ(G,J,Q,U)}function a1($){$.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.checked=!1,J.removeAttribute("checked");else J.value="",J.removeAttribute("value")}),$.querySelectorAll("textarea").forEach((J)=>{J.value="",J.textContent=""}),$.querySelectorAll("select").forEach((J)=>{J.selectedIndex=-1,J.querySelectorAll("option").forEach((Q)=>Q.removeAttribute("selected"))}),$.getElementById("json-ld")?.remove(),$.getElementById("data-layer")?.remove();let q=$.getElementById("json-debug");if(q)q.textContent=""}function s1($,q){let J=JSON.stringify(q,null,2),Q=$.createElement("script");Q.type="application/ld+json",Q.id="weba-user-vc",Q.textContent=J,$.body.appendChild(Q);let U=$.createElement("div");U.className="weba-user-verification no-print",U.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",U.innerHTML=`
    <details>
      <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
        <span></span> 
      </summary>
      <div style="padding: 1rem 0;">
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
      </div>
    </details>
  `;let G=U.querySelector("pre");if(G)G.textContent=J;$.body.appendChild(U)}function t1($,q){let J=$.createElement("script");J.id="weba-l2-envelope",J.type="application/json",J.textContent=JSON.stringify(q,null,2),$.body.appendChild(J)}function e1($,q){let J=new Date,Q=J.getFullYear()+("0"+(J.getMonth()+1)).slice(-2)+("0"+J.getDate()).slice(-2)+"-"+("0"+J.getHours()).slice(-2)+("0"+J.getMinutes()).slice(-2),U=Math.random().toString(36).substring(2,8);return`${$}_${Q}_${q}_${U}.html`}function $Q($,q){let Q=new DOMParser().parseFromString($,"text/html");if(q?.stripPlaintext)a1(Q);if(q?.embeddedVc)s1(Q,q.embeddedVc);if(q?.l2Envelope)t1(Q,q.l2Envelope);return Q.documentElement.outerHTML}function DJ($){let q=$Q($.documentHtml,$.options),J=new Blob([q],{type:"text/html"}),Q=URL.createObjectURL(J),U=document.createElement("a");if(U.href=Q,U.download=e1($.title,$.filenameSuffix),U.click(),$.isFinal)setTimeout(()=>window.location.reload(),1000)}class V${formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let q=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((U)=>{let G=U.dataset.jsonPath;if(G)q[G]=U.value}),document.querySelectorAll('[type="radio"]:checked').forEach((U)=>{q[U.name]=U.value}),document.querySelectorAll("table.data-table.dynamic").forEach((U)=>{let G=U.dataset.tableKey;if(G){let N=[];U.querySelectorAll("tbody tr").forEach((K)=>{let X={},M=!1;if(K.querySelectorAll("[data-base-key]").forEach((Z)=>{if(Z.type==="checkbox"){if(X[Z.dataset.baseKey]=Z.checked,Z.checked)M=!0}else if(X[Z.dataset.baseKey]=Z.value,Z.value)M=!0}),M)N.push(X)}),q[G]=N}});let J=document.getElementById("json-ld");if(J)J.textContent=JSON.stringify(q,null,2);let Q=document.getElementById("json-debug");if(Q)Q.textContent=JSON.stringify(q,null,2);return q}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),q=window,J=q.generatedJsonStructure&&q.generatedJsonStructure.name||"Response",Q=window.location.href.split("#")[0],U=this.getL2Config(),G=document.getElementById("weba-l2-encrypt");if(!!(U?.enabled&&(G?G.checked:U.default_enabled))){if(!U?.recipient_kid||!U?.recipient_x25519||!U?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let X=await HJ({layer2_plain:$,config:U,user_kid:U.user_kid});this.downloadHtml("submit",!0,{l2Envelope:X,stripPlaintext:!0})}catch(X){console.error(X),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!a0.getPublicKey()){if(!await a0.register()){alert("Key registration failed.");return}}let K={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:a0.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:Q,answers:$}};try{let X=await a0.sign(K);this.downloadHtml("submitted",!0,{embeddedVc:X})}catch(X){console.error(X),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let q=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(q[Q]!==void 0)J.value=q[Q]}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey,U=q[Q];if(Array.isArray(U)){let G=J.querySelector("tbody");if(!G)return;let N=G.querySelectorAll(".template-row");U.forEach((K,X)=>{let M;if(X===0)M=G.querySelector(".template-row");else{let Z=G.querySelector(".template-row");if(Z){M=Z.cloneNode(!0),M.classList.remove("template-row");let w=M.querySelector(".remove-row-btn");if(w)w.style.visibility="visible";G.appendChild(M)}}if(M)M.querySelectorAll("input, select").forEach((Z)=>{let w=Z.dataset.baseKey;if(w&&K[w]!==void 0)if(Z.type==="checkbox")Z.checked=!!K[w];else Z.value=K[w]})})}})}catch(q){console.error(q)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,q,J){let Q=window,U=Q.generatedJsonStructure&&Q.generatedJsonStructure.name||"web-a-form";DJ({documentHtml:document.documentElement.outerHTML,title:U,filenameSuffix:$,isFinal:q,options:J})}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class P${calc;data;constructor($,q){this.calc=$,this.data=q}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},q=(navigator.language||"en").startsWith("ja")?"ja":"en",J=$[q]||$.en;document.querySelectorAll("[data-i18n]").forEach((Q)=>{let U=Q.dataset.i18n;if(J[U])Q.textContent=J[U]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((J)=>{return J.querySelectorAll("td").length>0}).forEach((J,Q)=>{let U=Q+1;J.querySelectorAll(".auto-num").forEach((G)=>{if(G.value!=U)G.value=U.toString(),G.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let q=$.closest("tr"),J=q.parentElement;if(q.classList.contains("template-row"))q.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox")Q.checked=!1;else Q.value=""});else{if(q.remove(),J)this.renumberRows(J);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,q){let J=document.getElementById("tbl_"+q);if(!J)return;let Q=J.querySelector("tbody");if(!Q)return;let U=Q.querySelector(".template-row");if(!U)return;let G=U.cloneNode(!0);G.classList.remove("template-row"),G.querySelectorAll("input").forEach((K)=>{if(K.type==="checkbox")K.checked=K.hasAttribute("checked");else K.value=K.getAttribute("value")||""});let N=G.querySelector(".remove-row-btn");if(N)N.style.visibility="visible";G.querySelectorAll("[data-copy-from]").forEach((K)=>{let X=K.dataset.copyFrom;if(X){let M=G.querySelector(`[data-base-key="${X}"]`);if(M&&M.value)K.value=M.value}}),Q.appendChild(G),this.renumberRows(Q),this.calc.recalculate()}switchTab($,q){document.querySelectorAll(".tab-btn").forEach((Q)=>Q.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((Q)=>Q.classList.remove("active")),$.classList.add("active");let J=document.getElementById(q);if(J)J.classList.add("active")}}function zJ($){let q=document.getElementById($);if(!q||!q.textContent)return null;try{return JSON.parse(q.textContent)}catch{return null}}function AJ(){let $=zJ("weba-l2-envelope");if(!$)return;let q=zJ("weba-l2-keywrap"),J=document.querySelector(".weba-form-container")||document.body,Q=document.createElement("div");Q.className="weba-l2-unlock",Q.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let U=document.createElement("div");U.textContent="Encrypted Submission",U.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",Q.appendChild(U);let G=document.createElement("div");G.textContent="Locked. Unlock with Passkey.",G.style.cssText="color:#64748b;margin-bottom:0.75rem;",Q.appendChild(G);let N=document.createElement("button");N.textContent="Unlock (Passkey)",N.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",Q.appendChild(N);let K=document.createElement("pre");K.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",Q.appendChild(K);let X=document.createElement("details");X.style.cssText="margin-top:0.75rem; display:none;",X.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',Q.appendChild(X);let M=document.createElement("button");M.textContent="Export JSON",M.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",M.disabled=!0,Q.appendChild(M),N.addEventListener("click",async()=>{if(!q){G.textContent="Key wrap package not found.";return}N.disabled=!0,G.textContent="Waiting for passkey...";try{let Z=t(q.prf_salt),w=await c8(q.credential_id,Z),T=await RJ({keywrap:q,prfKey:w}),D=await p8($,T);qQ(D.layer2_plain),document.body.classList.add("weba-l2-readonly"),K.textContent=JSON.stringify(D.layer2_plain,null,2),K.style.display="block";let B=X.querySelector("pre");if(B)B.textContent=JSON.stringify(D.layer2_sig,null,2);X.style.display="block",M.style.display="inline-block",M.disabled=!1,G.textContent="Unlocked.",M.onclick=()=>{let x=new Blob([JSON.stringify(D,null,2)],{type:"application/json"}),W=URL.createObjectURL(x),j=document.createElement("a");j.href=W,j.download="weba-l2-decrypted.json",j.click()}}catch(Z){console.error(Z),G.textContent="Unlock failed.",N.disabled=!1}}),J.appendChild(Q)}function qQ($){if(!$||typeof $!=="object")return;let q=$;document.querySelectorAll("[data-json-path]").forEach((J)=>{let Q=J.dataset.jsonPath;if(!Q||!(Q in q))return;let U=q[Q];if(J.type==="checkbox")J.checked=Boolean(U);else if(J.type==="radio")J.checked=J.value===String(U);else J.value=U===null||U===void 0?"":String(U)}),document.querySelectorAll('input[type="radio"]').forEach((J)=>{let Q=J.name;if(!Q||!(Q in q))return;let U=q[Q];J.checked=J.value===String(U)}),document.querySelectorAll("table.data-table.dynamic").forEach((J)=>{let Q=J.dataset.tableKey;if(!Q)return;let U=q[Q];if(!Array.isArray(U))return;let G=J.querySelector("tbody");if(!G)return;let N=G.querySelector("tr.template-row");if(!N)return;Array.from(G.querySelectorAll("tr")).forEach((K)=>{if(!K.classList.contains("template-row"))K.remove()}),U.forEach((K,X)=>{let M=X===0?N:N.cloneNode(!0);if(X>0){M.classList.remove("template-row");let Z=M.querySelector(".remove-row-btn");if(Z)Z.style.visibility="visible";G.appendChild(M)}if(K&&typeof K==="object")M.querySelectorAll("input, select, textarea").forEach((Z)=>{let w=Z.dataset.baseKey;if(!w)return;let T=K[w];if(Z.type==="checkbox")Z.checked=Boolean(T);else Z.value=T===null||T===void 0?"":String(T)})})}),document.querySelectorAll("input").forEach((J)=>{if(J.type==="checkbox"||J.type==="radio")J.disabled=!0;else J.readOnly=!0}),document.querySelectorAll("textarea").forEach((J)=>{J.readOnly=!0}),document.querySelectorAll("select").forEach((J)=>{J.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((J)=>{J.disabled=!0})}function z0($){return document.getElementById($)}function BJ(){if(!z0("weba-l2-keywrap-tool"))return;let q=z0("kwp-recipient-sk"),J=z0("kwp-credential-id"),Q=z0("kwp-prf-salt"),U=z0("kwp-aad"),G=z0("kwp-kid"),N=z0("kwp-status"),K=z0("kwp-output"),X=z0("kwp-generate-salt"),M=z0("kwp-wrap");if(!q||!J||!Q||!N||!K||!M)return;X?.addEventListener("click",()=>{let Z=new Uint8Array(32);crypto.getRandomValues(Z),Q.value=M0(Z)}),M.addEventListener("click",async()=>{N.textContent="Waiting for passkey...",M.disabled=!0;try{if(!q.value||!J.value||!Q.value)throw new Error("Missing required fields.");let Z=t(q.value.trim()),w=t(Q.value.trim()),T=await c8(J.value.trim(),w),D=U?.value?t(U.value.trim()):void 0,B=await CJ({recipientSk:Z,prfKey:T,aad:D}),x={alg:"WebAuthn-PRF-AESGCM-v1",kid:G?.value||"issuer#passkey-1",credential_id:J.value.trim(),prf_salt:M0(w),wrapped_key:M0(B),...D?{aad:M0(D)}:{}};K.textContent=JSON.stringify(x,null,2),N.textContent="Key wrap ready."}catch(Z){console.error(Z),N.textContent="Key wrap failed."}finally{M.disabled=!1}})}function jJ($){let q={},J=(Q,U)=>{if(Q===null||Q===void 0){q[U]=null;return}if(Array.isArray(Q)){Q.forEach((G,N)=>{J(G,U?`${U}[${N}]`:`[${N}]`)});return}if(typeof Q==="object"){Object.entries(Q).forEach(([G,N])=>{let K=U?`${U}.${G}`:G;J(N,K)});return}q[U]=Q};if(J($,""),""in q)delete q[""];return q}function F$($){let q={_filename:$.filename},J=new Set(["_filename"]);if($.includeJson)J.add("_json"),q._json=JSON.stringify($.plain);let Q=jJ($.plain||{});for(let U of Object.keys(Q)){if($.omitKey&&$.omitKey(U))continue;J.add(U),q[U]=Q[U]}if($.sig)J.add("_l2_sig"),q._l2_sig=JSON.stringify($.sig);return{row:q,keys:J}}function IJ($){if($===null||$===void 0)return"";let q=String($);if(/[",\n]/.test(q))return`"${q.replace(/"/g,'""')}"`;return q}function yJ($,q){let J=[];return J.push(q.map(IJ).join(",")),$.forEach((Q)=>{let U=q.map((G)=>IJ(Q[G])).join(",");J.push(U)}),"\uFEFF"+J.join(`
`)}function gJ($){if(typeof DOMParser!=="undefined")return new DOMParser().parseFromString($,"text/html");if(typeof document!=="undefined"){let q=document.implementation.createHTMLDocument("");return q.documentElement.innerHTML=$,q}return null}function xJ($,q){let J=gJ($);if(J)return J.getElementById(q)?.textContent??null;let Q=new RegExp(`<script[^>]*id=["']${q}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),U=$.match(Q);return U?U[1]:null}function JQ($){return $.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function QQ($,q){let J=gJ($);if(J)return J.querySelector(`script[type="${q}"]`)?.textContent??null;let Q=new RegExp(`<script[^>]*type=["']${JQ(q)}["'][^>]*>([\\s\\S]*?)<\\/script>`,"i"),U=$.match(Q);return U?U[1]:null}function VJ($){let q=xJ($,"data-layer");if(q)try{return JSON.parse(q)}catch{return null}let J=QQ($,"application/ld+json");if(J)try{return JSON.parse(J)}catch{return null}return null}function PJ($){let q=xJ($,"weba-l2-envelope");if(!q)return null;try{return JSON.parse(q)}catch{return null}}function UQ($){if(!$.trim())return null;try{let q=JSON.parse($);if(!q.recipient_x25519_private&&!q.org_root_key)return null;return q}catch{return null}}function GQ(){let $=document.getElementById("weba-l2-keys");if(!$?.textContent)return null;return UQ($.textContent)}function NQ(){let $=document.getElementById("weba-agg-spec");if(!$?.textContent)return null;try{let q=JSON.parse($.textContent);if(Array.isArray(q))return q[0]??null;return q}catch{return null}}function u8($,q){let J=q.trim().replace(/^\$\./,"");if(!J)return[];let Q=J.split("."),U=[$];for(let G of Q){let N=G.match(/^(.*)\\[(\\d*)\\]$/),K=N?N[1]:G,X=N?N[2]:null,M=N&&X==="",Z=N&&X!==""?parseInt(X,10):null,w=[];for(let T of U){if(T===null||T===void 0)continue;let D=K?T[K]:T;if(M){if(Array.isArray(D))w.push(...D);continue}if(Z!==null){if(Array.isArray(D)&&D[Z]!==void 0)w.push(D[Z]);continue}if(D!==void 0)w.push(D)}U=w}return U}function k$($){if(typeof $==="number"&&Number.isFinite($))return $;if(typeof $==="string"&&$.trim()!==""){let q=Number($.replace(/,/g,""));return Number.isFinite(q)?q:null}return null}function XQ($,q){let J=u8($,q.path);if(q.op==="exists")return J.length>0;let Q=J[0],U=q.value;if(q.op==="eq")return Q===U;if(q.op==="neq")return Q!==U;if(q.op==="in"&&Array.isArray(U))return U.includes(Q);let G=k$(Q),N=k$(U);if(G===null||N===null)return!1;if(q.op==="gt")return G>N;if(q.op==="gte")return G>=N;if(q.op==="lt")return G<N;if(q.op==="lte")return G<=N;return!1}function KQ($,q){if(!q)return $;let J=Array.isArray(q)?q:[q];return $.filter((Q)=>J.every((U)=>XQ(Q,U)))}function FJ($,q){let J=KQ($,q.filter);if(q.op==="count"){if(q.path)return J.reduce((G,N)=>G+u8(N,q.path).length,0);return J.length}let U=(q.path?J.flatMap((G)=>u8(G,q.path)):J).map((G)=>k$(G)).filter((G)=>G!==null);if(U.length===0)return null;if(q.op==="sum")return U.reduce((G,N)=>G+N,0);if(q.op==="avg")return U.reduce((G,N)=>G+N,0)/U.length;if(q.op==="min")return Math.min(...U);if(q.op==="max")return Math.max(...U);return null}function kJ($,q){if($===null)return"-";if(q==="currency")return new Intl.NumberFormat(void 0,{style:"currency",currency:"JPY"}).format($);if(q==="percent")return new Intl.NumberFormat(void 0,{style:"percent",maximumFractionDigits:1}).format($);return new Intl.NumberFormat().format($)}function mJ($,q,J){if(!q?.dashboard||J.length===0){$.innerHTML="";return}let Q=J.map((X)=>X.plain),U=q.dashboard.title?`<div class="agg-dashboard-title">${q.dashboard.title}</div>`:"",G=(q.dashboard.cards||[]).map((X)=>{let M=FJ(Q,X),Z=kJ(M,X.format);return`<div class="agg-card"><div class="agg-card-label">${X.label}</div><div class="agg-card-value">${Z}</div></div>`}).join(""),N=G?`<div class="agg-card-grid">${G}</div>`:"",K=(q.dashboard.tables||[]).map((X)=>{let M=new Map;for(let W of Q){let j=u8(W,X.group_by)[0],z=j===void 0||j===null||j===""?"Unknown":String(j);if(!M.has(z))M.set(z,[]);M.get(z).push(W)}let Z=Array.from(M.entries()).map(([W,j])=>{let z={};return X.metrics.forEach((A)=>{let g=FJ(j,A);z[A.id]=kJ(g,A.format)}),{groupKey:W,metricValues:z}});if(X.sort){let W=X.sort.order==="asc"?1:-1;Z.sort((j,z)=>{let A=j.metricValues[X.sort.by],g=z.metricValues[X.sort.by];if(A===g)return 0;return A>g?W:-W})}let w=X.limit?Z.slice(0,X.limit):Z,D=["Group",...X.metrics.map((W)=>W.label||W.id)].map((W)=>`<th>${W}</th>`).join(""),B=w.map((W)=>{return`<tr>${[`<td>${W.groupKey}</td>`,...X.metrics.map((z)=>`<td>${W.metricValues[z.id]}</td>`)].join("")}</tr>`}).join("");return`<div class="agg-dashboard-table">${X.label?`<div class="agg-table-title">${X.label}</div>`:""}<table class="agg-table"><thead><tr>${D}</tr></thead><tbody>${B}</tbody></table></div>`}).join("");$.innerHTML=`${U}${N}${K}`}async function YQ($,q){let J=PJ($);if(J&&q){if(q.recipient_kid&&J.layer2?.recipient&&q.recipient_kid!==J.layer2.recipient)throw new Error(`recipient_kid mismatch (${J.layer2.recipient})`);let U=null;if(q.org_root_key){let K=q.org_campaign_id||J.meta?.campaign_id;if(!K)throw new Error("org_campaign_id is required for org_root_key");U=OJ({orgRootKey:t(q.org_root_key),campaignId:K,layer1Ref:J.layer1_ref,keyPolicy:q.org_key_policy||J.meta?.key_policy}).privateKey}else if(q.recipient_x25519_private)U=t(q.recipient_x25519_private);else throw new Error("No recipient key provided");let G=q.recipient_pqc_private&&q.recipient_pqc_kem==="ML-KEM-768"?{pqcProvider:globalThis.webaPqcKem??null,pqcRecipientSk:t(q.recipient_pqc_private)}:void 0,N=await p8(J,U,G);return{plain:N.layer2_plain??N,sig:N.layer2_sig,source:"l2"}}let Q=VJ($);if(Q)return{plain:Q,source:"jsonld"};return{source:null}}function ZQ($,q,J){if(q.length===0){$.innerHTML='<div class="agg-empty">No rows to display.</div>';return}let Q=J.map((G)=>`<th>${G}</th>`).join(""),U=q.slice(0,20).map((G)=>{return`<tr>${J.map((K)=>`<td>${G[K]??""}</td>`).join("")}</tr>`}).join("");$.innerHTML=`<table class="agg-table"><thead><tr>${Q}</tr></thead><tbody>${U}</tbody></table>`}function _J(){let $=document.getElementById("aggregator-root");if(!$)return;$.innerHTML=`
    <div class="agg-panel">
      <div class="agg-row">
        <label class="agg-label">Input HTML</label>
        <input id="weba-agg-files" type="file" accept=".html" multiple />
      </div>
      <div class="agg-row">
        <label class="agg-label">L2 Key (embedded)</label>
        <div id="weba-agg-key-status" class="agg-chip">Not loaded</div>
        <div class="agg-note">Use <code>&lt;script id="weba-l2-keys"&gt;</code> to embed.</div>
      </div>
      <div class="agg-row">
        <label class="agg-label">Include JSON</label>
        <input id="weba-agg-include-json" type="checkbox" />
      </div>
      <div class="agg-row">
        <button id="weba-agg-run" class="agg-btn">Decrypt & Aggregate</button>
        <button id="weba-agg-download" class="agg-btn secondary" disabled>Download CSV</button>
        <button id="weba-agg-download-jsonl" class="agg-btn secondary" disabled>Download JSONL</button>
        <button id="weba-agg-download-parquet" class="agg-btn secondary" disabled>Download Parquet</button>
      </div>
      <div id="weba-agg-status" class="agg-status">Ready.</div>
    </div>
    <div id="weba-agg-dashboard" class="agg-dashboard"></div>
    <div id="weba-agg-output" class="agg-output"></div>
  `;let q=$.querySelector("#weba-agg-files"),J=$.querySelector("#weba-agg-status"),Q=$.querySelector("#weba-agg-output"),U=$.querySelector("#weba-agg-dashboard"),G=$.querySelector("#weba-agg-include-json"),N=$.querySelector("#weba-agg-run"),K=$.querySelector("#weba-agg-download"),X=$.querySelector("#weba-agg-download-jsonl"),M=$.querySelector("#weba-agg-download-parquet"),Z=$.querySelector("#weba-agg-key-status"),w="",T="",D=[],B=GQ(),x=NQ(),W=Array.isArray(x?.samples)?x.samples.map((g,_)=>({filename:`sample-${_+1}.json`,plain:g})):[];if(Z)Z.textContent=B?.recipient_kid?`Loaded (${B.recipient_kid})`:B?"Loaded":"Not loaded",Z.classList.toggle("ready",!!B);if(x?.export?.jsonl===!1&&X)X.disabled=!0;let j=()=>{let g=globalThis.webaParquet;return!!(x?.export?.parquet&&g?.export)},z=j();if(M)M.disabled=!z,M.title=z?"":"Parquet export is loading";if(!z&&x?.export?.parquet){let g=window.setInterval(()=>{if(z=j(),z){if(M)M.disabled=!1,M.title="";window.clearInterval(g)}},300)}let A=async()=>{if((!q?.files||q.files.length===0)&&W.length===0){if(J)J.textContent="Select HTML files first.";return}if(J)J.textContent="Processing...";if(K)K.disabled=!0;if(X)X.disabled=!0;if(M)M.disabled=!z;let g=[],_=new Set(["_filename"]),S=0,c=0;D=[...W];let I=B;for(let b of Array.from(q.files))try{let p=await b.text(),f=await YQ(p,I);if(f.source==="l2"&&f.plain){D.push({filename:b.name,plain:f.plain,sig:f.sig});let E=F$({plain:f.plain,filename:b.name,includeJson:G?.checked,sig:f.sig});E.keys.forEach((O)=>_.add(O)),g.push(E.row),S+=1;continue}if(f.source==="jsonld"&&f.plain){D.push({filename:b.name,plain:f.plain});let E=F$({plain:f.plain,filename:b.name,includeJson:G?.checked,omitKey:(O)=>O.startsWith("@")});E.keys.forEach((O)=>_.add(O)),g.push(E.row),S+=1;continue}c+=1}catch(p){console.error(p),c+=1}let P=Array.from(_).sort((b,p)=>{if(b==="_filename")return-1;if(p==="_filename")return 1;return b.localeCompare(p)});if(w=yJ(g,P),K)K.disabled=g.length===0;let m=x?.export?.jsonl!==!1;if(T=D.map((b)=>JSON.stringify({_filename:b.filename,_l2_sig:b.sig??null,...b.plain})).join(`
`),X)X.disabled=D.length===0||!m;if(J)J.textContent=`Processed ${S} files. Errors: ${c}.`;if(U)mJ(U,x,D);if(Q)ZQ(Q,g,P)};if(W.length>0){if(D=[...W],T=D.map((g)=>JSON.stringify({_filename:g.filename,_l2_sig:g.sig??null,...g.plain})).join(`
`),U)mJ(U,x,D);if(X)X.disabled=T.length===0||x?.export?.jsonl===!1;if(J)J.textContent=`Loaded ${W.length} sample records.`}N?.addEventListener("click",()=>{A().catch((g)=>{if(J)J.textContent="Failed to aggregate.";console.error(g)})}),K?.addEventListener("click",()=>{if(!w)return;let g=new Blob([w],{type:"text/csv"}),_=URL.createObjectURL(g),S=document.createElement("a");S.href=_,S.download="weba-aggregated.csv",S.click(),URL.revokeObjectURL(_)}),X?.addEventListener("click",()=>{if(!T)return;let g=new Blob([T],{type:"application/json"}),_=URL.createObjectURL(g),S=document.createElement("a");S.href=_,S.download="weba-aggregated.jsonl",S.click(),URL.revokeObjectURL(_)}),M?.addEventListener("click",async()=>{if(!z||!D.length){if(J)J.textContent="Parquet export is not ready yet.";return}try{let g=await parquetProvider.export(D.map((I)=>({_filename:I.filename,_l2_sig:I.sig??null,...I.plain}))),_=new Blob([g],{type:"application/octet-stream"}),S=URL.createObjectURL(_),c=document.createElement("a");c.href=S,c.download="weba-aggregated.parquet",c.click(),URL.revokeObjectURL(S)}catch(g){if(J)J.textContent="Parquet export failed.";console.error(g)}})}function vJ(){console.log("Web/A Runtime Booting...");let $=new r8,q=new V$,J=new P$($,q),Q=window,U=document.getElementById("weba-structure");if(U?.textContent)try{Q.generatedJsonStructure=JSON.parse(U.textContent)}catch(K){console.warn("Failed to parse weba structure JSON",K)}let G=TJ();if(G)Q.webaL2Config=G;Q.saveDraft=()=>q.saveDraft(),Q.submitDocument=()=>q.submitDocument(),Q.signAndDownload=()=>q.signAndDownload(),Q.clearData=()=>q.clearData(),Q.removeTableRow=(K)=>J.removeTableRow(K),Q.addTableRow=(K,X)=>J.addTableRow(K,X),Q.switchTab=(K,X)=>J.switchTab(K,X),Q.recalculate=()=>$.recalculate(),Q.escapeHtml=(K)=>{if(!K)return"";let X={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return K.toString().replace(/[&<>"']/g,(M)=>X[M]||M)},q.restoreFromLS(),J.applyI18n(),J.initTables(),$.recalculate(),AJ(),BJ(),_J();let N;document.addEventListener("input",(K)=>{let X=K.target;if(K.isTrusted)X.dataset.dirty="true";let M=X.dataset.baseKey||X.dataset.jsonPath;if(M)(X.closest("tr")||document).querySelectorAll(`[data-copy-from="${M}"]`).forEach((T)=>{if(!T.dataset.dirty){if(T.value!==X.value)T.value=X.value,T.dispatchEvent(new Event("input"))}});$.recalculate(),q.updateJsonLd(),clearTimeout(N),N=setTimeout(()=>q.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class m${suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let q=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",q.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let q=$.toString().toLowerCase();return q=q.replace(/[---]/g,(J)=>{return String.fromCharCode(J.charCodeAt(0)-65248)}),q=q.replace(/[-]/g,(J)=>String.fromCharCode(J.charCodeAt(0)-65248)),q.trim()}clean($){if(!$)return"";let q=this.normalize($);return q=q.replace(/(|||||npo||)/g,""),q=q.replace(/(\(\)|\(\)|\(\))/g,""),q.trim()}toIndex($){let q=parseInt($||"",10);return Number.isFinite(q)?q-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let q=window,J=$.dataset.masterSrc,Q=$.dataset.suggestSource;if(!J&&!Q)return;let U=this.toIndex($.dataset.masterLabelIndex),G=this.toIndex($.dataset.masterValueIndex),N=$.value;if(!N){this.hideSuggestions();return}let K=[],X=this.normalize(N);if(Q==="column"){let M=$.dataset.baseKey,Z=$.closest("table");if(Z&&M){let w=new Set;Z.querySelectorAll(`[data-base-key="${M}"]`).forEach((T)=>{if(T===$)return;let D=T.value;if(D&&this.normalize(D).includes(X)){if(!w.has(D))w.add(D),K.push({val:D,row:[D],label:D,score:10})}})}}else if(J){let M=q.generatedJsonStructure.masterData;if(!M||!M[J])return;M[J].forEach((w,T)=>{if(T===0)return;if(w.some((B)=>this.normalize(B||"").includes(X))){let B=U>=0?w[U]||"":"",x=G>=0?w[G]||"":"",W=G>=0?x:U>=0?B:w[1]||w[0]||"";K.push({val:W,row:w,label:B,score:10,idx:T})}})}this.renderSuggestions($,K,U)}renderSuggestions($,q,J){if(q.length===0){this.hideSuggestions();return}let Q=window,U=q.slice(0,10),G="";U.forEach((Z)=>{let w=Q.escapeHtml(JSON.stringify(Z.row)),T=J>=0?Z.label||Z.row.join(" : "):Z.row.join(" : ");G+=`<div class="suggestion-item" data-val="${Q.escapeHtml(Z.val)}" data-row="${w}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${Q.escapeHtml(T)}</div>`});let N=this.getGlobalBox();N.innerHTML=G;let K=$.getBoundingClientRect(),X=window.scrollY||document.documentElement.scrollTop,M=window.scrollX||document.documentElement.scrollLeft;N.style.width=Math.max(K.width,200)+"px",N.style.left=K.left+M+"px",N.style.top=K.bottom+X+"px",N.querySelectorAll(".suggestion-item").forEach((Z)=>{Z.onmouseenter=()=>Z.style.background="#f0f8ff",Z.onmouseleave=()=>Z.style.background="white"}),N.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let q=window,J=this.activeSearchInput,Q=$.dataset.val||"",U=$.dataset.row||"[]";try{let G=JSON.parse(U),N=J.dataset.masterSrc,K=N?q.generatedJsonStructure.masterData[N][0]:[],X=!1;if(K.length>0&&G.length>0){let M=J.closest("tr");if(M){let Z=Array.from(M.querySelectorAll("input, select, textarea"));K.forEach((w,T)=>{if(!w)return;let D=G[T];this.fillField(Z,w,D,J,()=>{X=!0})})}}if(!X)J.value=Q,J.dispatchEvent(new Event("input",{bubbles:!0}))}catch(G){console.error(G)}this.hideSuggestions()}fillField($,q,J,Q,U){let G=this.normalize(q),N=$.find((K)=>{let X=K.dataset.baseKey||K.dataset.jsonPath,M=this.normalize(K.getAttribute("placeholder")||"");return X&&this.normalize(X)===G||M===G});if(N){if(N.value=J||"",N.dispatchEvent(new Event("input",{bubbles:!0})),N===Q)U()}}}var SJ=new m$;window.GlobalSearch=SJ;vJ();SJ.init();
