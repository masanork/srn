var IQ=Object.create;var{getPrototypeOf:wQ,defineProperty:b$,getOwnPropertyNames:AQ}=Object;var jQ=Object.prototype.hasOwnProperty;var h$=($,J,Q)=>{Q=$!=null?IQ(wQ($)):{};let q=J||!$||!$.__esModule?b$(Q,"default",{value:$,enumerable:!0}):Q;for(let G of AQ($))if(!jQ.call(q,G))b$(q,G,{get:()=>$[G],enumerable:!0});return q};var VQ=($,J)=>()=>(J||$((J={exports:{}}).exports,J),J.exports);var U$=VQ((W9,vJ)=>{vJ.exports=function $(J){if(typeof J==="number"&&isNaN(J))throw new Error("NaN is not allowed");if(typeof J==="number"&&!isFinite(J))throw new Error("Infinity is not allowed");if(J===null||typeof J!=="object")return JSON.stringify(J);if(J.toJSON instanceof Function)return $(J.toJSON());if(Array.isArray(J))return`[${J.reduce((G,X,Y)=>{return`${G}${Y===0?"":","}${$(X===void 0||typeof X==="symbol"?null:X)}`},"")}]`;return`{${Object.keys(J).sort().reduce((q,G)=>{if(J[G]===void 0||typeof J[G]==="symbol")return q;let X=q.length===0?"":",";return`${q}${X}${$(G)}:${$(J[G])}`},"")}}`}});class n0{runAutoCopy(){document.querySelectorAll("[data-copy-from]").forEach(($)=>{if(!$.dataset.dirty){let J=$.dataset.copyFrom;if(J){let G=($.closest("tr")||document).querySelector(`[data-base-key="${J}"], [data-json-path="${J}"]`);if(G&&G.value!==$.value)$.value=G.value,$.dispatchEvent(new Event("input",{bubbles:!0}))}}})}recalculate(){document.querySelectorAll("[data-formula]").forEach(($)=>{let J=$.dataset.formula;if(!J)return;let Q=$.closest("tr"),q=$.closest("table"),G=(Y)=>{let Z=0,U="none";if(Q){let M=`[data-base-key="${Y}"], [data-json-path="${Y}"]`,K=Q.querySelector(M);if(K){if(U="row-input",K.value!=="")Z=parseFloat(K.value)}}if(U==="none"){let M=document.querySelector(`[data-json-path="${Y}"]`);if(M){if(U="static-input",M.value!=="")Z=parseFloat(M.value)}}return Z},X=J.replace(/SUM\(([a-zA-Z0-9_\-\u0080-\uFFFF]+)\)/g,(Y,Z)=>{let U=0,M=q||document,K=M.querySelectorAll(`[data-base-key="${Z}"], [data-json-path="${Z}"]`);if(K.length===0&&M!==document)K=document.querySelectorAll(`[data-base-key="${Z}"], [data-json-path="${Z}"]`);return K.forEach((C)=>{let E=parseFloat(C.value);if(!isNaN(E))U+=E}),U});X=X.replace(/([a-zA-Z_\u0080-\uFFFF][a-zA-Z0-9_\-\u0080-\uFFFF]*)/g,(Y)=>{if(["Math","round","floor","ceil","abs","min","max"].includes(Y))return Y;return String(G(Y))});try{let Y=new Function("return "+X)();if(typeof Y==="number"&&!isNaN(Y))$.value=Number.isInteger(Y)?Y:Y.toFixed(0);else $.value=""}catch(Y){console.error("Calc Error:",Y),$.value="Err"}}),this.runAutoCopy()}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function M0($){return $ instanceof Uint8Array||ArrayBuffer.isView($)&&$.constructor.name==="Uint8Array"}function H8($,J=""){if(!Number.isSafeInteger($)||$<0){let Q=J&&`"${J}" `;throw new Error(`${Q}expected integer >= 0, got ${$}`)}}function c($,J,Q=""){let q=M0($),G=$?.length,X=J!==void 0;if(!q||X&&G!==J){let Y=Q&&`"${Q}" `,Z=X?` of length ${J}`:"",U=q?`length=${G}`:`type=${typeof $}`;throw new Error(Y+"expected Uint8Array"+Z+", got "+U)}return $}function t8($){if(typeof $!=="function"||typeof $.create!=="function")throw new Error("Hash must wrapped by utils.createHasher");H8($.outputLen),H8($.blockLen)}function c8($,J=!0){if($.destroyed)throw new Error("Hash instance has been destroyed");if(J&&$.finished)throw new Error("Hash#digest() has already been called")}function u$($,J){c($,void 0,"digestInto() output");let Q=J.outputLen;if($.length<Q)throw new Error('"digestInto() output" expected to be of length >='+Q)}function z8(...$){for(let J=0;J<$.length;J++)$[J].fill(0)}function O0($){return new DataView($.buffer,$.byteOffset,$.byteLength)}function D8($,J){return $<<32-J|$>>>J}var c$=(()=>typeof Uint8Array.from([]).toHex==="function"&&typeof Uint8Array.fromHex==="function")(),FQ=Array.from({length:256},($,J)=>J.toString(16).padStart(2,"0"));function l8($){if(c($),c$)return $.toHex();let J="";for(let Q=0;Q<$.length;Q++)J+=FQ[$[Q]];return J}var w8={_0:48,_9:57,A:65,F:70,a:97,f:102};function p$($){if($>=w8._0&&$<=w8._9)return $-w8._0;if($>=w8.A&&$<=w8.F)return $-(w8.A-10);if($>=w8.a&&$<=w8.f)return $-(w8.a-10);return}function e8($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);if(c$)return Uint8Array.fromHex($);let J=$.length,Q=J/2;if(J%2)throw new Error("hex string expected, got unpadded hex of length "+J);let q=new Uint8Array(Q);for(let G=0,X=0;G<Q;G++,X+=2){let Y=p$($.charCodeAt(X)),Z=p$($.charCodeAt(X+1));if(Y===void 0||Z===void 0){let U=$[X]+$[X+1];throw new Error('hex string expected, got non-hex character "'+U+'" at index '+X)}q[G]=Y*16+Z}return q}function $0(...$){let J=0;for(let q=0;q<$.length;q++){let G=$[q];c(G),J+=G.length}let Q=new Uint8Array(J);for(let q=0,G=0;q<$.length;q++){let X=$[q];Q.set(X,G),G+=X.length}return Q}function i0($,J={}){let Q=(G,X)=>$(X).update(G).digest(),q=$(void 0);return Q.outputLen=q.outputLen,Q.blockLen=q.blockLen,Q.create=(G)=>$(G),Object.assign(Q,J),Object.freeze(Q)}function J0($=32){let J=typeof globalThis==="object"?globalThis.crypto:null;if(typeof J?.getRandomValues!=="function")throw new Error("crypto.getRandomValues must be defined");return J.getRandomValues(new Uint8Array($))}var o0=($)=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,$])});function l$($,J,Q){return $&J^~$&Q}function d$($,J,Q){return $&J^$&Q^J&Q}class L0{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor($,J,Q,q){this.blockLen=$,this.outputLen=J,this.padOffset=Q,this.isLE=q,this.buffer=new Uint8Array($),this.view=O0(this.buffer)}update($){c8(this),c($);let{view:J,buffer:Q,blockLen:q}=this,G=$.length;for(let X=0;X<G;){let Y=Math.min(q-this.pos,G-X);if(Y===q){let Z=O0($);for(;q<=G-X;X+=q)this.process(Z,X);continue}if(Q.set($.subarray(X,X+Y),this.pos),this.pos+=Y,X+=Y,this.pos===q)this.process(J,0),this.pos=0}return this.length+=$.length,this.roundClean(),this}digestInto($){c8(this),u$($,this),this.finished=!0;let{buffer:J,view:Q,blockLen:q,isLE:G}=this,{pos:X}=this;if(J[X++]=128,z8(this.buffer.subarray(X)),this.padOffset>q-X)this.process(Q,0),X=0;for(let K=X;K<q;K++)J[K]=0;Q.setBigUint64(q-8,BigInt(this.length*8),G),this.process(Q,0);let Y=O0($),Z=this.outputLen;if(Z%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let U=Z/4,M=this.get();if(U>M.length)throw new Error("_sha2: outputLen bigger than state");for(let K=0;K<U;K++)Y.setUint32(4*K,M[K],G)}digest(){let{buffer:$,outputLen:J}=this;this.digestInto($);let Q=$.slice(0,J);return this.destroy(),Q}_cloneInto($){$||=new this.constructor,$.set(...this.get());let{blockLen:J,buffer:Q,length:q,finished:G,destroyed:X,pos:Y}=this;if($.destroyed=X,$.finished=G,$.length=q,$.pos=Y,q%J)$.buffer.set(Q);return $}clone(){return this._cloneInto()}}var A8=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),j8=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),$8=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J8=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var C0=BigInt(4294967295),n$=BigInt(32);function fQ($,J=!1){if(J)return{h:Number($&C0),l:Number($>>n$&C0)};return{h:Number($>>n$&C0)|0,l:Number($&C0)|0}}function i$($,J=!1){let Q=$.length,q=new Uint32Array(Q),G=new Uint32Array(Q);for(let X=0;X<Q;X++){let{h:Y,l:Z}=fQ($[X],J);[q[X],G[X]]=[Y,Z]}return[q,G]}var r0=($,J,Q)=>$>>>Q,a0=($,J,Q)=>$<<32-Q|J>>>Q,y8=($,J,Q)=>$>>>Q|J<<32-Q,m8=($,J,Q)=>$<<32-Q|J>>>Q,Q0=($,J,Q)=>$<<64-Q|J>>>Q-32,q0=($,J,Q)=>$>>>Q-32|J<<64-Q;function T8($,J,Q,q){let G=(J>>>0)+(q>>>0);return{h:$+Q+(G/4294967296|0)|0,l:G|0}}var o$=($,J,Q)=>($>>>0)+(J>>>0)+(Q>>>0),r$=($,J,Q,q)=>J+Q+q+($/4294967296|0)|0,a$=($,J,Q,q)=>($>>>0)+(J>>>0)+(Q>>>0)+(q>>>0),s$=($,J,Q,q,G)=>J+Q+q+G+($/4294967296|0)|0,t$=($,J,Q,q,G)=>($>>>0)+(J>>>0)+(Q>>>0)+(q>>>0)+(G>>>0),e$=($,J,Q,q,G,X)=>J+Q+q+G+X+($/4294967296|0)|0;var PQ=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),f8=new Uint32Array(64);class s0 extends L0{constructor($){super(64,$,8,!1)}get(){let{A:$,B:J,C:Q,D:q,E:G,F:X,G:Y,H:Z}=this;return[$,J,Q,q,G,X,Y,Z]}set($,J,Q,q,G,X,Y,Z){this.A=$|0,this.B=J|0,this.C=Q|0,this.D=q|0,this.E=G|0,this.F=X|0,this.G=Y|0,this.H=Z|0}process($,J){for(let K=0;K<16;K++,J+=4)f8[K]=$.getUint32(J,!1);for(let K=16;K<64;K++){let C=f8[K-15],E=f8[K-2],V=D8(C,7)^D8(C,18)^C>>>3,I=D8(E,17)^D8(E,19)^E>>>10;f8[K]=I+f8[K-7]+V+f8[K-16]|0}let{A:Q,B:q,C:G,D:X,E:Y,F:Z,G:U,H:M}=this;for(let K=0;K<64;K++){let C=D8(Y,6)^D8(Y,11)^D8(Y,25),E=M+C+l$(Y,Z,U)+PQ[K]+f8[K]|0,I=(D8(Q,2)^D8(Q,13)^D8(Q,22))+d$(Q,q,G)|0;M=U,U=Z,Z=Y,Y=X+E|0,X=G,G=q,q=Q,Q=E+I|0}Q=Q+this.A|0,q=q+this.B|0,G=G+this.C|0,X=X+this.D|0,Y=Y+this.E|0,Z=Z+this.F|0,U=U+this.G|0,M=M+this.H|0,this.set(Q,q,G,X,Y,Z,U,M)}roundClean(){z8(f8)}destroy(){this.set(0,0,0,0,0,0,0,0),z8(this.buffer)}}class $J extends s0{A=A8[0]|0;B=A8[1]|0;C=A8[2]|0;D=A8[3]|0;E=A8[4]|0;F=A8[5]|0;G=A8[6]|0;H=A8[7]|0;constructor(){super(32)}}class kQ extends s0{A=j8[0]|0;B=j8[1]|0;C=j8[2]|0;D=j8[3]|0;E=j8[4]|0;F=j8[5]|0;G=j8[6]|0;H=j8[7]|0;constructor(){super(28)}}var JJ=(()=>i$(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(($)=>BigInt($))))(),_Q=(()=>JJ[0])(),SQ=(()=>JJ[1])(),x8=new Uint32Array(80),P8=new Uint32Array(80);class G0 extends L0{constructor($){super(128,$,16,!1)}get(){let{Ah:$,Al:J,Bh:Q,Bl:q,Ch:G,Cl:X,Dh:Y,Dl:Z,Eh:U,El:M,Fh:K,Fl:C,Gh:E,Gl:V,Hh:I,Hl:x}=this;return[$,J,Q,q,G,X,Y,Z,U,M,K,C,E,V,I,x]}set($,J,Q,q,G,X,Y,Z,U,M,K,C,E,V,I,x){this.Ah=$|0,this.Al=J|0,this.Bh=Q|0,this.Bl=q|0,this.Ch=G|0,this.Cl=X|0,this.Dh=Y|0,this.Dl=Z|0,this.Eh=U|0,this.El=M|0,this.Fh=K|0,this.Fl=C|0,this.Gh=E|0,this.Gl=V|0,this.Hh=I|0,this.Hl=x|0}process($,J){for(let w=0;w<16;w++,J+=4)x8[w]=$.getUint32(J),P8[w]=$.getUint32(J+=4);for(let w=16;w<80;w++){let B=x8[w-15]|0,m=P8[w-15]|0,p=y8(B,m,1)^y8(B,m,8)^r0(B,m,7),l=m8(B,m,1)^m8(B,m,8)^a0(B,m,7),b=x8[w-2]|0,F=P8[w-2]|0,k=y8(b,F,19)^Q0(b,F,61)^r0(b,F,6),v=m8(b,F,19)^q0(b,F,61)^a0(b,F,6),u=a$(l,v,P8[w-7],P8[w-16]),d=s$(u,p,k,x8[w-7],x8[w-16]);x8[w]=d|0,P8[w]=u|0}let{Ah:Q,Al:q,Bh:G,Bl:X,Ch:Y,Cl:Z,Dh:U,Dl:M,Eh:K,El:C,Fh:E,Fl:V,Gh:I,Gl:x,Hh:D,Hl:A}=this;for(let w=0;w<80;w++){let B=y8(K,C,14)^y8(K,C,18)^Q0(K,C,41),m=m8(K,C,14)^m8(K,C,18)^q0(K,C,41),p=K&E^~K&I,l=C&V^~C&x,b=t$(A,m,l,SQ[w],P8[w]),F=e$(b,D,B,p,_Q[w],x8[w]),k=b|0,v=y8(Q,q,28)^Q0(Q,q,34)^Q0(Q,q,39),u=m8(Q,q,28)^q0(Q,q,34)^q0(Q,q,39),d=Q&G^Q&Y^G&Y,W=q&X^q&Z^X&Z;D=I|0,A=x|0,I=E|0,x=V|0,E=K|0,V=C|0,{h:K,l:C}=T8(U|0,M|0,F|0,k|0),U=Y|0,M=Z|0,Y=G|0,Z=X|0,G=Q|0,X=q|0;let T=o$(k,u,W);Q=r$(T,F,v,d),q=T|0}({h:Q,l:q}=T8(this.Ah|0,this.Al|0,Q|0,q|0)),{h:G,l:X}=T8(this.Bh|0,this.Bl|0,G|0,X|0),{h:Y,l:Z}=T8(this.Ch|0,this.Cl|0,Y|0,Z|0),{h:U,l:M}=T8(this.Dh|0,this.Dl|0,U|0,M|0),{h:K,l:C}=T8(this.Eh|0,this.El|0,K|0,C|0),{h:E,l:V}=T8(this.Fh|0,this.Fl|0,E|0,V|0),{h:I,l:x}=T8(this.Gh|0,this.Gl|0,I|0,x|0),{h:D,l:A}=T8(this.Hh|0,this.Hl|0,D|0,A|0),this.set(Q,q,G,X,Y,Z,U,M,K,C,E,V,I,x,D,A)}roundClean(){z8(x8,P8)}destroy(){z8(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class QJ extends G0{Ah=J8[0]|0;Al=J8[1]|0;Bh=J8[2]|0;Bl=J8[3]|0;Ch=J8[4]|0;Cl=J8[5]|0;Dh=J8[6]|0;Dl=J8[7]|0;Eh=J8[8]|0;El=J8[9]|0;Fh=J8[10]|0;Fl=J8[11]|0;Gh=J8[12]|0;Gl=J8[13]|0;Hh=J8[14]|0;Hl=J8[15]|0;constructor(){super(64)}}class vQ extends G0{Ah=$8[0]|0;Al=$8[1]|0;Bh=$8[2]|0;Bl=$8[3]|0;Ch=$8[4]|0;Cl=$8[5]|0;Dh=$8[6]|0;Dl=$8[7]|0;Eh=$8[8]|0;El=$8[9]|0;Fh=$8[10]|0;Fl=$8[11]|0;Gh=$8[12]|0;Gl=$8[13]|0;Hh=$8[14]|0;Hl=$8[15]|0;constructor(){super(48)}}var Q8=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),q8=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class yQ extends G0{Ah=Q8[0]|0;Al=Q8[1]|0;Bh=Q8[2]|0;Bl=Q8[3]|0;Ch=Q8[4]|0;Cl=Q8[5]|0;Dh=Q8[6]|0;Dl=Q8[7]|0;Eh=Q8[8]|0;El=Q8[9]|0;Fh=Q8[10]|0;Fl=Q8[11]|0;Gh=Q8[12]|0;Gl=Q8[13]|0;Hh=Q8[14]|0;Hl=Q8[15]|0;constructor(){super(28)}}class mQ extends G0{Ah=q8[0]|0;Al=q8[1]|0;Bh=q8[2]|0;Bl=q8[3]|0;Ch=q8[4]|0;Cl=q8[5]|0;Dh=q8[6]|0;Dl=q8[7]|0;Eh=q8[8]|0;El=q8[9]|0;Fh=q8[10]|0;Fl=q8[11]|0;Gh=q8[12]|0;Gl=q8[13]|0;Hh=q8[14]|0;Hl=q8[15]|0;constructor(){super(32)}}var Z8=i0(()=>new $J,o0(1));var qJ=i0(()=>new QJ,o0(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var XJ=BigInt(0),GJ=BigInt(1);function D0($,J=""){if(typeof $!=="boolean"){let Q=J&&`"${J}" `;throw new Error(Q+"expected boolean, got type="+typeof $)}return $}function gQ($){if(typeof $==="bigint"){if(!z0($))throw new Error("positive bigint expected, got "+$)}else H8($);return $}function YJ($){if(typeof $!=="string")throw new Error("hex string expected, got "+typeof $);return $===""?XJ:BigInt("0x"+$)}function UJ($){return YJ(l8($))}function V8($){return YJ(l8(g8(c($)).reverse()))}function t0($,J){H8(J),$=gQ($);let Q=e8($.toString(16).padStart(J*2,"0"));if(Q.length!==J)throw new Error("number too large");return Q}function H0($,J){return t0($,J).reverse()}function g8($){return Uint8Array.from($)}var z0=($)=>typeof $==="bigint"&&XJ<=$;function bQ($,J,Q){return z0($)&&z0(J)&&z0(Q)&&J<=$&&$<Q}function d8($,J,Q,q){if(!bQ(J,Q,q))throw new Error("expected valid "+$+": "+Q+" <= n < "+q+", got "+J)}var ZJ=($)=>(GJ<<BigInt($))-GJ;function b8($,J={},Q={}){if(!$||typeof $!=="object")throw new Error("expected valid options object");function q(X,Y,Z){let U=$[X];if(Z&&U===void 0)return;let M=typeof U;if(M!==Y||U===null)throw new Error(`param "${X}" is invalid: expected ${Y}, got ${M}`)}let G=(X,Y)=>Object.entries(X).forEach(([Z,U])=>q(Z,U,Y));G(J,!1),G(Q,!0)}function e0($){let J=new WeakMap;return(Q,...q)=>{let G=J.get(Q);if(G!==void 0)return G;let X=$(Q,...q);return J.set(Q,X),X}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var X8=BigInt(0),G8=BigInt(1),h8=BigInt(2),WJ=BigInt(3),MJ=BigInt(4),OJ=BigInt(5),hQ=BigInt(7),LJ=BigInt(8),pQ=BigInt(9),CJ=BigInt(16);function i($,J){let Q=$%J;return Q>=X8?Q:J+Q}function M8($,J,Q){let q=$;while(J-- >X8)q*=q,q%=Q;return q}function NJ($,J){if($===X8)throw new Error("invert: expected non-zero number");if(J<=X8)throw new Error("invert: expected positive modulus, got "+J);let Q=i($,J),q=J,G=X8,X=G8,Y=G8,Z=X8;while(Q!==X8){let M=q/Q,K=q%Q,C=G-Y*M,E=X-Z*M;q=Q,Q=K,G=Y,X=Z,Y=C,Z=E}if(q!==G8)throw new Error("invert: does not exist");return i(G,J)}function $$($,J,Q){if(!$.eql($.sqr(J),Q))throw new Error("Cannot find square root")}function zJ($,J){let Q=($.ORDER+G8)/MJ,q=$.pow(J,Q);return $$($,q,J),q}function uQ($,J){let Q=($.ORDER-OJ)/LJ,q=$.mul(J,h8),G=$.pow(q,Q),X=$.mul(J,G),Y=$.mul($.mul(X,h8),G),Z=$.mul(X,$.sub(Y,$.ONE));return $$($,Z,J),Z}function cQ($){let J=R0($),Q=DJ($),q=Q(J,J.neg(J.ONE)),G=Q(J,q),X=Q(J,J.neg(q)),Y=($+hQ)/CJ;return(Z,U)=>{let M=Z.pow(U,Y),K=Z.mul(M,q),C=Z.mul(M,G),E=Z.mul(M,X),V=Z.eql(Z.sqr(K),U),I=Z.eql(Z.sqr(C),U);M=Z.cmov(M,K,V),K=Z.cmov(E,C,I);let x=Z.eql(Z.sqr(K),U),D=Z.cmov(M,K,x);return $$(Z,D,U),D}}function DJ($){if($<WJ)throw new Error("sqrt is not defined for small field");let J=$-G8,Q=0;while(J%h8===X8)J/=h8,Q++;let q=h8,G=R0($);while(KJ(G,q)===1)if(q++>1000)throw new Error("Cannot find square root: probably non-prime P");if(Q===1)return zJ;let X=G.pow(q,J),Y=(J+G8)/h8;return function Z(U,M){if(U.is0(M))return M;if(KJ(U,M)!==1)throw new Error("Cannot find square root");let K=Q,C=U.mul(U.ONE,X),E=U.pow(M,J),V=U.pow(M,Y);while(!U.eql(E,U.ONE)){if(U.is0(E))return U.ZERO;let I=1,x=U.sqr(E);while(!U.eql(x,U.ONE))if(I++,x=U.sqr(x),I===K)throw new Error("Cannot find square root");let D=G8<<BigInt(K-I-1),A=U.pow(C,D);K=I,C=U.sqr(A),E=U.mul(E,C),V=U.mul(V,A)}return V}}function lQ($){if($%MJ===WJ)return zJ;if($%LJ===OJ)return uQ;if($%CJ===pQ)return cQ($);return DJ($)}var HJ=($,J)=>(i($,J)&G8)===G8,dQ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function TJ($){let J={ORDER:"bigint",BYTES:"number",BITS:"number"},Q=dQ.reduce((q,G)=>{return q[G]="function",q},J);return b8($,Q),$}function nQ($,J,Q){if(Q<X8)throw new Error("invalid exponent, negatives unsupported");if(Q===X8)return $.ONE;if(Q===G8)return J;let q=$.ONE,G=J;while(Q>X8){if(Q&G8)q=$.mul(q,G);G=$.sqr(G),Q>>=G8}return q}function T0($,J,Q=!1){let q=new Array(J.length).fill(Q?$.ZERO:void 0),G=J.reduce((Y,Z,U)=>{if($.is0(Z))return Y;return q[U]=Y,$.mul(Y,Z)},$.ONE),X=$.inv(G);return J.reduceRight((Y,Z,U)=>{if($.is0(Z))return Y;return q[U]=$.mul(Y,q[U]),$.mul(Y,Z)},X),q}function KJ($,J){let Q=($.ORDER-G8)/h8,q=$.pow(J,Q),G=$.eql(q,$.ONE),X=$.eql(q,$.ZERO),Y=$.eql(q,$.neg($.ONE));if(!G&&!X&&!Y)throw new Error("invalid Legendre symbol result");return G?1:X?0:-1}function iQ($,J){if(J!==void 0)H8(J);let Q=J!==void 0?J:$.toString(2).length,q=Math.ceil(Q/8);return{nBitLength:Q,nByteLength:q}}class RJ{ORDER;BITS;BYTES;isLE;ZERO=X8;ONE=G8;_lengths;_sqrt;_mod;constructor($,J={}){if($<=X8)throw new Error("invalid field: expected ORDER > 0, got "+$);let Q=void 0;if(this.isLE=!1,J!=null&&typeof J==="object"){if(typeof J.BITS==="number")Q=J.BITS;if(typeof J.sqrt==="function")this.sqrt=J.sqrt;if(typeof J.isLE==="boolean")this.isLE=J.isLE;if(J.allowedLengths)this._lengths=J.allowedLengths?.slice();if(typeof J.modFromBytes==="boolean")this._mod=J.modFromBytes}let{nBitLength:q,nByteLength:G}=iQ($,Q);if(G>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=$,this.BITS=q,this.BYTES=G,this._sqrt=void 0,Object.preventExtensions(this)}create($){return i($,this.ORDER)}isValid($){if(typeof $!=="bigint")throw new Error("invalid field element: expected bigint, got "+typeof $);return X8<=$&&$<this.ORDER}is0($){return $===X8}isValidNot0($){return!this.is0($)&&this.isValid($)}isOdd($){return($&G8)===G8}neg($){return i(-$,this.ORDER)}eql($,J){return $===J}sqr($){return i($*$,this.ORDER)}add($,J){return i($+J,this.ORDER)}sub($,J){return i($-J,this.ORDER)}mul($,J){return i($*J,this.ORDER)}pow($,J){return nQ(this,$,J)}div($,J){return i($*NJ(J,this.ORDER),this.ORDER)}sqrN($){return $*$}addN($,J){return $+J}subN($,J){return $-J}mulN($,J){return $*J}inv($){return NJ($,this.ORDER)}sqrt($){if(!this._sqrt)this._sqrt=lQ(this.ORDER);return this._sqrt(this,$)}toBytes($){return this.isLE?H0($,this.BYTES):t0($,this.BYTES)}fromBytes($,J=!1){c($);let{_lengths:Q,BYTES:q,isLE:G,ORDER:X,_mod:Y}=this;if(Q){if(!Q.includes($.length)||$.length>q)throw new Error("Field.fromBytes: expected "+Q+" bytes, got "+$.length);let U=new Uint8Array(q);U.set($,G?0:U.length-$.length),$=U}if($.length!==q)throw new Error("Field.fromBytes: expected "+q+" bytes, got "+$.length);let Z=G?V8($):UJ($);if(Y)Z=i(Z,X);if(!J){if(!this.isValid(Z))throw new Error("invalid field element: outside of range 0..ORDER")}return Z}invertBatch($){return T0(this,$)}cmov($,J,Q){return Q?J:$}}function R0($,J={}){return new RJ($,J)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var E0=BigInt(0),G$=BigInt(1);function EJ($,J){let Q=J.negate();return $?Q:J}function B0($,J){let Q=T0($.Fp,J.map((q)=>q.Z));return J.map((q,G)=>$.fromAffine(q.toAffine(Q[G])))}function AJ($,J){if(!Number.isSafeInteger($)||$<=0||$>J)throw new Error("invalid window size, expected [1.."+J+"], got W="+$)}function J$($,J){AJ($,J);let Q=Math.ceil(J/$)+1,q=2**($-1),G=2**$,X=ZJ($),Y=BigInt($);return{windows:Q,windowSize:q,mask:X,maxNumber:G,shiftBy:Y}}function BJ($,J,Q){let{windowSize:q,mask:G,maxNumber:X,shiftBy:Y}=Q,Z=Number($&G),U=$>>Y;if(Z>q)Z-=X,U+=G$;let M=J*q,K=M+Math.abs(Z)-1,C=Z===0,E=Z<0,V=J%2!==0;return{nextN:U,offset:K,isZero:C,isNeg:E,isNegF:V,offsetF:M}}var Q$=new WeakMap,jJ=new WeakMap;function q$($){return jJ.get($)||1}function IJ($){if($!==E0)throw new Error("invalid wNAF")}class X${BASE;ZERO;Fn;bits;constructor($,J){this.BASE=$.BASE,this.ZERO=$.ZERO,this.Fn=$.Fn,this.bits=J}_unsafeLadder($,J,Q=this.ZERO){let q=$;while(J>E0){if(J&G$)Q=Q.add(q);q=q.double(),J>>=G$}return Q}precomputeWindow($,J){let{windows:Q,windowSize:q}=J$(J,this.bits),G=[],X=$,Y=X;for(let Z=0;Z<Q;Z++){Y=X,G.push(Y);for(let U=1;U<q;U++)Y=Y.add(X),G.push(Y);X=Y.double()}return G}wNAF($,J,Q){if(!this.Fn.isValid(Q))throw new Error("invalid scalar");let q=this.ZERO,G=this.BASE,X=J$($,this.bits);for(let Y=0;Y<X.windows;Y++){let{nextN:Z,offset:U,isZero:M,isNeg:K,isNegF:C,offsetF:E}=BJ(Q,Y,X);if(Q=Z,M)G=G.add(EJ(C,J[E]));else q=q.add(EJ(K,J[U]))}return IJ(Q),{p:q,f:G}}wNAFUnsafe($,J,Q,q=this.ZERO){let G=J$($,this.bits);for(let X=0;X<G.windows;X++){if(Q===E0)break;let{nextN:Y,offset:Z,isZero:U,isNeg:M}=BJ(Q,X,G);if(Q=Y,U)continue;else{let K=J[Z];q=q.add(M?K.negate():K)}}return IJ(Q),q}getPrecomputes($,J,Q){let q=Q$.get(J);if(!q){if(q=this.precomputeWindow(J,$),$!==1){if(typeof Q==="function")q=Q(q);Q$.set(J,q)}}return q}cached($,J,Q){let q=q$($);return this.wNAF(q,this.getPrecomputes(q,$,Q),J)}unsafe($,J,Q,q){let G=q$($);if(G===1)return this._unsafeLadder($,J,q);return this.wNAFUnsafe(G,this.getPrecomputes(G,$,Q),J,q)}createCache($,J){AJ(J,this.bits),jJ.set($,J),Q$.delete($)}hasCache($){return q$($)!==1}}function wJ($,J,Q){if(J){if(J.ORDER!==$)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return TJ(J),J}else return R0($,{isLE:Q})}function VJ($,J,Q={},q){if(q===void 0)q=$==="edwards";if(!J||typeof J!=="object")throw new Error(`expected valid ${$} CURVE object`);for(let U of["p","n","h"]){let M=J[U];if(!(typeof M==="bigint"&&M>E0))throw new Error(`CURVE.${U} must be positive bigint`)}let G=wJ(J.p,Q.Fp,q),X=wJ(J.n,Q.Fn,q),Z=["Gx","Gy","a",$==="weierstrass"?"b":"d"];for(let U of Z)if(!G.isValid(J[U]))throw new Error(`CURVE.${U} must be valid field element of CURVE.Fp`);return J=Object.freeze(Object.assign({},J)),{CURVE:J,Fp:G,Fn:X}}function I0($,J){return function Q(q){let G=$(q);return{secretKey:G,publicKey:J(G)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var k8=BigInt(0),t=BigInt(1),Y$=BigInt(2),oQ=BigInt(8);function rQ($,J,Q,q){let G=$.sqr(Q),X=$.sqr(q),Y=$.add($.mul(J.a,G),X),Z=$.add($.ONE,$.mul(J.d,$.mul(G,X)));return $.eql(Y,Z)}function FJ($,J={}){let Q=VJ("edwards",$,J,J.FpFnLE),{Fp:q,Fn:G}=Q,X=Q.CURVE,{h:Y}=X;b8(J,{},{uvRatio:"function"});let Z=Y$<<BigInt(G.BYTES*8)-t,U=(D)=>q.create(D),M=J.uvRatio||((D,A)=>{try{return{isValid:!0,value:q.sqrt(q.div(D,A))}}catch(w){return{isValid:!1,value:k8}}});if(!rQ(q,X,X.Gx,X.Gy))throw new Error("bad curve params: generator point");function K(D,A,w=!1){let B=w?t:k8;return d8("coordinate "+D,A,B,Z),A}function C(D){if(!(D instanceof I))throw new Error("EdwardsPoint expected")}let E=e0((D,A)=>{let{X:w,Y:B,Z:m}=D,p=D.is0();if(A==null)A=p?oQ:q.inv(m);let l=U(w*A),b=U(B*A),F=q.mul(m,A);if(p)return{x:k8,y:t};if(F!==t)throw new Error("invZ was invalid");return{x:l,y:b}}),V=e0((D)=>{let{a:A,d:w}=X;if(D.is0())throw new Error("bad point: ZERO");let{X:B,Y:m,Z:p,T:l}=D,b=U(B*B),F=U(m*m),k=U(p*p),v=U(k*k),u=U(b*A),d=U(k*U(u+F)),W=U(v+U(w*U(b*F)));if(d!==W)throw new Error("bad point: equation left != right (1)");let T=U(B*m),L=U(p*l);if(T!==L)throw new Error("bad point: equation left != right (2)");return!0});class I{static BASE=new I(X.Gx,X.Gy,t,U(X.Gx*X.Gy));static ZERO=new I(k8,t,t,k8);static Fp=q;static Fn=G;X;Y;Z;T;constructor(D,A,w,B){this.X=K("x",D),this.Y=K("y",A),this.Z=K("z",w,!0),this.T=K("t",B),Object.freeze(this)}static CURVE(){return X}static fromAffine(D){if(D instanceof I)throw new Error("extended point not allowed");let{x:A,y:w}=D||{};return K("x",A),K("y",w),new I(A,w,t,U(A*w))}static fromBytes(D,A=!1){let w=q.BYTES,{a:B,d:m}=X;D=g8(c(D,w,"point")),D0(A,"zip215");let p=g8(D),l=D[w-1];p[w-1]=l&-129;let b=V8(p),F=A?Z:q.ORDER;d8("point.y",b,k8,F);let k=U(b*b),v=U(k-t),u=U(m*k-B),{isValid:d,value:W}=M(v,u);if(!d)throw new Error("bad point: invalid y coordinate");let T=(W&t)===t,L=(l&128)!==0;if(!A&&W===k8&&L)throw new Error("bad point: x=0 and x_0=1");if(L!==T)W=U(-W);return I.fromAffine({x:W,y:b})}static fromHex(D,A=!1){return I.fromBytes(e8(D),A)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(D=8,A=!0){if(x.createCache(this,D),!A)this.multiply(Y$);return this}assertValidity(){V(this)}equals(D){C(D);let{X:A,Y:w,Z:B}=this,{X:m,Y:p,Z:l}=D,b=U(A*l),F=U(m*B),k=U(w*l),v=U(p*B);return b===F&&k===v}is0(){return this.equals(I.ZERO)}negate(){return new I(U(-this.X),this.Y,this.Z,U(-this.T))}double(){let{a:D}=X,{X:A,Y:w,Z:B}=this,m=U(A*A),p=U(w*w),l=U(Y$*U(B*B)),b=U(D*m),F=A+w,k=U(U(F*F)-m-p),v=b+p,u=v-l,d=b-p,W=U(k*u),T=U(v*d),L=U(k*d),H=U(u*v);return new I(W,T,H,L)}add(D){C(D);let{a:A,d:w}=X,{X:B,Y:m,Z:p,T:l}=this,{X:b,Y:F,Z:k,T:v}=D,u=U(B*b),d=U(m*F),W=U(l*w*v),T=U(p*k),L=U((B+m)*(b+F)-u-d),H=T-W,R=T+W,j=U(d-A*u),P=U(L*H),_=U(R*j),S=U(L*j),y=U(H*R);return new I(P,_,y,S)}subtract(D){return this.add(D.negate())}multiply(D){if(!G.isValidNot0(D))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:A,f:w}=x.cached(this,D,(B)=>B0(I,B));return B0(I,[A,w])[0]}multiplyUnsafe(D,A=I.ZERO){if(!G.isValid(D))throw new Error("invalid scalar: expected 0 <= sc < curve.n");if(D===k8)return I.ZERO;if(this.is0()||D===t)return this;return x.unsafe(this,D,(w)=>B0(I,w),A)}isSmallOrder(){return this.multiplyUnsafe(Y).is0()}isTorsionFree(){return x.unsafe(this,X.n).is0()}toAffine(D){return E(this,D)}clearCofactor(){if(Y===t)return this;return this.multiplyUnsafe(Y)}toBytes(){let{x:D,y:A}=this.toAffine(),w=q.toBytes(A);return w[w.length-1]|=D&t?128:0,w}toHex(){return l8(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let x=new X$(I,G.BITS);return I.BASE.precompute(8),I}function fJ($,J,Q={}){if(typeof J!=="function")throw new Error('"hash" function param is required');b8(Q,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:q}=Q,{BASE:G,Fp:X,Fn:Y}=$,Z=Q.randomBytes||J0,U=Q.adjustScalarBytes||((F)=>F),M=Q.domain||((F,k,v)=>{if(D0(v,"phflag"),k.length||v)throw new Error("Contexts/pre-hash are not supported");return F});function K(F){return Y.create(V8(F))}function C(F){let k=B.secretKey;c(F,B.secretKey,"secretKey");let v=c(J(F),2*k,"hashedSecretKey"),u=U(v.slice(0,k)),d=v.slice(k,2*k),W=K(u);return{head:u,prefix:d,scalar:W}}function E(F){let{head:k,prefix:v,scalar:u}=C(F),d=G.multiply(u),W=d.toBytes();return{head:k,prefix:v,scalar:u,point:d,pointBytes:W}}function V(F){return E(F).pointBytes}function I(F=Uint8Array.of(),...k){let v=$0(...k);return K(J(M(v,c(F,void 0,"context"),!!q)))}function x(F,k,v={}){if(F=c(F,void 0,"message"),q)F=q(F);let{prefix:u,scalar:d,pointBytes:W}=E(k),T=I(v.context,u,F),L=G.multiply(T).toBytes(),H=I(v.context,L,W,F),R=Y.create(T+H*d);if(!Y.isValid(R))throw new Error("sign failed: invalid s");let j=$0(L,Y.toBytes(R));return c(j,B.signature,"result")}let D={zip215:!0};function A(F,k,v,u=D){let{context:d,zip215:W}=u,T=B.signature;if(F=c(F,T,"signature"),k=c(k,void 0,"message"),v=c(v,B.publicKey,"publicKey"),W!==void 0)D0(W,"zip215");if(q)k=q(k);let L=T/2,H=F.subarray(0,L),R=V8(F.subarray(L,T)),j,P,_;try{j=$.fromBytes(v,W),P=$.fromBytes(H,W),_=G.multiplyUnsafe(R)}catch(s8){return!1}if(!W&&j.isSmallOrder())return!1;let S=I(d,P.toBytes(),j.toBytes(),k);return P.add(j.multiplyUnsafe(S)).subtract(_).clearCofactor().is0()}let w=X.BYTES,B={secretKey:w,publicKey:w,signature:2*w,seed:w};function m(F=Z(B.seed)){return c(F,B.seed,"seed")}function p(F){return M0(F)&&F.length===Y.BYTES}function l(F,k){try{return!!$.fromBytes(F,k)}catch(v){return!1}}let b={getExtendedPublicKey:E,randomSecretKey:m,isValidSecretKey:p,isValidPublicKey:l,toMontgomery(F){let{y:k}=$.fromBytes(F),v=B.publicKey,u=v===32;if(!u&&v!==57)throw new Error("only defined for 25519 and 448");let d=u?X.div(t+k,t-k):X.div(k-t,k+t);return X.toBytes(d)},toMontgomerySecret(F){let k=B.secretKey;c(F,k);let v=J(F.subarray(0,k));return U(v).subarray(0,k)}};return Object.freeze({keygen:I0(m,V),getPublicKey:V,sign:x,verify:A,utils:b,Point:$,lengths:B})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var X0=BigInt(0),n8=BigInt(1),w0=BigInt(2);function aQ($){return b8($,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...$})}function xJ($){let J=aQ($),{P:Q,type:q,adjustScalarBytes:G,powPminus2:X,randomBytes:Y}=J,Z=q==="x25519";if(!Z&&q!=="x448")throw new Error("invalid type");let U=Y||J0,M=Z?255:448,K=Z?32:56,C=Z?BigInt(9):BigInt(5),E=Z?BigInt(121665):BigInt(39081),V=Z?w0**BigInt(254):w0**BigInt(447),I=Z?BigInt(8)*w0**BigInt(251)-n8:BigInt(4)*w0**BigInt(445)-n8,x=V+I+n8,D=(T)=>i(T,Q),A=w(C);function w(T){return H0(D(T),K)}function B(T){let L=g8(c(T,K,"uCoordinate"));if(Z)L[31]&=127;return D(V8(L))}function m(T){return V8(G(g8(c(T,K,"scalar"))))}function p(T,L){let H=v(B(L),m(T));if(H===X0)throw new Error("invalid private or public key received");return w(H)}function l(T){return p(T,A)}let b=l,F=p;function k(T,L,H){let R=D(T*(L-H));return L=D(L-R),H=D(H+R),{x_2:L,x_3:H}}function v(T,L){d8("u",T,X0,Q),d8("scalar",L,V,x);let H=L,R=T,j=n8,P=X0,_=T,S=n8,y=X0;for(let u0=BigInt(M-1);u0>=X0;u0--){let k$=H>>u0&n8;y^=k$,{x_2:j,x_3:_}=k(y,j,_),{x_2:P,x_3:S}=k(y,P,S),y=k$;let c0=j+P,l0=D(c0*c0),d0=j-P,_$=D(d0*d0),S$=l0-_$,EQ=_+S,BQ=_-S,v$=D(BQ*c0),y$=D(EQ*d0),m$=v$+y$,g$=v$-y$;_=D(m$*m$),S=D(R*D(g$*g$)),j=D(l0*_$),P=D(S$*(l0+D(E*S$)))}({x_2:j,x_3:_}=k(y,j,_)),{x_2:P,x_3:S}=k(y,P,S);let s8=X(P);return D(j*s8)}let u={secretKey:K,publicKey:K,seed:K},d=(T=U(K))=>{return c(T,u.seed,"seed"),T},W={randomSecretKey:d};return Object.freeze({keygen:I0(d,b),getSharedSecret:F,getPublicKey:b,scalarMult:p,scalarMultBase:l,utils:W,GuBytes:A.slice(),lengths:u})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var sQ=BigInt(1),PJ=BigInt(2),tQ=BigInt(3),eQ=BigInt(5),$q=BigInt(8),A0=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Jq=(()=>({p:A0,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:$q,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function _J($){let J=BigInt(10),Q=BigInt(20),q=BigInt(40),G=BigInt(80),X=A0,Z=$*$%X*$%X,U=M8(Z,PJ,X)*Z%X,M=M8(U,sQ,X)*$%X,K=M8(M,eQ,X)*M%X,C=M8(K,J,X)*K%X,E=M8(C,Q,X)*C%X,V=M8(E,q,X)*E%X,I=M8(V,G,X)*V%X,x=M8(I,G,X)*V%X,D=M8(x,J,X)*K%X;return{pow_p_5_8:M8(D,PJ,X)*$%X,b2:Z}}function SJ($){return $[0]&=248,$[31]&=127,$[31]|=64,$}var kJ=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Qq($,J){let Q=A0,q=i(J*J*J,Q),G=i(q*q*J,Q),X=_J($*G).pow_p_5_8,Y=i($*q*X,Q),Z=i(J*Y*Y,Q),U=Y,M=i(Y*kJ,Q),K=Z===$,C=Z===i(-$,Q),E=Z===i(-$*kJ,Q);if(K)Y=U;if(C||E)Y=M;if(HJ(Y,Q))Y=i(-Y,Q);return{isValid:K||C,value:Y}}var qq=FJ(Jq,{uvRatio:Qq});function Gq($){return fJ(qq,qJ,Object.assign({adjustScalarBytes:SJ},$))}var _8=Gq({});var j0=(()=>{let $=A0;return xJ({P:$,type:"x25519",powPminus2:(J)=>{let{pow_p_5_8:Q,b2:q}=_J(J);return i(M8(Q,tQ,$)*q,$)},adjustScalarBytes:SJ})})();var qQ=h$(U$(),1);var Z$;try{Z$=new TextDecoder}catch($){}var f,u8,z=0;var hJ=[],Xq=105,Yq=57342,Uq=57343,yJ=57337;var mJ=6,i8={},Y0=112810000,F8=16810000;var N$=hJ,K$=0,g={},o,f0,x0=0,Z0=0,a,O8,r=[],W$=[],U8,Y8,U0,gJ={useRecords:!1,mapsAsObjects:!0},N0=!1,pJ=2;try{new Function("")}catch($){pJ=1/0}class S8{constructor($){if($){if(($.keyMap||$._keyMap)&&!$.useRecords)$.useRecords=!1,$.mapsAsObjects=!0;if($.useRecords===!1&&$.mapsAsObjects===void 0)$.mapsAsObjects=!0;if($.getStructures)$.getShared=$.getStructures;if($.getShared&&!$.structures)($.structures=[]).uninitialized=!0;if($.keyMap){this.mapKey=new Map;for(let[J,Q]of Object.entries($.keyMap))this.mapKey.set(Q,J)}}Object.assign(this,$)}decodeKey($){return this.keyMap?this.mapKey.get($)||$:$}encodeKey($){return this.keyMap&&this.keyMap.hasOwnProperty($)?this.keyMap[$]:$}encodeKeys($){if(!this._keyMap)return $;let J=new Map;for(let[Q,q]of Object.entries($))J.set(this._keyMap.hasOwnProperty(Q)?this._keyMap[Q]:Q,q);return J}decodeKeys($){if(!this._keyMap||$.constructor.name!="Map")return $;if(!this._mapKey){this._mapKey=new Map;for(let[Q,q]of Object.entries(this._keyMap))this._mapKey.set(q,Q)}let J={};return $.forEach((Q,q)=>J[L8(this._mapKey.has(q)?this._mapKey.get(q):q)]=Q),J}mapDecode($,J){let Q=this.decode($);if(this._keyMap)switch(Q.constructor.name){case"Array":return Q.map((q)=>this.decodeKeys(q))}return Q}decode($,J){if(f)return dJ(()=>{return P0(),this?this.decode($,J):S8.prototype.decode.call(gJ,$,J)});u8=J>-1?J:$.length,z=0,K$=0,Z0=0,f0=null,N$=hJ,a=null,f=$;try{Y8=$.dataView||($.dataView=new DataView($.buffer,$.byteOffset,$.byteLength))}catch(Q){if(f=null,$ instanceof Uint8Array)throw Q;throw new Error("Source must be a Uint8Array or Buffer but was a "+($&&typeof $=="object"?$.constructor.name:typeof $))}if(this instanceof S8){if(g=this,U8=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return o=this.structures,V0();else if(!o||o.length>0)o=[]}else{if(g=gJ,!o||o.length>0)o=[];U8=null}return V0()}decodeMultiple($,J){let Q,q=0;try{let G=$.length;N0=!0;let X=this?this.decode($,G):D$.decode($,G);if(J){if(J(X)===!1)return;while(z<G)if(q=z,J(V0())===!1)return}else{Q=[X];while(z<G)q=z,Q.push(V0());return Q}}catch(G){throw G.lastPosition=q,G.values=Q,G}finally{N0=!1,P0()}}}function V0(){try{let $=h();if(a){if(z>=a.postBundlePosition){let J=new Error("Unexpected bundle position");throw J.incomplete=!0,J}z=a.postBundlePosition,a=null}if(z==u8){if(o=null,f=null,O8)O8=null}else if(z>u8){let J=new Error("Unexpected end of CBOR data");throw J.incomplete=!0,J}else if(!N0)throw new Error("Data read, but end of buffer not reached");return $}catch($){if(P0(),$ instanceof RangeError||$.message.startsWith("Unexpected end of buffer"))$.incomplete=!0;throw $}}function h(){let $=f[z++],J=$>>5;if($=$&31,$>23)switch($){case 24:$=f[z++];break;case 25:if(J==7)return Wq();$=Y8.getUint16(z),z+=2;break;case 26:if(J==7){let Q=Y8.getFloat32(z);if(g.useFloat32>2){let q=k0[(f[z]&127)<<1|f[z+1]>>7];return z+=4,(q*Q+(Q>0?0.5:-0.5)>>0)/q}return z+=4,Q}$=Y8.getUint32(z),z+=4;break;case 27:if(J==7){let Q=Y8.getFloat64(z);return z+=8,Q}if(J>1){if(Y8.getUint32(z)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");$=Y8.getUint32(z+4)}else if(g.int64AsNumber)$=Y8.getUint32(z)*4294967296,$+=Y8.getUint32(z+4);else $=Y8.getBigUint64(z);z+=8;break;case 31:switch(J){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let Q=[],q,G=0;while((q=h())!=i8){if(G>=Y0)throw new Error(`Array length exceeds ${Y0}`);Q[G++]=q}return J==4?Q:J==3?Q.join(""):Buffer.concat(Q);case 5:let X;if(g.mapsAsObjects){let Y={},Z=0;if(g.keyMap)while((X=h())!=i8){if(Z++>=F8)throw new Error(`Property count exceeds ${F8}`);Y[L8(g.decodeKey(X))]=h()}else while((X=h())!=i8){if(Z++>=F8)throw new Error(`Property count exceeds ${F8}`);Y[L8(X)]=h()}return Y}else{if(U0)g.mapsAsObjects=!0,U0=!1;let Y=new Map;if(g.keyMap){let Z=0;while((X=h())!=i8){if(Z++>=F8)throw new Error(`Map size exceeds ${F8}`);Y.set(g.decodeKey(X),h())}}else{let Z=0;while((X=h())!=i8){if(Z++>=F8)throw new Error(`Map size exceeds ${F8}`);Y.set(X,h())}}return Y}case 7:return i8;default:throw new Error("Invalid major type for indefinite length "+J)}default:throw new Error("Unknown token "+$)}switch(J){case 0:return $;case 1:return~$;case 2:return Kq($);case 3:if(Z0>=z)return f0.slice(z-x0,(z+=$)-x0);if(Z0==0&&u8<140&&$<32){let G=$<16?uJ($):Nq($);if(G!=null)return G}return Zq($);case 4:if($>=Y0)throw new Error(`Array length exceeds ${Y0}`);let Q=new Array($);for(let G=0;G<$;G++)Q[G]=h();return Q;case 5:if($>=F8)throw new Error(`Map size exceeds ${Y0}`);if(g.mapsAsObjects){let G={};if(g.keyMap)for(let X=0;X<$;X++)G[L8(g.decodeKey(h()))]=h();else for(let X=0;X<$;X++)G[L8(h())]=h();return G}else{if(U0)g.mapsAsObjects=!0,U0=!1;let G=new Map;if(g.keyMap)for(let X=0;X<$;X++)G.set(g.decodeKey(h()),h());else for(let X=0;X<$;X++)G.set(h(),h());return G}case 6:if($>=yJ){let G=o[$&8191];if(G){if(!G.read)G.read=M$(G);return G.read()}if($<65536){if($==Uq){let X=r8(),Y=h(),Z=h();L$(Y,Z);let U={};if(g.keyMap)for(let M=2;M<X;M++){let K=g.decodeKey(Z[M-2]);U[L8(K)]=h()}else for(let M=2;M<X;M++){let K=Z[M-2];U[L8(K)]=h()}return U}else if($==Yq){let X=r8(),Y=h();for(let Z=2;Z<X;Z++)L$(Y++,h());return h()}else if($==yJ)return Dq();if(g.getShared){if(z$(),G=o[$&8191],G){if(!G.read)G.read=M$(G);return G.read()}}}}let q=r[$];if(q)if(q.handlesRead)return q(h);else return q(h());else{let G=h();for(let X=0;X<W$.length;X++){let Y=W$[X]($,G);if(Y!==void 0)return Y}return new R8(G,$)}case 7:switch($){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let G=(U8||p8())[$];if(G!==void 0)return G;throw new Error("Unknown token "+$)}default:if(isNaN($)){let G=new Error("Unexpected end of CBOR data");throw G.incomplete=!0,G}throw new Error("Unknown CBOR token "+$)}}var bJ=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function M$($){if(!$)throw new Error("Structure is required in record definition");function J(){let Q=f[z++];if(Q=Q&31,Q>23)switch(Q){case 24:Q=f[z++];break;case 25:Q=Y8.getUint16(z),z+=2;break;case 26:Q=Y8.getUint32(z),z+=4;break;default:throw new Error("Expected array header, but got "+f[z-1])}let q=this.compiledReader;while(q){if(q.propertyCount===Q)return q(h);q=q.next}if(this.slowReads++>=pJ){let X=this.length==Q?this:this.slice(0,Q);if(q=g.keyMap?new Function("r","return {"+X.map((Y)=>g.decodeKey(Y)).map((Y)=>bJ.test(Y)?L8(Y)+":r()":"["+JSON.stringify(Y)+"]:r()").join(",")+"}"):new Function("r","return {"+X.map((Y)=>bJ.test(Y)?L8(Y)+":r()":"["+JSON.stringify(Y)+"]:r()").join(",")+"}"),this.compiledReader)q.next=this.compiledReader;return q.propertyCount=Q,this.compiledReader=q,q(h)}let G={};if(g.keyMap)for(let X=0;X<Q;X++)G[L8(g.decodeKey(this[X]))]=h();else for(let X=0;X<Q;X++)G[L8(this[X])]=h();return G}return $.slowReads=0,J}function L8($){if(typeof $==="string")return $==="__proto__"?"__proto_":$;if(typeof $==="number"||typeof $==="boolean"||typeof $==="bigint")return $.toString();if($==null)return $+"";throw new Error("Invalid property name type "+typeof $)}var Zq=O$;function O$($){let J;if($<16){if(J=uJ($))return J}if($>64&&Z$)return Z$.decode(f.subarray(z,z+=$));let Q=z+$,q=[];J="";while(z<Q){let G=f[z++];if((G&128)===0)q.push(G);else if((G&224)===192){let X=f[z++]&63;q.push((G&31)<<6|X)}else if((G&240)===224){let X=f[z++]&63,Y=f[z++]&63;q.push((G&31)<<12|X<<6|Y)}else if((G&248)===240){let X=f[z++]&63,Y=f[z++]&63,Z=f[z++]&63,U=(G&7)<<18|X<<12|Y<<6|Z;if(U>65535)U-=65536,q.push(U>>>10&1023|55296),U=56320|U&1023;q.push(U)}else q.push(G);if(q.length>=4096)J+=e.apply(String,q),q.length=0}if(q.length>0)J+=e.apply(String,q);return J}var e=String.fromCharCode;function Nq($){let J=z,Q=new Array($);for(let q=0;q<$;q++){let G=f[z++];if((G&128)>0){z=J;return}Q[q]=G}return e.apply(String,Q)}function uJ($){if($<4)if($<2)if($===0)return"";else{let J=f[z++];if((J&128)>1){z-=1;return}return e(J)}else{let J=f[z++],Q=f[z++];if((J&128)>0||(Q&128)>0){z-=2;return}if($<3)return e(J,Q);let q=f[z++];if((q&128)>0){z-=3;return}return e(J,Q,q)}else{let J=f[z++],Q=f[z++],q=f[z++],G=f[z++];if((J&128)>0||(Q&128)>0||(q&128)>0||(G&128)>0){z-=4;return}if($<6)if($===4)return e(J,Q,q,G);else{let X=f[z++];if((X&128)>0){z-=5;return}return e(J,Q,q,G,X)}else if($<8){let X=f[z++],Y=f[z++];if((X&128)>0||(Y&128)>0){z-=6;return}if($<7)return e(J,Q,q,G,X,Y);let Z=f[z++];if((Z&128)>0){z-=7;return}return e(J,Q,q,G,X,Y,Z)}else{let X=f[z++],Y=f[z++],Z=f[z++],U=f[z++];if((X&128)>0||(Y&128)>0||(Z&128)>0||(U&128)>0){z-=8;return}if($<10)if($===8)return e(J,Q,q,G,X,Y,Z,U);else{let M=f[z++];if((M&128)>0){z-=9;return}return e(J,Q,q,G,X,Y,Z,U,M)}else if($<12){let M=f[z++],K=f[z++];if((M&128)>0||(K&128)>0){z-=10;return}if($<11)return e(J,Q,q,G,X,Y,Z,U,M,K);let C=f[z++];if((C&128)>0){z-=11;return}return e(J,Q,q,G,X,Y,Z,U,M,K,C)}else{let M=f[z++],K=f[z++],C=f[z++],E=f[z++];if((M&128)>0||(K&128)>0||(C&128)>0||(E&128)>0){z-=12;return}if($<14)if($===12)return e(J,Q,q,G,X,Y,Z,U,M,K,C,E);else{let V=f[z++];if((V&128)>0){z-=13;return}return e(J,Q,q,G,X,Y,Z,U,M,K,C,E,V)}else{let V=f[z++],I=f[z++];if((V&128)>0||(I&128)>0){z-=14;return}if($<15)return e(J,Q,q,G,X,Y,Z,U,M,K,C,E,V,I);let x=f[z++];if((x&128)>0){z-=15;return}return e(J,Q,q,G,X,Y,Z,U,M,K,C,E,V,I,x)}}}}}function Kq($){return g.copyBuffers?Uint8Array.prototype.slice.call(f,z,z+=$):f.subarray(z,z+=$)}var cJ=new Float32Array(1),F0=new Uint8Array(cJ.buffer,0,4);function Wq(){let $=f[z++],J=f[z++],Q=($&127)>>2;if(Q===31){if(J||$&3)return NaN;return $&128?-1/0:1/0}if(Q===0){let q=(($&3)<<8|J)/16777216;return $&128?-q:q}return F0[3]=$&128|(Q>>1)+56,F0[2]=($&7)<<5|J>>3,F0[1]=J<<5,F0[0]=0,cJ[0]}var M9=new Array(4096);class R8{constructor($,J){this.value=$,this.tag=J}}r[0]=($)=>{return new Date($)};r[1]=($)=>{return new Date(Math.round($*1000))};r[2]=($)=>{let J=BigInt(0);for(let Q=0,q=$.byteLength;Q<q;Q++)J=BigInt($[Q])+(J<<BigInt(8));return J};r[3]=($)=>{return BigInt(-1)-r[2]($)};r[4]=($)=>{return+($[1]+"e"+$[0])};r[5]=($)=>{return $[1]*Math.exp($[0]*Math.log(2))};var L$=($,J)=>{$=$-57344;let Q=o[$];if(Q&&Q.isShared)(o.restoreStructures||(o.restoreStructures=[]))[$]=Q;o[$]=J,J.read=M$(J)};r[Xq]=($)=>{let J=$.length,Q=$[1];L$($[0],Q);let q={};for(let G=2;G<J;G++){let X=Q[G-2];q[L8(X)]=$[G]}return q};r[14]=($)=>{if(a)return a[0].slice(a.position0,a.position0+=$);return new R8($,14)};r[15]=($)=>{if(a)return a[1].slice(a.position1,a.position1+=$);return new R8($,15)};var Mq={Error,RegExp};r[27]=($)=>{return(Mq[$[0]]||Error)($[1],$[2])};var lJ=($)=>{if(f[z++]!=132){let Q=new Error("Packed values structure must be followed by a 4 element array");if(f.length<z)Q.incomplete=!0;throw Q}let J=$();if(!J||!J.length){let Q=new Error("Packed values structure must be followed by a 4 element array");throw Q.incomplete=!0,Q}return U8=U8?J.concat(U8.slice(J.length)):J,U8.prefixes=$(),U8.suffixes=$(),$()};lJ.handlesRead=!0;r[51]=lJ;r[mJ]=($)=>{if(!U8)if(g.getShared)z$();else return new R8($,mJ);if(typeof $=="number")return U8[16+($>=0?2*$:-2*$-1)];let J=new Error("No support for non-integer packed references yet");if($===void 0)J.incomplete=!0;throw J};r[28]=($)=>{if(!O8)O8=new Map,O8.id=0;let J=O8.id++,Q=z,q=f[z],G;if(q>>5==4)G=[];else G={};let X={target:G};O8.set(J,X);let Y=$();if(X.used){if(Object.getPrototypeOf(G)!==Object.getPrototypeOf(Y))z=Q,G=Y,O8.set(J,{target:G}),Y=$();return Object.assign(G,Y)}return X.target=Y,Y};r[28].handlesRead=!0;r[29]=($)=>{let J=O8.get($);return J.used=!0,J.target};r[258]=($)=>new Set($);(r[259]=($)=>{if(g.mapsAsObjects)g.mapsAsObjects=!1,U0=!0;return $()}).handlesRead=!0;function o8($,J){if(typeof $==="string")return $+J;if($ instanceof Array)return $.concat(J);return Object.assign({},$,J)}function p8(){if(!U8)if(g.getShared)z$();else throw new Error("No packed values available");return U8}var Oq=1399353956;W$.push(($,J)=>{if($>=225&&$<=255)return o8(p8().prefixes[$-224],J);if($>=28704&&$<=32767)return o8(p8().prefixes[$-28672],J);if($>=1879052288&&$<=2147483647)return o8(p8().prefixes[$-1879048192],J);if($>=216&&$<=223)return o8(J,p8().suffixes[$-216]);if($>=27647&&$<=28671)return o8(J,p8().suffixes[$-27639]);if($>=1811940352&&$<=1879048191)return o8(J,p8().suffixes[$-1811939328]);if($==Oq)return{packedValues:U8,structures:o.slice(0),version:J};if($==55799)return J});var Lq=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,C$=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],Cq=[64,68,69,70,71,72,77,78,79,85,86];for(let $=0;$<C$.length;$++)zq(C$[$],Cq[$]);function zq($,J){let Q="get"+$.name.slice(0,-5),q;if(typeof $==="function")q=$.BYTES_PER_ELEMENT;else $=null;for(let G=0;G<2;G++){if(!G&&q==1)continue;let X=q==2?1:q==4?2:q==8?3:0;r[G?J:J-4]=q==1||G==Lq?(Y)=>{if(!$)throw new Error("Could not find typed array for code "+J);if(!g.copyBuffers){if(q===1||q===2&&!(Y.byteOffset&1)||q===4&&!(Y.byteOffset&3)||q===8&&!(Y.byteOffset&7))return new $(Y.buffer,Y.byteOffset,Y.byteLength>>X)}return new $(Uint8Array.prototype.slice.call(Y,0).buffer)}:(Y)=>{if(!$)throw new Error("Could not find typed array for code "+J);let Z=new DataView(Y.buffer,Y.byteOffset,Y.byteLength),U=Y.length>>X,M=new $(U),K=Z[Q];for(let C=0;C<U;C++)M[C]=K.call(Z,C<<X,G);return M}}}function Dq(){let $=r8(),J=z+h();for(let q=2;q<$;q++){let G=r8();z+=G}let Q=z;return z=J,a=[O$(r8()),O$(r8())],a.position0=0,a.position1=0,a.postBundlePosition=z,z=Q,h()}function r8(){let $=f[z++]&31;if($>23)switch($){case 24:$=f[z++];break;case 25:$=Y8.getUint16(z),z+=2;break;case 26:$=Y8.getUint32(z),z+=4;break}return $}function z$(){if(g.getShared){let $=dJ(()=>{return f=null,g.getShared()})||{},J=$.structures||[];if(g.sharedVersion=$.version,U8=g.sharedValues=$.packedValues,o===!0)g.structures=o=J;else o.splice.apply(o,[0,J.length].concat(J))}}function dJ($){let J=u8,Q=z,q=K$,G=x0,X=Z0,Y=f0,Z=N$,U=O8,M=a,K=new Uint8Array(f.slice(0,u8)),C=o,E=g,V=N0,I=$();return u8=J,z=Q,K$=q,x0=G,Z0=X,f0=Y,N$=Z,O8=U,a=M,f=K,N0=V,o=C,g=E,Y8=new DataView(f.buffer,f.byteOffset,f.byteLength),I}function P0(){f=null,O8=null,o=null}var k0=new Array(147);for(let $=0;$<256;$++)k0[$]=+("1e"+Math.floor(45.15-$*0.30103));var D$=new S8({useRecords:!1}),_0=D$.decode,Hq=D$.decodeMultiple;var S0;try{S0=new TextEncoder}catch($){}var B$,tJ,y0=typeof globalThis==="object"&&globalThis.Buffer,K0=typeof y0!=="undefined",H$=K0?y0.allocUnsafeSlow:Uint8Array,nJ=K0?y0:Uint8Array,iJ=256,oJ=K0?4294967296:2144337920;var T$,O,n,N=0,v8,s=null,Tq=61440,Rq=/[\u0080-\uFFFF]/,N8=Symbol("record-id");class m0 extends S8{constructor($){super($);this.offset=0;let J,Q,q,G,X,Y;$=$||{};let Z=nJ.prototype.utf8Write?function(W,T,L){return O.utf8Write(W,T,L)}:S0&&S0.encodeInto?function(W,T){return S0.encodeInto(W,O.subarray(T)).written}:!1,U=this,M=$.structures||$.saveStructures,K=$.maxSharedStructures;if(K==null)K=M?128:0;if(K>8190)throw new Error("Maximum maxSharedStructure is 8190");let C=$.sequential;if(C)K=0;if(!this.structures)this.structures=[];if(this.saveStructures)this.saveShared=this.saveStructures;let E,V,I=$.sharedValues,x;if(I){x=Object.create(null);for(let W=0,T=I.length;W<T;W++)x[I[W]]=W}let D=[],A=0,w=0;this.mapEncode=function(W,T){if(this._keyMap&&!this._mapped)switch(W.constructor.name){case"Array":W=W.map((L)=>this.encodeKeys(L));break}return this.encode(W,T)},this.encode=function(W,T){if(!O)O=new H$(8192),n=new DataView(O.buffer,0,8192),N=0;if(v8=O.length-10,v8-N<2048)O=new H$(O.length),n=new DataView(O.buffer,0,O.length),v8=O.length-10,N=0;else if(T===w$)N=N+7&2147483640;if(Q=N,U.useSelfDescribedHeader)n.setUint32(N,3654940416),N+=3;if(Y=U.structuredClone?new Map:null,U.bundleStrings&&typeof W!=="string")s=[],s.size=1/0;else s=null;if(q=U.structures,q){if(q.uninitialized){let H=U.getShared()||{};U.structures=q=H.structures||[],U.sharedVersion=H.version;let R=U.sharedValues=H.packedValues;if(R){x={};for(let j=0,P=R.length;j<P;j++)x[R[j]]=j}}let L=q.length;if(L>K&&!C)L=K;if(!q.transitions){q.transitions=Object.create(null);for(let H=0;H<L;H++){let R=q[H];if(!R)continue;let j,P=q.transitions;for(let _=0,S=R.length;_<S;_++){if(P[N8]===void 0)P[N8]=H;let y=R[_];if(j=P[y],!j)j=P[y]=Object.create(null);P=j}P[N8]=H|1048576}}if(!C)q.nextId=L}if(G)G=!1;if(X=q||[],V=x,$.pack){let L=new Map;if(L.values=[],L.encoder=U,L.maxValues=$.maxPrivatePackedValues||(x?16:1/0),L.objectMap=x||!1,L.samplingPackedValues=E,v0(W,L),L.values.length>0){O[N++]=216,O[N++]=51,B8(4);let H=L.values;B(H),B8(0),B8(0),V=Object.create(x||null);for(let R=0,j=H.length;R<j;R++)V[H[R]]=R}}T$=T&E$;try{if(T$)return;if(B(W),s)aJ(Q,B);if(U.offset=N,Y&&Y.idsToInsert){if(N+=Y.idsToInsert.length*2,N>v8)p(N);U.offset=N;let L=Iq(O.subarray(Q,N),Y.idsToInsert);return Y=null,L}if(T&w$)return O.start=Q,O.end=N,O;return O.subarray(Q,N)}finally{if(q){if(w<10)w++;if(q.length>K)q.length=K;if(A>1e4){if(q.transitions=null,w=0,A=0,D.length>0)D=[]}else if(D.length>0&&!C){for(let L=0,H=D.length;L<H;L++)D[L][N8]=void 0;D=[]}}if(G&&U.saveShared){if(U.structures.length>K)U.structures=U.structures.slice(0,K);let L=O.subarray(Q,N);if(U.updateSharedData()===!1)return U.encode(W);return L}if(T&Vq)N=Q}},this.findCommonStringsToPack=()=>{if(E=new Map,!x)x=Object.create(null);return(W)=>{let T=W&&W.threshold||4,L=this.pack?W.maxPrivatePackedValues||16:0;if(!I)I=this.sharedValues=[];for(let[H,R]of E)if(R.count>T)x[H]=L++,I.push(H),G=!0;while(this.saveShared&&this.updateSharedData()===!1);E=null}};let B=(W)=>{if(N>v8)O=p(N);var T=typeof W,L;if(T==="string"){if(V){let P=V[W];if(P>=0){if(P<16)O[N++]=P+224;else if(O[N++]=198,P&1)B(15-P>>1);else B(P-16>>1);return}else if(E&&!$.pack){let _=E.get(W);if(_)_.count++;else E.set(W,{count:1})}}let H=W.length;if(s&&H>=4&&H<1024){if((s.size+=H)>Tq){let _,S=(s[0]?s[0].length*3+s[1].length:0)+10;if(N+S>v8)O=p(N+S);if(O[N++]=217,O[N++]=223,O[N++]=249,O[N++]=s.position?132:130,O[N++]=26,_=N-Q,N+=4,s.position)aJ(Q,B);s=["",""],s.size=0,s.position=_}let P=Rq.test(W);s[P?0:1]+=W,O[N++]=P?206:207,B(H);return}let R;if(H<32)R=1;else if(H<256)R=2;else if(H<65536)R=3;else R=5;let j=H*3;if(N+j>v8)O=p(N+j);if(H<64||!Z){let P,_,S,y=N+R;for(P=0;P<H;P++)if(_=W.charCodeAt(P),_<128)O[y++]=_;else if(_<2048)O[y++]=_>>6|192,O[y++]=_&63|128;else if((_&64512)===55296&&((S=W.charCodeAt(P+1))&64512)===56320)_=65536+((_&1023)<<10)+(S&1023),P++,O[y++]=_>>18|240,O[y++]=_>>12&63|128,O[y++]=_>>6&63|128,O[y++]=_&63|128;else O[y++]=_>>12|224,O[y++]=_>>6&63|128,O[y++]=_&63|128;L=y-N-R}else L=Z(W,N+R,j);if(L<24)O[N++]=96|L;else if(L<256){if(R<2)O.copyWithin(N+2,N+1,N+1+L);O[N++]=120,O[N++]=L}else if(L<65536){if(R<3)O.copyWithin(N+3,N+2,N+2+L);O[N++]=121,O[N++]=L>>8,O[N++]=L&255}else{if(R<5)O.copyWithin(N+5,N+3,N+3+L);O[N++]=122,n.setUint32(N,L),N+=4}N+=L}else if(T==="number")if(!this.alwaysUseFloat&&W>>>0===W)if(W<24)O[N++]=W;else if(W<256)O[N++]=24,O[N++]=W;else if(W<65536)O[N++]=25,O[N++]=W>>8,O[N++]=W&255;else O[N++]=26,n.setUint32(N,W),N+=4;else if(!this.alwaysUseFloat&&W>>0===W)if(W>=-24)O[N++]=31-W;else if(W>=-256)O[N++]=56,O[N++]=~W;else if(W>=-65536)O[N++]=57,n.setUint16(N,~W),N+=2;else O[N++]=58,n.setUint32(N,~W),N+=4;else{let H;if((H=this.useFloat32)>0&&W<4294967296&&W>=-2147483648){O[N++]=250,n.setFloat32(N,W);let R;if(H<4||(R=W*k0[(O[N]&127)<<1|O[N+1]>>7])>>0===R){N+=4;return}else N--}O[N++]=251,n.setFloat64(N,W),N+=8}else if(T==="object")if(!W)O[N++]=246;else{if(Y){let R=Y.get(W);if(R){if(O[N++]=216,O[N++]=29,O[N++]=25,!R.references){let j=Y.idsToInsert||(Y.idsToInsert=[]);R.references=[],j.push(R)}R.references.push(N-Q),N+=2;return}else Y.set(W,{offset:N-Q})}let H=W.constructor;if(H===Object)m(W);else if(H===Array){if(L=W.length,L<24)O[N++]=128|L;else B8(L);for(let R=0;R<L;R++)B(W[R])}else if(H===Map){if(this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)O[N++]=217,O[N++]=1,O[N++]=3;if(L=W.size,L<24)O[N++]=160|L;else if(L<256)O[N++]=184,O[N++]=L;else if(L<65536)O[N++]=185,O[N++]=L>>8,O[N++]=L&255;else O[N++]=186,n.setUint32(N,L),N+=4;if(U.keyMap)for(let[R,j]of W)B(U.encodeKey(R)),B(j);else for(let[R,j]of W)B(R),B(j)}else{for(let R=0,j=B$.length;R<j;R++){let P=tJ[R];if(W instanceof P){let _=B$[R],S=_.tag;if(S==null)S=_.getTag&&_.getTag.call(this,W);if(S<24)O[N++]=192|S;else if(S<256)O[N++]=216,O[N++]=S;else if(S<65536)O[N++]=217,O[N++]=S>>8,O[N++]=S&255;else if(S>-1)O[N++]=218,n.setUint32(N,S),N+=4;_.encode.call(this,W,B,p);return}}if(W[Symbol.iterator]){if(T$){let R=new Error("Iterable should be serialized as iterator");throw R.iteratorNotHandled=!0,R}O[N++]=159;for(let R of W)B(R);O[N++]=255;return}if(W[Symbol.asyncIterator]||R$(W)){let R=new Error("Iterable/blob should be serialized as iterator");throw R.iteratorNotHandled=!0,R}if(this.useToJSON&&W.toJSON){let R=W.toJSON();if(R!==W)return B(R)}m(W)}}else if(T==="boolean")O[N++]=W?245:244;else if(T==="bigint"){if(W<BigInt(1)<<BigInt(64)&&W>=0)O[N++]=27,n.setBigUint64(N,W);else if(W>-(BigInt(1)<<BigInt(64))&&W<0)O[N++]=59,n.setBigUint64(N,-W-BigInt(1));else if(this.largeBigIntToFloat)O[N++]=251,n.setFloat64(N,Number(W));else{if(W>=BigInt(0))O[N++]=194;else O[N++]=195,W=BigInt(-1)-W;let H=[];while(W)H.push(Number(W&BigInt(255))),W>>=BigInt(8);I$(new Uint8Array(H.reverse()),p);return}N+=8}else if(T==="undefined")O[N++]=247;else throw new Error("Unknown type: "+T)},m=this.useRecords===!1?this.variableMapSize?(W)=>{let T=Object.keys(W),L=Object.values(W),H=T.length;if(H<24)O[N++]=160|H;else if(H<256)O[N++]=184,O[N++]=H;else if(H<65536)O[N++]=185,O[N++]=H>>8,O[N++]=H&255;else O[N++]=186,n.setUint32(N,H),N+=4;let R;if(U.keyMap)for(let j=0;j<H;j++)B(U.encodeKey(T[j])),B(L[j]);else for(let j=0;j<H;j++)B(T[j]),B(L[j])}:(W)=>{O[N++]=185;let T=N-Q;N+=2;let L=0;if(U.keyMap){for(let H in W)if(typeof W.hasOwnProperty!=="function"||W.hasOwnProperty(H))B(U.encodeKey(H)),B(W[H]),L++}else for(let H in W)if(typeof W.hasOwnProperty!=="function"||W.hasOwnProperty(H))B(H),B(W[H]),L++;O[T+++Q]=L>>8,O[T+Q]=L&255}:(W,T)=>{let L,H=X.transitions||(X.transitions=Object.create(null)),R=0,j=0,P,_;if(this.keyMap){_=Object.keys(W).map((y)=>this.encodeKey(y)),j=_.length;for(let y=0;y<j;y++){let s8=_[y];if(L=H[s8],!L)L=H[s8]=Object.create(null),R++;H=L}}else for(let y in W)if(typeof W.hasOwnProperty!=="function"||W.hasOwnProperty(y)){if(L=H[y],!L){if(H[N8]&1048576)P=H[N8]&65535;L=H[y]=Object.create(null),R++}H=L,j++}let S=H[N8];if(S!==void 0)S&=65535,O[N++]=217,O[N++]=S>>8|224,O[N++]=S&255;else{if(!_)_=H.__keys__||(H.__keys__=Object.keys(W));if(P===void 0){if(S=X.nextId++,!S)S=0,X.nextId=1;if(S>=iJ)X.nextId=(S=K)+1}else S=P;if(X[S]=_,S<K){O[N++]=217,O[N++]=S>>8|224,O[N++]=S&255,H=X.transitions;for(let y=0;y<j;y++){if(H[N8]===void 0||H[N8]&1048576)H[N8]=S;H=H[_[y]]}H[N8]=S|1048576,G=!0}else{if(H[N8]=S,n.setUint32(N,3655335680),N+=3,R)A+=w*R;if(D.length>=iJ-K)D.shift()[N8]=void 0;if(D.push(H),B8(j+2),B(57344+S),B(_),T)return;for(let y in W)if(typeof W.hasOwnProperty!=="function"||W.hasOwnProperty(y))B(W[y]);return}}if(j<24)O[N++]=128|j;else B8(j);if(T)return;for(let y in W)if(typeof W.hasOwnProperty!=="function"||W.hasOwnProperty(y))B(W[y])},p=(W)=>{let T;if(W>16777216){if(W-Q>oJ)throw new Error("Encoded buffer would be larger than maximum buffer size");T=Math.min(oJ,Math.round(Math.max((W-Q)*(W>67108864?1.25:2),4194304)/4096)*4096)}else T=(Math.max(W-Q<<2,O.length-1)>>12)+1<<12;let L=new H$(T);if(n=new DataView(L.buffer,0,T),O.copy)O.copy(L,0,Q,W);else L.set(O.slice(Q,W));return N-=Q,Q=0,v8=L.length-10,O=L},l=100,b=1000;this.encodeAsIterable=function(W,T){return u(W,T,F)},this.encodeAsAsyncIterable=function(W,T){return u(W,T,d)};function*F(W,T,L){let H=W.constructor;if(H===Object){let R=U.useRecords!==!1;if(R)m(W,!0);else rJ(Object.keys(W).length,160);for(let j in W){let P=W[j];if(!R)B(j);if(P&&typeof P==="object")if(T[j])yield*F(P,T[j]);else yield*k(P,T,j);else B(P)}}else if(H===Array){let R=W.length;B8(R);for(let j=0;j<R;j++){let P=W[j];if(P&&(typeof P==="object"||N-Q>l))if(T.element)yield*F(P,T.element);else yield*k(P,T,"element");else B(P)}}else if(W[Symbol.iterator]&&!W.buffer){O[N++]=159;for(let R of W)if(R&&(typeof R==="object"||N-Q>l))if(T.element)yield*F(R,T.element);else yield*k(R,T,"element");else B(R);O[N++]=255}else if(R$(W))rJ(W.size,64),yield O.subarray(Q,N),yield W,v();else if(W[Symbol.asyncIterator])O[N++]=159,yield O.subarray(Q,N),yield W,v(),O[N++]=255;else B(W);if(L&&N>Q)yield O.subarray(Q,N);else if(N-Q>l)yield O.subarray(Q,N),v()}function*k(W,T,L){let H=N-Q;try{if(B(W),N-Q>l)yield O.subarray(Q,N),v()}catch(R){if(R.iteratorNotHandled)T[L]={},N=Q+H,yield*F.call(this,W,T[L]);else throw R}}function v(){l=b,U.encode(null,E$)}function u(W,T,L){if(T&&T.chunkThreshold)l=b=T.chunkThreshold;else l=100;if(W&&typeof W==="object")return U.encode(null,E$),L(W,U.iterateProperties||(U.iterateProperties={}),!0);return[U.encode(W)]}async function*d(W,T){for(let L of F(W,T,!0)){let H=L.constructor;if(H===nJ||H===Uint8Array)yield L;else if(R$(L)){let R=L.stream().getReader(),j;while(!(j=await R.read()).done)yield j.value}else if(L[Symbol.asyncIterator])for await(let R of L)if(v(),R)yield*d(R,T.async||(T.async={}));else yield U.encode(R);else yield L}}}useBuffer($){O=$,n=new DataView(O.buffer,O.byteOffset,O.byteLength),N=0}clearSharedData(){if(this.structures)this.structures=[];if(this.sharedValues)this.sharedValues=void 0}updateSharedData(){let $=this.sharedVersion||0;this.sharedVersion=$+1;let J=this.structures.slice(0),Q=new A$(J,this.sharedValues,this.sharedVersion),q=this.saveShared(Q,(G)=>(G&&G.version||0)==$);if(q===!1)Q=this.getShared()||{},this.structures=Q.structures||[],this.sharedValues=Q.packedValues,this.sharedVersion=Q.version,this.structures.nextId=this.structures.length;else J.forEach((G,X)=>this.structures[X]=G);return q}}function rJ($,J){if($<24)O[N++]=J|$;else if($<256)O[N++]=J|24,O[N++]=$;else if($<65536)O[N++]=J|25,O[N++]=$>>8,O[N++]=$&255;else O[N++]=J|26,n.setUint32(N,$),N+=4}class A${constructor($,J,Q){this.structures=$,this.packedValues=J,this.version=Q}}function B8($){if($<24)O[N++]=128|$;else if($<256)O[N++]=152,O[N++]=$;else if($<65536)O[N++]=153,O[N++]=$>>8,O[N++]=$&255;else O[N++]=154,n.setUint32(N,$),N+=4}var Eq=typeof Blob==="undefined"?function(){}:Blob;function R$($){if($ instanceof Eq)return!0;let J=$[Symbol.toStringTag];return J==="Blob"||J==="File"}function v0($,J){switch(typeof $){case"string":if($.length>3){if(J.objectMap[$]>-1||J.values.length>=J.maxValues)return;let q=J.get($);if(q){if(++q.count==2)J.values.push($)}else if(J.set($,{count:1}),J.samplingPackedValues){let G=J.samplingPackedValues.get($);if(G)G.count++;else J.samplingPackedValues.set($,{count:1})}}break;case"object":if($)if($ instanceof Array)for(let q=0,G=$.length;q<G;q++)v0($[q],J);else{let q=!J.encoder.useRecords;for(var Q in $)if($.hasOwnProperty(Q)){if(q)v0(Q,J);v0($[Q],J)}}break;case"function":console.log($)}}var Bq=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;tJ=[Date,Set,Error,RegExp,R8,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array=="undefined"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array=="undefined"?function(){}:BigInt64Array,Float32Array,Float64Array,A$];B$=[{tag:1,encode($,J){let Q=$.getTime()/1000;if((this.useTimestamp32||$.getMilliseconds()===0)&&Q>=0&&Q<4294967296)O[N++]=26,n.setUint32(N,Q),N+=4;else O[N++]=251,n.setFloat64(N,Q),N+=8}},{tag:258,encode($,J){let Q=Array.from($);J(Q)}},{tag:27,encode($,J){J([$.name,$.message])}},{tag:27,encode($,J){J(["RegExp",$.source,$.flags])}},{getTag($){return $.tag},encode($,J){J($.value)}},{encode($,J,Q){I$($,Q)}},{getTag($){if($.constructor===Uint8Array){if(this.tagUint8Array||K0&&this.tagUint8Array!==!1)return 64}},encode($,J,Q){I$($,Q)}},E8(68,1),E8(69,2),E8(70,4),E8(71,8),E8(72,1),E8(77,2),E8(78,4),E8(79,8),E8(85,4),E8(86,8),{encode($,J){let Q=$.packedValues||[],q=$.structures||[];if(Q.values.length>0){O[N++]=216,O[N++]=51,B8(4);let G=Q.values;J(G),B8(0),B8(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let X=0,Y=G.length;X<Y;X++)packedObjectMap[G[X]]=X}if(q){n.setUint32(N,3655335424),N+=3;let G=q.slice(0);G.unshift(57344),G.push(new R8($.version,1399353956)),J(G)}else J(new R8($.version,1399353956))}}];function E8($,J){if(!Bq&&J>1)$-=4;return{tag:$,encode:function Q(q,G){let X=q.byteLength,Y=q.byteOffset||0,Z=q.buffer||q;G(K0?y0.from(Z,Y,X):new Uint8Array(Z,Y,X))}}}function I$($,J){let Q=$.byteLength;if(Q<24)O[N++]=64+Q;else if(Q<256)O[N++]=88,O[N++]=Q;else if(Q<65536)O[N++]=89,O[N++]=Q>>8,O[N++]=Q&255;else O[N++]=90,n.setUint32(N,Q),N+=4;if(N+Q>=O.length)J(N+Q);O.set($.buffer?$:new Uint8Array($),N),N+=Q}function Iq($,J){let Q,q=J.length*2,G=$.length-q;J.sort((X,Y)=>X.offset>Y.offset?1:-1);for(let X=0;X<J.length;X++){let Y=J[X];Y.id=X;for(let Z of Y.references)$[Z++]=X>>8,$[Z]=X&255}while(Q=J.pop()){let X=Q.offset;$.copyWithin(X+q,X,G),q-=2;let Y=X+q;$[Y++]=216,$[Y++]=28,G=X}return $}function aJ($,J){n.setUint32(s.position+$,N-s.position-$+1);let Q=s;s=null,J(Q[0]),J(Q[1])}var j$=new m0({useRecords:!1}),wq=j$.encode,Aq=j$.encodeAsIterable,jq=j$.encodeAsAsyncIterable;var w$=512,Vq=1024,E$=2048;var g0=($)=>{let J=new Uint8Array($),Q="";for(let q=0;q<J.byteLength;q++)Q+=String.fromCharCode(J[q]);return btoa(Q).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},eJ=($)=>{let J=atob($.replace(/-/g,"+").replace(/_/g,"/")),Q=new Uint8Array(J.length);for(let q=0;q<J.length;q++)Q[q]=J.charCodeAt(q);return Q.buffer};async function $Q($){let J=crypto.getRandomValues(new Uint8Array(32)),Q=crypto.getRandomValues(new Uint8Array(16)),q=await navigator.credentials.create({publicKey:{challenge:J,rp:{name:"Sorane Web/A Form"},user:{id:Q,name:$,displayName:$},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",residentKey:"preferred"},timeout:60000,attestation:"none"}});if(!q)throw new Error("Credential creation failed");return{id:q.id,rawId:g0(q.rawId),response:q.response}}async function JQ($,J){let Q=await navigator.credentials.get({publicKey:{challenge:J,allowCredentials:[{id:eJ($),type:"public-key"}],userVerification:"required"}});if(!Q)throw new Error("Assertion failed");let q=Q.response;return{id:Q.id,signature:g0(q.signature),authenticatorData:g0(q.authenticatorData),clientDataJSON:g0(q.clientDataJSON)}}async function b0($,J){let Q=crypto.getRandomValues(new Uint8Array(32)),q=await navigator.credentials.get({publicKey:{challenge:Q,allowCredentials:[{id:eJ($),type:"public-key"}],userVerification:"required",extensions:{prf:{eval:{first:J}}}}});if(!q)throw new Error("Assertion failed");let X=q.getClientExtensionResults()?.prf?.results?.first;if(!X)throw new Error("PRF extension not available");return new Uint8Array(X)}function W0($){return Array.from($).map((J)=>J.toString(16).padStart(2,"0")).join("")}function QQ($){let J=new Uint8Array($.length/2);for(let Q=0;Q<J.length;Q++)J[Q]=parseInt($.substring(Q*2,Q*2+2),16);return J}class GQ{usePasskey=!0;credentialId=null;publicKey=null;publicKeyType="ed25519";edPrivateKey=null;constructor(){this.loadKey()}loadKey(){if(typeof localStorage==="undefined")return;let $=localStorage.getItem("weba_passkey_id"),J=localStorage.getItem("weba_passkey_pub");if($&&J){this.credentialId=$,this.publicKey=QQ(J),this.publicKeyType="p256",this.usePasskey=!0;return}let Q=localStorage.getItem("weba_private_key");if(Q)this.edPrivateKey=QQ(Q),this.publicKey=_8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1}resetKey(){if(typeof localStorage!=="undefined")localStorage.removeItem("weba_passkey_id"),localStorage.removeItem("weba_passkey_pub"),localStorage.removeItem("weba_private_key");this.credentialId=null,this.publicKey=null,this.edPrivateKey=null}async register(){try{console.log("Registering Passkey...");let $=await $Q("User"),J=new Uint8Array($.response.attestationObject),q=_0(J).authData,G=new DataView(q.buffer,q.byteOffset,q.byteLength),X=53,Y=G.getUint16(X);X+=2,X+=Y;let Z=q.slice(X),U=_0(Z),M=U.get(-2),K=U.get(-3);if(!M||!K)throw new Error("Invalid COSE Key: x or y missing");let C=new Uint8Array(65);if(C[0]=4,C.set(M,1),C.set(K,33),this.credentialId=$.rawId,this.publicKey=C,this.publicKeyType="p256",this.usePasskey=!0,typeof localStorage!=="undefined")localStorage.setItem("weba_passkey_id",this.credentialId),localStorage.setItem("weba_passkey_pub",W0(this.publicKey));return console.log("Passkey Registered:",this.credentialId),!0}catch($){return console.warn("Passkey registration failed, falling back to Ed25519",$),this.generateEdKey(),!1}}generateEdKey(){if(this.edPrivateKey=_8.utils.randomSecretKey(),this.publicKey=_8.getPublicKey(this.edPrivateKey),this.publicKeyType="ed25519",this.usePasskey=!1,typeof localStorage!=="undefined")localStorage.setItem("weba_private_key",W0(this.edPrivateKey))}getIssuerDid(){if(!this.publicKey)return"";return`did:key:z${W0(this.publicKey)}`}getPublicKey(){return this.publicKey?W0(this.publicKey):""}async sign($,J="authentication"){if(!this.publicKey)await this.register();let Q=qQ.default($),q=new TextEncoder().encode(Q);if(this.usePasskey&&this.credentialId){let G=await crypto.subtle.digest("SHA-256",q),X=await JQ(this.credentialId,G);return{...$,proof:{type:"PasskeySignature2025",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:J,proofValue:X.signature,"srn:authenticatorData":X.authenticatorData,"srn:clientDataJSON":X.clientDataJSON,"srn:credentialId":X.id}}}else{if(!this.edPrivateKey)this.generateEdKey();let G=_8.sign(q,this.edPrivateKey);return{...$,proof:{type:"Ed25519Signature2020",created:new Date().toISOString(),verificationMethod:this.getIssuerDid(),proofPurpose:J,proofValue:W0(G)}}}}}var a8=new GQ;class V${oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor($,J){if(t8($),c(J,void 0,"key"),this.iHash=$.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let Q=this.blockLen,q=new Uint8Array(Q);q.set(J.length>Q?$.create().update(J).digest():J);for(let G=0;G<q.length;G++)q[G]^=54;this.iHash.update(q),this.oHash=$.create();for(let G=0;G<q.length;G++)q[G]^=106;this.oHash.update(q),z8(q)}update($){return c8(this),this.iHash.update($),this}digestInto($){c8(this),c($,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto($),this.oHash.update($),this.oHash.digestInto($),this.destroy()}digest(){let $=new Uint8Array(this.oHash.outputLen);return this.digestInto($),$}_cloneInto($){$||=Object.create(Object.getPrototypeOf(this),{});let{oHash:J,iHash:Q,finished:q,destroyed:G,blockLen:X,outputLen:Y}=this;return $=$,$.finished=q,$.destroyed=G,$.blockLen=X,$.outputLen=Y,$.oHash=J._cloneInto($.oHash),$.iHash=Q._cloneInto($.iHash),$}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var h0=($,J,Q)=>new V$($,J).update(Q).digest();h0.create=($,J)=>new V$($,J);function Fq($,J,Q){if(t8($),Q===void 0)Q=new Uint8Array($.outputLen);return h0($,Q,J)}var F$=Uint8Array.of(0),XQ=Uint8Array.of();function fq($,J,Q,q=32){t8($),H8(q,"length");let G=$.outputLen;if(q>255*G)throw new Error("Length must be <= 255*HashLen");let X=Math.ceil(q/G);if(Q===void 0)Q=XQ;else c(Q,void 0,"info");let Y=new Uint8Array(X*G),Z=h0.create($,J),U=Z._cloneInto(),M=new Uint8Array(Z.outputLen);for(let K=0;K<X;K++)F$[0]=K+1,U.update(K===0?XQ:M).update(Q).update(F$).digestInto(M),Y.set(M,G*K),Z._cloneInto(U);return Z.destroy(),U.destroy(),z8(M,F$),Y.slice(0,q)}var K8=($,J,Q,q,G)=>fq($,Fq($,J,Q),q,G);var ZQ=h$(U$(),1),YQ="weba_l2_ed25519_sk";function C8($){if(typeof Buffer!=="undefined")return Buffer.from($).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");let J="";return $.forEach((q)=>{J+=String.fromCharCode(q)}),btoa(J).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function W8($){let J=$.length%4===0?"":"=".repeat(4-$.length%4),Q=$.replace(/-/g,"+").replace(/_/g,"/")+J;if(typeof Buffer!=="undefined")return new Uint8Array(Buffer.from(Q,"base64"));let q=atob(Q),G=new Uint8Array(q.length);for(let X=0;X<q.length;X+=1)G[X]=q.charCodeAt(X);return G}function p0($){let J=ZQ.default($);if(J===void 0)throw new Error("Failed to canonicalize JSON");return J}function UQ($){let J=new Uint8Array($);return crypto.getRandomValues(J),J}function xq(){let $=localStorage.getItem(YQ);if($)return W8($);let J=_8.utils.randomSecretKey();return localStorage.setItem(YQ,C8(J)),J}function Pq($,J,Q){let q={layer1_ref:$,recipient:J,weba_version:Q};return new TextEncoder().encode(p0(q))}async function NQ($,J,Q,q){let G=await crypto.subtle.importKey("raw",J,"AES-GCM",!1,["encrypt"]),X=await crypto.subtle.encrypt({name:"AES-GCM",iv:Q,additionalData:q},G,$);return new Uint8Array(X)}async function KQ($){let J=K8(Z8,$.prfKey,void 0,void 0,32),Q=K8(Z8,J,void 0,new TextEncoder().encode("weba-l2/kw"),32),q=K8(Z8,J,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.aad??new Uint8Array;return NQ($.recipientSk,Q,q,G)}async function WQ($,J,Q,q){let G=await crypto.subtle.importKey("raw",J,"AES-GCM",!1,["decrypt"]),X=await crypto.subtle.decrypt({name:"AES-GCM",iv:Q,additionalData:q},G,$);return new Uint8Array(X)}async function MQ($){let J=$.config.weba_version??"0.1",Q=$.config.recipient_kid,q=$.config.layer1_ref,G=$.user_kid??"user#sig-1",X=xq(),Y=p0($.layer2_plain),Z=new TextEncoder().encode(Y),U=_8.sign(Z,X),M={alg:"Ed25519",kid:G,sig:C8(U),created_at:new Date().toISOString()},K={layer2_plain:$.layer2_plain,layer2_sig:M},C=Pq(q,Q,J),E=new TextEncoder().encode(p0(K)),V=W8($.config.recipient_x25519),I=UQ(32),x=j0.getPublicKey(I),D=j0.getSharedSecret(I,V),A=K8(Z8,D,C,void 0,32),w=K8(Z8,A,void 0,new TextEncoder().encode("weba-l2/key"),32),B=K8(Z8,A,void 0,new TextEncoder().encode("weba-l2/iv"),12),m=await NQ(E,w,B,C);return{weba_version:J,layer1_ref:q,layer2:{enc:"HPKE-v1",suite:{kem:"X25519",kdf:"HKDF-SHA256",aead:"AES-256-GCM"},recipient:Q,encapsulated:{classical:C8(x)},ciphertext:C8(m),aad:C8(C)},meta:{created_at:new Date().toISOString(),nonce:C8(UQ(16))}}}function OQ(){let $=document.getElementById("weba-l2-config");if(!$||!$.textContent)return null;try{return JSON.parse($.textContent)}catch{return null}}async function LQ($,J){let Q=W8($.layer2.aad),q={layer1_ref:$.layer1_ref,recipient:$.layer2.recipient,weba_version:$.weba_version},G=new TextEncoder().encode(p0(q));if(C8(G)!==$.layer2.aad)throw new Error("AAD mismatch");let X=W8($.layer2.encapsulated.classical),Y=j0.getSharedSecret(J,X),Z=K8(Z8,Y,Q,void 0,32),U=K8(Z8,Z,void 0,new TextEncoder().encode("weba-l2/key"),32),M=K8(Z8,Z,void 0,new TextEncoder().encode("weba-l2/iv"),12),K=W8($.layer2.ciphertext),C=await WQ(K,U,M,Q);return JSON.parse(new TextDecoder().decode(C))}async function CQ($){let J=K8(Z8,$.prfKey,void 0,void 0,32),Q=K8(Z8,J,void 0,new TextEncoder().encode("weba-l2/kw"),32),q=K8(Z8,J,void 0,new TextEncoder().encode("weba-l2/kw-iv"),12),G=$.keywrap.aad?W8($.keywrap.aad):new Uint8Array,X=W8($.keywrap.wrapped_key);return WQ(X,Q,q,G)}class f${formId;constructor(){this.formId="WebA_"+window.location.pathname}updateJsonLd(){let J=window.generatedJsonStructure||{};document.querySelectorAll("[data-json-path]").forEach((G)=>{let X=G.dataset.jsonPath;if(X)J[X]=G.value}),document.querySelectorAll('[type="radio"]:checked').forEach((G)=>{J[G.name]=G.value}),document.querySelectorAll("table.data-table.dynamic").forEach((G)=>{let X=G.dataset.tableKey;if(X){let Y=[];G.querySelectorAll("tbody tr").forEach((Z)=>{let U={},M=!1;if(Z.querySelectorAll("[data-base-key]").forEach((K)=>{if(K.type==="checkbox"){if(U[K.dataset.baseKey]=K.checked,K.checked)M=!0}else if(U[K.dataset.baseKey]=K.value,K.value)M=!0}),M)Y.push(U)}),J[X]=Y}});let Q=document.getElementById("json-ld");if(Q)Q.textContent=JSON.stringify(J,null,2);let q=document.getElementById("json-debug");if(q)q.textContent=JSON.stringify(J,null,2);return J}getL2Config(){return window.webaL2Config||null}async signAndDownload(){let $=this.updateJsonLd(),J=window,Q=J.generatedJsonStructure&&J.generatedJsonStructure.name||"Response",q=window.location.href.split("#")[0],G=this.getL2Config(),X=document.getElementById("weba-l2-encrypt");if(!!(G?.enabled&&(X?X.checked:G.default_enabled))){if(!G?.recipient_kid||!G?.recipient_x25519||!G?.layer1_ref){alert("L2 encryption config is missing required fields.");return}try{let U=await MQ({layer2_plain:$,config:G,user_kid:G.user_kid});this.downloadHtml("submit",!0,{l2Envelope:U,stripPlaintext:!0})}catch(U){console.error(U),alert("L2 encryption failed. Please check your recipient key settings.")}return}if(!a8.getPublicKey()){if(!await a8.register()){alert("Key registration failed.");return}}let Z={"@context":["https://www.w3.org/2018/credentials/v1"],type:["VerifiableCredential","WebAFormResponse"],issuer:a8.getIssuerDid(),issuanceDate:new Date().toISOString(),credentialSubject:{id:`urn:uuid:${crypto.randomUUID()}`,type:"WebAFormResponse",templateId:q,answers:$}};try{let U=await a8.sign(Z);this.downloadHtml("submitted",!0,{embeddedVc:U})}catch(U){console.error(U),alert("Signing failed. Please ensure you are in a secure context (HTTPS/localhost).")}}saveToLS(){let $=this.updateJsonLd();localStorage.setItem(this.formId,JSON.stringify($))}restoreFromLS(){let $=localStorage.getItem(this.formId);if(!$)return;try{let J=JSON.parse($);document.querySelectorAll("[data-json-path]").forEach((Q)=>{let q=Q.dataset.jsonPath;if(J[q]!==void 0)Q.value=J[q]}),document.querySelectorAll("table.data-table.dynamic").forEach((Q)=>{let q=Q.dataset.tableKey,G=J[q];if(Array.isArray(G)){let X=Q.querySelector("tbody");if(!X)return;let Y=X.querySelectorAll(".template-row");G.forEach((Z,U)=>{let M;if(U===0)M=X.querySelector(".template-row");else{let K=X.querySelector(".template-row");if(K){M=K.cloneNode(!0),M.classList.remove("template-row");let C=M.querySelector(".remove-row-btn");if(C)C.style.visibility="visible";X.appendChild(M)}}if(M)M.querySelectorAll("input, select").forEach((K)=>{let C=K.dataset.baseKey;if(C&&Z[C]!==void 0)if(K.type==="checkbox")K.checked=!!Z[C];else K.value=Z[C]})})}})}catch(J){console.error(J)}}clearData(){if(confirm("Clear all saved data? / "))localStorage.removeItem(this.formId),window.location.reload()}bakeValues(){this.updateJsonLd(),document.querySelectorAll("input, textarea, select").forEach(($)=>{if($.closest(".template-row"))return;if($.type==="checkbox"||$.type==="radio")if($.checked)$.setAttribute("checked","checked");else $.removeAttribute("checked");else if($.setAttribute("value",$.value),$.tagName==="TEXTAREA")$.textContent=$.value})}downloadHtml($,J,Q){let q=window,X=new DOMParser().parseFromString(document.documentElement.outerHTML,"text/html");if(Q?.stripPlaintext){X.querySelectorAll("input").forEach((D)=>{if(D.type==="checkbox"||D.type==="radio")D.checked=!1,D.removeAttribute("checked");else D.value="",D.removeAttribute("value")}),X.querySelectorAll("textarea").forEach((D)=>{D.value="",D.textContent=""}),X.querySelectorAll("select").forEach((D)=>{D.selectedIndex=-1,D.querySelectorAll("option").forEach((A)=>A.removeAttribute("selected"))}),X.getElementById("json-ld")?.remove(),X.getElementById("data-layer")?.remove();let x=X.getElementById("json-debug");if(x)x.textContent=""}if(Q?.embeddedVc){let x=JSON.stringify(Q.embeddedVc,null,2),D=X.createElement("script");D.type="application/ld+json",D.id="weba-user-vc",D.textContent=x,X.body.appendChild(D);let A=X.createElement("div");A.className="weba-user-verification no-print",A.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #10b981;border-radius:8px;background:#f0fdf4;font-size:0.85rem;",A.innerHTML=`
                <details>
                    <summary style="cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #047857; font-weight: 600;">
                        <span></span> 
                    </summary>
                    <div style="padding: 1rem 0;">
                        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.8rem; line-height: 1.4;"></pre>
                    </div>
                </details>
            `;let w=A.querySelector("pre");if(w)w.textContent=x;X.body.appendChild(A)}if(Q?.l2Envelope){let x=X.createElement("script");x.id="weba-l2-envelope",x.type="application/json",x.textContent=JSON.stringify(Q.l2Envelope,null,2),X.body.appendChild(x)}let Y=X.documentElement.outerHTML,Z=new Blob([Y],{type:"text/html"}),U=URL.createObjectURL(Z),M=document.createElement("a");M.href=U;let K=q.generatedJsonStructure&&q.generatedJsonStructure.name||"web-a-form",C=new Date,E=C.getFullYear()+("0"+(C.getMonth()+1)).slice(-2)+("0"+C.getDate()).slice(-2)+"-"+("0"+C.getHours()).slice(-2)+("0"+C.getMinutes()).slice(-2),V=Math.random().toString(36).substring(2,8),I=`${K}_${E}_${$}_${V}.html`;if(M.download=I,M.click(),J)setTimeout(()=>window.location.reload(),1000)}saveDraft(){this.bakeValues(),this.downloadHtml("draft",!1)}submitDocument(){this.bakeValues(),document.querySelectorAll(".search-suggestions").forEach(($)=>$.remove()),this.downloadHtml("submit",!0)}}class x${calc;data;constructor($,J){this.calc=$,this.data=J}applyI18n(){let $={en:{add_row:"+ Add Row",work_save_btn:"Save Progress",clear_btn:"Clear Data",sign_btn:"Submit"},ja:{add_row:"+ ",work_save_btn:"",clear_btn:"",sign_btn:""}},J=(navigator.language||"en").startsWith("ja")?"ja":"en",Q=$[J]||$.en;document.querySelectorAll("[data-i18n]").forEach((q)=>{let G=q.dataset.i18n;if(Q[G])q.textContent=Q[G]})}initTables(){document.querySelectorAll(".data-table.dynamic tbody").forEach(($)=>{this.renumberRows($)})}renumberRows($){Array.from($.querySelectorAll("tr")).filter((Q)=>{return Q.querySelectorAll("td").length>0}).forEach((Q,q)=>{let G=q+1;Q.querySelectorAll(".auto-num").forEach((X)=>{if(X.value!=G)X.value=G.toString(),X.dispatchEvent(new Event("input",{bubbles:!0}))})})}removeTableRow($){let J=$.closest("tr"),Q=J.parentElement;if(J.classList.contains("template-row"))J.querySelectorAll("input").forEach((q)=>{if(q.type==="checkbox")q.checked=!1;else q.value=""});else{if(J.remove(),Q)this.renumberRows(Q);this.calc.recalculate(),this.data.updateJsonLd()}}addTableRow($,J){let Q=document.getElementById("tbl_"+J);if(!Q)return;let q=Q.querySelector("tbody");if(!q)return;let G=q.querySelector(".template-row");if(!G)return;let X=G.cloneNode(!0);X.classList.remove("template-row"),X.querySelectorAll("input").forEach((Z)=>{if(Z.type==="checkbox")Z.checked=Z.hasAttribute("checked");else Z.value=Z.getAttribute("value")||""});let Y=X.querySelector(".remove-row-btn");if(Y)Y.style.visibility="visible";X.querySelectorAll("[data-copy-from]").forEach((Z)=>{let U=Z.dataset.copyFrom;if(U){let M=X.querySelector(`[data-base-key="${U}"]`);if(M&&M.value)Z.value=M.value}}),q.appendChild(X),this.renumberRows(q),this.calc.recalculate()}switchTab($,J){document.querySelectorAll(".tab-btn").forEach((q)=>q.classList.remove("active")),document.querySelectorAll(".tab-content").forEach((q)=>q.classList.remove("active")),$.classList.add("active");let Q=document.getElementById(J);if(Q)Q.classList.add("active")}}function zQ($){let J=document.getElementById($);if(!J||!J.textContent)return null;try{return JSON.parse(J.textContent)}catch{return null}}function DQ(){let $=zQ("weba-l2-envelope");if(!$)return;let J=zQ("weba-l2-keywrap"),Q=document.querySelector(".weba-form-container")||document.body,q=document.createElement("div");q.className="weba-l2-unlock",q.style.cssText="margin-top:2rem;padding:1rem;border:1px solid #cbd5f5;border-radius:10px;background:#f8fafc;";let G=document.createElement("div");G.textContent="Encrypted Submission",G.style.cssText="font-weight:600;color:#334155;margin-bottom:0.5rem;",q.appendChild(G);let X=document.createElement("div");X.textContent="Locked. Unlock with Passkey.",X.style.cssText="color:#64748b;margin-bottom:0.75rem;",q.appendChild(X);let Y=document.createElement("button");Y.textContent="Unlock (Passkey)",Y.style.cssText="padding:0.5rem 1rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;",q.appendChild(Y);let Z=document.createElement("pre");Z.style.cssText="margin-top:1rem;padding:1rem;background:#0f172a;color:#e2e8f0;border-radius:8px;overflow:auto;font-size:0.85rem;display:none;",q.appendChild(Z);let U=document.createElement("details");U.style.cssText="margin-top:0.75rem; display:none;",U.innerHTML='<summary style="cursor:pointer;color:#64748b;">Show signature</summary><pre style="margin-top:0.5rem;padding:0.75rem;background:#0b1220;color:#cbd5f5;border-radius:6px;overflow:auto;font-size:0.8rem;"></pre>',q.appendChild(U);let M=document.createElement("button");M.textContent="Export JSON",M.style.cssText="margin-top:0.75rem;padding:0.45rem 0.9rem;border:1px solid #94a3b8;border-radius:6px;background:#fff;cursor:pointer;display:none;",M.disabled=!0,q.appendChild(M),Y.addEventListener("click",async()=>{if(!J){X.textContent="Key wrap package not found.";return}Y.disabled=!0,X.textContent="Waiting for passkey...";try{let K=W8(J.prf_salt),C=await b0(J.credential_id,K),E=await CQ({keywrap:J,prfKey:C}),V=await LQ($,E);kq(V.layer2_plain),document.body.classList.add("weba-l2-readonly"),Z.textContent=JSON.stringify(V.layer2_plain,null,2),Z.style.display="block";let I=U.querySelector("pre");if(I)I.textContent=JSON.stringify(V.layer2_sig,null,2);U.style.display="block",M.style.display="inline-block",M.disabled=!1,X.textContent="Unlocked.",M.onclick=()=>{let x=new Blob([JSON.stringify(V,null,2)],{type:"application/json"}),D=URL.createObjectURL(x),A=document.createElement("a");A.href=D,A.download="weba-l2-decrypted.json",A.click()}}catch(K){console.error(K),X.textContent="Unlock failed.",Y.disabled=!1}}),Q.appendChild(q)}function kq($){if(!$||typeof $!=="object")return;let J=$;document.querySelectorAll("[data-json-path]").forEach((Q)=>{let q=Q.dataset.jsonPath;if(!q||!(q in J))return;let G=J[q];if(Q.type==="checkbox")Q.checked=Boolean(G);else if(Q.type==="radio")Q.checked=Q.value===String(G);else Q.value=G===null||G===void 0?"":String(G)}),document.querySelectorAll('input[type="radio"]').forEach((Q)=>{let q=Q.name;if(!q||!(q in J))return;let G=J[q];Q.checked=Q.value===String(G)}),document.querySelectorAll("table.data-table.dynamic").forEach((Q)=>{let q=Q.dataset.tableKey;if(!q)return;let G=J[q];if(!Array.isArray(G))return;let X=Q.querySelector("tbody");if(!X)return;let Y=X.querySelector("tr.template-row");if(!Y)return;Array.from(X.querySelectorAll("tr")).forEach((Z)=>{if(!Z.classList.contains("template-row"))Z.remove()}),G.forEach((Z,U)=>{let M=U===0?Y:Y.cloneNode(!0);if(U>0){M.classList.remove("template-row");let K=M.querySelector(".remove-row-btn");if(K)K.style.visibility="visible";X.appendChild(M)}if(Z&&typeof Z==="object")M.querySelectorAll("input, select, textarea").forEach((K)=>{let C=K.dataset.baseKey;if(!C)return;let E=Z[C];if(K.type==="checkbox")K.checked=Boolean(E);else K.value=E===null||E===void 0?"":String(E)})})}),document.querySelectorAll("input").forEach((Q)=>{if(Q.type==="checkbox"||Q.type==="radio")Q.disabled=!0;else Q.readOnly=!0}),document.querySelectorAll("textarea").forEach((Q)=>{Q.readOnly=!0}),document.querySelectorAll("select").forEach((Q)=>{Q.disabled=!0}),document.querySelectorAll(".form-toolbar button, .add-row-btn, .remove-row-btn").forEach((Q)=>{Q.disabled=!0})}function I8($){return document.getElementById($)}function HQ(){if(!I8("weba-l2-keywrap-tool"))return;let J=I8("kwp-recipient-sk"),Q=I8("kwp-credential-id"),q=I8("kwp-prf-salt"),G=I8("kwp-aad"),X=I8("kwp-kid"),Y=I8("kwp-status"),Z=I8("kwp-output"),U=I8("kwp-generate-salt"),M=I8("kwp-wrap");if(!J||!Q||!q||!Y||!Z||!M)return;U?.addEventListener("click",()=>{let K=new Uint8Array(32);crypto.getRandomValues(K),q.value=C8(K)}),M.addEventListener("click",async()=>{Y.textContent="Waiting for passkey...",M.disabled=!0;try{if(!J.value||!Q.value||!q.value)throw new Error("Missing required fields.");let K=W8(J.value.trim()),C=W8(q.value.trim()),E=await b0(Q.value.trim(),C),V=G?.value?W8(G.value.trim()):void 0,I=await KQ({recipientSk:K,prfKey:E,aad:V}),x={alg:"WebAuthn-PRF-AESGCM-v1",kid:X?.value||"issuer#passkey-1",credential_id:Q.value.trim(),prf_salt:C8(C),wrapped_key:C8(I),...V?{aad:C8(V)}:{}};Z.textContent=JSON.stringify(x,null,2),Y.textContent="Key wrap ready."}catch(K){console.error(K),Y.textContent="Key wrap failed."}finally{M.disabled=!1}})}function TQ(){console.log("Web/A Runtime Booting...");let $=new n0,J=new f$,Q=new x$($,J),q=window,G=document.getElementById("weba-structure");if(G?.textContent)try{q.generatedJsonStructure=JSON.parse(G.textContent)}catch(Z){console.warn("Failed to parse weba structure JSON",Z)}let X=OQ();if(X)q.webaL2Config=X;q.saveDraft=()=>J.saveDraft(),q.submitDocument=()=>J.submitDocument(),q.signAndDownload=()=>J.signAndDownload(),q.clearData=()=>J.clearData(),q.removeTableRow=(Z)=>Q.removeTableRow(Z),q.addTableRow=(Z,U)=>Q.addTableRow(Z,U),q.switchTab=(Z,U)=>Q.switchTab(Z,U),q.recalculate=()=>$.recalculate(),q.escapeHtml=(Z)=>{if(!Z)return"";let U={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return Z.toString().replace(/[&<>"']/g,(M)=>U[M]||M)},J.restoreFromLS(),Q.applyI18n(),Q.initTables(),$.recalculate(),DQ(),HQ();let Y;document.addEventListener("input",(Z)=>{let U=Z.target;if(Z.isTrusted)U.dataset.dirty="true";let M=U.dataset.baseKey||U.dataset.jsonPath;if(M)(U.closest("tr")||document).querySelectorAll(`[data-copy-from="${M}"]`).forEach((E)=>{if(!E.dataset.dirty){if(E.value!==U.value)E.value=U.value,E.dispatchEvent(new Event("input"))}});$.recalculate(),J.updateJsonLd(),clearTimeout(Y),Y=setTimeout(()=>J.saveToLS(),1000)}),console.log("Web/A Runtime Ready.")}class P${suggestionsVisible=!1;activeSearchInput=null;globalBox=null;constructor(){}init(){console.log("Initializing Search Engine (Bundle)...");let $=window;if($.generatedJsonStructure&&$.generatedJsonStructure.masterData){let J=Object.keys($.generatedJsonStructure.masterData);console.log("Master Data Keys available:",J.join(", "))}this.setupEventDelegation()}normalize($){if(!$)return"";let J=$.toString().toLowerCase();return J=J.replace(/[---]/g,(Q)=>{return String.fromCharCode(Q.charCodeAt(0)-65248)}),J=J.replace(/[-]/g,(Q)=>String.fromCharCode(Q.charCodeAt(0)-65248)),J.trim()}clean($){if(!$)return"";let J=this.normalize($);return J=J.replace(/(|||||npo||)/g,""),J=J.replace(/(\(\)|\(\)|\(\))/g,""),J.trim()}toIndex($){let J=parseInt($||"",10);return Number.isFinite(J)?J-1:-1}getGlobalBox(){if(!this.globalBox){if(this.globalBox=document.getElementById("web-a-search-suggestions"),!this.globalBox)this.globalBox=document.createElement("div"),this.globalBox.id="web-a-search-suggestions",this.globalBox.className="search-suggestions",Object.assign(this.globalBox.style,{display:"none",position:"absolute",background:"white",border:"1px solid #ccc",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",zIndex:"9999",maxHeight:"200px",overflowY:"auto",borderRadius:"4px"}),document.body.appendChild(this.globalBox)}return this.globalBox}hideSuggestions(){let $=this.getGlobalBox();if($)$.style.display="none";this.suggestionsVisible=!1,this.activeSearchInput=null}setupEventDelegation(){document.addEventListener("click",($)=>{if(this.suggestionsVisible&&!$.target.closest("#web-a-search-suggestions")&&$.target!==this.activeSearchInput)this.hideSuggestions()}),document.addEventListener("scroll",()=>{if(this.suggestionsVisible)this.hideSuggestions()},!0),document.body.addEventListener("input",($)=>{if($.target.classList.contains("search-input"))this.handleSearchInput($.target)}),document.body.addEventListener("click",($)=>{if($.target.classList.contains("suggestion-item"))this.handleSelection($.target)})}handleSearchInput($){this.activeSearchInput=$;let J=window,Q=$.dataset.masterSrc,q=$.dataset.suggestSource;if(!Q&&!q)return;let G=this.toIndex($.dataset.masterLabelIndex),X=this.toIndex($.dataset.masterValueIndex),Y=$.value;if(!Y){this.hideSuggestions();return}let Z=[],U=this.normalize(Y);if(q==="column"){let M=$.dataset.baseKey,K=$.closest("table");if(K&&M){let C=new Set;K.querySelectorAll(`[data-base-key="${M}"]`).forEach((E)=>{if(E===$)return;let V=E.value;if(V&&this.normalize(V).includes(U)){if(!C.has(V))C.add(V),Z.push({val:V,row:[V],label:V,score:10})}})}}else if(Q){let M=J.generatedJsonStructure.masterData;if(!M||!M[Q])return;M[Q].forEach((C,E)=>{if(E===0)return;if(C.some((I)=>this.normalize(I||"").includes(U))){let I=G>=0?C[G]||"":"",x=X>=0?C[X]||"":"",D=X>=0?x:G>=0?I:C[1]||C[0]||"";Z.push({val:D,row:C,label:I,score:10,idx:E})}})}this.renderSuggestions($,Z,G)}renderSuggestions($,J,Q){if(J.length===0){this.hideSuggestions();return}let q=window,G=J.slice(0,10),X="";G.forEach((K)=>{let C=q.escapeHtml(JSON.stringify(K.row)),E=Q>=0?K.label||K.row.join(" : "):K.row.join(" : ");X+=`<div class="suggestion-item" data-val="${q.escapeHtml(K.val)}" data-row="${C}" style="padding:8px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; color:#333;">${q.escapeHtml(E)}</div>`});let Y=this.getGlobalBox();Y.innerHTML=X;let Z=$.getBoundingClientRect(),U=window.scrollY||document.documentElement.scrollTop,M=window.scrollX||document.documentElement.scrollLeft;Y.style.width=Math.max(Z.width,200)+"px",Y.style.left=Z.left+M+"px",Y.style.top=Z.bottom+U+"px",Y.querySelectorAll(".suggestion-item").forEach((K)=>{K.onmouseenter=()=>K.style.background="#f0f8ff",K.onmouseleave=()=>K.style.background="white"}),Y.style.display="block",this.suggestionsVisible=!0}handleSelection($){if(!this.activeSearchInput)return;let J=window,Q=this.activeSearchInput,q=$.dataset.val||"",G=$.dataset.row||"[]";try{let X=JSON.parse(G),Y=Q.dataset.masterSrc,Z=Y?J.generatedJsonStructure.masterData[Y][0]:[],U=!1;if(Z.length>0&&X.length>0){let M=Q.closest("tr");if(M){let K=Array.from(M.querySelectorAll("input, select, textarea"));Z.forEach((C,E)=>{if(!C)return;let V=X[E];this.fillField(K,C,V,Q,()=>{U=!0})})}}if(!U)Q.value=q,Q.dispatchEvent(new Event("input",{bubbles:!0}))}catch(X){console.error(X)}this.hideSuggestions()}fillField($,J,Q,q,G){let X=this.normalize(J),Y=$.find((Z)=>{let U=Z.dataset.baseKey||Z.dataset.jsonPath,M=this.normalize(Z.getAttribute("placeholder")||"");return U&&this.normalize(U)===X||M===X});if(Y){if(Y.value=Q||"",Y.dispatchEvent(new Event("input",{bubbles:!0})),Y===q)G()}}}var RQ=new P$;window.GlobalSearch=RQ;TQ();RQ.init();
